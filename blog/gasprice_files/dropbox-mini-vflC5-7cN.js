var Prototype={Version:"1.7",Browser:(function(){var b=navigator.userAgent;var a=Object.prototype.toString.call(window.opera)=="[object Opera]";var d=/MSIE\s([\d.]+)/.exec(b);var c=(d&&d.length>1)?parseInt(d[1]):NaN;return{IE:!!window.attachEvent&&!a,Opera:a,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b),IEV:c}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var a=window.Element||window.HTMLElement;return !!(a&&a.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var c=document.createElement("div"),b=document.createElement("form"),a=false;if(c.__proto__&&(c.__proto__!==b.__proto__)){a=true}c=b=null;return a})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",TemplateScriptFilter:/<script type="text\/template"/i,JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var c;for(var b=0,d=arguments.length;b<d;b++){var a=arguments[b];try{c=a();break}catch(f){}}return c}};var Class=(function(){var d=(function(){for(var e in {toString:1}){if(e==="toString"){return false}}return true})();function a(){}function b(){var h=null,g=$A(arguments);if(Object.isFunction(g[0])){h=g.shift()}function e(){this.initialize.apply(this,arguments)}Object.extend(e,Class.Methods);e.superclass=h;e.subclasses=[];if(h){a.prototype=h.prototype;e.prototype=new a;h.subclasses.push(e)}for(var f=0,j=g.length;f<j;f++){e.addMethods(g[f])}if(!e.prototype.initialize){e.prototype.initialize=Prototype.emptyFunction}e.prototype.constructor=e;return e}function c(l){var g=this.superclass&&this.superclass.prototype,f=Object.keys(l);if(d){if(l.toString!=Object.prototype.toString){f.push("toString")}if(l.valueOf!=Object.prototype.valueOf){f.push("valueOf")}}for(var e=0,h=f.length;e<h;e++){var k=f[e],j=l[k];if(g&&Object.isFunction(j)&&j.argumentNames()[0]=="$super"){var m=j;j=(function(n){return function(){return g[n].apply(this,arguments)}})(k).wrap(m);j.valueOf=m.valueOf.bind(m);j.toString=m.toString.bind(m)}this.prototype[k]=j}return this}return{create:b,Methods:{addMethods:c}}})();(function(){var D=Object.prototype.toString,C="Null",p="Undefined",w="Boolean",f="Number",t="String",I="Object",u="[object Function]",z="[object Boolean]",g="[object Number]",m="[object String]",h="[object Array]",y="[object Date]",j=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";function l(K){switch(K){case null:return C;case (void 0):return p}var J=typeof K;switch(J){case"boolean":return w;case"number":return f;case"string":return t}return I}function A(J,L){for(var K in L){J[K]=L[K]}return J}function H(J){try{if(c(J)){return"undefined"}if(J===null){return"null"}return J.inspect?J.inspect():String(J)}catch(K){if(K instanceof RangeError){return"..."}throw K}}function E(J){return G("",{"":J},[])}function G(S,P,Q){var R=P[S],O=typeof R;if(l(R)===I&&typeof R.toJSON==="function"){R=R.toJSON(S)}var L=D.call(R);switch(L){case g:case z:case m:R=R.valueOf()}switch(R){case null:return"null";case true:return"true";case false:return"false"}O=typeof R;switch(O){case"string":return R.inspect(true);case"number":return isFinite(R)?String(R):"null";case"object":for(var K=0,J=Q.length;K<J;K++){if(Q[K]===R){throw new TypeError()}}Q.push(R);var N=[];if(L===h){for(var K=0,J=R.length;K<J;K++){var M=G(K,R,Q);N.push(typeof M==="undefined"?"null":M)}N="["+N.join(",")+"]"}else{var U=Object.keys(R);for(var K=0,J=U.length;K<J;K++){var S=U[K],M=G(S,R,Q);if(typeof M!=="undefined"){N.push(S.inspect(true)+":"+M)}}N="{"+N.join(",")+"}"}Q.pop();return N}}function x(J){return JSON.stringify(J)}function k(J){return $H(J).toQueryString()}function q(J){return J&&J.toHTML?J.toHTML():String.interpret(J)}function s(J){if(l(J)!==I){throw new TypeError()}var K=[];for(var L in J){if(J.hasOwnProperty(L)){K.push(L)}}return K}function d(J){var K=[];for(var L in J){K.push(J[L])}return K}function B(J){return A({},J)}function v(J){return !!(J&&J.nodeType==1)}function n(J){return D.call(J)===h}var b=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(b){n=Array.isArray}function e(J){return J instanceof Hash}function a(J){return D.call(J)===u}function o(J){return D.call(J)===m}function r(J){return D.call(J)===g}function F(J){return D.call(J)===y}function c(J){return typeof J==="undefined"}A(Object,{extend:A,inspect:H,toJSON:j?x:E,toQueryString:k,toHTML:q,keys:Object.keys||s,values:d,clone:B,isElement:v,isArray:n,isHash:e,isFunction:a,isString:o,isNumber:r,isDate:F,isUndefined:c})})();Object.extend(Function.prototype,(function(){var l=Array.prototype.slice;function d(p,m){var o=p.length,n=m.length;while(n--){p[o+n]=m[n]}return p}function j(n,m){n=l.call(n,0);return d(n,m)}function g(){var m=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return m.length==1&&!m[0]?[]:m}function h(o){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var m=this,n=l.call(arguments,1);return function(){var p=j(n,arguments);return m.apply(o,p)}}function f(o){var m=this,n=l.call(arguments,1);return function(q){var p=d([q||window.event],n);return m.apply(o,p)}}function k(){if(!arguments.length){return this}var m=this,n=l.call(arguments,0);return function(){var o=j(n,arguments);return m.apply(this,o)}}function e(o){var m=this,n=l.call(arguments,1);o=o*1000;return window.setTimeout(function(){return m.apply(m,n)},o)}function a(){var m=d([0.01],arguments);return this.delay.apply(this,m)}function c(n){var m=this;return function(){var o=d([m.bind(this)],arguments);return n.apply(this,o)}}function b(){if(this._methodized){return this._methodized}var m=this;return this._methodized=function(){var n=d([this],arguments);return m.apply(null,n)}}return{argumentNames:g,bind:h,bindAsEventListener:f,curry:k,delay:e,defer:a,wrap:c,methodize:b}})());(function(c){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function a(){return this.toISOString()}if(!c.toISOString){c.toISOString=b}if(!c.toJSON){c.toJSON=a}})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(b,a){this.callback=b;this.frequency=a;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=false;throw a}}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){if(!Prototype.TemplateScriptFilter.match(scriptTag)){return(scriptTag.match(matchOne)||["",""])[1]}})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character]}return"\\u00"+character.charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;if(str.blank()){return false}str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.indexOf(pattern)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements)){a=a.toTemplateReplacements()}return this.template.gsub(this.pattern,function(d){if(a==null){return(d[1]+"")}var f=d[1]||"";if(f=="\\"){return d[2]}var b=a,g=d[3],e=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;d=e.exec(g);if(d==null){return f}while(d!=null){var c=d[1].startsWith("[")?d[2].replace(/\\\\]/g,"]"):d[1];b=b[c];if(null==b||""==d[3]){break}g=g.substring("["==d[3]?d[1].length:d[0].length);d=e.exec(g)}return f+String.interpret(b)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function c(z,y){var x=0;try{this._each(function(B){z.call(y,B,x++)})}catch(A){if(A!=$break){throw A}}return this}function s(A,z,y){var x=-A,B=[],C=this.toArray();if(A<1){return C}while((x+=A)<C.length){B.push(C.slice(x,x+A))}return B.collect(z,y)}function b(z,y){z=z||Prototype.K;var x=true;this.each(function(B,A){x=x&&!!z.call(y,B,A);if(!x){throw $break}});return x}function j(z,y){z=z||Prototype.K;var x=false;this.each(function(B,A){if(x=!!z.call(y,B,A)){throw $break}});return x}function k(z,y){z=z||Prototype.K;var x=[];this.each(function(B,A){x.push(z.call(y,B,A))});return x}function u(z,y){var x;this.each(function(B,A){if(z.call(y,B,A)){x=B;throw $break}});return x}function h(z,y){var x=[];this.each(function(B,A){if(z.call(y,B,A)){x.push(B)}});return x}function g(A,z,y){z=z||Prototype.K;var x=[];if(Object.isString(A)){A=new RegExp(RegExp.escape(A))}this.each(function(C,B){if(A.match(C)){x.push(z.call(y,C,B))}});return x}function a(x){if(Object.isFunction(this.indexOf)){if(this.indexOf(x)!=-1){return true}}var y=false;this.each(function(z){if(z==x){y=true;throw $break}});return y}function r(y,x){x=Object.isUndefined(x)?null:x;return this.eachSlice(y,function(z){while(z.length<y){z.push(x)}return z})}function m(x,z,y){this.each(function(B,A){x=z.call(y,x,B,A)});return x}function w(y){var x=$A(arguments).slice(1);return this.map(function(z){return z[y].apply(z,x)})}function q(z,y){z=z||Prototype.K;var x;this.each(function(B,A){B=z.call(y,B,A);if(x==null||B>=x){x=B}});return x}function o(z,y){z=z||Prototype.K;var x;this.each(function(B,A){B=z.call(y,B,A);if(x==null||B<x){x=B}});return x}function e(A,y){A=A||Prototype.K;var z=[],x=[];this.each(function(C,B){(A.call(y,C,B)?z:x).push(C)});return[z,x]}function f(y){var x=[];this.each(function(z){x.push(z[y])});return x}function d(z,y){var x=[];this.each(function(B,A){if(!z.call(y,B,A)){x.push(B)}});return x}function n(y,x){return this.map(function(A,z){return{value:A,criteria:y.call(x,A,z)}}).sort(function(C,B){var A=C.criteria,z=B.criteria;return A<z?-1:A>z?1:0}).pluck("value")}function p(){return this.map()}function t(){var y=Prototype.K,x=$A(arguments);if(Object.isFunction(x.last())){y=x.pop()}var z=[this].concat(x).map($A);return this.map(function(B,A){return y(z.pluck(A))})}function l(){return this.toArray().length}function v(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:c,eachSlice:s,all:b,every:b,any:j,some:j,collect:k,map:k,detect:u,findAll:h,select:h,filter:h,grep:g,include:a,member:a,inGroupsOf:r,inject:m,invoke:w,max:q,min:o,partition:e,pluck:f,reject:d,sortBy:n,toArray:p,entries:p,zip:t,size:l,inspect:v,find:u}})();function $A(c){if(!c){return[]}if("toArray" in Object(c)){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}function $w(a){if(!Object.isString(a)){return[]}a=a.strip();return a?a.split(/\s+/):[]}Array.from=$A;(function(){var s=Array.prototype,n=s.slice,p=s.forEach;function b(x,w){for(var v=0,y=this.length>>>0;v<y;v++){if(v in this){x.call(w,this[v],v,this)}}}if(!p){p=b}function m(){this.length=0;return this}function d(){return this[0]}function g(){return this[this.length-1]}function j(){return this.select(function(v){return v!=null})}function u(){return this.inject([],function(w,v){if(Object.isArray(v)){return w.concat(v.flatten())}w.push(v);return w})}function h(){var v=n.call(arguments,0);return this.select(function(w){return !v.include(w)})}function f(v){return(v===false?this.toArray():this)._reverse()}function l(v){return this.inject([],function(y,x,w){if(0==w||(v?y.last()!=x:!y.include(x))){y.push(x)}return y})}function q(v){return this.uniq().findAll(function(w){return v.detect(function(x){return w===x})})}function r(){return n.call(this,0)}function k(){return this.length}function t(){return"["+this.map(Object.inspect).join(", ")+"]"}function a(x,v){v||(v=0);var w=this.length;if(v<0){v=w+v}for(;v<w;v++){if(this[v]===x){return v}}return -1}function o(w,v){v=isNaN(v)?this.length:(v<0?this.length+v:v)+1;var x=this.slice(0,v).reverse().indexOf(w);return(x<0)?x:v-x-1}function c(){var A=n.call(this,0),y;for(var w=0,x=arguments.length;w<x;w++){y=arguments[w];if(Object.isArray(y)&&!("callee" in y)){for(var v=0,z=y.length;v<z;v++){A.push(y[v])}}else{A.push(y)}}return A}Object.extend(s,Enumerable);if(!s._reverse){s._reverse=s.reverse}Object.extend(s,{_each:p,clear:m,first:d,last:g,compact:j,flatten:u,without:h,reverse:f,uniq:l,intersect:q,clone:r,toArray:r,size:k,inspect:t});var e=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(e){s.concat=c}if(!s.indexOf){s.indexOf=a}if(!s.lastIndexOf){s.lastIndexOf=o}})();function $H(a){return new Hash(a)}var Hash=Class.create(Enumerable,(function(){function e(q){this._object=Object.isHash(q)?q.toObject():Object.clone(q)}function f(r){for(var q in this._object){var s=this._object[q],t=[q,s];t.key=q;t.value=s;r(t)}}function k(q,r){return this._object[q]=r}function c(q){if(this._object[q]!==Object.prototype[q]){return this._object[q]}}function n(q){var r=this._object[q];delete this._object[q];return r}function p(){return Object.clone(this._object)}function o(){return this.pluck("key")}function m(){return this.pluck("value")}function g(r){var q=this.detect(function(s){return s.value===r});return q&&q.key}function j(q){return this.clone().update(q)}function d(q){return new Hash(q).inject(this,function(r,s){r.set(s.key,s.value);return r})}function b(q,r){if(Object.isUndefined(r)){return q}return q+"="+encodeURIComponent(String.interpret(r))}function a(){return this.inject([],function(u,x){var t=encodeURIComponent(x.key),r=x.value;if(r&&typeof r=="object"){if(Object.isArray(r)){var w=[];for(var s=0,q=r.length,v;s<q;s++){v=r[s];w.push(b(t,v))}return u.concat(w)}}else{u.push(b(t,r))}return u}).join("&")}function l(){return"#<Hash:{"+this.map(function(q){return q.map(Object.inspect).join(": ")}).join(", ")+"}>"}function h(){return new Hash(this)}return{initialize:e,_each:f,set:k,get:c,unset:n,toObject:p,toTemplateReplacements:p,keys:o,values:m,index:g,merge:j,update:d,toQueryString:a,inspect:l,toJSON:p,clone:h}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function d(){return this.toPaddedString(2,16)}function b(){return this+1}function h(k,j){$R(0,this,true).each(k,j);return this}function g(l,k){var j=this.toString(k||10);return"0".times(l-j.length)+j}function a(){return Math.abs(this)}function c(){return Math.round(this)}function e(){return Math.ceil(this)}function f(){return Math.floor(this)}return{toColorPart:d,succ:b,times:h,toPaddedString:g,abs:a,round:c,ceil:e,floor:f}})());function $R(c,a,b){return new ObjectRange(c,a,b)}var ObjectRange=Class.create(Enumerable,(function(){function b(f,d,e){this.start=f;this.end=d;this.exclusive=e}function c(d){var e=this.start;while(this.include(e)){d(e);e=e.succ()}}function a(d){if(d<this.start){return false}if(this.exclusive){return d<this.end}return d<=this.end}return{initialize:b,_each:c,include:a}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){if(!this.include(a)){this.responders.push(a)}},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(d,b,c,a){this.each(function(f){if(Object.isFunction(f[d])){try{f[d].apply(f,[b,c,a])}catch(g){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,a){$super(a);this.transport=Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var d=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){d+=(d?"&":"")+"_method="+this.method;this.method="post"}if(d&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+d}this.parameters=d.toQueryParams();try{var a=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.withCredentials){this.transport.withCredentials=true}if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||d):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var e={Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(!this.options.suppress_nonstandard_headers){e["X-Requested-With"]="XMLHttpRequest";e["X-Prototype-Version"]=Prototype.Version}if(this.method=="post"){e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){e.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push)){for(var b=0,d=c.length;b<d;b+=2){e[c[b]]=c[b+1]}}else{$H(c).each(function(f){e[f.key]=f.value})}}for(var a in e){this.transport.setRequestHeader(a,e[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)||a==304},getStatus:function(){try{if(this.transport.status===1223){return 204}return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=Ajax.Request.Events[a],b=new Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(d){this.dispatchException(d)}var f=b.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&f&&f.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+c]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+c,this,b,b.headerJSON)}catch(d){this.dispatchException(d)}if(c=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return !a||(a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(a){try{return this.transport.getResponseHeader(a)||null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(c){this.request=c;var d=this.transport=c.transport,a=this.readyState=d.readyState;if((a>2&&!Prototype.Browser.IE)||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(d.responseText);if(this.request.options.evalJSON){this.headerJSON=this._getHeaderJSON()}}if(a==4){var b=d.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a){return null}a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||(a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,a,c,b){this.container={success:(a.success||a),failure:(a.failure||(a.success?null:a))};b=Object.clone(b);var d=b.onComplete;b.onComplete=(function(e,f){this.updateContent(e.responseText);if(Object.isFunction(d)){d(e,f)}}).bind(this);$super(c,b)},updateContent:function(d){var c=this.container[this.success()?"success":"failure"],a=this.options;if(!a.evalScripts){d=d.stripScripts()}if(c=$(c)){if(a.insertion){if(Object.isString(a.insertion)){var b={};b[a.insertion]=d;c.insert(b)}else{a.insertion(c,d)}}else{c.update(d)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,a,c,b){$super(b);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=a;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){if(this.options.decay){this.decay=(a.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(b){if(arguments.length>1){for(var a=0,d=[],c=arguments.length;a<c;a++){d.push($(arguments[a]))}return d}if(Object.isString(b)){b=document.getElementById(b)}return Element.extend(b)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(f,a){var c=[];var e=document.evaluate(f,$(a)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var b=0,d=e.snapshotLength;b<d;b++){c.push(Element.extend(e.snapshotItem(b)))}return c}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(c){function d(f,e){if(f==="select"){return false}if("type" in e){return false}return true}var b=(function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(f){return false}})();var a=c.Element;c.Element=function(g,f){f=f||{};g=g.toLowerCase();var e=Element.cache;if(b&&f.name){g="<"+g+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(g),f)}if(!e[g]){e[g]=Element.extend(document.createElement(g))}var h=d(g,f)?e[g].cloneNode(false):document.createElement(g);return Element.writeAttribute(h,f)};Object.extend(c.Element,a||{});if(a){c.Element.prototype=a.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(b){var a=b._prototypeUID;if(a){Element.stopObserving(b);b._prototypeUID=void 0;delete Element.Storage[a]}};Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:(function(){var d=(function(){var g=document.createElement("select"),h=true;g.innerHTML='<option value="test">test</option>';if(g.options&&g.options[0]){h=g.options[0].nodeName.toUpperCase()!=="OPTION"}g=null;return h})();var b=(function(){try{var g=document.createElement("table");if(g&&g.tBodies){g.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var j=typeof g.tBodies[0]=="undefined";g=null;return j}}catch(h){return true}})();var a=(function(){try{var g=document.createElement("div");g.innerHTML="<link>";var j=(g.childNodes.length===0);g=null;return j}catch(h){return true}})();var c=d||b||a;var f=(function(){var g=document.createElement("script"),j=false;try{g.appendChild(document.createTextNode(""));j=!g.firstChild||g.firstChild&&g.firstChild.nodeType!==3}catch(h){j=true}g=null;return j})();function e(l,m){l=$(l);var g=Element._purgeElement;var n=l.getElementsByTagName("*"),k=n.length;while(k--){g(n[k])}if(m&&m.toElement){m=m.toElement()}if(Object.isElement(m)){return l.update().insert(m)}m=Object.toHTML(m);var j=l.tagName.toUpperCase();if(j==="SCRIPT"&&f){l.text=m;return l}if(c){if(j in Element._insertionTranslations.tags){while(l.firstChild){l.removeChild(l.firstChild)}Element._getContentFromAnonymousElement(j,m.stripScripts()).each(function(o){l.appendChild(o)})}else{if(a&&Object.isString(m)&&m.indexOf("<link")>-1){while(l.firstChild){l.removeChild(l.firstChild)}var h=Element._getContentFromAnonymousElement(j,m.stripScripts(),true);h.each(function(o){l.appendChild(o)})}else{l.innerHTML=m.stripScripts()}}}else{l.innerHTML=m.stripScripts()}m.evalScripts.bind(m).defer();return l}return e})(),replace:function(b,c){b=$(b);if(c&&c.toElement){c=c.toElement()}else{if(!Object.isElement(c)){c=Object.toHTML(c);var a=b.ownerDocument.createRange();a.selectNode(b);c.evalScripts.bind(c).defer();c=a.createContextualFragment(c.stripScripts())}}b.parentNode.replaceChild(c,b);return b},insert:function(c,e){c=$(c);if(Object.isString(e)||Object.isNumber(e)||Object.isElement(e)||(e&&(e.toElement||e.toHTML))){e={bottom:e}}var d,f,b,g;for(var a in e){d=e[a];a=a.toLowerCase();f=Element._insertionTranslations[a];if(d&&d.toElement){d=d.toElement()}if(Object.isElement(d)){f(c,d);continue}d=Object.toHTML(d);b=((a=="before"||a=="after")?c.parentNode:c).tagName.toUpperCase();g=Element._getContentFromAnonymousElement(b,d.stripScripts());if(a=="top"||a=="after"){g.reverse()}g.each(f.curry(c));d.evalScripts.bind(d).defer()}return c},wrap:function(b,c,a){b=$(b);if(Object.isElement(c)){$(c).writeAttribute(a||{})}else{if(Object.isString(c)){c=new Element(c,a)}else{c=new Element("div",c)}}if(b.parentNode){b.parentNode.replaceChild(c,b)}c.appendChild(b);return c},inspect:function(b){b=$(b);var a="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(f){var e=f.first(),c=f.last(),d=(b[e]||"").toString();if(d){a+=" "+c+"="+d.inspect(true)}});return a+">"},recursivelyCollect:function(a,c,d){a=$(a);d=d||-1;var b=[];while(a=a[c]){if(a.nodeType==1){b.push(Element.extend(a))}if(b.length==d){break}}return b},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){a=$(a).firstChild;while(a&&a.nodeType!=1){a=a.nextSibling}return $(a)},immediateDescendants:function(b){var a=[],c=$(b).firstChild;while(c){if(c.nodeType===1){a.push(Element.extend(c))}c=c.nextSibling}return a},previousSiblings:function(a,b){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(b,a){b=$(b);if(Object.isString(a)){return Prototype.Selector.match(b,a)}return a.match(b)},up:function(b,d,a){b=$(b);if(arguments.length==1){return $(b.parentNode)}var c=Element.ancestors(b);return Object.isNumber(d)?c[d]:Prototype.Selector.find(c,d,a)},down:function(b,c,a){b=$(b);if(arguments.length==1){return Element.firstDescendant(b)}return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[a||0]},previous:function(b,c,a){b=$(b);if(Object.isNumber(c)){a=c,c=false}if(!Object.isNumber(a)){a=0}if(c){return Prototype.Selector.find(b.previousSiblings(),c,a)}else{return b.recursivelyCollect("previousSibling",a+1)[a]}},next:function(b,d,a){b=$(b);if(Object.isNumber(d)){a=d,d=false}if(!Object.isNumber(a)){a=0}if(d){return Prototype.Selector.find(b.nextSiblings(),d,a)}else{var c=Object.isNumber(a)?a+1:1;return b.recursivelyCollect("nextSibling",a+1)[a]}},select:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){a=$(a);var b=Element.readAttribute(a,"id");if(b){return b}do{b="anonymous_element_"+Element.idCounter++}while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(c,a){c=$(c);if(Prototype.Browser.IE){var b=Element._attributeTranslations.read;if(b.values[a]){return b.values[a](c,a)}if(b.names[a]){a=b.names[a]}if(a.include(":")){return(!c.attributes||!c.attributes[a])?null:c.attributes[a].value}}return c.getAttribute(a)},writeAttribute:function(e,c,f){e=$(e);var b={},d=Element._attributeTranslations.write;if(typeof c=="object"){b=c}else{b[c]=Object.isUndefined(f)?true:f}for(var a in b){c=d.names[a]||a;f=b[a];if(d.values[a]){c=d.values[a](e,f)}if(f===false||f===null){e.removeAttribute(c)}else{if(f===true){e.setAttribute(c,c)}else{e.setAttribute(c,f)}}}return e},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a))){return}var c=a.className;return(c.length>0&&(c==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)))},addClassName:function(a,b){if(!(a=$(a))){return}if(!Element.hasClassName(a,b)){a.className+=(a.className?" ":"")+b}return a},removeClassName:function(a,b){if(!(a=$(a))){return}a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a},toggleClassName:function(a,b){if(!(a=$(a))){return}return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(b){b=$(b);var c=b.firstChild;while(c){var a=c.nextSibling;if(c.nodeType==3&&!/\S/.test(c.nodeValue)){b.removeChild(c)}c=a}return b},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(b,a){b=$(b),a=$(a);if(b.compareDocumentPosition){return(b.compareDocumentPosition(a)&8)===8}if(a.contains){return a.contains(b)&&a!==b}while(b=b.parentNode){if(b==a){return true}}return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];if(!d||d=="auto"){var a=document.defaultView.getComputedStyle(b,null);d=a?a[c]:null}if(c=="opacity"){return d?parseFloat(d):1}return d=="auto"?null:d},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(b,c){b=$(b);var e=b.style,a;if(Object.isString(c)){b.style.cssText+=";"+c;return c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var d in c){if(d=="opacity"){b.setOpacity(c[d])}else{e[(d=="float"||d=="cssFloat")?(Object.isUndefined(e.styleFloat)?"cssFloat":"styleFloat"):d]=c[d]}}return b},setOpacity:function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;return a},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow){return a}a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden"){a.style.overflow="hidden"}return a},undoClipping:function(a){a=$(a);if(!a._overflow){return a}a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(d,b,c){switch(c){case"height":case"width":if(!Element.visible(b)){return null}var e=parseInt(d(b,c),10);if(e!==b["offset"+c.capitalize()]){return e+"px"}var a;if(c==="height"){a=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{a=["border-left-width","padding-left","padding-right","border-right-width"]}return a.inject(e,function(f,g){var h=d(b,g);return h===null?f:f-parseInt(h,10)})+"px";default:return d(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(c,a,b){if(b==="title"){return a.title}return c(a,b)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(a,b){a=$(a);b=(b=="float"||b=="cssFloat")?"styleFloat":b.camelize();var c=a.style[b];if(!c&&a.currentStyle){c=a.currentStyle[b]}if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(c[1]){return parseFloat(c[1])/100}}return 1}if(c=="auto"){if((b=="width"||b=="height")&&(a.getStyle("display")!="none")){return a["offset"+b.capitalize()]+"px"}return null}return c};Element.Methods.setOpacity=function(b,e){function f(g){g=g||"";return g.replace(/alpha\([^\)]*\)/gi,"")}b=$(b);var a=b.currentStyle;if((a&&!a.hasLayout)||(!a&&b.style.zoom=="normal")){b.style.zoom=1}var d=b.getStyle("filter"),c=b.style;if(e==1||e===""){(d=f(d))?c.filter=d:c.removeAttribute("filter");return b}else{if(e<0.00001){e=0}}c.filter=f(d)+"alpha(opacity="+(e*100)+")";return b};Element._attributeTranslations=(function(){var b="className",a="for",c=document.createElement("div");c.setAttribute(b,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x"){b="class"}}c=null;c=document.createElement("label");c.setAttribute(a,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");if(c.htmlFor==="x"){a="htmlFor"}}c=null;return{read:{names:{"class":b,className:b,"for":a,htmlFor:a},values:{_getAttr:function(d,e){return d.getAttribute(e)},_getAttr2:function(d,e){return d.getAttribute(e,2)},_getAttrNode:function(d,f){var e=d.getAttributeNode(f);return e?e.value:""},_getEv:(function(){var d=document.createElement("div"),g;d.onclick=Prototype.emptyFunction;var e=d.getAttribute("onclick");if(String(e).indexOf("{")>-1){g=function(f,h){h=f.getAttribute(h);if(!h){return null}h=h.toString();h=h.split("{")[1];h=h.split("}")[0];return h.strip()}}else{if(e===""){g=function(f,h){h=f.getAttribute(h);if(!h){return null}return h.strip()}}}d=null;return g})(),_flag:function(d,e){return $(d).hasAttribute(e)?e:null},style:function(d){return d.style.cssText.toLowerCase()},title:function(d){return d.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function a(e){var b=e.getElementsByTagName("*"),d=[];for(var c=0,f;f=b[c];c++){if(f.tagName!=="!"){d.push(f)}}return d}Element.Methods.down=function(c,d,b){c=$(c);if(arguments.length==1){return c.firstDescendant()}return Object.isNumber(d)?a(c)[d]:Element.select(c,d)[b||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1)?0.999999:(b==="")?"":(b<0.00001)?0:b;return a}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;if(b==1){if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else{try{var d=document.createTextNode(" ");a.appendChild(d);a.removeChild(d)}catch(c){}}}return a}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(c,e){c=$(c);if(e&&e.toElement){e=e.toElement()}if(Object.isElement(e)){c.parentNode.replaceChild(e,c);return c}e=Object.toHTML(e);var d=c.parentNode,b=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[b]){var f=c.next(),a=Element._getContentFromAnonymousElement(b,e.stripScripts());d.removeChild(c);if(f){a.each(function(g){d.insertBefore(g,f)})}else{a.each(function(g){d.appendChild(g)})}}else{c.outerHTML=e.stripScripts()}e.evalScripts.bind(e).defer();return c}}Element._returnOffset=function(b,c){var a=[b,c];a.left=b;a.top=c;return a};Element._getContentFromAnonymousElement=function(e,d,f){var g=new Element("div"),c=Element._insertionTranslations.tags[e];var a=false;if(c){a=true}else{if(f){a=true;c=["","",0]}}if(a){g.innerHTML="&nbsp;"+c[0]+d+c[1];g.removeChild(g.firstChild);for(var b=c[2];b--;){g=g.firstChild}}else{g.innerHTML=d}return $A(g.childNodes)};Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,c){c=Element._attributeTranslations.has[c]||c;var b=$(a).getAttributeNode(c);return !!(b&&b.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}a=null})(document.createElement("div"));Element.extend=(function(){function c(g){if(typeof window.Element!="undefined"){var j=window.Element.prototype;if(j){var l="_"+(Math.random()+"").slice(2),h=document.createElement(g);j[l]="x";var k=(h[l]!=="x");delete j[l];h=null;return k}}return false}function b(h,g){for(var k in g){var j=g[k];if(Object.isFunction(j)&&!(k in h)){h[k]=j.methodize()}}}var d=c("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(d){return function(h){if(h&&typeof h._extendedByPrototype=="undefined"){var g=h.tagName;if(g&&(/^(?:object|applet|embed)$/i.test(g))){b(h,Element.Methods);b(h,Element.Methods.Simulated);b(h,Element.Methods.ByTag[g.toUpperCase()])}}return h}}return Prototype.K}var a={},e=Element.Methods.ByTag;var f=Object.extend(function(j){if(!j||typeof j._extendedByPrototype!="undefined"||j.nodeType!=1||j==window){return j}var g=Object.clone(a),h=j.tagName.toUpperCase();if(e[h]){Object.extend(g,e[h])}b(j,g);j._extendedByPrototype=Prototype.emptyFunction;return j},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(a,Element.Methods);Object.extend(a,Element.Methods.Simulated)}}});f.refresh();return f})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(a,b){return a.hasAttribute(b)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(c){var j=Prototype.BrowserFeatures,d=Element.Methods.ByTag;if(!c){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var b=c;c=arguments[1]}if(!b){Object.extend(Element.Methods,c||{})}else{if(Object.isArray(b)){b.each(g)}else{g(b)}}function g(l){l=l.toUpperCase();if(!Element.Methods.ByTag[l]){Element.Methods.ByTag[l]={}}Object.extend(Element.Methods.ByTag[l],c)}function a(n,m,l){l=l||false;for(var p in n){var o=n[p];if(!Object.isFunction(o)){continue}if(!l||!(p in m)){m[p]=o.methodize()}}}function e(o){var l;var n={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(n[o]){l="HTML"+n[o]+"Element"}if(window[l]){return window[l]}l="HTML"+o+"Element";if(window[l]){return window[l]}l="HTML"+o.capitalize()+"Element";if(window[l]){return window[l]}var m=document.createElement(o),p=m.__proto__||m.constructor.prototype;m=null;return p}var h=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(j.ElementExtensions){a(Element.Methods,h);a(Element.Methods.Simulated,h,true)}if(j.SpecificElementExtensions){for(var k in Element.Methods.ByTag){var f=e(k);if(Object.isUndefined(f)){continue}a(d[k],f.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(b){var g=Prototype.Browser,e=document,c,d={};function a(){if(g.WebKit&&!e.evaluate){return document}if(g.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function f(h){if(!c){c=a()}d[h]="client"+h;b["get"+h]=function(){return c[d[h]]};return b["get"+h]()}b.getWidth=f.curry("Width");b.getHeight=f.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(b){if(!(b=$(b))){return}var a;if(b===window){a=0}else{if(typeof b._prototypeUID==="undefined"){b._prototypeUID=Element.Storage.UID++}a=b._prototypeUID}if(!Element.Storage[a]){Element.Storage[a]=$H()}return Element.Storage[a]},store:function(b,a,c){if(!(b=$(b))){return}if(arguments.length===2){Element.getStorage(b).update(a)}else{Element.getStorage(b).set(a,c)}return b},retrieve:function(c,b,a){if(!(c=$(c))){return}var e=Element.getStorage(c),d=e.get(b);if(Object.isUndefined(d)){e.set(b,a);d=a}return d},clone:function(c,a){if(!(c=$(c))){return}var e=c.cloneNode(a);e._prototypeUID=void 0;if(a){var d=Element.select(e,"*"),b=d.length;while(b--){d[b]._prototypeUID=void 0}}return Element.extend(e)},purge:function(c){if(!(c=$(c))){return}var a=Element._purgeElement;a(c);var d=c.getElementsByTagName("*"),b=d.length;while(b--){a(d[b])}return null}});(function(){function h(w){var v=w.match(/^(\d+)%?$/i);if(!v){return null}return(Number(v[1])/100)}function p(G,H,w){var z=null;if(Object.isElement(G)){z=G;G=z.getStyle(H)}if(G===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(G)){return window.parseFloat(G)}var B=G.include("%"),x=(w===document.viewport);if(/\d/.test(G)&&z&&z.runtimeStyle&&!(B&&x)){var v=z.style.left,F=z.runtimeStyle.left;z.runtimeStyle.left=z.currentStyle.left;z.style.left=G||0;G=z.style.pixelLeft;z.style.left=v;z.runtimeStyle.left=F;return G}if(z&&B){w=w||z.parentNode;var y=h(G);var C=null;var A=z.getStyle("position");var E=H.include("left")||H.include("right")||H.include("width");var D=H.include("top")||H.include("bottom")||H.include("height");if(w===document.viewport){if(E){C=document.viewport.getWidth()}else{if(D){C=document.viewport.getHeight()}}}else{if(E){C=$(w).measure("width")}else{if(D){C=$(w).measure("height")}}}return(C===null)?0:C*y}return 0}function g(v){if(Object.isString(v)&&v.endsWith("px")){return v}return v+"px"}function k(w){var v=w;while(w&&w.parentNode){var x=w.getStyle("display");if(x==="none"){return false}w=$(w.parentNode)}return true}var d=Prototype.K;if("currentStyle" in document.documentElement){d=function(v){if(!v.currentStyle.hasLayout){v.style.zoom=1}return v}}function f(v){if(v.include("border")){v=v+"-width"}return v.camelize()}Element.Layout=Class.create(Hash,{initialize:function($super,w,v){$super();this.element=$(w);Element.Layout.PROPERTIES.each(function(x){this._set(x,null)},this);if(v){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(w,v){return Hash.prototype.set.call(this,w,v)},set:function(w,v){throw"Properties of Element.Layout are read-only."},get:function($super,w){var v=$super(w);return v===null?this._compute(w):v},_begin:function(){if(this._prepared){return}var z=this.element;if(k(z)){this._prepared=true;return}var B={position:z.style.position||"",width:z.style.width||"",visibility:z.style.visibility||"",display:z.style.display||""};z.store("prototype_original_styles",B);var C=z.getStyle("position"),v=z.getStyle("width");if(v==="0px"||v===null){z.style.display="block";v=z.getStyle("width")}var w=(C==="fixed")?document.viewport:z.parentNode;z.setStyle({position:"absolute",visibility:"hidden",display:"block"});var x=z.getStyle("width");var y;if(v&&(x===v)){y=p(z,"width",w)}else{if(C==="absolute"||C==="fixed"){y=p(z,"width",w)}else{var D=z.parentNode,A=$(D).getLayout();y=A.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}z.setStyle({width:y+"px"});this._prepared=true},_end:function(){var w=this.element;var v=w.retrieve("prototype_original_styles");w.store("prototype_original_styles",null);w.setStyle(v);this._prepared=false},_compute:function(w){var v=Element.Layout.COMPUTATIONS;if(!(w in v)){throw"Property not found."}return this._set(w,v[w].call(this,this.element))},toObject:function(){var v=$A(arguments);var w=(v.length===0)?Element.Layout.PROPERTIES:v.join(" ").split(" ");var x={};w.each(function(y){if(!Element.Layout.PROPERTIES.include(y)){return}var z=this.get(y);if(z!=null){x[y]=z}},this);return x},toHash:function(){var v=this.toObject.apply(this,arguments);return new Hash(v)},toCSS:function(){var v=$A(arguments);var x=(v.length===0)?Element.Layout.PROPERTIES:v.join(" ").split(" ");var w={};x.each(function(y){if(!Element.Layout.PROPERTIES.include(y)){return}if(Element.Layout.COMPOSITE_PROPERTIES.include(y)){return}var z=this.get(y);if(z!=null){w[f(y)]=z+"px"}},this);return w},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(x){if(!this._preComputing){this._begin()}var v=this.get("border-box-height");if(v<=0){if(!this._preComputing){this._end()}return 0}var y=this.get("border-top"),w=this.get("border-bottom");var A=this.get("padding-top"),z=this.get("padding-bottom");if(!this._preComputing){this._end()}return v-y-w-A-z},width:function(x){if(!this._preComputing){this._begin()}var w=this.get("border-box-width");if(w<=0){if(!this._preComputing){this._end()}return 0}var A=this.get("border-left"),v=this.get("border-right");var y=this.get("padding-left"),z=this.get("padding-right");if(!this._preComputing){this._end()}return w-A-v-y-z},"padding-box-height":function(w){var v=this.get("height"),y=this.get("padding-top"),x=this.get("padding-bottom");return v+y+x},"padding-box-width":function(v){var w=this.get("width"),x=this.get("padding-left"),y=this.get("padding-right");return w+x+y},"border-box-height":function(w){if(!this._preComputing){this._begin()}var v=w.offsetHeight;if(!this._preComputing){this._end()}return v},"border-box-width":function(v){if(!this._preComputing){this._begin()}var w=v.offsetWidth;if(!this._preComputing){this._end()}return w},"margin-box-height":function(w){var v=this.get("border-box-height"),x=this.get("margin-top"),y=this.get("margin-bottom");if(v<=0){return 0}return v+x+y},"margin-box-width":function(x){var w=this.get("border-box-width"),y=this.get("margin-left"),v=this.get("margin-right");if(w<=0){return 0}return w+y+v},top:function(v){var w=v.positionedOffset();return w.top},bottom:function(v){var y=v.positionedOffset(),w=v.getOffsetParent(),x=w.measure("height");var z=this.get("border-box-height");return x-z-y.top},left:function(v){var w=v.positionedOffset();return w.left},right:function(x){var z=x.positionedOffset(),y=x.getOffsetParent(),v=y.measure("width");var w=this.get("border-box-width");return v-w-z.left},"padding-top":function(v){return p(v,"paddingTop")},"padding-bottom":function(v){return p(v,"paddingBottom")},"padding-left":function(v){return p(v,"paddingLeft")},"padding-right":function(v){return p(v,"paddingRight")},"border-top":function(v){return p(v,"borderTopWidth")},"border-bottom":function(v){return p(v,"borderBottomWidth")},"border-left":function(v){return p(v,"borderLeftWidth")},"border-right":function(v){return p(v,"borderRightWidth")},"margin-top":function(v){return p(v,"marginTop")},"margin-bottom":function(v){return p(v,"marginBottom")},"margin-left":function(v){return p(v,"marginLeft")},"margin-right":function(v){return p(v,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(w){var x=d(w.getOffsetParent());var y=w.getBoundingClientRect(),v=x.getBoundingClientRect();return(v.right-y.right).round()},bottom:function(w){var x=d(w.getOffsetParent());var y=w.getBoundingClientRect(),v=x.getBoundingClientRect();return(v.bottom-y.bottom).round()}})}Element.Offset=Class.create({initialize:function(w,v){this.left=w.round();this.top=v.round();this[0]=this.left;this[1]=this.top},relativeTo:function(v){return new Element.Offset(this.left-v.left,this.top-v.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function s(w,v){return new Element.Layout(w,v)}function b(v,w){return $(v).getLayout().get(w)}function o(w){w=$(w);var A=Element.getStyle(w,"display");if(A&&A!=="none"){return{width:w.offsetWidth,height:w.offsetHeight}}var x=w.style;var v={visibility:x.visibility,position:x.position,display:x.display};var z={visibility:"hidden",display:"block"};if(v.position!=="fixed"){z.position="absolute"}Element.setStyle(w,z);var y={width:w.offsetWidth,height:w.offsetHeight};Element.setStyle(w,v);return y}function m(v){v=$(v);if(e(v)||c(v)||n(v)||l(v)){return $(document.body)}var w=(Element.getStyle(v,"display")==="inline");if(!w&&v.offsetParent&&!Prototype.Browser.IE){return $(v.offsetParent)}while((v=v.parentNode)&&v!==document.body){if(Element.getStyle(v,"position")!=="static"){return l(v)?$(document.body):$(v)}}return $(document.body)}function u(w){w=$(w);var v=0,x=0;if(w.parentNode){do{v+=w.offsetTop||0;x+=w.offsetLeft||0;w=w.offsetParent}while(w)}return new Element.Offset(x,v)}function q(w){w=$(w);var x=w.getLayout();var v=0,z=0;do{v+=w.offsetTop||0;z+=w.offsetLeft||0;w=w.offsetParent;if(w){if(n(w)){break}var y=Element.getStyle(w,"position");if(y!=="static"){break}}}while(w);z-=x.get("margin-top");v-=x.get("margin-left");return new Element.Offset(z,v)}function a(w){var v=0,x=0;do{v+=w.scrollTop||0;x+=w.scrollLeft||0;w=w.parentNode}while(w);return new Element.Offset(x,v)}function t(z){w=$(w);var v=0,y=0,x=document.body;var w=z;do{v+=w.offsetTop||0;y+=w.offsetLeft||0;if(w.offsetParent==x&&Element.getStyle(w,"position")=="absolute"){break}}while(w=w.offsetParent);w=z;do{if(w!=x){v-=w.scrollTop||0;y-=w.scrollLeft||0}}while(w=w.parentNode);return new Element.Offset(y,v)}function r(v){v=$(v);if(Element.getStyle(v,"position")==="absolute"){return v}var z=m(v);var y=v.viewportOffset(),w=z.viewportOffset();var A=y.relativeTo(w);var x=v.getLayout();v.store("prototype_absolutize_original_styles",{left:v.getStyle("left"),top:v.getStyle("top"),width:v.getStyle("width"),height:v.getStyle("height")});v.setStyle({position:"absolute",top:A.top+"px",left:A.left+"px",width:x.get("width")+"px",height:x.get("height")+"px"});return v}function j(w){w=$(w);if(Element.getStyle(w,"position")==="relative"){return w}var v=w.retrieve("prototype_absolutize_original_styles");if(v){w.setStyle(v)}return w}if(Prototype.Browser.IE){m=m.wrap(function(x,w){w=$(w);if(e(w)||c(w)||n(w)||l(w)){return $(document.body)}var v=w.getStyle("position");if(v!=="static"){return x(w)}w.setStyle({position:"relative"});var y=x(w);w.setStyle({position:v});return y});q=q.wrap(function(y,w){w=$(w);if(!w.parentNode){return new Element.Offset(0,0)}var v=w.getStyle("position");if(v!=="static"){return y(w)}var x=w.getOffsetParent();if(x&&x.getStyle("position")==="fixed"){d(x)}w.setStyle({position:"relative"});var z=y(w);w.setStyle({position:v});return z})}else{if(Prototype.Browser.Webkit){u=function(w){w=$(w);var v=0,x=0;do{v+=w.offsetTop||0;x+=w.offsetLeft||0;if(w.offsetParent==document.body){if(Element.getStyle(w,"position")=="absolute"){break}}w=w.offsetParent}while(w);return new Element.Offset(x,v)}}}Element.addMethods({getLayout:s,measure:b,getDimensions:o,getOffsetParent:m,cumulativeOffset:u,positionedOffset:q,cumulativeScrollOffset:a,viewportOffset:t,absolutize:r,relativize:j});function n(v){return v.nodeName.toUpperCase()==="BODY"}function l(v){return v.nodeName.toUpperCase()==="HTML"}function e(v){return v.nodeType===Node.DOCUMENT_NODE}function c(v){return v!==document.body&&!Element.descendantOf(v,document.body)}if("getBoundingClientRect" in document.documentElement){Element.addMethods({viewportOffset:function(v){v=$(v);if(c(v)){return new Element.Offset(0,0)}var w=v.getBoundingClientRect(),x=document.documentElement;return new Element.Offset(w.left-x.clientLeft,w.top-x.clientTop)}})}})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};Prototype.Selector=(function(){function a(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function c(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function d(l,m,h){h=h||0;var g=Prototype.Selector.match,k=l.length,f=0,j;for(j=0;j<k;j++){if(g(l[j],m)&&h==f++){return Element.extend(l[j])}}}function e(h){for(var f=0,g=h.length;f<g;f++){Element.extend(h[f])}return h}var b=Prototype.K;return{select:a,match:c,find:d,extendElements:(Element.extend===b)?b:e,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,k=0,d=Object.prototype.toString,p=false,j=true;[0,0].sort(function(){j=false;return 0});var b=function(F,v,C,x){C=C||[];var e=v=v||document;if(v.nodeType!==1&&v.nodeType!==9){return[]}if(!F||typeof F!=="string"){return C}var D=[],E,A,J,I,B,u,t=true,y=q(v),H=F;while((r.exec(""),E=r.exec(H))!==null){H=E[3];D.push(E[1]);if(E[2]){u=E[3];break}}if(D.length>1&&l.exec(F)){if(D.length===2&&f.relative[D[0]]){A=g(D[0]+D[1],v)}else{A=f.relative[D[0]]?[v]:b(D.shift(),v);while(D.length){F=D.shift();if(f.relative[F]){F+=D.shift()}A=g(F,A)}}}else{if(!x&&D.length>1&&v.nodeType===9&&!y&&f.match.ID.test(D[0])&&!f.match.ID.test(D[D.length-1])){var K=b.find(D.shift(),v,y);v=K.expr?b.filter(K.expr,K.set)[0]:K.set[0]}if(v){var K=x?{expr:D.pop(),set:a(x)}:b.find(D.pop(),D.length===1&&(D[0]==="~"||D[0]==="+")&&v.parentNode?v.parentNode:v,y);A=K.expr?b.filter(K.expr,K.set):K.set;if(D.length>0){J=a(A)}else{t=false}while(D.length){var w=D.pop(),z=w;if(!f.relative[w]){w=""}else{z=D.pop()}if(z==null){z=v}f.relative[w](J,z,y)}}else{J=D=[]}}if(!J){J=A}if(!J){throw"Syntax error, unrecognized expression: "+(w||F)}if(d.call(J)==="[object Array]"){if(!t){C.push.apply(C,J)}else{if(v&&v.nodeType===1){for(var G=0;J[G]!=null;G++){if(J[G]&&(J[G]===true||J[G].nodeType===1&&h(v,J[G]))){C.push(A[G])}}}else{for(var G=0;J[G]!=null;G++){if(J[G]&&J[G].nodeType===1){C.push(A[G])}}}}}else{a(J,C)}if(u){b(u,e,C,x);b.uniqueSort(C)}return C};b.uniqueSort=function(t){if(c){p=j;t.sort(c);if(p){for(var e=1;e<t.length;e++){if(t[e]===t[e-1]){t.splice(e--,1)}}}}return t};b.matches=function(e,t){return b(e,null,null,t)};b.find=function(z,e,A){var y,w;if(!z){return[]}for(var v=0,u=f.order.length;v<u;v++){var x=f.order[v],w;if((w=f.leftMatch[x].exec(z))){var t=w[1];w.splice(1,1);if(t.substr(t.length-1)!=="\\"){w[1]=(w[1]||"").replace(/\\/g,"");y=f.find[x](w,e,A);if(y!=null){z=z.replace(f.match[x],"");break}}}}if(!y){y=e.getElementsByTagName("*")}return{set:y,expr:z}};b.filter=function(C,B,F,v){var u=C,H=[],z=B,x,e,y=B&&B[0]&&q(B[0]);while(C&&B.length){for(var A in f.filter){if((x=f.match[A].exec(C))!=null){var t=f.filter[A],G,E;e=false;if(z==H){H=[]}if(f.preFilter[A]){x=f.preFilter[A](x,z,F,H,v,y);if(!x){e=G=true}else{if(x===true){continue}}}if(x){for(var w=0;(E=z[w])!=null;w++){if(E){G=t(E,x,w,z);var D=v^!!G;if(F&&G!=null){if(D){e=true}else{z[w]=false}}else{if(D){H.push(E);e=true}}}}}if(G!==undefined){if(!F){z=H}C=C.replace(f.match[A],"");if(!e){return[]}break}}}if(C==u){if(e==null){throw"Syntax error, unrecognized expression: "+C}else{break}}u=C}return z};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(z,e,y){var w=typeof e==="string",A=w&&!/\W/.test(e),x=w&&!A;if(A&&!y){e=e.toUpperCase()}for(var v=0,u=z.length,t;v<u;v++){if((t=z[v])){while((t=t.previousSibling)&&t.nodeType!==1){}z[v]=x||t&&t.nodeName===e?t||false:t===e}}if(x){b.filter(e,z,true)}},">":function(y,t,z){var w=typeof t==="string";if(w&&!/\W/.test(t)){t=z?t:t.toUpperCase();for(var u=0,e=y.length;u<e;u++){var x=y[u];if(x){var v=x.parentNode;y[u]=v.nodeName===t?v:false}}}else{for(var u=0,e=y.length;u<e;u++){var x=y[u];if(x){y[u]=w?x.parentNode:x.parentNode===t}}if(w){b.filter(t,y,true)}}},"":function(v,t,x){var u=k++,e=s;if(!/\W/.test(t)){var w=t=x?t:t.toUpperCase();e=o}e("parentNode",t,u,v,w,x)},"~":function(v,t,x){var u=k++,e=s;if(typeof t==="string"&&!/\W/.test(t)){var w=t=x?t:t.toUpperCase();e=o}e("previousSibling",t,u,v,w,x)}},find:{ID:function(t,u,v){if(typeof u.getElementById!=="undefined"&&!v){var e=u.getElementById(t[1]);return e?[e]:[]}},NAME:function(u,x,y){if(typeof x.getElementsByName!=="undefined"){var t=[],w=x.getElementsByName(u[1]);for(var v=0,e=w.length;v<e;v++){if(w[v].getAttribute("name")===u[1]){t.push(w[v])}}return t.length===0?null:t}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(v,t,u,e,y,z){v=" "+v[1].replace(/\\/g,"")+" ";if(z){return v}for(var w=0,x;(x=t[w])!=null;w++){if(x){if(y^(x.className&&(" "+x.className+" ").indexOf(v)>=0)){if(!u){e.push(x)}}else{if(u){t[w]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(t,e){for(var u=0;e[u]===false;u++){}return e[u]&&q(e[u])?t[1]:t[1].toUpperCase()},CHILD:function(e){if(e[1]=="nth"){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]=="even"&&"2n"||e[2]=="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(t[1]+(t[2]||1))-0;e[3]=t[3]-0}e[0]=k++;return e},ATTR:function(w,t,u,e,x,y){var v=w[1].replace(/\\/g,"");if(!y&&f.attrMap[v]){w[1]=f.attrMap[v]}if(w[2]==="~="){w[4]=" "+w[4]+" "}return w},PSEUDO:function(w,t,u,e,x){if(w[1]==="not"){if((r.exec(w[3])||"").length>1||/^\w/.test(w[3])){w[3]=b(w[3],null,null,t)}else{var v=b.filter(w[3],t,u,true^x);if(!u){e.push.apply(e,v)}return false}}else{if(f.match.POS.test(w[0])||f.match.CHILD.test(w[0])){return true}}return w},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(u,t,e){return !!b(e[3],u).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toUpperCase()==="BUTTON"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(t,e){return e===0},last:function(u,t,e,v){return t===v.length-1},even:function(t,e){return e%2===0},odd:function(t,e){return e%2===1},lt:function(u,t,e){return t<e[3]-0},gt:function(u,t,e){return t>e[3]-0},nth:function(u,t,e){return e[3]-0==t},eq:function(u,t,e){return e[3]-0==t}},filter:{PSEUDO:function(y,u,v,z){var t=u[1],w=f.filters[t];if(w){return w(y,v,u,z)}else{if(t==="contains"){return(y.textContent||y.innerText||"").indexOf(u[3])>=0}else{if(t==="not"){var x=u[3];for(var v=0,e=x.length;v<e;v++){if(x[v]===y){return false}}return true}}}},CHILD:function(e,v){var y=v[1],t=e;switch(y){case"only":case"first":while((t=t.previousSibling)){if(t.nodeType===1){return false}}if(y=="first"){return true}t=e;case"last":while((t=t.nextSibling)){if(t.nodeType===1){return false}}return true;case"nth":var u=v[2],B=v[3];if(u==1&&B==0){return true}var x=v[0],A=e.parentNode;if(A&&(A.sizcache!==x||!e.nodeIndex)){var w=0;for(t=A.firstChild;t;t=t.nextSibling){if(t.nodeType===1){t.nodeIndex=++w}}A.sizcache=x}var z=e.nodeIndex-B;if(u==0){return z==0}else{return(z%u==0&&z/u>=0)}}},ID:function(t,e){return t.nodeType===1&&t.getAttribute&&t.getAttribute("id")===e},TAG:function(t,e){return(e==="*"&&t.nodeType===1)||t.nodeName===e},CLASS:function(t,e){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(x,v){var u=v[1],e=f.attrHandle[u]?f.attrHandle[u](x):x[u]!=null?x[u]:x.getAttribute(u),y=e+"",w=v[2],t=v[4];return e==null?w==="!=":w==="="?y===t:w==="*="?y.indexOf(t)>=0:w==="~="?(" "+y+" ").indexOf(t)>=0:!t?y&&e!==false:w==="!="?y!=t:w==="^="?y.indexOf(t)===0:w==="$="?y.substr(y.length-t.length)===t:w==="|="?y===t||y.substr(0,t.length+1)===t+"-":false},POS:function(w,t,u,x){var e=t[2],v=f.setFilters[e];if(v){return v(w,u,t,x)}}}};var l=f.match.POS;for(var n in f.match){f.match[n]=new RegExp(f.match[n].source+/(?![^\[]*\])(?![^\(]*\))/.source);f.leftMatch[n]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[n].source)}var a=function(t,e){t=Array.prototype.slice.call(t,0);if(e){e.push.apply(e,t);return e}return t};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(m){a=function(w,v){var t=v||[];if(d.call(w)==="[object Array]"){Array.prototype.push.apply(t,w)}else{if(typeof w.length==="number"){for(var u=0,e=w.length;u<e;u++){t.push(w[u])}}else{for(var u=0;w[u];u++){t.push(w[u])}}}return t}}var c;if(document.documentElement.compareDocumentPosition){c=function(t,e){if(!t.compareDocumentPosition||!e.compareDocumentPosition){if(t==e){p=true}return 0}var u=t.compareDocumentPosition(e)&4?-1:t===e?0:1;if(u===0){p=true}return u}}else{if("sourceIndex" in document.documentElement){c=function(t,e){if(!t.sourceIndex||!e.sourceIndex){if(t==e){p=true}return 0}var u=t.sourceIndex-e.sourceIndex;if(u===0){p=true}return u}}else{if(document.createRange){c=function(v,t){if(!v.ownerDocument||!t.ownerDocument){if(v==t){p=true}return 0}var u=v.ownerDocument.createRange(),e=t.ownerDocument.createRange();u.setStart(v,0);u.setEnd(v,0);e.setStart(t,0);e.setEnd(t,0);var w=u.compareBoundaryPoints(Range.START_TO_END,e);if(w===0){p=true}return w}}}}(function(){var t=document.createElement("div"),u="script"+(new Date).getTime();t.innerHTML="<a name='"+u+"'/>";var e=document.documentElement;e.insertBefore(t,e.firstChild);if(!!document.getElementById(u)){f.find.ID=function(w,x,y){if(typeof x.getElementById!=="undefined"&&!y){var v=x.getElementById(w[1]);return v?v.id===w[1]||typeof v.getAttributeNode!=="undefined"&&v.getAttributeNode("id").nodeValue===w[1]?[v]:undefined:[]}};f.filter.ID=function(x,v){var w=typeof x.getAttributeNode!=="undefined"&&x.getAttributeNode("id");return x.nodeType===1&&w&&w.nodeValue===v}}e.removeChild(t);e=t=null})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){f.find.TAG=function(t,x){var w=x.getElementsByTagName(t[1]);if(t[1]==="*"){var v=[];for(var u=0;w[u];u++){if(w[u].nodeType===1){v.push(w[u])}}w=v}return w}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(t){return t.getAttribute("href",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,u=document.createElement("div");u.innerHTML="<p class='TEST'></p>";if(u.querySelectorAll&&u.querySelectorAll(".TEST").length===0){return}b=function(y,x,v,w){x=x||document;if(!w&&x.nodeType===9&&!q(x)){try{return a(x.querySelectorAll(y),v)}catch(z){}}return e(y,x,v,w)};for(var t in e){b[t]=e[t]}u=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(t,u,v){if(typeof u.getElementsByClassName!=="undefined"&&!v){return u.getElementsByClassName(t[1])}};e=null})()}function o(t,y,x,C,z,B){var A=t=="previousSibling"&&!B;for(var v=0,u=C.length;v<u;v++){var e=C[v];if(e){if(A&&e.nodeType===1){e.sizcache=x;e.sizset=v}e=e[t];var w=false;while(e){if(e.sizcache===x){w=C[e.sizset];break}if(e.nodeType===1&&!B){e.sizcache=x;e.sizset=v}if(e.nodeName===y){w=e;break}e=e[t]}C[v]=w}}}function s(t,y,x,C,z,B){var A=t=="previousSibling"&&!B;for(var v=0,u=C.length;v<u;v++){var e=C[v];if(e){if(A&&e.nodeType===1){e.sizcache=x;e.sizset=v}e=e[t];var w=false;while(e){if(e.sizcache===x){w=C[e.sizset];break}if(e.nodeType===1){if(!B){e.sizcache=x;e.sizset=v}if(typeof y!=="string"){if(e===y){w=true;break}}else{if(b.filter(y,[e]).length>0){w=e;break}}}e=e[t]}C[v]=w}}}var h=document.compareDocumentPosition?function(t,e){return t.compareDocumentPosition(e)&16}:function(t,e){return t!==e&&(t.contains?t.contains(e):true)};var q=function(e){return e.nodeType===9&&e.documentElement.nodeName!=="HTML"||!!e.ownerDocument&&e.ownerDocument.documentElement.nodeName!=="HTML"};var g=function(e,z){var v=[],w="",x,u=z.nodeType?[z]:z;while((x=f.match.PSEUDO.exec(e))){w+=x[0];e=e.replace(f.match.PSEUDO,"")}e=f.relative[e]?e+"*":e;for(var y=0,t=u.length;y<t;y++){b(e,u[y],v)}return b.filter(w,v)};window.Sizzle=b})();(function(c){var d=Prototype.Selector.extendElements;function a(e,f){return d(c(e,f||document))}function b(f,e){return c.matches(e,[f]).length==1}Prototype.Selector.engine=c;Prototype.Selector.select=a;Prototype.Selector.match=b})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(h,d){if(typeof d!="object"){d={hash:!!d}}else{if(Object.isUndefined(d.hash)){d.hash=true}}var e,g,a=false,f=d.submit,b,c;if(d.hash){c={};b=function(j,k,l){if(k in j){if(!Object.isArray(j[k])){j[k]=[j[k]]}j[k].push(l)}else{j[k]=l}return j}}else{c="";b=function(j,k,l){return j+(j?"&":"")+encodeURIComponent(k)+"="+encodeURIComponent(l)}}return h.inject(c,function(j,k){if(!k.disabled&&k.name){e=k.name;g=$(k).getValue();if(g!=null&&k.type!="file"&&(k.type!="submit"||(!a&&f!==false&&(!f||e==f)&&(a=true)))){j=b(j,e,g)}}return j})}};Form.Methods={serialize:function(b,a){return Form.serializeElements(Form.getElements(b),a)},getElements:function(e){var f=$(e).getElementsByTagName("*"),d,a=[],c=Form.Element.Serializers;for(var b=0;d=f[b];b++){a.push(d)}return a.inject([],function(g,h){if(c[h.tagName.toLowerCase()]){g.push(Element.extend(h))}return g})},getInputs:function(g,c,d){g=$(g);var a=g.getElementsByTagName("input");if(!c&&!d){return $A(a).map(Element.extend)}for(var e=0,h=[],f=a.length;e<f;e++){var b=a[e];if((c&&b.type!=c)||(d&&b.name!=d)){continue}h.push(Element.extend(b))}return h},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(b){var c=$(b).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var a=c.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return a?a:c.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},focusFirstElement:function(b){b=$(b);var a=b.findFirstElement();if(a){a.activate()}return b},request:function(b,a){b=$(b),a=Object.clone(a||{});var d=a.parameters,c=b.readAttribute("action")||"";if(c.blank()){c=window.location.href}a.parameters=b.serialize(true);if(d){if(Object.isString(d)){d=d.toQueryParams()}Object.extend(a.parameters,d)}if(b.hasAttribute("method")&&!a.method){a.method=b.method}return new Ajax.Request(c,a)}};Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();if(a.select&&(a.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(a.type)))){a.select()}}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function b(h,j){switch(h.type.toLowerCase()){case"checkbox":case"radio":return f(h,j);default:return e(h,j)}}function f(h,j){if(Object.isUndefined(j)){return h.checked?h.value:null}else{h.checked=!!j}}function e(h,j){if(Object.isUndefined(j)){return h.value}else{h.value=j}}function a(k,n){if(Object.isUndefined(n)){return(k.type==="select-one"?c:d)(k)}var j,l,o=!Object.isArray(n);for(var h=0,m=k.length;h<m;h++){j=k.options[h];l=this.optionValue(j);if(o){if(l==n){j.selected=true;return}}else{j.selected=n.include(l)}}}function c(j){var h=j.selectedIndex;return h>=0?g(j.options[h]):null}function d(l){var h,m=l.length;if(!m){return null}for(var k=0,h=[];k<m;k++){var j=l.options[k];if(j.selected){h.push(g(j))}}return h}function g(h){return Element.hasAttribute(h,"value")?h.value:h.text}return{input:b,inputSelector:f,textarea:e,select:a,selectOne:c,selectMany:d,optionValue:g,button:e}})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,a,b,c){$super(c,b);this.element=$(a);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type){switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var D={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var f=document.documentElement;var E="onmouseenter" in f&&"onmouseleave" in f;var a=function(F){return false};if(window.attachEvent){if(window.addEventListener){a=function(F){return !(F instanceof window.Event)}}else{a=function(F){return true}}}var s;function B(G,F){return G.which?(G.which===F+1):(G.button===F)}var p={0:1,1:4,2:2};function z(G,F){return G.button===p[F]}function C(G,F){switch(F){case 0:return G.which==1&&!G.metaKey;case 1:return G.which==2||(G.which==1&&G.metaKey);case 2:return G.which==3;default:return false}}if(window.attachEvent){if(!window.addEventListener){s=z}else{s=function(G,F){return a(G)?z(G,F):B(G,F)}}}else{if(Prototype.Browser.WebKit){s=C}else{s=B}}function w(F){return s(F,0)}function u(F){return s(F,1)}function o(F){return s(F,2)}function d(H){H=D.extend(H);var G=H.target,F=H.type,I=H.currentTarget;if(I&&I.tagName){if(F==="load"||F==="error"||(F==="click"&&I.tagName.toLowerCase()==="input"&&I.type==="radio")){G=I}}if(G.nodeType==Node.TEXT_NODE){G=G.parentNode}return Element.extend(G)}function q(G,H){var F=D.element(G);if(!H){return F}while(F){if(Object.isElement(F)&&Prototype.Selector.match(F,H)){return Element.extend(F)}F=F.parentNode}}function t(F){return{x:c(F),y:b(F)}}function c(H){var G=document.documentElement,F=document.body||{scrollLeft:0};return H.pageX||(H.clientX+(G.scrollLeft||F.scrollLeft)-(G.clientLeft||0))}function b(H){var G=document.documentElement,F=document.body||{scrollTop:0};return H.pageY||(H.clientY+(G.scrollTop||F.scrollTop)-(G.clientTop||0))}function r(F){D.extend(F);F.preventDefault();F.stopPropagation();F.stopped=true}D.Methods={isLeftClick:w,isMiddleClick:u,isRightClick:o,element:d,findElement:q,pointer:t,pointerX:c,pointerY:b,stop:r};var y=Object.keys(D.Methods).inject({},function(F,G){F[G]=D.Methods[G].methodize();return F});if(window.attachEvent){function j(G){var F;switch(G.type){case"mouseover":case"mouseenter":F=G.fromElement;break;case"mouseout":case"mouseleave":F=G.toElement;break;default:return null}return Element.extend(F)}var v={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}};D.extend=function(G,F){if(!G){return false}if(!a(G)){return G}if(G._extendedByPrototype){return G}G._extendedByPrototype=Prototype.emptyFunction;var H=D.pointer(G);Object.extend(G,{target:G.srcElement||F,relatedTarget:j(G),pageX:H.x,pageY:H.y});Object.extend(G,y);Object.extend(G,v);return G}}else{D.extend=Prototype.K}if(window.addEventListener){D.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(D.prototype,y)}function n(J,I,K){var H=Element.retrieve(J,"prototype_event_registry");if(Object.isUndefined(H)){e.push(J);H=Element.retrieve(J,"prototype_event_registry",$H())}var F=H.get(I);if(Object.isUndefined(F)){F=[];H.set(I,F)}if(F.pluck("handler").include(K)){return false}var G;if(I.include(":")){G=function(L){if(Object.isUndefined(L.eventName)){return false}if(L.eventName!==I){return false}D.extend(L,J);K.call(J,L)}}else{if(!E&&(I==="mouseenter"||I==="mouseleave")){if(I==="mouseenter"||I==="mouseleave"){G=function(M){D.extend(M,J);var L=M.relatedTarget;while(L&&L!==J){try{L=L.parentNode}catch(N){L=J}}if(L===J){return}K.call(J,M)}}}else{G=function(L){D.extend(L,J);K.call(J,L)}}}G.handler=K;F.push(G);return G}function h(){for(var F=0,G=e.length;F<G;F++){D.stopObserving(e[F]);e[F]=null}}var e=[];if(Prototype.Browser.IE){window.attachEvent("onunload",h)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var m=Prototype.K,g={mouseenter:"mouseover",mouseleave:"mouseout"};if(!E){m=function(F){return(g[F]||F)}}function x(I,H,J){I=$(I);var G=n(I,H,J);if(!G){return I}if(H.include(":")){if(I.addEventListener){I.addEventListener("dataavailable",G,false)}else{I.attachEvent("ondataavailable",G);I.attachEvent("onlosecapture",G)}}else{var F=m(H);if(I.addEventListener){I.addEventListener(F,G,false)}else{I.attachEvent("on"+F,G)}}return I}function l(L,I,M){L=$(L);var H=Element.retrieve(L,"prototype_event_registry");if(!H){return L}if(!I){H.each(function(O){var N=O.key;l(L,N)});return L}var J=H.get(I);if(!J){return L}if(!M){J.each(function(N){l(L,I,N.handler)});return L}var K=J.length,G;while(K--){if(J[K].handler===M){G=J[K];break}}if(!G){return L}if(I.include(":")){if(L.removeEventListener){L.removeEventListener("dataavailable",G,false)}else{L.detachEvent("ondataavailable",G);L.detachEvent("onlosecapture",G)}}else{var F=m(I);if(L.removeEventListener){L.removeEventListener(F,G,false)}else{L.detachEvent("on"+F,G)}}H.set(I,J.without(G));return L}function A(I,H,G,F){I=$(I);if(Object.isUndefined(F)){F=true}if(I==document&&document.createEvent&&!I.dispatchEvent){I=document.documentElement}var J;if(document.createEvent){J=document.createEvent("HTMLEvents");J.initEvent("dataavailable",F,true)}else{J=document.createEventObject();J.eventType=F?"ondataavailable":"onlosecapture"}J.eventName=H;J.memo=G||{};if(document.createEvent){I.dispatchEvent(J)}else{I.fireEvent(J.eventType,J)}return D.extend(J)}D.Handler=Class.create({initialize:function(H,G,F,I){this.element=$(H);this.eventName=G;this.selector=F;this.callback=I;this.handler=this.handleEvent.bind(this)},start:function(){D.observe(this.element,this.eventName,this.handler);return this},stop:function(){D.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(G){var F=D.findElement(G,this.selector);if(F){this.callback.call(this.element,G,F)}}});function k(H,G,F,I){H=$(H);if(Object.isFunction(F)&&Object.isUndefined(I)){I=F,F=null}return new D.Handler(H,G,F,I).start()}Object.extend(D,D.Methods);Object.extend(D,{fire:A,observe:x,stopObserving:l,on:k});Element.addMethods({fire:A,observe:x,stopObserving:l,on:k});Object.extend(document,{fire:A.methodize(),observe:x.methodize(),stopObserving:l.methodize(),on:k.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,D)}else{window.Event=D}})();(function(){var d;function a(){if(document.loaded){return}if(d){window.clearTimeout(d)}document.loaded=true;document.fire("dom:loaded")}function c(){if(document.readyState==="complete"){document.stopObserving("readystatechange",c);a()}}function b(){try{document.documentElement.doScroll("left")}catch(f){d=b.defer();return}a()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",a,false)}else{document.observe("readystatechange",c);if(window==top){d=b.defer()}}Event.observe(window,"load",a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(b,a,c){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(b,a,c)}this.xcomp=a;this.ycomp=c;this.offset=Element.cumulativeOffset(b);return(c>=this.offset[1]&&c<this.offset[1]+b.offsetHeight&&a>=this.offset[0]&&a<this.offset[0]+b.offsetWidth)},withinIncludingScrolloffsets:function(b,a,d){var c=Element.cumulativeScrollOffset(b);this.xcomp=a+c[0]-this.deltaX;this.ycomp=d+c[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth)},overlap:function(b,a){if(!b){return 0}if(b=="vertical"){return((this.offset[1]+a.offsetHeight)-this.ycomp)/a.offsetHeight}if(b=="horizontal"){return((this.offset[0]+a.offsetWidth)-this.xcomp)/a.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,a){a=a||{};return Element.clonePosition(c,b,a)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(b){function a(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,e){e=e.toString().strip();var d=/\s/.test(e)?$w(e).map(a).join(""):a(e);return d?document._getElementsByXPath(".//*"+d,c):[]}:function(e,f){f=f.toString().strip();var g=[],h=(/\s/.test(f)?$w(f):null);if(!h&&!f){return g}var c=$(e).getElementsByTagName("*");f=" "+f+" ";for(var d=0,k,j;k=c[d];d++){if(k.className&&(j=" "+k.className+" ")&&(j.include(f)||(h&&h.all(function(l){return !l.toString().blank()&&j.include(" "+l+" ")})))){g.push(Element.extend(k))}}return g};return function(d,c){return $(c||document.body).getElementsByClassName(d)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a)){return}this.set($A(this).concat(a).join(" "))},remove:function(a){if(!this.include(a)){return}this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(f,g){var a=Prototype.Selector.match,d=[];for(var c=0,e=f.length;c<e;c++){var b=f[c];if(a(b,g)){d.push(Element.extend(b))}}return d},findElement:function(f,g,b){b=b||0;var a=0,d;for(var c=0,e=f.length;c<e;c++){d=f[c];if(Prototype.Selector.match(d,g)&&b===a++){return Element.extend(d)}}},findChildElements:function(b,c){var a=c.toArray().join(", ");return Prototype.Selector.select(a,b||document)}})})();String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(",");var b=0;do{a+=parseInt(c[b]).toColorPart()}while(++b<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var b=1;b<4;b++){a+=(this.charAt(b)+this.charAt(b)).toLowerCase()}}if(this.length==7){a=this.toLowerCase()}}}return(a.length==7?a:(arguments[0]||this))};Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return(c.nodeType==3?c.nodeValue:((c.hasChildNodes()&&!Element.hasClassName(c,b))?Element.collectTextNodesIgnoreClass(c,b):""))}).flatten().join("")};Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:(b/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(b){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return(-Math.cos(a*Math.PI)/2)+0.5},reverse:function(a){return 1-a},flicker:function(a){var a=((-Math.cos(a*Math.PI)/4)+0.75)+Math.random()/4;return a>1?1:a},wobble:function(a){return(-Math.cos(a*Math.PI*(9*a))/2)+0.5},pulse:function(b,a){return(-Math.cos((b*((a||5)-0.5)*2)*Math.PI)/2)+0.5},spring:function(a){return 1-(Math.cos(a*4.5*Math.PI)*Math.exp(-a*6))},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE){b+=";zoom:1"}a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore(new Element("span",{style:b}).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(b,c){var e;if(((typeof b=="object")||Object.isFunction(b))&&(b.length)){e=b}else{e=$(b).childNodes}var a=Object.extend({speed:0.1,delay:0},arguments[2]||{});var d=a.delay;$A(e).each(function(g,f){new c(g,Object.extend(a,{delay:f*a.speed+d}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(b,c,a){b=$(b);c=(c||"appear").toLowerCase();return Effect[Effect.PAIRS[c][b.visible()?1:0]](b,Object.extend({queue:{position:"end",scope:(b.id||"global"),limit:1}},a||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(b){var c=new Date().getTime();var a=Object.isString(b.options.queue)?b.options.queue:b.options.queue.position;switch(a){case"front":this.effects.findAll(function(d){return d.state=="idle"}).each(function(d){d.startOn+=b.finishOn;d.finishOn+=b.finishOn});break;case"with-last":c=this.effects.pluck("startOn").max()||c;break;case"end":c=this.effects.pluck("finishOn").max()||c;break}b.startOn+=c;b.finishOn+=c;if(!b.options.queue.limit||(this.effects.length<b.options.queue.limit)){this.effects.push(b)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var c=new Date().getTime();for(var b=0,a=this.effects.length;b<a;b++){this.effects[b]&&this.effects[b].loop(c)}}});Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a)){return a}return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false){a.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function b(d,c){if(d.options[c+"Internal"]){d.options[c+"Internal"](d)}if(d.options[c]){d.options[c](d)}}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");if(this.setup){this.setup()}b(this,"afterSetup")}if(this.state==="running"){c=(this.options.transition(c)*this.fromToDelta)+this.options.from;this.position=c;b(this,"beforeUpdate");if(this.update){this.update(c)}b(this,"afterUpdate")}}})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(c){if(c>=this.startOn){if(c>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var b=(c-this.startOn)/this.totalTime,a=(b*this.totalFrames).round();if(a>this.currentFrame){this.render(b);this.currentFrame=a}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(a){if(this.options[a+"Internal"]){this.options[a+"Internal"](this)}if(this.options[a]){this.options[a](this)}},inspect:function(){var a=$H();for(property in this){if(!Object.isFunction(this[property])){a.set(property,this[property])}}return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[];this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");if(b.finish){b.finish(a)}b.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(c,f,e){c=Object.isString(c)?$(c):c;var b=$A(arguments),d=b.last(),a=b.length==5?b[3]:null;this.method=Object.isFunction(d)?d.bind(c):Object.isFunction(c[d])?c[d].bind(c):function(g){c[d]=g};this.start(Object.extend({from:f,to:e},a||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var a=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(a)},update:function(a){this.element.setOpacity(a)}});Effect.Move=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(b,a,c){return new Effect.Move(b,Object.extend({x:c,y:a},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(b,c){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:c},arguments[2]||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(a){var b=(this.options.scaleFrom/100)+(this.factor*a);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(a,e){var f={};if(this.options.scaleX){f.width=e.round()+"px"}if(this.options.scaleY){f.height=a.round()+"px"}if(this.options.scaleFromCenter){var c=(a-this.dims[0])/2;var b=(e-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){f.top=this.originalTop-c+"px"}if(this.options.scaleX){f.left=this.originalLeft-b+"px"}}else{if(this.options.scaleY){f.top=-c+"px"}if(this.options.scaleX){f.left=-b+"px"}}}this.element.setStyle(f)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(a)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+((this._base[d]+(this._delta[d]*a)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(c){var b=arguments[1]||{},a=document.viewport.getScrollOffsets(),d=$(c).cumulativeOffset();if(b.offset){d[1]+=b.offset}return new Effect.Tween(null,a.top,d[1],b,function(e){scrollTo(a.left,e.round())})};Effect.Fade=function(c){c=$(c);var a=c.getInlineOpacity();var b=Object.extend({from:c.getOpacity()||1,to:0,afterFinishInternal:function(d){if(d.options.to!=0){return}d.element.hide().setStyle({opacity:a})}},arguments[1]||{});return new Effect.Opacity(c,b)};Effect.Appear=function(b){b=$(b);var a=Object.extend({from:(b.getStyle("display")=="none"?0:b.getOpacity()||0),to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},arguments[1]||{});return new Effect.Opacity(b,a)};Effect.Puff=function(b){b=$(b);var a={opacity:b.getInlineOpacity(),position:b.getStyle("position"),top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};return new Effect.Parallel([new Effect.Scale(b,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(c){Position.absolutize(c.effects[0].element)},afterFinishInternal:function(c){c.effects[0].element.hide().setStyle(a)}},arguments[1]||{}))};Effect.BlindUp=function(a){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(b){b=$(b);var a=b.getDimensions();return new Effect.Scale(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){c.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(b){b=$(b);var a=b.getInlineOpacity();return new Effect.Appear(b,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(c){new Effect.Scale(c.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(d){d.element.makePositioned().makeClipping()},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned().setStyle({opacity:a})}})}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(b,{x:0,y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.Shake=function(d){d=$(d);var b=Object.extend({distance:20,duration:0.5},arguments[1]||{});var e=parseFloat(b.distance);var c=parseFloat(b.duration)/10;var a={top:d.getStyle("top"),left:d.getStyle("left")};return new Effect.Move(d,{x:e,y:0,duration:c,afterFinishInternal:function(f){new Effect.Move(f.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(g){new Effect.Move(g.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(j){new Effect.Move(j.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:-e,y:0,duration:c,afterFinishInternal:function(l){l.element.undoPositioned().setStyle(a)}})}})}})}})}})}})};Effect.SlideDown=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.SlideUp=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};Effect.Grow=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var g=c.getDimensions();var h,f;var e,d;switch(b.direction){case"top-left":h=f=e=d=0;break;case"top-right":h=g.width;f=d=0;e=-g.width;break;case"bottom-left":h=e=0;f=g.height;d=-g.height;break;case"bottom-right":h=g.width;f=g.height;e=-g.width;d=-g.height;break;case"center":h=g.width/2;f=g.height/2;e=-g.width/2;d=-g.height/2;break}return new Effect.Move(c,{x:h,y:f,duration:0.01,beforeSetup:function(j){j.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(j){new Effect.Parallel([new Effect.Opacity(j.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(j.element,{x:e,y:d,sync:true,transition:b.moveTransition}),new Effect.Scale(j.element,100,{scaleMode:{originalHeight:g.height,originalWidth:g.width},sync:true,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(k){k.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(k){k.effects[0].element.undoClipping().undoPositioned().setStyle(a)}},b))}})};Effect.Shrink=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var f=c.getDimensions();var e,d;switch(b.direction){case"top-left":e=d=0;break;case"top-right":e=f.width;d=0;break;case"bottom-left":e=0;d=f.height;break;case"bottom-right":e=f.width;d=f.height;break;case"center":e=f.width/2;d=f.height/2;break}return new Effect.Parallel([new Effect.Opacity(c,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(c,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(c,{x:e,y:d,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(g){g.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(g){g.effects[0].element.hide().undoClipping().undoPositioned().setStyle(a)}},b))};Effect.Pulsate=function(c){c=$(c);var b=arguments[1]||{},a=c.getInlineOpacity(),e=b.transition||Effect.Transitions.linear,d=function(f){return 1-e((-Math.cos((f*(b.pulses||5)*2)*Math.PI)/2)+0.5)};return new Effect.Opacity(c,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(f){f.element.setStyle({opacity:a})}},b),{transition:d}))};Effect.Fold=function(b){b=$(b);var a={top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};b.makeClipping();return new Effect.Scale(b,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(c){new Effect.Scale(b,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(a)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(c){this.element=$(c);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(a.style)){this.style=$H(a.style)}else{if(a.style.include(":")){this.style=a.style.parseStyle()}else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var b=this.element.getStyles();this.style=this.style.reject(function(d){return d.value==b[d.key]});a.afterFinishInternal=function(d){d.element.addClassName(d.options.style);d.transforms.each(function(e){d.element.style[e.style]=""})}}}this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b)){b="#ffffff"}b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(g){var f=g[0],e=g[1],d=null;if(e.parseColor("#zzzzzz")!="#zzzzzz"){e=e.parseColor();d="color"}else{if(f=="opacity"){e=parseFloat(e);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(e)){var c=e.match(/^([\+\-]?[0-9\.]+)(.*)$/);e=parseFloat(c[1]);d=(c.length==3)?c[2]:null}}}var b=this.element.getStyle(f);return{style:f.camelize(),originalValue:d=="color"?a(b):parseFloat(b||0),targetValue:d=="color"?a(e):e,unit:d}}.bind(this)).reject(function(b){return((b.originalValue==b.targetValue)||(b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))))})},update:function(a){var d={},b,c=this.transforms.length;while(c--){d[(b=this.transforms[c]).style]=b.unit=="color"?"#"+(Math.round(b.originalValue[0]+(b.targetValue[0]-b.originalValue[0])*a)).toColorPart()+(Math.round(b.originalValue[1]+(b.targetValue[1]-b.originalValue[1])*a)).toColorPart()+(Math.round(b.originalValue[2]+(b.targetValue[2]-b.originalValue[2])*a)).toColorPart():(b.originalValue+(b.targetValue-b.originalValue)*a).toFixed(3)+(b.unit===null?"":b.unit)}this.element.setStyle(d,true)}});Effect.Transform=Class.create({initialize:function(a){this.tracks=[];this.options=arguments[1]||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var d=a.get("ids"),c=a.get("effect"),b=a.get("options");var e=[$(d)||$$(d)].flatten();return e.map(function(f){return new c(f,Object.extend({sync:true},b))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var b,a=$H();if(Prototype.Browser.WebKit){b=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';b=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){if(b[c]){a.set(c,b[c])}});if(Prototype.Browser.IE&&this.include("opacity")){a.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return a};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(b){var a=document.defaultView.getComputedStyle($(b),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=a[d];return c})}}else{Element.getStyles=function(b){b=$(b);var a=b.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=a[e];return d});if(!c.opacity){c.opacity=b.getOpacity()}return c}}Effect.Methods={morph:function(a,b){a=$(a);new Effect.Morph(a,Object.extend({style:b},arguments[2]||{}));return a},visualEffect:function(c,e,b){c=$(c);var d=e.dasherize().camelize(),a=d.charAt(0).toUpperCase()+d.substring(1);new Effect[a](c,b);return c},highlight:function(b,a){b=$(b);new Effect.Highlight(b,a);return b}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(c,b){c=$(c);Effect[a.charAt(0).toUpperCase()+a.substring(1)](c,b);return c}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,c,a){b=$(b);this.element=b;this.update=$(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight-1})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){$j(this.iefix).clonePosition($j(this.update),{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){this.onObserverEvent();if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry());this.index=0},updateElement:function(f){if(this.options.updateElement){this.options.updateElement(f);return}var d="";if(this.options.select){var a=$(f).select("."+this.options.select)||[];if(a.length>0){d=Element.collectTextNodes(a[0],this.options.select)}}else{d=Element.collectTextNodesIgnoreClass(f,"informal")}var c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]);var b=this.element.value.substr(c[0]).match(/^\s+/);if(b){e+=b[0]}this.element.value=e+d+this.element.value.substr(c[1])}else{this.element.value=d}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,f)}},updateChoices:function(c){if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}if(this.index>=this.entryCount){this.index=0}}else{this.entryCount=0}this.stopIndicator();if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var e=this.element.value;if(e.strip().empty()){return[-1,0]}var f=arguments.callee.getFirstDifferencePos(e,this.oldElementValue);var h=(f==this.oldElementValue.length?1:0);var d=-1,c=e.length;var g;for(var b=0,a=this.options.tokens.length;b<a;++b){g=e.lastIndexOf(this.options.tokens[b],f+h-1);if(g>d){d=g}g=e.indexOf(this.options.tokens[b],f+h);if(-1!=g&&g<c){c=g}}return(this.tokenBounds=[d+1,c])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(c,a){var d=Math.min(c.length,a.length);for(var b=0;b<d;++b){if(c[b]!=a[b]){return b}}return d};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var h=b.getToken();var g=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var f=b.options.array[e];var j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase()):f.indexOf(h);while(j!=-1){if(j==0&&f.length!=h.length){d.push("<li><strong>"+f.substr(0,h.length)+"</strong>"+f.substr(h.length)+"</li>");break}else{if(h.length>=b.options.partialChars&&b.options.partialSearch&&j!=-1){if(b.options.fullSearch||/\s/.test(f.substr(j-1,1))){c.push("<li>"+f.substr(0,j)+"<strong>"+f.substr(j,h.length)+"</strong>"+f.substr(j+h.length)+"</li>");break}}}j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase(),j+1):f.indexOf(h,j+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(c,b,a){this.url=b;this.element=c=$(c);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundCancel=(this.options.onCancel||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this._keyHandler=this.checkForEscapeOrReturn.bind(this);if(this.options.clickToEdit){this.registerListeners()}},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(g,c,b){var e=this.options[g+"Control"];var f=this.options[g+"Text"];if("button"==e){var a=document.createElement("input");a.type="submit";a.value=f;a.className="editor_"+g+"_button";if("cancel"==g){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[g]=a}else{if("link"==e){var d=document.createElement("a");d.href="#";d.appendChild(document.createTextNode(f));d.onclick="cancel"==g?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+g+"_link";if(b){d.className+=" "+b}this._form.appendChild(d);this._controls[g]=d}}},createEditField:function(){var c=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;if(this.options.initialText!==undefined&&this.options.initialText!==null){this.initialValue=this.options.initialText}else{this.initialValue=c}b.value=this.initialValue;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}Event.observe(b,"keydown",this._keyHandler);this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(d,e){var c=b.options["text"+d+"Controls"];if(!c||e===false){return}b._form.appendChild(document.createTextNode(c))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){if(this._handling_form){return}this._handling_form=true;this.wrapUp();if(a){Event.stop(a)}this._boundCancel();this._handling_form=false},handleFormSubmission:function(c,g){if(this._handling_form){return}var d=this._form;var f=$F(this._controls.editor);if(this.options.cancelIfSame&&(f===this.initialValue)){this.handleFormCancellation(g);return}this._handling_form=true;this.prepareSubmission();var h=this.options.callback(d,f)||"";if(Object.isString(h)){h=h.toQueryParams()}h.editorId=this.element.id;if(this.options.htmlResponse){var b=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,b)}else{var b=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});var a=this.options.ajaxClass||Ajax.Request;new a(this.url,b)}if(g){Event.stop(g)}this._handling_form=false;return false},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(c){this._form.removeClassName(this.options.loadingClassName);var b=c.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._controls.editor.blur();this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,c,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(c,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(d){return d[0]==b}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,d){c=document.createElement("option");c.value=e[0];c.selected=a?e[0]==b:0==d;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(c,d){if(c in a||d===undefined){return}a[c]=d}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelIfSame:false,cancelText:"cancel",clickToEdit:true,clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,initialText:"",loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,c){this.delay=a||0.5;this.element=$(b);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});
/* jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else{r=t}}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t])){continue}if(t!=="toJSON"){return !1}}return !0}function et(){return !1}function tt(){return !0}function ut(e){return !e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do{e=e[t]}while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t)){return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n})}if(t.nodeType){return v.grep(e,function(e,r){return e===t===n})}if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t)){return v.filter(t,r,!n)}t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement){while(t.length){n.createElement(t.pop())}}return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e)){return}var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u){for(r=0,i=u[n].length;r<i;r++){v.event.add(t,n,u[n][r])}}}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1){return}t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e){return t}var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e){return t}}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style){continue}i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style){continue}if(!t||n.style.display==="none"||n.style.display===""){n.style.display=t?i[s]||"":"none"}}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2){n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0))}return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null){r=e.style[t]}if(Ut.test(r)){return r}i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e]){return Wt[e]}var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement){Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close()}t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t)){v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)})}else{if(!n&&v.type(t)==="object"){for(i in t){fn(e+"["+i+"]",t[i],n,r)}}else{r(e,t)}}}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n)){for(;u<a;u++){r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++){u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)))}return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n){n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r])}i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l){s in r&&(n[l[s]]=r[s])}while(f[0]==="*"){f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"))}if(i){for(s in a){if(a[s]&&a[s].test(i)){f.unshift(s);break}}}if(f[0] in r){o=f[0]}else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o){return o!==f[0]&&f.unshift(o),r[o]}}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1]){for(n in e.converters){a[n.toLowerCase()]=e.converters[n]}}for(;i=o[++f];){if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n){for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}}if(n!==!0){if(n&&e["throws"]){t=n(t)}else{try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}}}u=i}}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++){if(r[i].call(e,t,n)){return}}})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++){f.tweens[s].run(i)}return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++){f.tweens[n].run(1)}return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r){return r}}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand" in o){s=o.expand(s),delete e[r];for(n in s){n in e||(e[n]=s[n],t[n]=i)}}else{t[r]=i}}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height" in t||"width" in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show")){continue}m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden" in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d){v.style(e,t,d[t])}});for(r=0;r<o;r++){i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t){n=$t[i],r["margin"+n]=r["padding"+n]=e}return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e){return this}if(e.nodeType){return this.context=this[0]=e,this.length=1,this}if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1]){return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e)}o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2]){return r.find(e)}this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return !n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++){if((e=arguments[a])!=null){for(n in e){r=u[n],i=e[n];if(u===i){continue}l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}}}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady){return}if(!i.body){return setTimeout(v.ready,1)}v.isReady=!0;if(e!==!0&&--v.readyWait>0){return}r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return !isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e)){return !1}try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf")){return !1}}catch(n){return !1}var r;for(r in e){}return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e){return !1}return !0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return !e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string"){return null}t=v.trim(t);if(e.JSON&&e.JSON.parse){return e.JSON.parse(t)}if(S.test(t.replace(T,"@").replace(N,"]").replace(x,""))){return(new Function("return "+t))()}v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string"){return null}try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e){if(n.apply(e[i],r)===!1){break}}}else{for(;s<o;){if(n.apply(e[s++],r)===!1){break}}}}else{if(u){for(i in e){if(n.call(e[i],i,e[i])===!1){break}}}else{for(;s<o;){if(n.call(e[s],s,e[s++])===!1){break}}}}return e},trim:d&&!d.call("\ufeff\u00a0")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c){return c.call(t,e,n)}r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++){if(n in t&&t[n]===e){return n}}}return -1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number"){for(;s<r;s++){e[i++]=n[s]}}else{while(n[s]!==t){e[i++]=n[s++]}}return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++){r=!!t(e[s],s),n!==r&&i.push(e[s])}return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f){for(;u<a;u++){i=n(e[u],u,r),i!=null&&(o[o.length]=i)}}else{for(s in e){i=n(e[s],s,r),i!=null&&(o[o.length]=i)}}return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r){v.access(e,n,l,r[l],1,o,i)}s=1}else{if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n){for(;l<c;l++){n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u)}}s=1}}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete"){setTimeout(v.ready,1)}else{if(i.addEventListener){i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1)}else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++){if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1){a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return !a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return !f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return !!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++){n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length){return{}}s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent){for(l in {submit:!0,change:!0,focusin:!0}){f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c}}return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a){return}n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e)){return}var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t){return}c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function"){i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n)}return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e)){return}var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a]){return}if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++){delete r[t[i]]}if(!(n?B:v.isEmptyObject)(r)){return}}}if(!n){delete u[a].data;if(!B(u[a])){return}}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return !t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++){o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]))}v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t){return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l}r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e){return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]}},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--){r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a))}return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e)){return this.each(function(t){v(this).addClass(e.call(this,t,this.className))})}if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1){if(!i.className&&t.length===1){i.className=e}else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++){s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ")}i.className=v.trim(s)}}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e)){return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))})}if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++){while(r.indexOf(" "+n[s]+" ")>=0){r=r.replace(" "+n[s]+" "," ")}}i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++]){u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}}else{if(n==="undefined"||n==="boolean"){this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""}}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++){if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0){return !0}}return !1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s){return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get" in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r)}return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1){return}i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set" in n)||n.set(this,s,"value")===t){this.value=s}})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return !t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s){return t}o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2){return}if(i&&v.isFunction(v.fn[n])){return v(e)[n](r)}if(typeof e.getAttribute=="undefined"){return v.prop(e,n,r)}u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set" in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get" in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++){i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode){v.error("type property can't be changed")}else{if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button")){return j.set(e,t,n)}e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2){return}return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set" in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get" in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n===""){return e.setAttribute(t,"auto"),n}}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t)){return e.checked=v.inArray(v(e).val(),t)>=0}}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e))){return}r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1){e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events)){return}t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h){v.event.remove(e,u+t[s],n,r,!0)}continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++){m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m))}d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered)){return}y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y]){return}n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u){u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0)}return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1){return}m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode){m.push([l,g]),c=l}c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++){l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault()}return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1){return}if(m&&(!n.button||n.type!=="click")){for(s=n.target;s!=this;s=s.parentNode||this){if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++){c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c)}f.length&&w.push({elem:s,matches:f})}}}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace)){n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando]){return e}var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;){n=o[--t],e[n]=r[n]}return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event)){return new v.Event(e,t)}e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e){return}e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e){return}e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i)){e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t}return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form")){return !1}v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form")){return !1}v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)})}return !1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox"){return e.handleObj.handler.apply(this,arguments)}},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e){this.on(u,n,r,e[u],s)}return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1){i=et}else{if(!i){return this}}return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj){return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if(typeof e=="object"){for(s in e){this.off(s,n,e[s])}return this}if(n===!1||typeof n=="function"){r=n,n=t}return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){return v.event.trigger(e,t,this[0],!0)}},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length){t[r++].guid=n}return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string"){return n}if(l!==1&&l!==9){return[]}a=o(t);if(!a&&!r){if(i=R.exec(e)){if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode){return n}if(s.id===f){return n.push(s),n}}else{if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f){return n.push(s),n}}}else{if(i[2]){return S.apply(n,x.call(t.getElementsByTagName(e),0)),n}if((f=i[3])&&Z&&t.getElementsByClassName){return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}}}}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--){n[i=s[o]]&&(n[i]=!(r[i]=n[i]))}})})}function ot(e,t,n){if(e===t){return n}var r=e.nextSibling;while(r){if(r===t){return -1}r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l){return t?0:l.slice(0)}u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u))){r&&(u=u.slice(r[0].length)||u),a.push(s=[])}n=!1;if(r=I.exec(u)){s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ")}for(o in i.filter){(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r)}if(!n){break}}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i]){if(s||t.nodeType===1){return e(t,n,r)}}}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i]){if(s||t.nodeType===1){if((a=t[d])===l){return t.sizset}if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset){return t}}else{t[d]=l;if(e(t,r,u)){return t.sizset=!0,t}t.sizset=!1}}}}else{while(t=t[i]){if(s||t.nodeType===1){if(e(t,r,u)){return t}}}}}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--){if(!e[i](t,n,r)){return !1}}return !0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++){if(s=e[u]){if(!n||n(s,r,i)){o.push(s),f&&t.push(u)}}}return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--){if(c=f[l]){g[p[l]]=!(m[p[l]]=c)}}}if(s){if(i||e){if(i){f=[],l=g.length;while(l--){(c=g[l])&&f.push(m[l]=c)}i(null,g=[],f,a)}l=g.length;while(l--){(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}}else{g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)}})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return !o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++){if(n=i.relative[e[a].type]){h=[at(ft(h),n)]}else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++){if(i.relative[e[r].type]){break}}return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++){if(v(p,a,f)){l.push(p);break}}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++){v(x,m,a,f)}if(u){if(y>0){while(w--){!x[w]&&!m[w]&&(m[w]=E.call(l))}}m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++){nt(e,t[r],n)}return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t){return n}e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type]){break}if(c=i.find[l]){if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e){return S.apply(n,x.call(r,0)),n}break}}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++){if(this[t]===e){return t}}return -1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return !1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++){n.push(t)}return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string"){return e.textContent}for(e=e.firstChild;e;e=e.nextSibling){n+=s(e)}}else{if(i===3||i===4){return e.nodeValue}}}else{for(;t=e[r];r++){n+=s(t)}}return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode){if(t===e){return !0}}return !1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p){return t.getElementsByTagName(e)}}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++){r.nodeType===1&&i.push(r)}return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p){return t.getElementsByName(name)}},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n){return t.getElementsByClassName(e)}}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0])){return null}if(e[3]){e[2]=e[3]}else{if(t=e[4]){q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t}}return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return !0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0){return !0}if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling){if(t.nodeType===1){i++;if(e===t){break}}}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling){if(n.nodeType===1){return !1}}if(e==="first"){return !0}n=t;case"last":while(n=n.nextSibling){if(n.nodeType===1){return !1}}return !0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--){i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--){if(s=o[u]){e[u]=!(t[u]=s)}}}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return !i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4){return !1}e=e.nextSibling}return !0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2){e.push(n)}return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2){e.push(n)}return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;){e.push(r)}return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;){e.push(r)}return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t){return l=!0,0}if(e.sourceIndex&&t.sourceIndex){return e.sourceIndex-t.sourceIndex}var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u){return ot(e,t)}if(!o){return -1}if(!u){return 1}while(a){i.unshift(a),a=a.parentNode}a=u;while(a){s.unshift(a),a=a.parentNode}n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++){if(i[f]!==s[f]){return ot(i[f],s[f])}}return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++){t===e[r-1]&&(i=n.push(r))}while(i--){e.splice(n[i],1)}}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--){s=ht(t[n]),s[d]?r.push(s):i.push(s)}s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--){a[f]=c+a[f].join("")}h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p){try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n)){try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11){return a}}catch(f){}}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string"){return v(e).filter(function(){for(t=0,n=u.length;t<n;t++){if(v.contains(u[t],this)){return !0}}})}o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0){for(i=r;i<o.length;i++){for(s=0;s<r;s++){if(o[s]===o[i]){o.splice(i--,1);break}}}}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++){if(v.contains(this,n[t])){return !0}}})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return !!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r))){s.nodeType===1&&i.push(s),s=s[n]}return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){e.nodeType===1&&e!==t&&n.push(e)}return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e)){return this.each(function(t){v(this).wrapAll(e.call(this,t))})}if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0])){return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)})}if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0])){return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)})}if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++){if(!e||v.filter(e,[n]).length){!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n)}}return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild){e.removeChild(e.firstChild)}}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t){return n.nodeType===1?n.innerHTML.replace(ht,""):t}if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++){n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e)}n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f)){return this.each(function(){v(this).domManip(e,n,r)})}if(v.isFunction(f)){return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)})}if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++){r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1){return o[t](this[0]),this}for(;i<u;i++){r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r)}return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s){i[s]&&Ot(r[s],i[s])}}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s){At(r[s],i[s])}}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined"){t=i}for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u){continue}if(typeof u=="string"){if(!gt.test(u)){u=t.createTextNode(u)}else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--){c=c.lastChild}if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o){v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked){for(s=0;(u=b[s])!=null;s++){v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t)}}if(n){m=function(e){if(!e.type||xt.test(e.type)){return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)}};for(s=0;(u=b[s])!=null;s++){if(!v.nodeName(u,"script")||!m(u)){n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}}}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++){if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events){for(s in n.events){l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle)}}a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t){return u&&"get" in u&&(s=u.get(e,!1,i))!==t?s:f[n]}o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r)){return}o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set" in u)||(r=u.set(e,r,i))!==t){try{f[n]=r}catch(l){}}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get" in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t){s[i]=e.style[i],e.style[i]=t[i]}r=n.call(e);for(i in t){e.style[i]=s[i]}return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n){return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)}},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter){return}}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t){return Dt(e,"marginRight")}})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return !v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++){s[e+$t[r]+t]=i[r]||i[r-2]||i[0]}return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e)){v.each(e,function(){s(this.name,this.value)})}else{for(r in e){fn(r,e[r],n,s)}}return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En){return En.apply(this,arguments)}if(!this.length){return this}var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2){return}E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304){c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b)}else{b=T;if(!T||e){T="error",e<0&&(e=0)}}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i)){s[n[1].toLowerCase()]=n[2]}}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2){for(t in e){g[t]=[g[t],e[t]]}}else{t=e[x.status],x.always(t)}}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2){return x}f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers){x.setRequestHeader(l,c.headers[l])}if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in {success:1,error:1,complete:1}){x[l](c[l])}o=kn(xn,c,n,x);if(!o){T(-1,"No Transport")}else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2)){throw k}T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h){return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState)){n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")}},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn){Hn[e](0,1)}}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return !this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials" in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields){for(u in n.xhrFields){a[u]=n.xhrFields[u]}}n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i){a.setRequestHeader(u,i[u])}}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i){a.readyState!==4&&a.abort()}else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do{a=a||".5",u/=a,v.style(i.elem,e,u+r)}while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++){n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)}},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n){o[n]&&o[n].stop&&i(o[n])}else{for(n in o){o[n]&&o[n].stop&&Wn.test(n)&&i(o[n])}}for(n=s.length;n--;){s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1))}(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0){r.queue="fx"}return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return 0.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++){e=n[r],!e()&&n[r]===e&&n.splice(r--,1)}n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length){return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)})}var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c){return}return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using" in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0]){return}var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static"){e=e.offsetParent}return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t){return o?n in o?o[n]:o.document.documentElement[i]:e[i]}o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})})(window);window.$j=jQuery.noConflict();
/* jQuery UI - v1.10.2 - 2013-04-03
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.slider.js, jquery.ui.effect.js
* Copyright 2013 jQuery Foundation and other contributors Licensed MIT */
(function(g,d){function c(k,j){var e,p,l,m=k.nodeName.toLowerCase();return"area"===m?(e=k.parentNode,p=e.name,k.href&&p&&"map"===e.nodeName.toLowerCase()?(l=g("img[usemap=#"+p+"]")[0],!!l&&f(l)):!1):(/input|select|textarea|button|object/.test(m)?!k.disabled:"a"===m?k.href||j:j)&&f(k)}function f(a){return g.expr.filters.visible(a)&&!g(a).parents().addBack().filter(function(){return"hidden"===g.css(this,"visibility")}).length}var b=0,h=/^ui-id-\d+$/;g.ui=g.ui||{},g.extend(g.ui,{version:"1.10.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),g.fn.extend({focus:function(a){return function(e,j){return"number"==typeof e?this.each(function(){var k=this;setTimeout(function(){g(k).focus(),j&&j.call(k)},e)}):a.apply(this,arguments)}}(g.fn.focus),scrollParent:function(){var a;return a=g.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(g.css(this,"position"))&&/(auto|scroll)/.test(g.css(this,"overflow")+g.css(this,"overflow-y")+g.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(g.css(this,"overflow")+g.css(this,"overflow-y")+g.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!a.length?g(document):a},zIndex:function(j){if(j!==d){return this.css("zIndex",j)}if(this.length){for(var k,e,l=g(this[0]);l.length&&l[0]!==document;){if(k=l.css("position"),("absolute"===k||"relative"===k||"fixed"===k)&&(e=parseInt(l.css("zIndex"),10),!isNaN(e)&&0!==e)){return e}l=l.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++b)})},removeUniqueId:function(){return this.each(function(){h.test(this.id)&&g(this).removeAttr("id")})}}),g.extend(g.expr[":"],{data:g.expr.createPseudo?g.expr.createPseudo(function(a){return function(e){return !!g.data(e,a)}}):function(e,a,j){return !!g.data(e,j[3])},focusable:function(a){return c(a,!isNaN(g.attr(a,"tabindex")))},tabbable:function(j){var k=g.attr(j,"tabindex"),e=isNaN(k);return(e||k>=0)&&c(j,!e)}}),g("<a>").outerWidth(1).jquery||g.each(["Width","Height"],function(j,k){function e(q,o,r,n){return g.each(p,function(){o-=parseFloat(g.css(q,"padding"+this))||0,r&&(o-=parseFloat(g.css(q,"border"+this+"Width"))||0),n&&(o-=parseFloat(g.css(q,"margin"+this))||0)}),o}var p="Width"===k?["Left","Right"]:["Top","Bottom"],l=k.toLowerCase(),m={innerWidth:g.fn.innerWidth,innerHeight:g.fn.innerHeight,outerWidth:g.fn.outerWidth,outerHeight:g.fn.outerHeight};g.fn["inner"+k]=function(a){return a===d?m["inner"+k].call(this):this.each(function(){g(this).css(l,e(this,a)+"px")})},g.fn["outer"+k]=function(n,a){return"number"!=typeof n?m["outer"+k].call(this,n):this.each(function(){g(this).css(l,e(this,n,!0,a)+"px")})}}),g.fn.addBack||(g.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),g("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(g.fn.removeData=function(a){return function(e){return arguments.length?a.call(this,g.camelCase(e)):a.call(this)}}(g.fn.removeData)),g.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),g.support.selectstart="onselectstart" in document.createElement("div"),g.fn.extend({disableSelection:function(){return this.bind((g.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),g.extend(g.ui,{plugin:{add:function(k,j,l){var e,m=g.ui[k].prototype;for(e in l){m.plugins[e]=m.plugins[e]||[],m.plugins[e].push([j,l[e]])}},call:function(n,l,k){var m,j=n.plugins[l];if(j&&n.element[0].parentNode&&11!==n.element[0].parentNode.nodeType){for(m=0;j.length>m;m++){n.options[j[m][0]]&&j[m][1].apply(n.element,k)}}}},hasScroll:function(k,j){if("hidden"===g(k).css("overflow")){return !1}var l=j&&"left"===j?"scrollLeft":"scrollTop",e=!1;return k[l]>0?!0:(k[l]=1,e=k[l]>0,k[l]=0,e)}})})(jQuery);(function(d,b){var a=0,c=Array.prototype.slice,f=d.cleanData;d.cleanData=function(h){for(var g,j=0;null!=(g=h[j]);j++){try{d(g).triggerHandler("remove")}catch(e){}}f(h)},d.widget=function(m,v,j){var q,e,g,p,k={},t=m.split(".")[0];m=m.split(".")[1],q=t+"-"+m,j||(j=v,v=d.Widget),d.expr[":"][q.toLowerCase()]=function(h){return !!d.data(h,q)},d[t]=d[t]||{},e=d[t][m],g=d[t][m]=function(l,h){return this._createWidget?(arguments.length&&this._createWidget(l,h),b):new g(l,h)},d.extend(g,e,{version:j.version,_proto:d.extend({},j),_childConstructors:[]}),p=new v,p.options=d.widget.extend({},p.options),d.each(j,function(h,l){return d.isFunction(l)?(k[h]=function(){var o=function(){return v.prototype[h].apply(this,arguments)},n=function(r){return v.prototype[h].apply(this,r)};return function(){var u,w=this._super,r=this._superApply;return this._super=o,this._superApply=n,u=l.apply(this,arguments),this._super=w,this._superApply=r,u}}(),b):(k[h]=l,b)}),g.prototype=d.widget.extend(p,{widgetEventPrefix:e?p.widgetEventPrefix:m},k,{constructor:g,namespace:t,widgetName:m,widgetFullName:q}),e?(d.each(e._childConstructors,function(l,h){var n=h.prototype;d.widget(n.namespace+"."+n.widgetName,g,h._proto)}),delete e._childConstructors):v._childConstructors.push(g),d.widget.bridge(m,g)},d.widget.extend=function(g){for(var m,e,k=c.call(arguments,1),l=0,j=k.length;j>l;l++){for(m in k[l]){e=k[l][m],k[l].hasOwnProperty(m)&&e!==b&&(g[m]=d.isPlainObject(e)?d.isPlainObject(g[m])?d.widget.extend({},g[m],e):d.widget.extend({},e):e)}}return g},d.widget.bridge=function(g,h){var e=h.prototype.widgetFullName||g;d.fn[g]=function(m){var n="string"==typeof m,k=c.call(arguments,1),j=this;return m=!n&&k.length?d.widget.extend.apply(null,[m].concat(k)):m,n?this.each(function(){var l,o=d.data(this,e);return o?d.isFunction(o[m])&&"_"!==m.charAt(0)?(l=o[m].apply(o,k),l!==o&&l!==b?(j=l&&l.jquery?j.pushStack(l.get()):l,!1):b):d.error("no such method '"+m+"' for "+g+" widget instance"):d.error("cannot call methods on "+g+" prior to initialization; attempted to call method '"+m+"'")}):this.each(function(){var l=d.data(this,e);l?l.option(m||{})._init():d.data(this,e,new h(m,this))}),j}},d.Widget=function(){},d.Widget._childConstructors=[],d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,g){g=d(g||this.defaultElement||this)[0],this.element=d(g),this.uuid=a++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=d.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=d(),this.hoverable=d(),this.focusable=d(),g!==this&&(d.data(g,this.widgetFullName,this),this._on(!0,this.element,{remove:function(h){h.target===g&&this.destroy()}}),this.document=d(g.style?g.ownerDocument:g.document||g),this.window=d(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:d.noop,_getCreateEventData:d.noop,_create:d.noop,_init:d.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(d.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},option:function(g,h){var l,e,j,k=g;if(0===arguments.length){return d.widget.extend({},this.options)}if("string"==typeof g){if(k={},l=g.split("."),g=l.shift(),l.length){for(e=k[g]=d.widget.extend({},this.options[g]),j=0;l.length-1>j;j++){e[l[j]]=e[l[j]]||{},e=e[l[j]]}if(g=l.pop(),h===b){return e[g]===b?null:e[g]}e[g]=h}else{if(h===b){return this.options[g]===b?null:this.options[g]}k[g]=h}}return this._setOptions(k),this},_setOptions:function(h){var g;for(g in h){this._setOption(g,h[g])}return this},_setOption:function(h,g){return this.options[h]=g,"disabled"===h&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!g).attr("aria-disabled",g),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(g,h,k){var e,j=this;"boolean"!=typeof g&&(k=h,h=g,g=!1),k?(h=e=d(h),this.bindings=this.bindings.add(h)):(k=h,h=this.element,e=this.widget()),d.each(k,function(t,r){function q(){return g||j.options.disabled!==!0&&!d(this).hasClass("ui-state-disabled")?("string"==typeof r?j[r]:r).apply(j,arguments):b}"string"!=typeof r&&(q.guid=r.guid=r.guid||q.guid||d.guid++);var m=t.match(/^(\w+)\s*(.*)$/),p=m[1]+j.eventNamespace,s=m[2];s?e.delegate(s,p,q):h.bind(p,q)})},_off:function(h,g){g=(g||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,h.unbind(g).undelegate(g)},_delay:function(k,h){function g(){return("string"==typeof k?j[k]:k).apply(j,arguments)}var j=this;return setTimeout(g,h||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(g){d(g.currentTarget).addClass("ui-state-hover")},mouseleave:function(g){d(g.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(g){d(g.currentTarget).addClass("ui-state-focus")},focusout:function(g){d(g.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(h,g,j){var l,e,k=this.options[h];if(j=j||{},g=d.Event(g),g.type=(h===this.widgetEventPrefix?h:this.widgetEventPrefix+h).toLowerCase(),g.target=this.element[0],e=g.originalEvent){for(l in e){l in g||(g[l]=e[l])}}return this.element.trigger(g,j),!(d.isFunction(k)&&k.apply(this.element[0],[g].concat(j))===!1||g.isDefaultPrevented())}},d.each({show:"fadeIn",hide:"fadeOut"},function(g,e){d.Widget.prototype["_"+g]=function(j,m,h){"string"==typeof m&&(m={effect:m});var k,l=m?m===!0||"number"==typeof m?e:m.effect||e:g;m=m||{},"number"==typeof m&&(m={duration:m}),k=!d.isEmptyObject(m),m.complete=h,m.delay&&j.delay(m.delay),k&&d.effects&&d.effects.effect[l]?j[g](m):l!==g&&j[l]?j[l](m.duration,m.easing,h):j.queue(function(n){d(this)[g](),h&&h.call(j[0]),n()})}})})(jQuery);(function(b){var a=!1;b(document).mouseup(function(){a=!1}),b.widget("ui.mouse",{version:"1.10.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var c=this;this.element.bind("mousedown."+this.widgetName,function(d){return c._mouseDown(d)}).bind("click."+this.widgetName,function(d){return !0===b.data(d.target,c.widgetName+".preventClickEvent")?(b.removeData(d.target,c.widgetName+".preventClickEvent"),d.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(d){if(!a){this._mouseStarted&&this._mouseUp(d),this._mouseDownEvent=d;var e=this,f=1===d.which,c="string"==typeof this.options.cancel&&d.target.nodeName?b(d.target).closest(this.options.cancel).length:!1;return f&&!c&&this._mouseCapture(d)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(d)&&this._mouseDelayMet(d)&&(this._mouseStarted=this._mouseStart(d)!==!1,!this._mouseStarted)?(d.preventDefault(),!0):(!0===b.data(d.target,this.widgetName+".preventClickEvent")&&b.removeData(d.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(g){return e._mouseMove(g)},this._mouseUpDelegate=function(g){return e._mouseUp(g)},b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),d.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(c){return b.ui.ie&&(!document.documentMode||9>document.documentMode)&&!c.button?this._mouseUp(c):this._mouseStarted?(this._mouseDrag(c),c.preventDefault()):(this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,c)!==!1,this._mouseStarted?this._mouseDrag(c):this._mouseUp(c)),!this._mouseStarted)},_mouseUp:function(c){return b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,c.target===this._mouseDownEvent.target&&b.data(c.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(c)),!1},_mouseDistanceMet:function(c){return Math.max(Math.abs(this._mouseDownEvent.pageX-c.pageX),Math.abs(this._mouseDownEvent.pageY-c.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return !0}})})(jQuery);(function(C,x){function q(c,d,a){return[parseFloat(c[0])*(g.test(c[0])?d/100:1),parseFloat(c[1])*(g.test(c[1])?a/100:1)]}function D(c,a){return parseInt(C.css(c,a),10)||0}function k(c){var a=c[0];return 9===a.nodeType?{width:c.width(),height:c.height(),offset:{top:0,left:0}}:C.isWindow(a)?{width:c.width(),height:c.height(),offset:{top:c.scrollTop(),left:c.scrollLeft()}}:a.preventDefault?{width:0,height:0,offset:{top:a.pageY,left:a.pageX}}:{width:c.outerWidth(),height:c.outerHeight(),offset:c.offset()}}C.ui=C.ui||{};var A,j=Math.max,b=Math.abs,v=Math.round,m=/left|center|right/,z=/top|center|bottom/,B=/[\+\-]\d+(\.[\d]+)?%?/,y=/^\w+/,g=/%$/,w=C.fn.position;C.position={scrollbarWidth:function(){if(A!==x){return A}var a,c,e=C("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),d=e.children()[0];return C("body").append(e),a=d.offsetWidth,e.css("overflow","scroll"),c=d.offsetWidth,a===c&&(c=e[0].clientWidth),e.remove(),A=a-c},getScrollInfo:function(h){var d=h.isWindow?"":h.element.css("overflow-x"),f=h.isWindow?"":h.element.css("overflow-y"),l="scroll"===d||"auto"===d&&h.width<h.element[0].scrollWidth,c="scroll"===f||"auto"===f&&h.height<h.element[0].scrollHeight;return{width:c?C.position.scrollbarWidth():0,height:l?C.position.scrollbarWidth():0}},getWithinInfo:function(d){var a=C(d||window),c=C.isWindow(a[0]);return{element:a,isWindow:c,offset:a.offset()||{left:0,top:0},scrollLeft:a.scrollLeft(),scrollTop:a.scrollTop(),width:c?a.width():a.outerWidth(),height:c?a.height():a.outerHeight()}}},C.fn.position=function(l){if(!l||!l.of){return w.apply(this,arguments)}l=C.extend({},l);var s,c,d,h,E,u,o=C(l.of),n=C.position.getWithinInfo(l.within),t=C.position.getScrollInfo(n),r=(l.collision||"flip").split(" "),f={};return u=k(o),o[0].preventDefault&&(l.at="left top"),c=u.width,d=u.height,h=u.offset,E=C.extend({},h),C.each(["my","at"],function(){var e,a,p=(l[this]||"").split(" ");1===p.length&&(p=m.test(p[0])?p.concat(["center"]):z.test(p[0])?["center"].concat(p):["center","center"]),p[0]=m.test(p[0])?p[0]:"center",p[1]=z.test(p[1])?p[1]:"center",e=B.exec(p[0]),a=B.exec(p[1]),f[this]=[e?e[0]:0,a?a[0]:0],l[this]=[y.exec(p[0])[0],y.exec(p[1])[0]]}),1===r.length&&(r[1]=r[0]),"right"===l.at[0]?E.left+=c:"center"===l.at[0]&&(E.left+=c/2),"bottom"===l.at[1]?E.top+=d:"center"===l.at[1]&&(E.top+=d/2),s=q(f.at,c,d),E.left+=s[0],E.top+=s[1],this.each(function(){var p,F,K=C(this),N=K.outerWidth(),J=K.outerHeight(),H=D(this,"marginLeft"),L=D(this,"marginTop"),a=N+H+D(this,"marginRight")+t.width,G=J+L+D(this,"marginBottom")+t.height,e=C.extend({},E),I=q(f.my,K.outerWidth(),K.outerHeight());"right"===l.my[0]?e.left-=N:"center"===l.my[0]&&(e.left-=N/2),"bottom"===l.my[1]?e.top-=J:"center"===l.my[1]&&(e.top-=J/2),e.left+=I[0],e.top+=I[1],C.support.offsetFractions||(e.left=v(e.left),e.top=v(e.top)),p={marginLeft:H,marginTop:L},C.each(["left","top"],function(M,O){C.ui.position[r[M]]&&C.ui.position[r[M]][O](e,{targetWidth:c,targetHeight:d,elemWidth:N,elemHeight:J,collisionPosition:p,collisionWidth:a,collisionHeight:G,offset:[s[0]+I[0],s[1]+I[1]],my:l.my,at:l.at,within:n,elem:K})}),l.using&&(F=function(P){var O=h.left-e.left,R=O+c-N,S=h.top-e.top,M=S+d-J,Q={target:{element:o,left:h.left,top:h.top,width:c,height:d},element:{element:K,left:e.left,top:e.top,width:N,height:J},horizontal:0>R?"left":O>0?"right":"center",vertical:0>M?"top":S>0?"bottom":"middle"};N>c&&c>b(O+R)&&(Q.horizontal="center"),J>d&&d>b(S+M)&&(Q.vertical="middle"),Q.important=j(b(O),b(R))>j(b(S),b(M))?"horizontal":"vertical",l.using.call(this,P,Q)}),K.offset(C.extend(e,{using:F}))})},C.ui.position={fit:{left:function(F,u){var o,G=u.within,d=G.isWindow?G.scrollLeft:G.offset.left,E=G.width,c=F.left-u.collisionPosition.marginLeft,p=d-c,f=c+u.collisionWidth-E-d;u.collisionWidth>E?p>0&&0>=f?(o=F.left+p+u.collisionWidth-E-d,F.left+=p-o):F.left=f>0&&0>=p?d:p>f?d+E-u.collisionWidth:d:p>0?F.left+=p:f>0?F.left-=f:F.left=j(F.left-c,F.left)},top:function(F,u){var o,G=u.within,d=G.isWindow?G.scrollTop:G.offset.top,E=u.within.height,c=F.top-u.collisionPosition.marginTop,p=d-c,f=c+u.collisionHeight-E-d;u.collisionHeight>E?p>0&&0>=f?(o=F.top+p+u.collisionHeight-E-d,F.top+=p-o):F.top=f>0&&0>=p?d:p>f?d+E-u.collisionHeight:d:p>0?F.top+=p:f>0?F.top-=f:F.top=j(F.top-c,F.top)}},flip:{left:function(P,K){var H,Q,F=K.within,N=F.offset.left+F.scrollLeft,E=F.width,I=F.isWindow?F.scrollLeft:F.offset.left,G=P.left-K.collisionPosition.marginLeft,M=G-I,O=G+K.collisionWidth-E-I,L="left"===K.my[0]?-K.elemWidth:"right"===K.my[0]?K.elemWidth:0,r="left"===K.at[0]?K.targetWidth:"right"===K.at[0]?-K.targetWidth:0,J=-2*K.offset[0];0>M?(H=P.left+L+r+J+K.collisionWidth-E-N,(0>H||b(M)>H)&&(P.left+=L+r+J)):O>0&&(Q=P.left-K.collisionPosition.marginLeft+L+r+J-I,(Q>0||O>b(Q))&&(P.left+=L+r+J))},top:function(Q,L){var I,R,F=L.within,O=F.offset.top+F.scrollTop,E=F.height,J=F.isWindow?F.scrollTop:F.offset.top,H=Q.top-L.collisionPosition.marginTop,N=H-J,P=H+L.collisionHeight-E-J,M="top"===L.my[1],r=M?-L.elemHeight:"bottom"===L.my[1]?L.elemHeight:0,K="top"===L.at[1]?L.targetHeight:"bottom"===L.at[1]?-L.targetHeight:0,G=-2*L.offset[1];0>N?(R=Q.top+r+K+G+L.collisionHeight-E-O,Q.top+r+K+G>N&&(0>R||b(N)>R)&&(Q.top+=r+K+G)):P>0&&(I=Q.top-L.collisionPosition.marginTop+r+K+G-J,Q.top+r+K+G>P&&(I>0||P>b(I))&&(Q.top+=r+K+G))}},flipfit:{left:function(){C.ui.position.flip.left.apply(this,arguments),C.ui.position.fit.left.apply(this,arguments)},top:function(){C.ui.position.flip.top.apply(this,arguments),C.ui.position.fit.top.apply(this,arguments)}}},function(){var l,d,f,t,c,p=document.getElementsByTagName("body")[0],h=document.createElement("div");l=document.createElement(p?"div":"body"),f={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},p&&C.extend(f,{position:"absolute",left:"-1000px",top:"-1000px"});for(c in f){l.style[c]=f[c]}l.appendChild(h),d=p||document.documentElement,d.insertBefore(l,d.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",t=C(h).offset().left,C.support.offsetFractions=t>10&&11>t,l.innerHTML="",d.removeChild(l)}()})(jQuery);(function(b){var a=0;b.widget("ui.autocomplete",{version:"1.10.2",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var e,d,f,h=this.element[0].nodeName.toLowerCase(),c="textarea"===h,g="input"===h;this.isMultiLine=c?!0:g?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[c||g?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(k){if(this.element.prop("readOnly")){return e=!0,f=!0,d=!0,undefined}e=!1,f=!1,d=!1;var j=b.ui.keyCode;switch(k.keyCode){case j.PAGE_UP:e=!0,this._move("previousPage",k);break;case j.PAGE_DOWN:e=!0,this._move("nextPage",k);break;case j.UP:e=!0,this._keyEvent("previous",k);break;case j.DOWN:e=!0,this._keyEvent("next",k);break;case j.ENTER:case j.NUMPAD_ENTER:this.menu.active&&(e=!0,k.preventDefault(),this.menu.select(k));break;case j.TAB:this.menu.active&&this.menu.select(k);break;case j.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(k),k.preventDefault());break;default:d=!0,this._searchTimeout(k)}},keypress:function(j){if(e){return e=!1,j.preventDefault(),undefined}if(!d){var k=b.ui.keyCode;switch(j.keyCode){case k.PAGE_UP:this._move("previousPage",j);break;case k.PAGE_DOWN:this._move("nextPage",j);break;case k.UP:this._keyEvent("previous",j);break;case k.DOWN:this._keyEvent("next",j)}}},input:function(j){return f?(f=!1,j.preventDefault(),undefined):(this._searchTimeout(j),undefined)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(j){return this.cancelBlur?(delete this.cancelBlur,undefined):(clearTimeout(this.searching),this.close(j),this._change(j),undefined)}}),this._initSource(),this.menu=b("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({input:b(),role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(k){k.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var j=this.menu.element[0];b(k.target).closest(".ui-menu-item").length||this._delay(function(){var l=this;this.document.one("mousedown",function(m){m.target===l.element[0]||m.target===j||b.contains(j,m.target)||l.close()})})},menufocus:function(k,j){if(this.isNewMenu&&(this.isNewMenu=!1,k.originalEvent&&/^mouse/.test(k.originalEvent.type))){return this.menu.blur(),this.document.one("mousemove",function(){b(k.target).trigger(k.originalEvent)}),undefined}var l=j.item.data("ui-autocomplete-item");!1!==this._trigger("focus",k,{item:l})?k.originalEvent&&/^key/.test(k.originalEvent.type)&&this._value(l.value):this.liveRegion.text(l.value)},menuselect:function(m,k){var j=k.item.data("ui-autocomplete-item"),l=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=l,this._delay(function(){this.previous=l,this.selectedItem=j})),!1!==this._trigger("select",m,{item:j})&&this._value(j.value),this.term=this._value(),this.close(m),this.selectedItem=j}}),this.liveRegion=b("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(d,c){this._super(d,c),"source"===d&&this._initSource(),"appendTo"===d&&this.menu.element.appendTo(this._appendTo()),"disabled"===d&&c&&this.xhr&&this.xhr.abort()},_appendTo:function(){var c=this.options.appendTo;return c&&(c=c.jquery||c.nodeType?b(c):this.document.find(c).eq(0)),c||(c=this.element.closest(".ui-front")),c.length||(c=this.document[0].body),c},_initSource:function(){var d,c,e=this;b.isArray(this.options.source)?(d=this.options.source,this.source=function(f,g){g(b.ui.autocomplete.filter(d,f.term))}):"string"==typeof this.options.source?(c=this.options.source,this.source=function(f,g){e.xhr&&e.xhr.abort(),e.xhr=b.ajax({url:c,data:f,dataType:"json",success:function(h){g(h)},error:function(){g([])}})}):this.source=this.options.source},_searchTimeout:function(c){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,c))},this.options.delay)},search:function(d,c){return d=null!=d?d:this._value(),this.term=this._value(),d.length<this.options.minLength?this.close(c):this._trigger("search",c)!==!1?this._search(d):undefined},_search:function(c){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:c},this._response())},_response:function(){var d=this,c=++a;return function(e){c===a&&d.__response(e),d.pending--,d.pending||d.element.removeClass("ui-autocomplete-loading")}},__response:function(c){c&&(c=this._normalize(c)),this._trigger("response",null,{content:c}),!this.options.disabled&&c&&c.length&&!this.cancelSearch?(this._suggest(c),this._trigger("open")):this._close()},close:function(c){this.cancelSearch=!0,this._close(c)},_close:function(c){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",c))},_change:function(c){this.previous!==this._value()&&this._trigger("change",c,{item:this.selectedItem})},_normalize:function(c){return c.length&&c[0].label&&c[0].value?c:b.map(c,function(d){return"string"==typeof d?{label:d,value:d}:b.extend({label:d.label||d.value,value:d.value||d.label},d)})},_suggest:function(d){var c=this.menu.element.empty();this._renderMenu(c,d),this.isNewMenu=!0,this.menu.refresh(),c.show(),this._resizeMenu(),c.position(b.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var c=this.menu.element;c.outerWidth(Math.max(c.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(d,c){var e=this;b.each(c,function(g,f){e._renderItemData(d,f)})},_renderItemData:function(d,c){return this._renderItem(d,c).data("ui-autocomplete-item",c)},_renderItem:function(d,c){return b("<li>").append(b("<a>").text(c.label)).appendTo(d)},_move:function(d,c){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(d)||this.menu.isLastItem()&&/^next/.test(d)?(this._value(this.term),this.menu.blur(),undefined):(this.menu[d](c),undefined):(this.search(null,c),undefined)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(d,c){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(d,c),c.preventDefault())}}),b.extend(b.ui.autocomplete,{escapeRegex:function(c){return c.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(d,c){var e=RegExp(b.ui.autocomplete.escapeRegex(c),"i");return b.grep(d,function(f){return e.test(f.label||f.value||f)})}}),b.widget("ui.autocomplete",b.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(c){return c+(c>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(d){var c;this._superApply(arguments),this.options.disabled||this.cancelSearch||(c=d&&d.length?this.options.messages.results(d.length):this.options.messages.noResults,this.liveRegion.text(c))}})})(jQuery);(function(a){a.widget("ui.menu",{version:"1.10.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,a.proxy(function(b){this.options.disabled&&b.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(b){b.preventDefault()},"click .ui-state-disabled > a":function(b){b.preventDefault()},"click .ui-menu-item:has(a)":function(c){var b=a(c.target).closest(".ui-menu-item");!this.mouseHandled&&b.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(c),b.has(".ui-menu").length?this.expand(c):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(c){var b=a(c.currentTarget);b.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(c,b)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(c,d){var b=this.active||this.element.children(".ui-menu-item").eq(0);d||this.focus(c,b)},blur:function(b){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(b)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(b){a(b.target).closest(".ui-menu").length||this.collapseAll(b),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var b=a(this);b.data("ui-menu-submenu-carat")&&b.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(j){function c(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var f,l,b,k,g,d=!0;switch(j.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(j);break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(j);break;case a.ui.keyCode.HOME:this._move("first","first",j);break;case a.ui.keyCode.END:this._move("last","last",j);break;case a.ui.keyCode.UP:this.previous(j);break;case a.ui.keyCode.DOWN:this.next(j);break;case a.ui.keyCode.LEFT:this.collapse(j);break;case a.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(j);break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:this._activate(j);break;case a.ui.keyCode.ESCAPE:this.collapse(j);break;default:d=!1,l=this.previousFilter||"",b=String.fromCharCode(j.keyCode),k=!1,clearTimeout(this.filterTimer),b===l?k=!0:b=l+b,g=RegExp("^"+c(b),"i"),f=this.activeMenu.children(".ui-menu-item").filter(function(){return g.test(a(this).children("a").text())}),f=k&&-1!==f.index(this.active.next())?this.active.nextAll(".ui-menu-item"):f,f.length||(b=String.fromCharCode(j.keyCode),g=RegExp("^"+c(b),"i"),f=this.activeMenu.children(".ui-menu-item").filter(function(){return g.test(a(this).children("a").text())})),f.length?(this.focus(j,f),f.length>1?(this.previousFilter=b,this.filterTimer=this._delay(function(){delete this.previousFilter},1000)):delete this.previousFilter):delete this.previousFilter}d&&j.preventDefault()},_activate:function(b){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(b):this.select(b))},refresh:function(){var d,b=this.options.icons.submenu,c=this.element.find(this.options.menus);c.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var g=a(this),f=g.prev("a"),h=a("<span>").addClass("ui-menu-icon ui-icon "+b).data("ui-menu-submenu-carat",!0);f.attr("aria-haspopup","true").prepend(h),g.attr("aria-labelledby",f.attr("id"))}),d=c.add(this.element),d.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),d.children(":not(.ui-menu-item)").each(function(){var f=a(this);/[^\-\u2014\u2013\s]/.test(f.text())||f.addClass("ui-widget-content ui-menu-divider")}),d.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!a.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(b,c){"icons"===b&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(c.submenu),this._super(b,c)},focus:function(c,f){var b,d;this.blur(c,c&&"focus"===c.type),this._scrollIntoView(f),this.active=f.first(),d=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",d.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),c&&"keydown"===c.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),b=f.children(".ui-menu"),b.length&&/^mouse/.test(c.type)&&this._startOpening(b),this.activeMenu=f.parent(),this._trigger("focus",c,{item:f})},_scrollIntoView:function(g){var c,d,j,b,h,f;this._hasScroll()&&(c=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,d=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,j=g.offset().top-this.activeMenu.offset().top-c-d,b=this.activeMenu.scrollTop(),h=this.activeMenu.height(),f=g.height(),0>j?this.activeMenu.scrollTop(b+j):j+f>h&&this.activeMenu.scrollTop(b+j-h+f))},blur:function(b,c){c||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",b,{item:this.active}))},_startOpening:function(b){clearTimeout(this.timer),"true"===b.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(b)},this.delay))},_open:function(c){var b=a.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(c.parents(".ui-menu")).hide().attr("aria-hidden","true"),c.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(b)},collapseAll:function(c,b){clearTimeout(this.timer),this.timer=this._delay(function(){var d=b?this.element:a(c&&c.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element),this._close(d),this.blur(c),this.activeMenu=d},this.delay)},_close:function(b){b||(b=this.active?this.active.parent():this.element),b.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(b){var c=this.active&&this.active.parent().closest(".ui-menu-item",this.element);c&&c.length&&(this._close(),this.focus(b,c))},expand:function(b){var c=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();c&&c.length&&(this._open(c.parent()),this._delay(function(){this.focus(b,c)}))},next:function(b){this._move("next","first",b)},previous:function(b){this._move("prev","last",b)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(c,f,b){var d;this.active&&(d="first"===c||"last"===c?this.active["first"===c?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[c+"All"](".ui-menu-item").eq(0)),d&&d.length&&this.active||(d=this.activeMenu.children(".ui-menu-item")[f]()),this.focus(b,d)},nextPage:function(d){var b,c,f;return this.active?(this.isLastItem()||(this._hasScroll()?(c=this.active.offset().top,f=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return b=a(this),0>b.offset().top-c-f}),this.focus(d,b)):this.focus(d,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),undefined):(this.next(d),undefined)},previousPage:function(d){var b,c,f;return this.active?(this.isFirstItem()||(this._hasScroll()?(c=this.active.offset().top,f=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return b=a(this),b.offset().top-c+f>0}),this.focus(d,b)):this.focus(d,this.activeMenu.children(".ui-menu-item").first())),undefined):(this.next(d),undefined)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(c){this.active=this.active||a(c.target).closest(".ui-menu-item");var b={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(c,!0),this._trigger("select",c,b)}})})(jQuery);(function(a){var b=5;a.widget("ui.slider",a.ui.mouse,{version:"1.10.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var g,d,f=this.options,j=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),c="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",h=[];for(d=f.values&&f.values.length||1,j.length>d&&(j.slice(d).remove(),j=j.slice(0,d)),g=j.length;d>g;g++){h.push(c)}this.handles=j.add(a(h.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(k){a(this).data("ui-slider-handle-index",k)})},_createRange:function(){var d=this.options,c="";d.range?(d.range===!0&&(d.values?d.values.length&&2!==d.values.length?d.values=[d.values[0],d.values[0]]:a.isArray(d.values)&&(d.values=d.values.slice(0)):d.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===d.range||"max"===d.range?" ui-slider-range-"+d.range:""))):this.range=a([])},_setupEvents:function(){var c=this.handles.add(this.range).filter("a");this._off(c),this._on(c,this._handleEvents),this._hoverable(c),this._focusable(c)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(p){var k,w,g,t,f,d,m,j,v=this,q=this.options;return q.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),k={x:p.pageX,y:p.pageY},w=this._normValueFromMouse(k),g=this._valueMax()-this._valueMin()+1,this.handles.each(function(h){var c=Math.abs(w-v.values(h));(g>c||g===c&&(h===v._lastChangedValue||v.values(h)===q.min))&&(g=c,t=a(this),f=h)}),d=this._start(p,f),d===!1?!1:(this._mouseSliding=!0,this._handleIndex=f,t.addClass("ui-state-active").focus(),m=t.offset(),j=!a(p.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:p.pageX-m.left-t.width()/2,top:p.pageY-m.top-t.height()/2-(parseInt(t.css("borderTopWidth"),10)||0)-(parseInt(t.css("borderBottomWidth"),10)||0)+(parseInt(t.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(p,f,w),this._animateOff=!0,!0))},_mouseStart:function(){return !0},_mouseDrag:function(d){var f={x:d.pageX,y:d.pageY},c=this._normValueFromMouse(f);return this._slide(d,this._handleIndex,c),!1},_mouseStop:function(c){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(c,this._handleIndex),this._change(c,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(f){var h,d,g,j,c;return"horizontal"===this.orientation?(h=this.elementSize.width,d=f.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(h=this.elementSize.height,d=f.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),g=d/h,g>1&&(g=1),0>g&&(g=0),"vertical"===this.orientation&&(g=1-g),j=this._valueMax()-this._valueMin(),c=this._valueMin()+g*j,this._trimAlignValue(c)},_start:function(d,f){var c={handle:this.handles[f],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(f),c.values=this.values()),this._trigger("start",d,c)},_slide:function(f,h,d){var g,j,c;this.options.values&&this.options.values.length?(g=this.values(h?0:1),2===this.options.values.length&&this.options.range===!0&&(0===h&&d>g||1===h&&g>d)&&(d=g),d!==this.values(h)&&(j=this.values(),j[h]=d,c=this._trigger("slide",f,{handle:this.handles[h],value:d,values:j}),g=this.values(h?0:1),c!==!1&&this.values(h,d,!0))):d!==this.value()&&(c=this._trigger("slide",f,{handle:this.handles[h],value:d}),c!==!1&&this.value(d))},_stop:function(d,f){var c={handle:this.handles[f],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(f),c.values=this.values()),this._trigger("stop",d,c)},_change:function(d,f){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[f],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(f),c.values=this.values()),this._lastChangedValue=f,this._trigger("change",d,c)}},value:function(c){return arguments.length?(this.options.value=this._trimAlignValue(c),this._refreshValue(),this._change(null,0),undefined):this._value()},values:function(g,d){var f,h,c;if(arguments.length>1){return this.options.values[g]=this._trimAlignValue(d),this._refreshValue(),this._change(null,g),undefined}if(!arguments.length){return this._values()}if(!a.isArray(arguments[0])){return this.options.values&&this.options.values.length?this._values(g):this.value()}for(f=this.options.values,h=arguments[0],c=0;f.length>c;c+=1){f[c]=this._trimAlignValue(h[c]),this._change(null,c)}this._refreshValue()},_setOption:function(f,c){var d,g=0;switch("range"===f&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(g=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments),f){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;g>d;d+=1){this._change(null,d)}this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var c=this.options.value;return c=this._trimAlignValue(c)},_values:function(d){var g,c,f;if(arguments.length){return g=this.options.values[d],g=this._trimAlignValue(g)}if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),f=0;c.length>f;f+=1){c[f]=this._trimAlignValue(c[f])}return c}return[]},_trimAlignValue:function(d){if(this._valueMin()>=d){return this._valueMin()}if(d>=this._valueMax()){return this._valueMax()}var g=this.options.step>0?this.options.step:1,c=(d-this._valueMin())%g,f=d-c;return 2*Math.abs(c)>=g&&(f+=c>0?g:-g),parseFloat(f.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var m,j,t,f,p,d=this.options.range,c=this.options,k=this,g=this._animateOff?!1:c.animate,q={};this.options.values&&this.options.values.length?this.handles.each(function(e){j=100*((k.values(e)-k._valueMin())/(k._valueMax()-k._valueMin())),q["horizontal"===k.orientation?"left":"bottom"]=j+"%",a(this).stop(1,1)[g?"animate":"css"](q,c.animate),k.options.range===!0&&("horizontal"===k.orientation?(0===e&&k.range.stop(1,1)[g?"animate":"css"]({left:j+"%"},c.animate),1===e&&k.range[g?"animate":"css"]({width:j-m+"%"},{queue:!1,duration:c.animate})):(0===e&&k.range.stop(1,1)[g?"animate":"css"]({bottom:j+"%"},c.animate),1===e&&k.range[g?"animate":"css"]({height:j-m+"%"},{queue:!1,duration:c.animate}))),m=j}):(t=this.value(),f=this._valueMin(),p=this._valueMax(),j=p!==f?100*((t-f)/(p-f)):0,q["horizontal"===this.orientation?"left":"bottom"]=j+"%",this.handle.stop(1,1)[g?"animate":"css"](q,c.animate),"min"===d&&"horizontal"===this.orientation&&this.range.stop(1,1)[g?"animate":"css"]({width:j+"%"},c.animate),"max"===d&&"horizontal"===this.orientation&&this.range[g?"animate":"css"]({width:100-j+"%"},{queue:!1,duration:c.animate}),"min"===d&&"vertical"===this.orientation&&this.range.stop(1,1)[g?"animate":"css"]({height:j+"%"},c.animate),"max"===d&&"vertical"===this.orientation&&this.range[g?"animate":"css"]({height:100-j+"%"},{queue:!1,duration:c.animate}))},_handleEvents:{keydown:function(d){var e,h,c,g,f=a(d.target).data("ui-slider-handle-index");switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(d.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(d.target).addClass("ui-state-active"),e=this._start(d,f),e===!1)){return}}switch(g=this.options.step,h=c=this.options.values&&this.options.values.length?this.values(f):this.value(),d.keyCode){case a.ui.keyCode.HOME:c=this._valueMin();break;case a.ui.keyCode.END:c=this._valueMax();break;case a.ui.keyCode.PAGE_UP:c=this._trimAlignValue(h+(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.PAGE_DOWN:c=this._trimAlignValue(h-(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(h===this._valueMax()){return}c=this._trimAlignValue(h+g);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(h===this._valueMin()){return}c=this._trimAlignValue(h-g)}this._slide(d,f,c)},click:function(c){c.preventDefault()},keyup:function(d){var c=a(d.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(d,c),this._change(d,c),a(d.target).removeClass("ui-state-active"))}}})})(jQuery);(function(b,c){var a="ui-effects-";b.effects={effect:{}},function(D,y){function v(f,l,d){var h=C[l.type]||{};return null==f?d||!l.def?null:l.def:(f=h.floor?~~f:parseFloat(f),isNaN(f)?l.def:h.mod?(f+h.mod)%h.mod:0>f?0:f>h.max?h.max:f)}function E(d){var e=q(),f=e._rgba=[];return d=d.toLowerCase(),x(w,function(s,p){var G,F=p.re.exec(d),u=F&&p.parse(F),n=p.space||"rgba";return u?(G=e[n](u),e[A[n].cache]=G[A[n].cache],f=e._rgba=G._rgba,!1):y}),f.length?("0,0,0,0"===f.join()&&D.extend(f,B.transparent),e):B[d]}function m(f,h,d){return d=(d+1)%1,1>6*d?f+6*(h-f)*d:1>2*d?h:2>3*d?f+6*(h-f)*(2/3-d):f}var B,k="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",g=/^([\-+])=\s*(\d+\.?\d*)/,w=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(d){return[d[1],d[2],d[3],d[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(d){return[2.55*d[1],2.55*d[2],2.55*d[3],d[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(d){return[parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(d){return[parseInt(d[1]+d[1],16),parseInt(d[2]+d[2],16),parseInt(d[3]+d[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(d){return[d[1],d[2]/100,d[3]/100,d[4]]}}],q=D.Color=function(h,d,f,l){return new D.Color.fn.parse(h,d,f,l)},A={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},C={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},z=q.support={},j=D("<p>")[0],x=D.each;j.style.cssText="background-color:rgba(1,1,1,.5)",z.rgba=j.style.backgroundColor.indexOf("rgba")>-1,x(A,function(d,f){f.cache="_"+d,f.props.alpha={idx:3,type:"percent",def:1}}),q.fn=D.extend(q.prototype,{parse:function(G,F,l,f){if(G===y){return this._rgba=[null,null,null,null],this}(G.jquery||G.nodeType)&&(G=D(G).css(F),F=y);var e=this,t=D.type(G),s=this._rgba=[];return F!==y&&(G=[G,F,l,f],t="array"),"string"===t?this.parse(E(G)||B._default):"array"===t?(x(A.rgba.props,function(d,h){s[h.idx]=v(G[h.idx],h)}),this):"object"===t?(G instanceof q?x(A,function(d,h){G[h.cache]&&(e[h.cache]=G[h.cache].slice())}):x(A,function(n,h){var d=h.cache;x(h.props,function(o,p){if(!e[d]&&h.to){if("alpha"===o||null==G[o]){return}e[d]=h.to(e._rgba)}e[d][p.idx]=v(G[o],p,!0)}),e[d]&&0>D.inArray(null,e[d].slice(0,3))&&(e[d][3]=1,h.from&&(e._rgba=h.from(e[d])))}),this):y},is:function(e){var d=q(e),f=!0,h=this;return x(A,function(n,l){var s,p=d[l.cache];return p&&(s=h[l.cache]||l.to&&l.to(h._rgba)||[],x(l.props,function(r,o){return null!=p[o.idx]?f=p[o.idx]===s[o.idx]:y})),f}),f},_space:function(){var d=[],f=this;return x(A,function(e,h){f[h.cache]&&d.push(e)}),d.pop()},transition:function(f,F){var p=q(f),H=p._space(),d=A[H],G=0===this.alpha()?q("transparent"):this,u=G[d.cache]||d.to(G._rgba),l=u.slice();return p=p[d.cache],x(d.props,function(r,J){var h=J.idx,s=u[h],e=p[h],I=C[J.type]||{};null!==e&&(null===s?l[h]=e:(I.mod&&(e-s>I.mod/2?s+=I.mod:s-e>I.mod/2&&(s-=I.mod)),l[h]=v((e-s)*F+s,J)))}),this[H](l)},blend:function(h){if(1===this._rgba[3]){return this}var d=this._rgba.slice(),f=d.pop(),l=q(h)._rgba;return q(D.map(d,function(n,o){return(1-f)*l[o]+f*n}))},toRgbaString:function(){var f="rgba(",d=D.map(this._rgba,function(h,l){return null==h?l>2?1:0:h});return 1===d[3]&&(d.pop(),f="rgb("),f+d.join()+")"},toHslaString:function(){var f="hsla(",d=D.map(this.hsla(),function(h,l){return null==h&&(h=l>2?1:0),l&&3>l&&(h=Math.round(100*h)+"%"),h});return 1===d[3]&&(d.pop(),f="hsl("),f+d.join()+")"},toHexString:function(h){var d=this._rgba.slice(),f=d.pop();return h&&d.push(~~(255*f)),"#"+D.map(d,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),q.fn.parse.prototype=q.fn,A.hsla.to=function(M){if(null==M[0]||null==M[1]||null==M[2]){return[null,null,null,M[3]]}var I,G,N=M[0]/255,p=M[1]/255,K=M[2]/255,f=M[3],d=Math.max(N,p,K),H=Math.min(N,p,K),F=d-H,J=d+H,L=0.5*J;return I=H===d?0:N===d?60*(p-K)/F+360:p===d?60*(K-N)/F+120:60*(N-p)/F+240,G=0===F?0:0.5>=L?F/J:F/(2-J),[Math.round(I)%360,G,L,null==f?1:f]},A.hsla.from=function(h){if(null==h[0]||null==h[1]||null==h[2]){return[null,null,null,h[3]]}var p=h[0]/360,f=h[1],l=h[2],d=h[3],u=0.5>=l?l*(1+f):l+f-l*f,n=2*l-u;return[Math.round(255*m(n,u,p+1/3)),Math.round(255*m(n,u,p)),Math.round(255*m(n,u,p-1/3)),d]},x(A,function(f,r){var d=r.props,l=r.cache,e=r.to,p=r.from;q.fn[f]=function(o){if(e&&!this[l]&&(this[l]=e(this._rgba)),o===y){return this[l].slice()}var G,t=D.type(o),h="array"===t||"object"===t?o:arguments,F=this[l].slice();return x(d,function(n,H){var u=h["object"===t?n:H.idx];null==u&&(u=F[H.idx]),F[H.idx]=v(u,H)}),p?(G=q(p(F)),G[l]=F,G):q(F)},x(d,function(n,h){q.fn[n]||(q.fn[n]=function(H){var t,F=D.type(H),u="alpha"===n?this._hsla?"hsla":"rgba":f,s=this[u](),G=s[h.idx];return"undefined"===F?G:("function"===F&&(H=H.call(this,G),F=D.type(H)),null==H&&h.empty?this:("string"===F&&(t=g.exec(H),t&&(H=G+parseFloat(t[2])*("+"===t[1]?1:-1))),s[h.idx]=H,this[u](s)))})})}),q.hook=function(f){var d=f.split(" ");x(d,function(l,h){D.cssHooks[h]={set:function(u,G){var p,F,t="";if("transparent"!==G&&("string"!==D.type(G)||(p=E(G)))){if(G=q(p||G),!z.rgba&&1!==G._rgba[3]){for(F="backgroundColor"===h?u.parentNode:u;(""===t||"transparent"===t)&&F&&F.style;){try{t=D.css(F,"backgroundColor"),F=F.parentNode}catch(s){}}G=G.blend(t&&"transparent"!==t?t:"_default")}G=G.toRgbaString()}try{u.style[h]=G}catch(s){}}},D.fx.step[h]=function(n){n.colorInit||(n.start=q(n.elem,h),n.end=q(n.end),n.colorInit=!0),D.cssHooks[h].set(n.elem,n.start.transition(n.end,n.pos))}})},q.hook(k),D.cssHooks.borderColor={expand:function(d){var f={};return x(["Top","Right","Bottom","Left"],function(e,h){f["border"+h+"Color"]=d}),f}},B=D.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function e(l){var j,k,m=l.ownerDocument.defaultView?l.ownerDocument.defaultView.getComputedStyle(l,null):l.currentStyle,h={};if(m&&m.length&&m[0]&&m[m[0]]){for(k=m.length;k--;){j=m[k],"string"==typeof m[j]&&(h[b.camelCase(j)]=m[j])}}else{for(j in m){"string"==typeof m[j]&&(h[j]=m[j])}}return h}function f(k,h){var j,m,l={};for(j in h){m=h[j],k[j]!==m&&(d[j]||(b.fx.step[j]||!isNaN(parseFloat(m)))&&(l[j]=m))}return l}var g=["add","remove","toggle"],d={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};b.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(j,h){b.fx.step[h]=function(k){("none"!==k.end&&!k.setAttr||1===k.pos&&!k.setAttr)&&(jQuery.style(k.elem,h,k.end),k.setAttr=!0)}}),b.fn.addBack||(b.fn.addBack=function(h){return this.add(null==h?this.prevObject:this.prevObject.filter(h))}),b.effects.animateClass=function(m,j,n,l){var k=b.speed(j,n,l);return this.queue(function(){var p,s=b(this),q=s.attr("class")||"",h=k.children?s.find("*").addBack():s;h=h.map(function(){var o=b(this);return{el:o,start:e(this)}}),p=function(){b.each(g,function(r,o){m[o]&&s[o+"Class"](m[o])})},p(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=f(this.start,this.end),this}),s.attr("class",q),h=h.map(function(){var t=this,o=b.Deferred(),r=b.extend({},k,{queue:!1,complete:function(){o.resolve(t)}});return this.el.animate(this.diff,r),o.promise()}),b.when.apply(b,h.get()).done(function(){p(),b.each(arguments,function(){var o=this.el;b.each(this.diff,function(r){o.css(r,"")})}),k.complete.call(s[0])})})},b.fn.extend({addClass:function(h){return function(k,l,m,j){return l?b.effects.animateClass.call(this,{add:k},l,m,j):h.apply(this,arguments)}}(b.fn.addClass),removeClass:function(h){return function(k,l,m,j){return arguments.length>1?b.effects.animateClass.call(this,{remove:k},l,m,j):h.apply(this,arguments)}}(b.fn.removeClass),toggleClass:function(h){return function(k,p,j,m,l){return"boolean"==typeof p||p===c?j?b.effects.animateClass.call(this,p?{add:k}:{remove:k},j,m,l):h.apply(this,arguments):b.effects.animateClass.call(this,{toggle:k},p,j,m)}}(b.fn.toggleClass),switchClass:function(l,j,k,m,h){return b.effects.animateClass.call(this,{add:j,remove:l},k,m,h)}})}(),function(){function d(h,f,g,j){return b.isPlainObject(h)&&(f=h,h=h.effect),h={effect:h},null==f&&(f={}),b.isFunction(f)&&(j=f,g=null,f={}),("number"==typeof f||b.fx.speeds[f])&&(j=g,g=f,f={}),b.isFunction(g)&&(j=g,g=null),f&&b.extend(h,f),g=g||f.duration,h.duration=b.fx.off?0:"number"==typeof g?g:g in b.fx.speeds?b.fx.speeds[g]:b.fx.speeds._default,h.complete=j||f.complete,h}function e(f){return !f||"number"==typeof f||b.fx.speeds[f]?!0:"string"!=typeof f||b.effects.effect[f]?b.isFunction(f)?!0:"object"!=typeof f||f.effect?!1:!0:!0}b.extend(b.effects,{version:"1.10.2",save:function(f,h){for(var g=0;h.length>g;g++){null!==h[g]&&f.data(a+h[g],f[0].style[h[g]])}},restore:function(g,h){var j,f;for(f=0;h.length>f;f++){null!==h[f]&&(j=g.data(a+h[f]),j===c&&(j=""),g.css(h[f],j))}},setMode:function(f,g){return"toggle"===g&&(g=f.is(":hidden")?"show":"hide"),g},getBaseline:function(g,j){var f,h;switch(g[0]){case"top":f=0;break;case"middle":f=0.5;break;case"bottom":f=1;break;default:f=g[0]/j.height}switch(g[1]){case"left":h=0;break;case"center":h=0.5;break;case"right":h=1;break;default:h=g[1]/j.width}return{x:h,y:f}},createWrapper:function(j){if(j.parent().is(".ui-effects-wrapper")){return j.parent()}var g={width:j.outerWidth(!0),height:j.outerHeight(!0),"float":j.css("float")},h=b("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),l={width:j.width(),height:j.height()},f=document.activeElement;try{f.id}catch(k){f=document.body}return j.wrap(h),(j[0]===f||b.contains(j[0],f))&&b(f).focus(),h=j.parent(),"static"===j.css("position")?(h.css({position:"relative"}),j.css({position:"relative"})):(b.extend(g,{position:j.css("position"),zIndex:j.css("z-index")}),b.each(["top","left","bottom","right"],function(m,n){g[n]=j.css(n),isNaN(parseInt(g[n],10))&&(g[n]="auto")}),j.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),j.css(l),h.css(g).show()},removeWrapper:function(g){var f=document.activeElement;return g.parent().is(".ui-effects-wrapper")&&(g.parent().replaceWith(g),(g[0]===f||b.contains(g[0],f))&&b(f).focus()),g},setTransition:function(h,f,g,j){return j=j||{},b.each(f,function(m,l){var k=h.cssUnit(l);k[0]>0&&(j[l]=k[0]*g+k[1])}),j}}),b.fn.extend({effect:function(){function h(p){function m(){b.isFunction(l)&&l.call(q[0]),b.isFunction(p)&&p()}var q=b(this),l=g.complete,o=g.mode;(q.is(":hidden")?"hide"===o:"show"===o)?(q[o](),m()):j.call(q[0],g,m)}var g=d.apply(this,arguments),k=g.mode,f=g.queue,j=b.effects.effect[g.effect];return b.fx.off||!j?k?this[k](g.duration,g.complete):this.each(function(){g.complete&&g.complete.call(this)}):f===!1?this.each(h):this.queue(f||"fx",h)},show:function(f){return function(h){if(e(h)){return f.apply(this,arguments)}var g=d.apply(this,arguments);return g.mode="show",this.effect.call(this,g)}}(b.fn.show),hide:function(f){return function(h){if(e(h)){return f.apply(this,arguments)}var g=d.apply(this,arguments);return g.mode="hide",this.effect.call(this,g)}}(b.fn.hide),toggle:function(f){return function(h){if(e(h)||"boolean"==typeof h){return f.apply(this,arguments)}var g=d.apply(this,arguments);return g.mode="toggle",this.effect.call(this,g)}}(b.fn.toggle),cssUnit:function(h){var f=this.css(h),g=[];return b.each(["em","px","%","pt"],function(j,k){f.indexOf(k)>0&&(g=[parseFloat(f),k])}),g}})}(),function(){var d={};b.each(["Quad","Cubic","Quart","Quint","Expo"],function(f,e){d[e]=function(g){return Math.pow(g,f+2)}}),b.extend(d,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(g){for(var h,f=4;((h=Math.pow(2,--f))-1)/11>g;){}return 1/Math.pow(4,3-f)-7.5625*Math.pow((3*h-2)/22-g,2)}}),b.each(d,function(g,f){b.easing["easeIn"+g]=f,b.easing["easeOut"+g]=function(e){return 1-f(1-e)},b.easing["easeInOut"+g]=function(e){return 0.5>e?f(2*e)/2:1-f(-2*e+2)/2}})}()})(jQuery);(function(){var ai=this,ac=ai._,ae={},ar=Array.prototype,ab=Object.prototype,an=Function.prototype,aw=ar.push,ah=ar.slice,au=ar.concat,ak=ab.toString,aq=ab.hasOwnProperty,ad=ar.forEach,ag=ar.map,ao=ar.reduce,aa=ar.reduceRight,at=ar.filter,ap=ar.every,aj=ar.some,X=ar.indexOf,av=ar.lastIndexOf,Y=Array.isArray,ax=Object.keys,am=an.bind,Z=function(a){return a instanceof Z?a:this instanceof Z?(this._wrapped=a,void 0):new Z(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Z),exports._=Z):ai._=Z,Z.VERSION="1.4.4";var W=Z.each=Z.forEach=function(h,f,g){if(null!=h){if(ad&&h.forEach===ad){h.forEach(f,g)}else{if(h.length===+h.length){for(var c=0,d=h.length;d>c;c++){if(f.call(g,h[c],c,h)===ae){return}}}else{for(var b in h){if(Z.has(h,b)&&f.call(g,h[b],b,h)===ae){return}}}}}};Z.map=Z.collect=function(d,a,b){var c=[];return null==d?c:ag&&d.map===ag?d.map(a,b):(W(d,function(g,e,f){c[c.length]=a.call(b,g,e,f)}),c)};var H="Reduce of empty array with no initial value";Z.reduce=Z.foldl=Z.inject=function(f,b,c,d){var a=arguments.length>2;if(null==f&&(f=[]),ao&&f.reduce===ao){return d&&(b=Z.bind(b,d)),a?f.reduce(b,c):f.reduce(b)}if(W(f,function(h,g,e){a?c=b.call(d,c,h,g,e):(c=h,a=!0)}),!a){throw new TypeError(H)}return c},Z.reduceRight=Z.foldr=function(j,f,g,h){var c=arguments.length>2;if(null==j&&(j=[]),aa&&j.reduceRight===aa){return h&&(f=Z.bind(f,h)),c?j.reduceRight(f,g):j.reduceRight(f)}var d=j.length;if(d!==+d){var b=Z.keys(j);d=b.length}if(W(j,function(e,k,a){k=b?b[--d]:--d,c?g=f.call(h,g,j[k],k,a):(g=j[k],c=!0)}),!c){throw new TypeError(H)}return g},Z.find=Z.detect=function(d,a,b){var c;return Q(d,function(g,e,f){return a.call(b,g,e,f)?(c=g,!0):void 0}),c},Z.filter=Z.select=function(d,a,b){var c=[];return null==d?c:at&&d.filter===at?d.filter(a,b):(W(d,function(g,e,f){a.call(b,g,e,f)&&(c[c.length]=g)}),c)},Z.reject=function(c,a,b){return Z.filter(c,function(g,f,d){return !a.call(b,g,f,d)},b)},Z.every=Z.all=function(d,b,c){b||(b=Z.identity);var a=!0;return null==d?a:ap&&d.every===ap?d.every(b,c):(W(d,function(g,f,e){return(a=a&&b.call(c,g,f,e))?void 0:ae}),!!a)};var Q=Z.some=Z.any=function(d,b,c){b||(b=Z.identity);var a=!1;return null==d?a:aj&&d.some===aj?d.some(b,c):(W(d,function(g,f,e){return a||(a=b.call(c,g,f,e))?ae:void 0}),!!a)};Z.contains=Z.include=function(b,a){return null==b?!1:X&&b.indexOf===X?b.indexOf(a)!=-1:Q(b,function(c){return c===a})},Z.invoke=function(d,a){var b=ah.call(arguments,2),c=Z.isFunction(a);return Z.map(d,function(e){return(c?a:e[a]).apply(e,b)})},Z.pluck=function(b,a){return Z.map(b,function(c){return c[a]})},Z.where=function(c,a,b){return Z.isEmpty(a)?b?null:[]:Z[b?"find":"filter"](c,function(e){for(var d in a){if(a[d]!==e[d]){return !1}}return !0})},Z.findWhere=function(b,a){return Z.where(b,a,!0)},Z.max=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.max.apply(Math,d)}if(!a&&Z.isEmpty(d)){return -1/0}var c={computed:-1/0,value:-1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;e>=c.computed&&(c={value:h,computed:e})}),c.value},Z.min=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.min.apply(Math,d)}if(!a&&Z.isEmpty(d)){return 1/0}var c={computed:1/0,value:1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;c.computed>e&&(c={value:h,computed:e})}),c.value},Z.shuffle=function(d){var a,b=0,c=[];return W(d,function(e){a=Z.random(b++),c[b-1]=c[a],c[a]=e}),c};var al=function(a){return Z.isFunction(a)?a:function(b){return b[a]}};Z.sortBy=function(d,a,b){var c=al(a);return Z.pluck(Z.map(d,function(g,f,e){return{value:g,index:f,criteria:c.call(b,g,f,e)}}).sort(function(j,f){var g=j.criteria,h=f.criteria;if(g!==h){if(g>h||g===void 0){return 1}if(h>g||h===void 0){return -1}}return j.index<f.index?-1:1}),"value")};var P=function(g,c,d,f){var a={},b=al(c||Z.identity);return W(g,function(h,e){var j=b.call(d,h,e,g);f(a,j,h)}),a};Z.groupBy=function(c,a,b){return P(c,a,b,function(f,d,e){(Z.has(f,d)?f[d]:f[d]=[]).push(e)})},Z.countBy=function(c,a,b){return P(c,a,b,function(e,d){Z.has(e,d)||(e[d]=0),e[d]++})},Z.sortedIndex=function(k,f,g,h){g=null==g?Z.identity:al(g);for(var c=g.call(h,f),d=0,b=k.length;b>d;){var j=d+b>>>1;c>g.call(h,k[j])?d=j+1:b=j}return d},Z.toArray=function(a){return a?Z.isArray(a)?ah.call(a):a.length===+a.length?Z.map(a,Z.identity):Z.values(a):[]},Z.size=function(a){return null==a?0:a.length===+a.length?a.length:Z.keys(a).length},Z.first=Z.head=Z.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:ah.call(c,0,a)},Z.initial=function(c,a,b){return ah.call(c,0,c.length-(null==a||b?1:a))},Z.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:ah.call(c,Math.max(c.length-a,0))},Z.rest=Z.tail=Z.drop=function(c,a,b){return ah.call(c,null==a||b?1:a)},Z.compact=function(a){return Z.filter(a,Z.identity)};var G=function(c,a,b){return W(c,function(d){Z.isArray(d)?a?aw.apply(b,d):G(d,a,b):b.push(d)}),b};Z.flatten=function(b,a){return G(b,a,[])},Z.without=function(a){return Z.difference(a,ah.call(arguments,1))},Z.uniq=Z.unique=function(j,f,g,h){Z.isFunction(f)&&(h=g,g=f,f=!1);var c=g?Z.map(j,g,h):j,d=[],b=[];return W(c,function(a,k){(f?k&&b[b.length-1]===a:Z.contains(b,a))||(b.push(a),d.push(j[k]))}),d},Z.union=function(){return Z.uniq(au.apply(ar,arguments))},Z.intersection=function(b){var a=ah.call(arguments,1);return Z.filter(Z.uniq(b),function(c){return Z.every(a,function(d){return Z.indexOf(d,c)>=0})})},Z.difference=function(b){var a=au.apply(ar,ah.call(arguments,1));return Z.filter(b,function(c){return !Z.contains(a,c)})},Z.zip=function(){for(var d=ah.call(arguments),a=Z.max(Z.pluck(d,"length")),b=Array(a),c=0;a>c;c++){b[c]=Z.pluck(d,""+c)}return b},Z.object=function(f,b){if(null==f){return{}}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1]}return c},Z.indexOf=function(f,b,c){if(null==f){return -1}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=Z.sortedIndex(f,b),f[d]===b?d:-1}d=0>c?Math.max(0,a+c):c}if(X&&f.indexOf===X){return f.indexOf(b,c)}for(;a>d;d++){if(f[d]===b){return d}}return -1},Z.lastIndexOf=function(f,b,c){if(null==f){return -1}var d=null!=c;if(av&&f.lastIndexOf===av){return d?f.lastIndexOf(b,c):f.lastIndexOf(b)}for(var a=d?c:f.length;a--;){if(f[a]===b){return a}}return -1},Z.range=function(g,c,d){1>=arguments.length&&(c=g||0,g=0),d=arguments[2]||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=0,b=Array(f);f>a;){b[a++]=g,g+=d}return b},Z.bind=function(c,a){if(c.bind===am&&am){return am.apply(c,ah.call(arguments,1))}var b=ah.call(arguments,2);return function(){return c.apply(a,b.concat(ah.call(arguments)))}},Z.partial=function(b){var a=ah.call(arguments,1);return function(){return b.apply(this,a.concat(ah.call(arguments)))}},Z.bindAll=function(b){var a=ah.call(arguments,1);return 0===a.length&&(a=Z.functions(b)),W(a,function(c){b[c]=Z.bind(b[c],b)}),b},Z.memoize=function(c,a){var b={};return a||(a=Z.identity),function(){var d=a.apply(this,arguments);return Z.has(b,d)?b[d]:b[d]=c.apply(this,arguments)}},Z.delay=function(c,a){var b=ah.call(arguments,2);return setTimeout(function(){return c.apply(null,b)},a)},Z.defer=function(a){return Z.delay.apply(Z,[a,1].concat(ah.call(arguments,1)))},Z.throttle=function(k,f){var g,h,c,d,b=0,j=function(){b=new Date,c=null,d=k.apply(g,h)};return function(){var e=new Date,a=f-(e-b);return g=this,h=arguments,0>=a?(clearTimeout(c),c=null,b=e,d=k.apply(g,h)):c||(c=setTimeout(j,a)),d}},Z.debounce=function(f,b,c){var d,a;return function(){var g=this,e=arguments,h=function(){d=null,c||(a=f.apply(g,e))},j=c&&!d;return clearTimeout(d),d=setTimeout(h,b),j&&(a=f.apply(g,e)),a}},Z.once=function(c){var a,b=!1;return function(){return b?a:(b=!0,a=c.apply(this,arguments),c=null,a)}},Z.wrap=function(b,a){return function(){var c=[b];return aw.apply(c,arguments),a.apply(this,c)}},Z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}},Z.after=function(b,a){return 0>=b?a():function(){return 1>--b?a.apply(this,arguments):void 0}},Z.keys=ax||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var a=[];for(var b in c){Z.has(c,b)&&(a[a.length]=b)}return a},Z.values=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push(c[b])}return a},Z.pairs=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push([b,c[b]])}return a},Z.invert=function(c){var a={};for(var b in c){Z.has(c,b)&&(a[c[b]]=b)}return a},Z.functions=Z.methods=function(c){var a=[];for(var b in c){Z.isFunction(c[b])&&a.push(b)}return a.sort()},Z.extend=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){a[c]=b[c]}}}),a},Z.pick=function(c){var a={},b=au.apply(ar,ah.call(arguments,1));return W(b,function(d){d in c&&(a[d]=c[d])}),a},Z.omit=function(d){var b={},c=au.apply(ar,ah.call(arguments,1));for(var a in d){Z.contains(c,a)||(b[a]=d[a])}return b},Z.defaults=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){null==a[c]&&(a[c]=b[c])}}}),a},Z.clone=function(a){return Z.isObject(a)?Z.isArray(a)?a.slice():Z.extend({},a):a},Z.tap=function(b,a){return a(b),b};var L=function(g,q,b,k){if(g===q){return 0!==g||1/g==1/q}if(null==g||null==q){return g===q}g instanceof Z&&(g=g._wrapped),q instanceof Z&&(q=q._wrapped);var p=ak.call(g);if(p!=ak.call(q)){return !1}switch(p){case"[object String]":return g==q+"";case"[object Number]":return g!=+g?q!=+q:0==g?1/g==1/q:g==+q;case"[object Date]":case"[object Boolean]":return +g==+q;case"[object RegExp]":return g.source==q.source&&g.global==q.global&&g.multiline==q.multiline&&g.ignoreCase==q.ignoreCase}if("object"!=typeof g||"object"!=typeof q){return !1}for(var h=b.length;h--;){if(b[h]==g){return k[h]==q}}b.push(g),k.push(q);var m=0,d=!0;if("[object Array]"==p){if(m=g.length,d=m==q.length){for(;m--&&(d=L(g[m],q[m],b,k));){}}}else{var l=g.constructor,j=q.constructor;if(l!==j&&!(Z.isFunction(l)&&l instanceof l&&Z.isFunction(j)&&j instanceof j)){return !1}for(var v in g){if(Z.has(g,v)&&(m++,!(d=Z.has(q,v)&&L(g[v],q[v],b,k)))){break}}if(d){for(v in q){if(Z.has(q,v)&&!m--){break}}d=!m}}return b.pop(),k.pop(),d};Z.isEqual=function(b,a){return L(b,a,[],[])},Z.isEmpty=function(b){if(null==b){return !0}if(Z.isArray(b)||Z.isString(b)){return 0===b.length}for(var a in b){if(Z.has(b,a)){return !1}}return !0},Z.isElement=function(a){return !(!a||1!==a.nodeType)},Z.isArray=Y||function(a){return"[object Array]"==ak.call(a)},Z.isObject=function(a){return a===Object(a)},W(["Arguments","Function","String","Number","Date","RegExp"],function(a){Z["is"+a]=function(b){return ak.call(b)=="[object "+a+"]"}}),Z.isArguments(arguments)||(Z.isArguments=function(a){return !(!a||!Z.has(a,"callee"))}),"function"!=typeof/./&&(Z.isFunction=function(a){return"function"==typeof a}),Z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},Z.isNaN=function(a){return Z.isNumber(a)&&a!=+a},Z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==ak.call(a)},Z.isNull=function(a){return null===a},Z.isUndefined=function(a){return a===void 0},Z.has=function(b,a){return aq.call(b,a)},Z.noConflict=function(){return ai._=ac,this},Z.identity=function(a){return a},Z.times=function(f,b,c){for(var d=Array(f),a=0;f>a;a++){d[a]=b.call(c,a)}return d},Z.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1))};var K={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};K.unescape=Z.invert(K.escape);var C={escape:RegExp("["+Z.keys(K.escape).join("")+"]","g"),unescape:RegExp("("+Z.keys(K.unescape).join("|")+")","g")};Z.each(["escape","unescape"],function(a){Z[a]=function(b){return null==b?"":(""+b).replace(C[a],function(c){return K[a][c]})}}),Z.result=function(c,a){if(null==c){return null}var b=c[a];return Z.isFunction(b)?b.call(c):b},Z.mixin=function(a){W(Z.functions(a),function(b){var c=Z[b]=a[b];Z.prototype[b]=function(){var d=[this._wrapped];return aw.apply(d,arguments),U.call(this,c.apply(Z,d))}})};var J=0;Z.uniqueId=function(b){var a=++J+"";return b?b+a:a},Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,af={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;Z.template=function(f,m,b){var h;b=Z.defaults({},b,Z.templateSettings);var l=RegExp([(b.escape||z).source,(b.interpolate||z).source,(b.evaluate||z).source].join("|")+"|$","g"),g=0,k="__p+='";f.replace(l,function(c,n,p,a,q){return k+=f.slice(g,q).replace(V,function(e){return"\\"+af[e]}),n&&(k+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),p&&(k+="'+\n((__t=("+p+"))==null?'':__t)+\n'"),a&&(k+="';\n"+a+"\n__p+='"),g=q+c.length,c}),k+="';\n",b.variable||(k="with(obj||{}){\n"+k+"}\n"),k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{h=Function(b.variable||"obj","_",k)}catch(d){throw d.source=k,d}if(m){return h(m,Z)}var j=function(a){return h.call(this,a,Z)};return j.source="function("+(b.variable||"obj")+"){\n"+k+"}",j},Z.chain=function(a){return Z(a).chain()};var U=function(a){return this._chain?Z(a).chain():a};Z.mixin(Z),W(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=ar[b];Z.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!=b&&"splice"!=b||0!==c.length||delete c[0],U.call(this,c)}}),W(["concat","join","slice"],function(b){var a=ar[b];Z.prototype[b]=function(){return U.call(this,a.apply(this._wrapped,arguments))}}),Z.extend(Z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);window.$u=_.noConflict();
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var E="undefined",s="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",r="application/x-shockwave-flash",S="SWFObjectExprInst",y="onreadystatechange",P=window,k=document,u=navigator,V=false,W=[h],p=[],O=[],J=[],m,R,F,C,K=false,a=false,o,H,n=true,N=function(){var ac=typeof k.getElementById!=E&&typeof k.getElementsByTagName!=E&&typeof k.createElement!=E,aj=u.userAgent.toLowerCase(),aa=u.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;if(typeof u.plugins!=E&&typeof u.plugins[U]==s){ad=u.plugins[U].description;if(ad&&!(typeof u.mimeTypes!=E&&u.mimeTypes[r]&&!u.mimeTypes[r].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof P.ActiveXObject!=E){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}}(),l=function(){if(!N.w3){return}if((typeof k.readyState!=E&&k.readyState=="complete")||(typeof k.readyState==E&&(k.getElementsByTagName("body")[0]||k.body))){f()}if(!K){if(typeof k.addEventListener!=E){k.addEventListener("DOMContentLoaded",f,false)}if(N.ie&&N.win){k.attachEvent(y,function(){if(k.readyState=="complete"){k.detachEvent(y,arguments.callee);f()}});if(P==top){(function(){if(K){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}f()})()}}if(N.wk){(function(){if(K){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}f()})()}t(f)}}();function f(){if(K){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(D("span"));ab.parentNode.removeChild(ab)}catch(ac){return}K=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function L(Z){if(K){Z()}else{W[W.length]=Z}}function t(aa){if(typeof P.addEventListener!=E){P.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=E){k.addEventListener("load",aa,false)}else{if(typeof P.attachEvent!=E){j(P,"onload",aa)}else{if(typeof P.onload=="function"){var Z=P.onload;P.onload=function(){Z();aa()}}else{P.onload=aa}}}}}function h(){if(V){X()}else{I()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=D(s);ac.setAttribute("type",r);var ab=Z.appendChild(ac);if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=E){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");N.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;I()})()}else{I()}}function I(){var ai=p.length;if(ai>0){for(var ah=0;ah<ai;ah++){var aa=p[ah].id;var ad=p[ah].callbackFn;var ac={success:false,id:aa};if(N.pv[0]>0){var ag=c(aa);if(ag){if(G(p[ah].swfVersion)&&!(N.wk&&N.wk<312)){x(aa,true);if(ad){ac.success=true;ac.ref=A(aa);ad(ac)}}else{if(p[ah].expressInstall&&B()){var ak={};ak.data=p[ah].expressInstall;ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")}}Q(ak,aj,aa,ad)}else{q(ag);if(ad){ad(ac)}}}}}else{x(aa,true);if(ad){var ab=A(aa);if(ab&&typeof ab.SetVariable!=E){ac.success=true;ac.ref=ab}ad(ac)}}}}}function A(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=E){Z=aa}else{var ab=aa.getElementsByTagName(s)[0];if(ab){Z=ab}}}return Z}function B(){return !a&&G("6.0.65")&&(N.win||N.mac)&&!(N.wk&&N.wk<312)}function Q(ac,ad,Z,ab){a=true;F=ab||null;C={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){m=g(ag);R=null}else{m=ag;R=Z}ac.id=S;if(typeof ac.width==E||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"}if(typeof ac.height==E||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=N.ie&&N.win?"ActiveX":"PlugIn",ae="MMredirectURL="+P.location.toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=E){ad.flashvars+="&"+ae}else{ad.flashvars=ae}if(N.ie&&N.win&&ag.readyState!=4){var aa=D("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}v(ac,ad,Z)}}function q(aa){if(N.ie&&N.win&&aa.readyState!=4){var Z=D("div");aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(g(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(g(aa),aa)}}function g(ae){var ad=D("div");if(N.win&&N.ie){ad.innerHTML=ae.innerHTML}else{var aa=ae.getElementsByTagName(s)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function v(ak,ai,aa){var Z,ac=c(aa);if(N.wk&&N.wk<312){return Z}if(ac){if(typeof ak.id==E){ak.id=aa}if(N.ie&&N.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";O[O.length]=ak.id;Z=c(ak.id)}else{var ab=D(s);ab.setAttribute("type",r);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){e(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function e(ab,Z,aa){var ac=D("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);ab.appendChild(ac)}function z(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(N.ie&&N.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function D(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);J[J.length]=[ab,Z,aa]}function G(ab){var aa=N.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function w(ae,aa,af,ad){if(N.ie&&N.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){o=null;H=null}if(!o||H!=Z){var ab=D("style");ab.setAttribute("type","text/css");ab.setAttribute("media",Z);o=ac.appendChild(ab);if(N.ie&&N.win&&typeof k.styleSheets!=E&&k.styleSheets.length>0){o=k.styleSheets[k.styleSheets.length-1]}H=Z}if(N.ie&&N.win){if(o&&typeof o.addRule==s){o.addRule(ae,aa)}}else{if(o&&typeof k.createTextNode!=E){o.appendChild(k.createTextNode(ae+" {"+aa+"}"))}}}function x(ab,Z){if(!n){return}var aa=Z?"visible":"hidden";if(K&&c(ab)){c(ab).style.visibility=aa}else{w("#"+ab,"visibility:"+aa)}}function M(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=E?encodeURIComponent(aa):aa}var d=function(){if(N.ie&&N.win){window.attachEvent("onunload",function(){var ae=J.length;for(var ad=0;ad<ae;ad++){J[ad][0].detachEvent(J[ad][1],J[ad][2])}var ab=O.length;for(var ac=0;ac<ab;ac++){z(O[ac])}for(var aa in N){N[aa]=null}N=null;for(var Z in swfobject){swfobject[Z]=null}swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(N.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;aa.expressInstall=ac;aa.callbackFn=ab;p[p.length]=aa;x(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(N.w3){return A(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(N.w3&&!(N.wk&&N.wk<312)&&ad&&aj&&ag&&ai&&aa){x(aj,false);L(function(){ag+="";ai+="";var al={};if(ah&&typeof ah===s){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===s){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===s){for(var ak in ab){if(typeof ao.flashvars!=E){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]}}}if(G(aa)){var ap=v(al,ao,aj);if(al.id==aj){x(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&B()){al.data=ac;Q(al,ao,aj,ae);return}else{x(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){n=false},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(ab,aa,Z){if(N.w3){return v(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(N.w3&&B()){Q(ab,ac,Z,aa)}},removeSWF:function(Z){if(N.w3){z(Z)}},createCSS:function(ac,ab,aa,Z){if(N.w3){w(ac,ab,aa,Z)}},addDomLoadEvent:L,addLoadEvent:t,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return M(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return M(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(S);if(Z&&m){Z.parentNode.replaceChild(m,Z);if(R){x(R,true);if(N.ie&&N.win){m.style.display="block"}}if(F){F(C)}}a=false}}}}();var FlashDetect=new function(){var a=this;a.installed=false;a.raw="";a.major=-1;a.minor=-1;a.revision=-1;a.revisionStr="";var b=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(h){return d(h)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(k){var h="6,0,21";try{k.AllowScriptAccess="always";h=d(k)}catch(j){}return h}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(h){return d(h)}}];var d=function(k){var h=-1;try{h=k.GetVariable("$version")}catch(j){}return h};var g=function(h){var k=-1;try{k=new ActiveXObject(h)}catch(j){k={activeXError:true}}return k};var c=function(j){var h=j.split(",");return{raw:j,major:parseInt(h[0].split(" ")[1],10),minor:parseInt(h[1],10),revision:parseInt(h[2],10),revisionStr:h[2]}};var f=function(l){var j=l.split(/ +/);var k=j[2].split(/\./);var h=j[3];return{raw:l,major:parseInt(k[0],10),minor:parseInt(k[1],10),revisionStr:h,revision:e(h)}};var e=function(h){return parseInt(h.replace(/[a-zA-Z]/g,""),10)||a.revision};a.majorAtLeast=function(h){return a.major>=h};a.minorAtLeast=function(h){return a.minor>=h};a.revisionAtLeast=function(h){return a.revision>=h};a.versionAtLeast=function(j){var k=[a.major,a.minor,a.revision];var h=Math.min(k.length,arguments.length);for(i=0;i<h;i++){if(k[i]>=arguments[i]){if(i+1<h&&k[i]==arguments[i]){continue}else{return true}}else{return false}}};a.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var l="application/x-shockwave-flash";var k=navigator.mimeTypes;if(k&&k[l]&&k[l].enabledPlugin&&k[l].enabledPlugin.description){var h=k[l].enabledPlugin.description;var m=f(h);a.raw=m.raw;a.major=m.major;a.minor=m.minor;a.revisionStr=m.revisionStr;a.revision=m.revision;a.installed=true}}else{if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){var h=-1;for(var j=0;j<b.length&&h==-1;j++){var n=g(b[j].name);if(!n.activeXError){a.installed=true;h=b[j].version(n);if(h!=-1){var m=c(h);a.raw=m.raw;a.major=m.major;a.minor=m.minor;a.revision=m.revision;a.revisionStr=m.revisionStr}}}}}}()};FlashDetect.JS_RELEASE="1.0.4";(function(c){var g,f={},o={16:false,18:false,17:false,91:false},d="all",a={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},p={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};for(g=1;g<20;g++){p["f"+g]=111+g}function m(s,r){var k=s.length;while(k--){if(s[k]===r){return k}}return -1}function n(w){var u,t,x,v,r,s,y;x=w.target||w.srcElement;t=x.tagName;u=w.keyCode;if(u==93||u==224){u=91}if(u in o){o[u]=true;for(r in a){if(a[r]==u){b[r]=true}}return}if(t=="INPUT"||t=="SELECT"||t=="TEXTAREA"){if(["submit","button"].indexOf(x.type)==-1){if(u!=p.escape&&u!=p.tab){return}}}if(!(u in f)){return}for(s=0;s<f[u].length;s++){v=f[u][s];if(v.scope==d||v.scope=="all"){y=v.mods.length>0;for(r in o){if((!o[r]&&m(v.mods,+r)>-1)||(o[r]&&m(v.mods,+r)==-1)){y=false}}if((v.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91])||y){if(v.method(w,v)===false){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}if(w.stopPropagation){w.stopPropagation()}if(w.cancelBubble){w.cancelBubble=true}}}}}}function e(t){var s=t.keyCode,r;if(s==93||s==224){s=91}if(s in o){o[s]=false;for(r in a){if(a[r]==s){b[r]=false}}}}function q(){for(g in o){if(o.hasOwnProperty(g)){o[g]=false}}}function b(s,t,w){var v,u,r,k;if(w===undefined){w=t;t="all"}s=s.replace(/\s/g,"");v=s.split(",");if((v[v.length-1])==""){v[v.length-2]+=","}for(r=0;r<v.length;r++){u=[];s=v[r].split("+");if(s.length>1){u=s.slice(0,s.length-1);for(k=0;k<u.length;k++){u[k]=a[u[k]]}s=[s[s.length-1]]}s=s[0];s=p[s]||s.toUpperCase().charCodeAt(0);if(!(s in f)){f[s]=[]}f[s].push({shortcut:v[r],scope:t,method:w,key:v[r],mods:u})}}for(g in a){b[g]=false}function j(k){d=k||"all"}function l(){return d}function h(k,r,s){if(k.addEventListener){k.addEventListener(r,s,false)}else{if(k.attachEvent){k.attachEvent("on"+r,function(){s(window.event)})}}}h(document,"keydown",n);h(document,"keyup",e);h(window,"focus",q);h(document,"contextmenu",q);c.key=b;c.key.setScope=j;c.key.getScope=l;if(typeof module!=="undefined"){module.exports=key}})(this);window.Modernizr=function(ax,aw,av){function V(b){an.cssText=b}function U(d,c){return V(aj.join(d+";")+(c||""))}function S(d,c){return typeof d===c}function R(d,c){return !!~(""+d).indexOf(c)}function Q(e,c){for(var f in e){if(an[e[f]]!==av){return c=="pfx"?e[f]:!0}}return !1}function P(g,c,k){for(var j in g){var h=c[g[j]];if(h!==av){return k===!1?g[j]:S(h,"function")?h.bind(k||c):h}}return !1}function O(g,f,k){var j=g.charAt(0).toUpperCase()+g.substr(1),h=(g+" "+ah.join(j+" ")+j).split(" ");return S(f,"string")||S(f,"undefined")?Q(h,f):(h=(g+" "+ag.join(j+" ")+j).split(" "),P(h,f,k))}function M(){at.input=function(f){for(var b=0,a=f.length;b<a;b++){ad[f[b]]=f[b] in am}return ad.list&&(ad.list=!!aw.createElement("datalist")&&!!ax.HTMLDataListElement),ad}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),at.inputtypes=function(b){for(var l=0,k,j,g,c=b.length;l<c;l++){am.setAttribute("type",j=b[l]),k=am.type!=="text",k&&(am.value=al,am.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(j)&&am.style.WebkitAppearance!==av?(aq.appendChild(am),g=aw.defaultView,k=g.getComputedStyle&&g.getComputedStyle(am,null).WebkitAppearance!=="textfield"&&am.offsetHeight!==0,aq.removeChild(am)):/^(search|tel)$/.test(j)||(/^(url|email)$/.test(j)?k=am.checkValidity&&am.checkValidity()===!1:/^color$/.test(j)?(aq.appendChild(am),aq.offsetWidth,k=am.value!=al,aq.removeChild(am)):k=am.value!=al)),ae[b[l]]=!!k}return ae}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var au="2.5.3",at={},ar=!0,aq=aw.documentElement,ap="modernizr",ao=aw.createElement(ap),an=ao.style,am=aw.createElement("input"),al=":)",ak={}.toString,aj=" -webkit- -moz- -o- -ms- ".split(" "),ai="Webkit Moz O ms",ah=ai.split(" "),ag=ai.toLowerCase().split(" "),af={},ae={},ad={},ac=[],ab=ac.slice,aa,Z=function(t,s,r,q){var p,o,n,h=aw.createElement("div"),g=aw.body,b=g?g:aw.createElement("body");if(parseInt(r,10)){while(r--){n=aw.createElement("div"),n.id=q?q[r]:ap+(r+1),h.appendChild(n)}}return p=["&#173;","<style>",t,"</style>"].join(""),h.id=ap,(g?h:b).innerHTML+=p,b.appendChild(h),g||(b.style.background="",aq.appendChild(b)),o=s(h,t),g?h.parentNode.removeChild(h):b.parentNode.removeChild(b),!!o},Y=function(){function c(h,g){g=g||aw.createElement(b[h]||"div"),h="on"+h;var a=h in g;return a||(g.setAttribute||(g=aw.createElement("div")),g.setAttribute&&g.removeAttribute&&(g.setAttribute(h,""),a=S(g[h],"function"),S(g[h],"undefined")||(g[h]=av),g.removeAttribute(h))),g=null,a}var b={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return c}(),X={}.hasOwnProperty,W;!S(X,"undefined")&&!S(X.call,"undefined")?W=function(d,c){return X.call(d,c)}:W=function(d,c){return c in d&&S(d.constructor.prototype[c],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var h=this;if(typeof h!="function"){throw new TypeError}var g=ab.call(arguments,1),f=function(){if(this instanceof f){var b=function(){};b.prototype=h.prototype;var d=new b,c=h.apply(d,g.concat(ab.call(arguments)));return Object(c)===c?c:d}return h.apply(a,g.concat(ab.call(arguments)))};return f});var N=function(h,e){var b=h.join(""),a=e.length;Z(b,function(o,n){var m=aw.styleSheets[aw.styleSheets.length-1],l=m?m.cssRules&&m.cssRules[0]?m.cssRules[0].cssText:m.cssText||"":"",k=o.childNodes,g={};while(a--){g[k[a].id]=k[a]}at.touch="ontouchstart" in ax||ax.DocumentTouch&&aw instanceof DocumentTouch||(g.touch&&g.touch.offsetTop)===9,at.csstransforms3d=(g.csstransforms3d&&g.csstransforms3d.offsetLeft)===9&&g.csstransforms3d.offsetHeight===3,at.generatedcontent=(g.generatedcontent&&g.generatedcontent.offsetHeight)>=1,at.fontface=/src/i.test(l)&&l.indexOf(n.split(" ")[0])===0},a,e)}(['@font-face {font-family:"font";src:url("https://")}',["@media (",aj.join("touch-enabled),("),ap,")","{#touch{top:9px;position:absolute}}"].join(""),["@media (",aj.join("transform-3d),("),ap,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join(""),['#generatedcontent:after{content:"',al,'";visibility:hidden}'].join("")],["fontface","touch","csstransforms3d","generatedcontent"]);af.flexbox=function(){return O("flexOrder")},af.canvas=function(){var b=aw.createElement("canvas");return !!b.getContext&&!!b.getContext("2d")},af.canvastext=function(){return !!at.canvas&&!!S(aw.createElement("canvas").getContext("2d").fillText,"function")},af.touch=function(){return at.touch},af.postmessage=function(){return !!ax.postMessage},af.websqldatabase=function(){return !!ax.openDatabase},af.indexedDB=function(){return !!O("indexedDB",ax)},af.hashchange=function(){return Y("hashchange",ax)&&(aw.documentMode===av||aw.documentMode>7)},af.history=function(){return !!ax.history&&!!history.pushState},af.draganddrop=function(){var b=aw.createElement("div");return"draggable" in b||"ondragstart" in b&&"ondrop" in b},af.websockets=function(){for(var a=-1,d=ah.length;++a<d;){if(ax[ah[a]+"WebSocket"]){return !0}}return"WebSocket" in ax},af.rgba=function(){return V("background-color:rgba(150,255,150,.5)"),R(an.backgroundColor,"rgba")},af.hsla=function(){return V("background-color:hsla(120,40%,100%,.5)"),R(an.backgroundColor,"rgba")||R(an.backgroundColor,"hsla")},af.multiplebgs=function(){return V("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(an.background)},af.backgroundsize=function(){return O("backgroundSize")},af.borderimage=function(){return O("borderImage")},af.borderradius=function(){return O("borderRadius")},af.boxshadow=function(){return O("boxShadow")},af.textshadow=function(){return aw.createElement("div").style.textShadow===""},af.opacity=function(){return U("opacity:.55"),/^0.55$/.test(an.opacity)},af.cssanimations=function(){return O("animationName")},af.csscolumns=function(){return O("columnCount")},af.cssgradients=function(){var e="background-image:",d="gradient(linear,left top,right bottom,from(#9f9),to(white));",f="linear-gradient(left top,#9f9, white);";return V((e+"-webkit- ".split(" ").join(d+e)+aj.join(f+e)).slice(0,-e.length)),R(an.backgroundImage,"gradient")},af.cssreflections=function(){return O("boxReflect")},af.csstransforms=function(){return !!O("transform")},af.csstransforms3d=function(){var b=!!O("perspective");return b&&"webkitPerspective" in aq.style&&(b=at.csstransforms3d),b},af.csstransitions=function(){return O("transition")},af.fontface=function(){return at.fontface},af.generatedcontent=function(){return at.generatedcontent},af.video=function(){var b=aw.createElement("video"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),f.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),f.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(e){}return f},af.audio=function(){var b=aw.createElement("audio"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),f.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,""),f.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),f.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(e){}return f},af.localstorage=function(){try{return localStorage.setItem(ap,ap),localStorage.removeItem(ap),!0}catch(b){return !1}},af.sessionstorage=function(){try{return sessionStorage.setItem(ap,ap),sessionStorage.removeItem(ap),!0}catch(b){return !1}},af.webworkers=function(){return !!ax.Worker},af.applicationcache=function(){return !!ax.applicationCache};for(var L in af){W(af,L)&&(aa=L.toLowerCase(),at[aa]=af[L](),ac.push((at[aa]?"":"no-")+aa))}return at.input||M(),V(""),ao=am=null,at._version=au,at._prefixes=aj,at._domPrefixes=ag,at._cssomPrefixes=ah,at.hasEvent=Y,at.testProp=function(b){return Q([b])},at.testAllProps=O,at.testStyles=Z,aq.className=aq.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(ar?" js "+ac.join(" "):""),at}(this,this.document);var HTML=Class.create({initialize:function(a){if(a instanceof HTML){return a}this._str_DONT_TOUCH=a},toHTML:function(){return this._str_DONT_TOUCH},toString:function(){return"[object HTML]"}});(function(){var d={};HTML.tmpl=function c(k,j){var h=!/\W/.test(k)?d[k]=d[k]||c(document.getElementById(k).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+k.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.*?)%>/g,"',HTML._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('")+"');}return new HTML(p.join('').trim());");return j?h(j):h};var e=/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@\.\ _\-\(\)\,\$~%#\[\]\{\}\!\^]/g;var f=function b(h){return"&#"+h.charCodeAt(0)+";"};function g(h){return(""+h).replace(e,f)}HTML.escape=HTML.quoteattr=function(h){if(h instanceof HTML){return h}else{return new HTML(g(h))}};HTML._raw_escape=function a(h){if(h instanceof HTML){return h.toHTML()}else{if(typeof h=="number"){return h}else{return g(h)}}}})();var MailCheck=Class.create({DOMAINS:["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],WHITELIST_REGEXS:["ymail.com","yahoo\\.co\\.","yahoo\\.com\\.","hotmail\\.co\\.","hotmail\\.com\\.","gmx\\.net","gmx\\.at","gmx\\.ch","gmx\\.com","mail\\.com","web\\.com"],THRESHOLD:2,initialize:function(b,a){this.emailTextInputId=b;this.resultElemId=a;this.listen()},listen:function(){$(this.emailTextInputId).observe("blur",this.onEmailBlur.bind(this))},onEmailBlur:function(){if(!this.emailTextInputId||!this.resultElemId){return}this.suggestion=this.suggest($(this.emailTextInputId).getValue());if(this.suggestion){var a='<span class="email_warning_area">'+this.suggestion.domain+"</span>";var c=this.suggestion.address+"@"+a;var b=new HTML(_("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:c}));$(this.resultElemId).__date(b);$(this.resultElemId).setStyle({display:"block"});$(this.resultElemId).on("click","a",this.onLinkClick.bind(this))}else{$(this.resultElemId).__date();$(this.resultElemId).setStyle({display:"none"})}},onLinkClick:function(){$(this.emailTextInputId).setValue(this.suggestion.full);$(this.resultElemId).__date();$(this.resultElemId).setStyle({display:"none"})},suggest:function(c){c=c.toLowerCase();var a=this.splitEmail(c);var b=this.findClosestDomain(a.domain);for(var d=0;d<this.WHITELIST_REGEXS.length;d++){var e=RegExp(this.WHITELIST_REGEXS[d]);if(e.match(a.domain)){return false}}if(b){return{address:a.address,domain:b,full:a.address+"@"+b}}else{return false}},findClosestDomain:function(d){var e;var b=99;var a=null;for(var c=0;c<this.DOMAINS.length;c++){e=this.stringDistance(d,this.DOMAINS[c]);if(e<b){b=e;a=this.DOMAINS[c]}}if(b<=this.THRESHOLD&&a!==null&&a!==d){return a}else{return false}},stringDistance:function(f,b){if(f==null||f.length===0){if(b==null||b.length===0){return 0}else{return b.length}}if(b==null||b.length===0){return f.length}var j=0;var h=0;var g=0;var a=0;var e=5;while((j+h<f.length)&&(j+g<b.length)){if(f.charAt(j+h)==b.charAt(j+g)){a++}else{h=0;g=0;for(var d=0;d<e;d++){if((j+d<f.length)&&(f.charAt(j+d)==b.charAt(j))){h=d;break}if((j+d<b.length)&&(f.charAt(j)==b.charAt(j+d))){g=d;break}}}j++}return(f.length+b.length)/2-a},splitEmail:function(a){var b=a.split("@");if(b.length<2){return false}return{domain:b.pop(),address:b.join("@")}}});
/*
Video.js - HTML5 Video Player
Version 3.2.0

LGPL v3 LICENSE INFO
This file is part of Video.js. Copyright 2011 Zencoder, Inc.

Video.js is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Video.js is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with Video.js.  If not, see <http://www.gnu.org/licenses/>.
*/
(function(window,undefined){var document=window.document;document.createElement("video");document.createElement("audio");var VideoJS=function(id,addOptions,ready){var tag;if(typeof id=="string"){if(id.indexOf("#")===0){id=id.slice(1)}if(_V_.players[id]){return _V_.players[id]}else{tag=_V_.el(id)}}else{tag=id}if(!tag||!tag.nodeName){throw new TypeError("The element or ID supplied is not valid. (VideoJS)")}return tag.player||new _V_.Player(tag,addOptions,ready)},_V_=VideoJS,CDN_VERSION="3.2";VideoJS.players={};VideoJS.options={techOrder:["html5","flash"],html5:{},flash:{swf:"http://vjs.zencdn.net/c/video-js.swf"},width:"auto",height:"auto",defaultVolume:0,components:{posterImage:{},textTrackDisplay:{},loadingSpinner:{},bigPlayButton:{},controlBar:{}}};if(CDN_VERSION!="GENERATED_CDN_VSN"){_V_.options.flash.swf="http://vjs.zencdn.net/"+CDN_VERSION+"/video-js.swf"}_V_.merge=function(obj1,obj2,safe){if(!obj2){obj2={}}for(var attrname in obj2){if(obj2.hasOwnProperty(attrname)&&(!safe||!obj1.hasOwnProperty(attrname))){obj1[attrname]=obj2[attrname]}}return obj1};_V_.extend=function(obj){this.merge(this,obj,true)};_V_.extend({tech:{},controlSets:{},isIE:function(){return !+"\v1"},isFF:function(){return !!_V_.ua.match("Firefox")},isIPad:function(){return navigator.userAgent.match(/iPad/i)!==null},isIPhone:function(){return navigator.userAgent.match(/iPhone/i)!==null},isIOS:function(){return VideoJS.isIPhone()||VideoJS.isIPad()},iOSVersion:function(){var match=navigator.userAgent.match(/OS (\d+)_/i);if(match&&match[1]){return match[1]}},isAndroid:function(){return navigator.userAgent.match(/Android.*AppleWebKit/i)!==null},androidVersion:function(){var match=navigator.userAgent.match(/Android (\d+)\./i);if(match&&match[1]){return match[1]}},testVid:document.createElement("video"),ua:navigator.userAgent,support:{},each:function(arr,fn){if(!arr||arr.length===0){return}for(var i=0,j=arr.length;i<j;i++){fn.call(this,arr[i],i)}},eachProp:function(obj,fn){if(!obj){return}for(var name in obj){if(obj.hasOwnProperty(name)){fn.call(this,name,obj[name])}}},el:function(id){return document.getElementById(id)},createElement:function(tagName,attributes){var el=document.createElement(tagName),attrname;for(attrname in attributes){if(attributes.hasOwnProperty(attrname)){if(attrname.indexOf("-")!==-1){el.setAttribute(attrname,attributes[attrname])}else{el[attrname]=attributes[attrname]}}}return el},insertFirst:function(node,parent){if(parent.firstChild){parent.insertBefore(node,parent.firstChild)}else{parent.appendChild(node)}},addClass:function(element,classToAdd){if((" "+element.className+" ").indexOf(" "+classToAdd+" ")==-1){element.className=element.className===""?classToAdd:element.className+" "+classToAdd}},removeClass:function(element,classToRemove){if(element.className.indexOf(classToRemove)==-1){return}var classNames=element.className.split(" ");classNames.splice(classNames.indexOf(classToRemove),1);element.className=classNames.join(" ")},remove:function(item,array){if(!array){return}var i=array.indexOf(item);if(i!=-1){return array.splice(i,1)}},blockTextSelection:function(){document.body.focus();document.onselectstart=function(){return false}},unblockTextSelection:function(){document.onselectstart=function(){return true}},formatTime:function(seconds,guide){guide=guide||seconds;var s=Math.floor(seconds%60),m=Math.floor(seconds/60%60),h=Math.floor(seconds/3600),gm=Math.floor(guide/60%60),gh=Math.floor(guide/3600);h=(h>0||gh>0)?h+":":"";m=(((h||gm>=10)&&m<10)?"0"+m:m)+":";s=(s<10)?"0"+s:s;return h+m+s},uc:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},getRelativePosition:function(x,relativeElement){return Math.max(0,Math.min(1,(x-_V_.findPosX(relativeElement))/relativeElement.offsetWidth))},getComputedStyleValue:function(element,style){return window.getComputedStyle(element,null).getPropertyValue(style)},trim:function(string){return string.toString().replace(/^\s+/,"").replace(/\s+$/,"")},round:function(num,dec){if(!dec){dec=0}return Math.round(num*Math.pow(10,dec))/Math.pow(10,dec)},isEmpty:function(object){for(var prop in object){return false}return true},createTimeRange:function(start,end){return{length:1,start:function(){return start},end:function(){return end}}},cache:{},guid:1,expando:"vdata"+(new Date).getTime(),getData:function(elem){var id=elem[_V_.expando];if(!id){id=elem[_V_.expando]=_V_.guid++;_V_.cache[id]={}}return _V_.cache[id]},removeData:function(elem){var id=elem[_V_.expando];if(!id){return}delete _V_.cache[id];try{delete elem[_V_.expando]}catch(e){if(elem.removeAttribute){elem.removeAttribute(_V_.expando)}else{elem[_V_.expando]=null}}},proxy:function(context,fn,uid){if(!fn.guid){fn.guid=_V_.guid++}var ret=function(){return fn.apply(context,arguments)};ret.guid=(uid)?uid+"_"+fn.guid:fn.guid;return ret},get:function(url,onSuccess,onError){var local=(url.indexOf("file:")==0||(window.location.href.indexOf("file:")==0&&url.indexOf("http:")==-1));if(typeof XMLHttpRequest=="undefined"){XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(f){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(g){}throw new Error("This browser does not support XMLHttpRequest.")}}var request=new XMLHttpRequest();try{request.open("GET",url)}catch(e){_V_.log("VideoJS XMLHttpRequest (open)",e);return false}request.onreadystatechange=_V_.proxy(this,function(){if(request.readyState==4){if(request.status==200||local&&request.status==0){onSuccess(request.responseText)}else{if(onError){onError()}}}});try{request.send()}catch(e){_V_.log("VideoJS XMLHttpRequest (send)",e);if(onError){onError(e)}}},setLocalStorage:function(key,value){var localStorage=window.localStorage||false;if(!localStorage){return}try{localStorage[key]=value}catch(e){if(e.code==22||e.code==1014){_V_.log("LocalStorage Full (VideoJS)",e)}else{_V_.log("LocalStorage Error (VideoJS)",e)}}},getAbsoluteURL:function(url){if(!url.match(/^https?:\/\//)){url=_V_.createElement("div",{innerHTML:'<a href="'+url+'">x</a>'}).firstChild.href}return url}});_V_.log=function(){if(Constants.IS_PROD){return}_V_.log.history=_V_.log.history||[];_V_.log.history.push(arguments);if(window.console){arguments.callee=arguments.callee.caller;var newarr=[].slice.call(arguments);(typeof console.log==="object"?_V_.log.apply.call(console.log,console,newarr):console.log.apply(console,newarr))}};(function(b){function c(){}for(var d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,timeStamp,profile,profileEnd,time,timeEnd,trace,warn".split(","),a;a=d.pop();){b[a]=b[a]||c}})((function(){try{console.log();return window.console}catch(err){return window.console={}}})());if("getBoundingClientRect" in document.documentElement){_V_.findPosX=function(el){var box;try{box=el.getBoundingClientRect()}catch(e){}if(!box){return 0}var docEl=document.documentElement,body=document.body,clientLeft=docEl.clientLeft||body.clientLeft||0,scrollLeft=window.pageXOffset||body.scrollLeft,left=box.left+scrollLeft-clientLeft;return left}}else{_V_.findPosX=function(el){var curleft=el.offsetLeft;while(el=obj.offsetParent){if(el.className.indexOf("video-js")==-1){}else{}curleft+=el.offsetLeft}return curleft}}(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;_V_.Class=function(){};_V_.Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!initializing&&this.init){return this.init.apply(this,arguments)}else{if(!initializing){return arguments.callee.prototype.init()}}}Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class}})();_V_.Component=_V_.Class.extend({init:function(player,options){this.player=player;options=this.options=_V_.merge(this.options||{},options);if(options.el){this.el=options.el}else{this.el=this.createElement()}this.initComponents()},destroy:function(){},createElement:function(type,attrs){return _V_.createElement(type||"div",attrs)},buildCSSClass:function(){return""},initComponents:function(){var options=this.options;if(options&&options.components){this.eachProp(options.components,function(name,opts){var tempAdd=this.proxy(function(){this[name]=this.addComponent(name,opts)});if(opts.loadEvent){this.one(opts.loadEvent,tempAdd)}else{tempAdd()}})}},addComponent:function(name,options){var component,componentClass;if(typeof name=="string"){options=options||{};componentClass=options.componentClass||_V_.uc(name);component=new _V_[componentClass](this.player||this,options)}else{component=name}this.el.appendChild(component.el);return component},removeComponent:function(component){this.el.removeChild(component.el)},show:function(){this.el.style.display="block"},hide:function(){this.el.style.display="none"},fadeIn:function(){this.removeClass("vjs-fade-out");this.addClass("vjs-fade-in")},fadeOut:function(){this.removeClass("vjs-fade-in");this.addClass("vjs-fade-out")},lockShowing:function(){var style=this.el.style;style.display="block";style.opacity=1;style.visiblity="visible"},unlockShowing:function(){var style=this.el.style;style.display="";style.opacity="";style.visiblity=""},addClass:function(classToAdd){_V_.addClass(this.el,classToAdd)},removeClass:function(classToRemove){_V_.removeClass(this.el,classToRemove)},addEvent:function(type,fn,uid){return _V_.addEvent(this.el,type,_V_.proxy(this,fn))},removeEvent:function(type,fn){return _V_.removeEvent(this.el,type,fn)},triggerEvent:function(type,e){return _V_.triggerEvent(this.el,type,e)},one:function(type,fn){_V_.one(this.el,type,_V_.proxy(this,fn))},ready:function(fn){if(!fn){return this}if(this.isReady){fn.call(this)}else{if(this.readyQueue===undefined){this.readyQueue=[]}this.readyQueue.push(fn)}return this},triggerReady:function(){this.isReady=true;if(this.readyQueue&&this.readyQueue.length>0){this.each(this.readyQueue,function(fn){fn.call(this)});this.readyQueue=[];this.triggerEvent("ready")}},each:function(arr,fn){_V_.each.call(this,arr,fn)},eachProp:function(obj,fn){_V_.eachProp.call(this,obj,fn)},extend:function(obj){_V_.merge(this,obj)},proxy:function(fn,uid){return _V_.proxy(this,fn,uid)}});_V_.Control=_V_.Component.extend({buildCSSClass:function(){return"vjs-control "+this._super()}});_V_.ControlBar=_V_.Component.extend({options:{loadEvent:"play",components:{playToggle:{},fullscreenToggle:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},remainingTimeDisplay:{},progressControl:{},volumeControl:{},muteToggle:{}}},init:function(player,options){this._super(player,options);player.addEvent("play",this.proxy(function(){this.fadeIn();this.player.addEvent("mouseover",this.proxy(this.fadeIn));this.player.addEvent("mouseout",this.proxy(this.fadeOut))}))},createElement:function(){return _V_.createElement("div",{className:"vjs-controls"})},fadeIn:function(){this._super();this.player.triggerEvent("controlsvisible")},fadeOut:function(){this._super();this.player.triggerEvent("controlshidden")},lockShowing:function(){this.el.style.opacity="1"}});_V_.Button=_V_.Control.extend({init:function(player,options){this._super(player,options);this.addEvent("click",this.onClick);this.addEvent("focus",this.onFocus);this.addEvent("blur",this.onBlur)},createElement:function(type,attrs){attrs=_V_.merge({className:this.buildCSSClass(),innerHTML:'<div><span class="vjs-control-text">'+(this.buttonText||"Need Text")+"</span></div>",role:"button",tabIndex:0},attrs);return this._super(type,attrs)},onClick:function(){},onFocus:function(){_V_.addEvent(document,"keyup",_V_.proxy(this,this.onKeyPress))},onKeyPress:function(event){if(event.which==32||event.which==13){event.preventDefault();this.onClick()}},onBlur:function(){_V_.removeEvent(document,"keyup",_V_.proxy(this,this.onKeyPress))}});_V_.PlayButton=_V_.Button.extend({buttonText:"Play",buildCSSClass:function(){return"vjs-play-button "+this._super()},onClick:function(){this.player.play()}});_V_.PauseButton=_V_.Button.extend({buttonText:"Pause",buildCSSClass:function(){return"vjs-pause-button "+this._super()},onClick:function(){this.player.pause()}});_V_.PlayToggle=_V_.Button.extend({buttonText:"Play",init:function(player,options){this._super(player,options);player.addEvent("play",_V_.proxy(this,this.onPlay));player.addEvent("pause",_V_.proxy(this,this.onPause))},buildCSSClass:function(){return"vjs-play-control "+this._super()},onClick:function(){if(this.player.paused()){this.player.play()}else{this.player.pause()}},onPlay:function(){_V_.removeClass(this.el,"vjs-paused");_V_.addClass(this.el,"vjs-playing")},onPause:function(){_V_.removeClass(this.el,"vjs-playing");_V_.addClass(this.el,"vjs-paused")}});_V_.FullscreenToggle=_V_.Button.extend({buttonText:"Fullscreen",buildCSSClass:function(){return"vjs-fullscreen-control "+this._super()},onClick:function(){if(!this.player.isFullScreen){this.player.requestFullScreen()}else{this.player.cancelFullScreen()}}});_V_.BigPlayButton=_V_.Button.extend({init:function(player,options){this._super(player,options);player.addEvent("play",_V_.proxy(this,this.hide));player.addEvent("ended",_V_.proxy(this,this.show))},createElement:function(){return this._super("div",{className:"vjs-big-play-button",innerHTML:"<span></span>"})},onClick:function(){this.player.triggerEvent("play_clicked");this.hide();if(this.player.currentTime()){this.player.currentTime(0)}this.player.play()}});_V_.LoadingSpinner=_V_.Component.extend({init:function(player,options){this._super(player,options);player.addEvent("canplay",_V_.proxy(this,this.hide));player.addEvent("canplaythrough",_V_.proxy(this,this.hide));player.addEvent("playing",_V_.proxy(this,this.hide));player.addEvent("play_clicked",_V_.proxy(this,this.show));player.addEvent("error",_V_.proxy(this,this.show));player.addEvent("waiting",_V_.proxy(this,this.show))},createElement:function(){var classNameSpinner,innerHtmlSpinner;if(typeof this.player.el.style.WebkitBorderRadius=="string"||typeof this.player.el.style.MozBorderRadius=="string"||typeof this.player.el.style.KhtmlBorderRadius=="string"||typeof this.player.el.style.borderRadius=="string"){classNameSpinner="vjs-loading-spinner";innerHtmlSpinner="<div class='ball1'></div><div class='ball2'></div><div class='ball3'></div><div class='ball4'></div><div class='ball5'></div><div class='ball6'></div><div class='ball7'></div><div class='ball8'></div>"}else{classNameSpinner="vjs-loading-spinner-fallback";innerHtmlSpinner=""}return this._super("div",{className:classNameSpinner,innerHTML:innerHtmlSpinner})}});_V_.CurrentTimeDisplay=_V_.Component.extend({init:function(player,options){this._super(player,options);player.addEvent("timeupdate",_V_.proxy(this,this.updateContent))},createElement:function(){var el=this._super("div",{className:"vjs-current-time vjs-time-controls vjs-control"});this.content=_V_.createElement("div",{className:"vjs-current-time-display",innerHTML:"0:00"});el.appendChild(_V_.createElement("div").appendChild(this.content));return el},updateContent:function(){var time=(this.player.scrubbing)?this.player.values.currentTime:this.player.currentTime();this.content.innerHTML=_V_.formatTime(time,this.player.duration())}});_V_.DurationDisplay=_V_.Component.extend({init:function(player,options){this._super(player,options);player.addEvent("timeupdate",_V_.proxy(this,this.updateContent))},createElement:function(){var el=this._super("div",{className:"vjs-duration vjs-time-controls vjs-control"});this.content=_V_.createElement("div",{className:"vjs-duration-display",innerHTML:"0:00"});el.appendChild(_V_.createElement("div").appendChild(this.content));return el},updateContent:function(){if(this.player.duration()){this.content.innerHTML=_V_.formatTime(this.player.duration())}}});_V_.TimeDivider=_V_.Component.extend({createElement:function(){return this._super("div",{className:"vjs-time-divider",innerHTML:"<div><span>/</span></div>"})}});_V_.RemainingTimeDisplay=_V_.Component.extend({init:function(player,options){this._super(player,options);player.addEvent("timeupdate",_V_.proxy(this,this.updateContent))},createElement:function(){var el=this._super("div",{className:"vjs-remaining-time vjs-time-controls vjs-control"});this.content=_V_.createElement("div",{className:"vjs-remaining-time-display",innerHTML:"-0:00"});el.appendChild(_V_.createElement("div").appendChild(this.content));return el},updateContent:function(){if(this.player.duration()){var time_remaining=Math.max(0,this.player.remainingTime());this.content.innerHTML="-"+_V_.formatTime(time_remaining)}}});_V_.Slider=_V_.Component.extend({init:function(player,options){this._super(player,options);player.addEvent(this.playerEvent,_V_.proxy(this,this.update));this.addEvent("mousedown",this.onMouseDown);this.addEvent("focus",this.onFocus);this.addEvent("blur",this.onBlur);this.player.addEvent("controlsvisible",this.proxy(this.update));this.update()},createElement:function(type,attrs){attrs=_V_.merge({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},attrs);return this._super(type,attrs)},onMouseDown:function(event){event.preventDefault();_V_.blockTextSelection();_V_.addEvent(document,"mousemove",_V_.proxy(this,this.onMouseMove));_V_.addEvent(document,"mouseup",_V_.proxy(this,this.onMouseUp));this.onMouseMove(event)},onMouseUp:function(event){_V_.unblockTextSelection();_V_.removeEvent(document,"mousemove",this.onMouseMove,false);_V_.removeEvent(document,"mouseup",this.onMouseUp,false);this.update()},update:function(){var barProgress,progress=this.getPercent();handle=this.handle,bar=this.bar;if(isNaN(progress)){progress=0}barProgress=progress;if(handle){var box=this.el,boxWidth=box.offsetWidth,handleWidth=handle.el.offsetWidth,handlePercent=(handleWidth)?handleWidth/boxWidth:0,boxAdjustedPercent=1-handlePercent;adjustedProgress=progress*boxAdjustedPercent,barProgress=adjustedProgress+(handlePercent/2);handle.el.style.left=_V_.round(adjustedProgress*100,2)+"%"}bar.el.style.width=_V_.round(barProgress*100,2)+"%"},calculateDistance:function(event){var box=this.el,boxX=_V_.findPosX(box),boxW=box.offsetWidth,handle=this.handle;if(handle){var handleW=handle.el.offsetWidth;boxX=boxX+(handleW/2);boxW=boxW-handleW}return Math.max(0,Math.min(1,(event.pageX-boxX)/boxW))},onFocus:function(event){_V_.addEvent(document,"keyup",_V_.proxy(this,this.onKeyPress))},onKeyPress:function(event){if(event.which==37){event.preventDefault();this.stepBack()}else{if(event.which==39){event.preventDefault();this.stepForward()}}},onBlur:function(event){_V_.removeEvent(document,"keyup",_V_.proxy(this,this.onKeyPress))}});_V_.ProgressControl=_V_.Component.extend({options:{components:{seekBar:{}}},createElement:function(){return this._super("div",{className:"vjs-progress-control vjs-control"})}});_V_.SeekBar=_V_.Slider.extend({options:{components:{loadProgressBar:{},bar:{componentClass:"PlayProgressBar"},handle:{componentClass:"SeekHandle"}}},playerEvent:"timeupdate",init:function(player,options){this._super(player,options)},createElement:function(){return this._super("div",{className:"vjs-progress-holder"})},getPercent:function(){return this.player.currentTime()/this.player.duration()},onMouseDown:function(event){this._super(event);this.player.scrubbing=true;this.videoWasPlaying=!this.player.paused();this.player.pause()},onMouseMove:function(event){var newTime=this.calculateDistance(event)*this.player.duration();if(newTime==this.player.duration()){newTime=newTime-0.1}this.player.currentTime(newTime)},onMouseUp:function(event){this._super(event);this.player.scrubbing=false;if(this.videoWasPlaying){this.player.play()}},stepForward:function(){this.player.currentTime(this.player.currentTime()+1)},stepBack:function(){this.player.currentTime(this.player.currentTime()-1)}});_V_.LoadProgressBar=_V_.Component.extend({init:function(player,options){this._super(player,options);player.addEvent("progress",_V_.proxy(this,this.update))},createElement:function(){return this._super("div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text">Loaded: 0%</span>'})},update:function(){if(this.el.style){this.el.style.width=_V_.round(this.player.bufferedPercent()*100,2)+"%"}}});_V_.PlayProgressBar=_V_.Component.extend({createElement:function(){return this._super("div",{className:"vjs-play-progress",innerHTML:'<span class="vjs-control-text">Progress: 0%</span>'})}});_V_.SeekHandle=_V_.Component.extend({createElement:function(){return this._super("div",{className:"vjs-seek-handle",innerHTML:'<span class="vjs-control-text">00:00</span>'})}});_V_.VolumeControl=_V_.Component.extend({options:{components:{volumeBar:{}}},createElement:function(){return this._super("div",{className:"vjs-volume-control vjs-control"})}});_V_.VolumeBar=_V_.Slider.extend({options:{components:{bar:{componentClass:"VolumeLevel"},handle:{componentClass:"VolumeHandle"}}},playerEvent:"volumechange",createElement:function(){return this._super("div",{className:"vjs-volume-bar"})},onMouseMove:function(event){this.player.volume(this.calculateDistance(event))},getPercent:function(){return this.player.volume()},stepForward:function(){this.player.volume(this.player.volume()+0.1)},stepBack:function(){this.player.volume(this.player.volume()-0.1)}});_V_.VolumeLevel=_V_.Component.extend({createElement:function(){return this._super("div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})}});_V_.VolumeHandle=_V_.Component.extend({createElement:function(){return this._super("div",{className:"vjs-volume-handle",innerHTML:'<span class="vjs-control-text"></span>'})}});_V_.MuteToggle=_V_.Button.extend({init:function(player,options){this._super(player,options);player.addEvent("volumechange",_V_.proxy(this,this.update))},createElement:function(){return this._super("div",{className:"vjs-mute-control vjs-control",innerHTML:'<div><span class="vjs-control-text">Mute</span></div>'})},onClick:function(event){this.player.muted(this.player.muted()?false:true)},update:function(event){var vol=this.player.volume(),level=3;if(vol==0||this.player.muted()){level=0}else{if(vol<0.33){level=1}else{if(vol<0.67){level=2}}}_V_.each.call(this,[0,1,2,3],function(i){_V_.removeClass(this.el,"vjs-vol-"+i)});_V_.addClass(this.el,"vjs-vol-"+level)}});_V_.PosterImage=_V_.Button.extend({init:function(player,options){this._super(player,options);if(!this.player.options.poster){this.hide()}player.addEvent("play",_V_.proxy(this,this.hide))},createElement:function(){var container=_V_.createElement("div",{className:"vjs-poster-container"});var poster=this.player.options.poster;if(poster){if("backgroundSize" in container.style){container.style.backgroundImage='url("'+poster+'")'}else{container.appendChild(_V_.createElement("img",{src:poster,className:"vjs-poster"}))}}return container},onClick:function(){this.player.play()}});_V_.Menu=_V_.Component.extend({init:function(player,options){this._super(player,options)},addItem:function(component){this.addComponent(component);component.addEvent("click",this.proxy(function(){this.unlockShowing()}))},createElement:function(){return this._super("ul",{className:"vjs-menu"})}});_V_.MenuItem=_V_.Button.extend({init:function(player,options){this._super(player,options);if(options.selected){this.addClass("vjs-selected")}},createElement:function(type,attrs){return this._super("li",_V_.merge({className:"vjs-menu-item",innerHTML:this.options.label},attrs))},onClick:function(){this.selected(true)},selected:function(selected){if(selected){this.addClass("vjs-selected")}else{this.removeClass("vjs-selected")}}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this===void 0||this===null){throw new TypeError()}var t=Object(this);var len=t.length>>>0;if(len===0){return -1}var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0}else{if(n!==0&&n!==(1/0)&&n!==-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n))}}}if(n>=len){return -1}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k}}return -1}}_V_.extend({addEvent:function(elem,type,fn){var data=_V_.getData(elem),handlers;if(data&&!data.handler){data.handler=function(event){event=_V_.fixEvent(event);var handlers=_V_.getData(elem).events[event.type];if(handlers){var handlersCopy=[];_V_.each(handlers,function(handler,i){handlersCopy[i]=handler});for(var i=0,l=handlersCopy.length;i<l;i++){handlersCopy[i].call(elem,event)}}}}if(!data.events){data.events={}}handlers=data.events[type];if(!handlers){handlers=data.events[type]=[];if(document.addEventListener){elem.addEventListener(type,data.handler,false)}else{if(document.attachEvent){elem.attachEvent("on"+type,data.handler)}}}if(!fn.guid){fn.guid=_V_.guid++}handlers.push(fn)},removeEvent:function(elem,type,fn){var data=_V_.getData(elem),handlers;if(!data.events){return}if(!type){for(type in data.events){_V_.cleanUpEvents(elem,type)}return}handlers=data.events[type];if(!handlers){return}if(fn&&fn.guid){for(var i=0;i<handlers.length;i++){if(handlers[i].guid===fn.guid){handlers.splice(i--,1)}}}_V_.cleanUpEvents(elem,type)},cleanUpEvents:function(elem,type){var data=_V_.getData(elem);if(data.events[type].length===0){delete data.events[type];if(document.removeEventListener){elem.removeEventListener(type,data.handler,false)}else{if(document.detachEvent){elem.detachEvent("on"+type,data.handler)}}}if(_V_.isEmpty(data.events)){delete data.events;delete data.handler}if(_V_.isEmpty(data)){_V_.removeData(elem)}},fixEvent:function(event){if(event[_V_.expando]){return event}var originalEvent=event;event=new _V_.Event(originalEvent);for(var i=_V_.Event.props.length,prop;i;){prop=_V_.Event.props[--i];event[prop]=originalEvent[prop]}if(!event.target){event.target=event.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}if(!event.relatedTarget&&event.fromElement){event.relatedTarget=event.fromElement===event.target?event.toElement:event.fromElement}if(event.pageX==null&&event.clientX!=null){var eventDocument=event.target.ownerDocument||document,doc=eventDocument.documentElement,body=eventDocument.body;event.pageX=event.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=event.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(event.which==null&&(event.charCode!=null||event.keyCode!=null)){event.which=event.charCode!=null?event.charCode:event.keyCode}if(!event.metaKey&&event.ctrlKey){event.metaKey=event.ctrlKey}if(!event.which&&event.button!==undefined){event.which=(event.button&1?1:(event.button&2?3:(event.button&4?2:0)))}return event},triggerEvent:function(elem,event){var data=_V_.getData(elem),parent=elem.parentNode||elem.ownerDocument,type=event.type||event,handler;if(data){handler=data.handler}event=typeof event==="object"?event[_V_.expando]?event:new _V_.Event(type,event):new _V_.Event(type);event.type=type;if(handler){handler.call(elem,event)}event.result=undefined;event.target=elem},one:function(elem,type,fn){_V_.addEvent(elem,type,function(){_V_.removeEvent(elem,type,arguments.callee);fn.apply(this,arguments)})}});_V_.Event=function(src,props){if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse}else{this.type=src}if(props){_V_.merge(this,props)}this.timeStamp=(new Date).getTime();this[_V_.expando]=true};_V_.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};_V_.Event.props="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");function returnTrue(){return true}function returnFalse(){return false}var JSON;if(!JSON){JSON={}}(function(){var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());_V_.Player=_V_.Component.extend({init:function(tag,addOptions,ready){this.tag=tag;var el=this.el=_V_.createElement("div"),options=this.options={},width=options.width=tag.getAttribute("width"),height=options.height=tag.getAttribute("height"),initWidth=width||300,initHeight=height||150;tag.player=el.player=this;this.ready(ready);tag.parentNode.insertBefore(el,tag);el.appendChild(tag);el.id=this.id=tag.id;el.className=tag.className;tag.id+="_html5_api";tag.className="vjs-tech";_V_.players[el.id]=this;initWidth=Math.floor(initWidth);initHeight=Math.floor(initHeight);el.setAttribute("width",initWidth);el.setAttribute("height",initHeight);el.style.width=initWidth+"px";el.style.height=initHeight+"px";tag.removeAttribute("width");tag.removeAttribute("height");_V_.merge(options,_V_.options);_V_.merge(options,this.getVideoTagSettings());_V_.merge(options,addOptions);tag.removeAttribute("controls");tag.removeAttribute("poster");if(tag.hasChildNodes()){for(var i=0,j=tag.childNodes;i<j.length;i++){if(j[i].nodeName=="SOURCE"||j[i].nodeName=="TRACK"){tag.removeChild(j[i])}}}this.values={};this.addClass("vjs-paused");this.addEvent("ended",this.onEnded);this.addEvent("play",this.onPlay);this.addEvent("pause",this.onPause);this.addEvent("progress",this.onProgress);this.addEvent("error",this.onError);if(options.controls){this.ready(function(){this.initComponents()})}this.textTracks=[];if(options.tracks&&options.tracks.length>0){this.addTextTracks(options.tracks)}if(!options.sources||options.sources.length==0){for(var i=0,j=options.techOrder;i<j.length;i++){var techName=j[i],tech=_V_[techName];if(tech.isSupported()){this.loadTech(techName);break}}}else{this.src(options.sources)}},values:{},destroy:function(){this.stopTrackingProgress();this.stopTrackingCurrentTime();_V_.players[this.id]=null;delete _V_.players[this.id];this.tech.destroy();this.el.parentNode.removeChild(this.el)},createElement:function(type,options){},getVideoTagSettings:function(){var options={sources:[],tracks:[]};options.src=this.tag.getAttribute("src");options.controls=this.tag.getAttribute("controls")!==null;options.poster=this.tag.getAttribute("poster");options.preload=this.tag.getAttribute("preload");options.autoplay=this.tag.getAttribute("autoplay")!==null;options.loop=this.tag.getAttribute("loop")!==null;options.muted=this.tag.getAttribute("muted")!==null;if(this.tag.hasChildNodes()){for(var c,i=0,j=this.tag.childNodes;i<j.length;i++){c=j[i];if(c.nodeName.toUpperCase()=="SOURCE"){options.sources.push({src:c.getAttribute("src"),type:c.getAttribute("type"),media:c.getAttribute("media"),title:c.getAttribute("title")})}if(c.nodeName=="TRACK"){options.tracks.push({src:c.getAttribute("src"),kind:c.getAttribute("kind"),srclang:c.getAttribute("srclang"),label:c.getAttribute("label"),"default":c.getAttribute("default")!==null,title:c.getAttribute("title")})}}}return options},loadTech:function(techName,source){if(this.tech){this.unloadTech()}else{if(techName!="html5"&&this.tag){this.el.removeChild(this.tag);this.tag=false}}this.techName=techName;this.isReady=false;var techReady=function(){this.player.triggerReady();if(!this.support.progressEvent){this.player.manualProgressOn()}if(!this.support.timeupdateEvent){this.player.manualTimeUpdatesOn()}};var techOptions=_V_.merge({source:source,parentEl:this.el},this.options[techName]);if(source){if(source.src==this.values.src&&this.values.currentTime>0){techOptions.startTime=this.values.currentTime}this.values.src=source.src}this.tech=new _V_[techName](this,techOptions);this.tech.ready(techReady)},unloadTech:function(){this.tech.destroy();if(this.manualProgress){this.manualProgressOff()}if(this.manualTimeUpdates){this.manualTimeUpdatesOff()}this.tech=false},manualProgressOn:function(){this.manualProgress=true;this.trackProgress();this.tech.addEvent("progress",function(){this.removeEvent("progress",arguments.callee);this.support.progressEvent=true;this.player.manualProgressOff()})},manualProgressOff:function(){this.manualProgress=false;this.stopTrackingProgress()},trackProgress:function(){this.progressInterval=setInterval(_V_.proxy(this,function(){if(this.values.bufferEnd<this.buffered().end(0)){this.triggerEvent("progress")}else{if(this.bufferedPercent()==1){this.stopTrackingProgress();this.triggerEvent("progress")}}}),500)},stopTrackingProgress:function(){clearInterval(this.progressInterval)},manualTimeUpdatesOn:function(){this.manualTimeUpdates=true;this.addEvent("play",this.trackCurrentTime);this.addEvent("pause",this.stopTrackingCurrentTime);this.tech.addEvent("timeupdate",function(){this.removeEvent("timeupdate",arguments.callee);this.support.timeupdateEvent=true;this.player.manualTimeUpdatesOff()})},manualTimeUpdatesOff:function(){this.manualTimeUpdates=false;this.stopTrackingCurrentTime();this.removeEvent("play",this.trackCurrentTime);this.removeEvent("pause",this.stopTrackingCurrentTime)},trackCurrentTime:function(){if(this.currentTimeInterval){this.stopTrackingCurrentTime()}this.currentTimeInterval=setInterval(_V_.proxy(this,function(){this.triggerEvent("timeupdate")}),250)},stopTrackingCurrentTime:function(){clearInterval(this.currentTimeInterval)},onEnded:function(){if(this.options.loop){this.currentTime(0);this.play()}else{this.pause();this.currentTime(0);this.pause()}},onPlay:function(){_V_.removeClass(this.el,"vjs-paused");_V_.addClass(this.el,"vjs-playing")},onPause:function(){_V_.removeClass(this.el,"vjs-playing");_V_.addClass(this.el,"vjs-paused")},onProgress:function(){$j(".vjs-play-control").focus();if(this.bufferedPercent()==1){this.triggerEvent("loadedalldata")}},onError:function(e){_V_.log("Video Error",Util.to_json(e))},techCall:function(method,arg){if(!this.tech.isReady){this.tech.ready(function(){this[method](arg)})}else{try{this.tech[method](arg)}catch(e){_V_.log(e)}}},techGet:function(method){if(this.tech.isReady){try{return this.tech[method]()}catch(e){if(this.tech[method]===undefined){_V_.log("Video.js: "+method+" method not defined for "+this.techName+" playback technology.",e)}else{if(e.name=="TypeError"){_V_.log("Video.js: "+method+" unavailable on "+this.techName+" playback technology element.",e);this.tech.isReady=false}else{_V_.log(e)}}}}return},play:function(){this.techCall("play");return this},pause:function(){this.techCall("pause");return this},paused:function(){return(this.techGet("paused")===false)?false:true},currentTime:function(seconds){if(seconds!==undefined){this.values.lastSetCurrentTime=seconds;this.techCall("setCurrentTime",seconds);if(this.manualTimeUpdates){this.triggerEvent("timeupdate")}return this}return this.values.currentTime=(this.techGet("currentTime")||0)},duration:function(){return parseFloat(this.techGet("duration"))},remainingTime:function(){return this.duration()-this.currentTime()},buffered:function(){var buffered=this.techGet("buffered"),start=0,end=this.values.bufferEnd=this.values.bufferEnd||0,timeRange;if(buffered&&buffered.length>0&&buffered.end(0)!==end){end=buffered.end(0);this.values.bufferEnd=end}return _V_.createTimeRange(start,end)},bufferedPercent:function(){return(this.duration())?this.buffered().end(0)/this.duration():0},volume:function(percentAsDecimal){var vol;if(percentAsDecimal!==undefined){vol=Math.max(0,Math.min(1,parseFloat(percentAsDecimal)));this.values.volume=vol;this.techCall("setVolume",vol);_V_.setLocalStorage("volume",vol);return this}vol=parseFloat(this.techGet("volume"));return(isNaN(vol))?1:vol},muted:function(muted){if(muted!==undefined){this.techCall("setMuted",muted);return this}return this.techGet("muted")||false},width:function(width,skipListeners){if(width!==undefined){width=Math.floor(width);this.el.width=width;this.el.style.width=width+"px";if(!skipListeners){this.triggerEvent("resize")}return this}return parseInt(this.el.getAttribute("width"))},height:function(height){if(height!==undefined){height=Math.floor(height);this.el.height=height;this.el.style.height=height+"px";this.triggerEvent("resize");return this}return parseInt(this.el.getAttribute("height"))},size:function(width,height){return this.width(width,true).height(height)},supportsFullScreen:function(){return this.techGet("supportsFullScreen")||false},requestFullScreen:function(){var requestFullScreen=_V_.support.requestFullScreen;this.isFullScreen=true;if(requestFullScreen){_V_.addEvent(document,requestFullScreen.eventName,this.proxy(function(){this.isFullScreen=document[requestFullScreen.isFullScreen];if(this.isFullScreen==false){_V_.removeEvent(document,requestFullScreen.eventName,arguments.callee)}this.triggerEvent("fullscreenchange")}));if(this.tech.support.fullscreenResize===false&&this.options.flash.iFrameMode!=true){this.pause();this.unloadTech();_V_.addEvent(document,requestFullScreen.eventName,this.proxy(function(){_V_.removeEvent(document,requestFullScreen.eventName,arguments.callee);this.loadTech(this.techName,{src:this.values.src})}));this.el[requestFullScreen.requestFn]()}else{this.el[requestFullScreen.requestFn]()}}else{if(this.tech.supportsFullScreen()){this.triggerEvent("fullscreenchange");this.techCall("enterFullScreen")}else{this.triggerEvent("fullscreenchange");this.enterFullWindow()}}return this},cancelFullScreen:function(){var requestFullScreen=_V_.support.requestFullScreen;this.isFullScreen=false;if(requestFullScreen){if(this.tech.support.fullscreenResize===false&&this.options.flash.iFrameMode!=true){this.pause();this.unloadTech();_V_.addEvent(document,requestFullScreen.eventName,this.proxy(function(){_V_.removeEvent(document,requestFullScreen.eventName,arguments.callee);this.loadTech(this.techName,{src:this.values.src})}));document[requestFullScreen.cancelFn]()}else{document[requestFullScreen.cancelFn]()}}else{if(this.tech.supportsFullScreen()){this.techCall("exitFullScreen");this.triggerEvent("fullscreenchange")}else{this.exitFullWindow();this.triggerEvent("fullscreenchange")}}return this},enterFullWindow:function(){this.isFullWindow=true;this.docOrigOverflow=document.documentElement.style.overflow;_V_.addEvent(document,"keydown",_V_.proxy(this,this.fullWindowOnEscKey));document.documentElement.style.overflow="hidden";_V_.addClass(document.body,"vjs-full-window");_V_.addClass(this.el,"vjs-fullscreen");this.triggerEvent("enterFullWindow")},fullWindowOnEscKey:function(event){if(event.keyCode==27){if(this.isFullScreen==true){this.cancelFullScreen()}else{this.exitFullWindow()}}},exitFullWindow:function(){this.isFullWindow=false;_V_.removeEvent(document,"keydown",this.fullWindowOnEscKey);document.documentElement.style.overflow=this.docOrigOverflow;_V_.removeClass(document.body,"vjs-full-window");_V_.removeClass(this.el,"vjs-fullscreen");this.triggerEvent("exitFullWindow")},selectSource:function(sources){for(var i=0,j=this.options.techOrder;i<j.length;i++){var techName=j[i],tech=_V_[techName];if(tech.isSupported()){for(var a=0,b=sources;a<b.length;a++){var source=b[a];if(tech.canPlaySource.call(this,source)){return{source:source,tech:techName}}}}}return false},src:function(source){if(source instanceof Array){var sourceTech=this.selectSource(source),source,techName;if(sourceTech){source=sourceTech.source;techName=sourceTech.tech;if(techName==this.techName){this.src(source)}else{this.loadTech(techName,source)}}else{_V_.log("No compatible source and playback technology were found.")}}else{if(source instanceof Object){if(_V_[this.techName].canPlaySource(source)){this.src(source.src)}else{this.src([source])}}else{this.values.src=source;if(!this.isReady){this.ready(function(){this.src(source)})}else{this.techCall("src",source);if(this.options.preload=="auto"){this.load()}if(this.options.autoplay){this.play()}}}}return this},load:function(){this.techCall("load");return this},currentSrc:function(){return this.techGet("currentSrc")||this.values.src||""},preload:function(value){if(value!==undefined){this.techCall("setPreload",value);this.options.preload=value;return this}return this.techGet("preload")},autoplay:function(value){if(value!==undefined){this.techCall("setAutoplay",value);this.options.autoplay=value;return this}return this.techGet("autoplay",value)},loop:function(value){if(value!==undefined){this.techCall("setLoop",value);this.options.loop=value;return this}return this.techGet("loop")},controls:function(){return this.options.controls},poster:function(){return this.techGet("poster")},error:function(){return this.techGet("error")},ended:function(){return this.techGet("ended")}});(function(){var requestFn,cancelFn,eventName,isFullScreen,playerProto=_V_.Player.prototype;if(document.cancelFullscreen!==undefined){requestFn="requestFullscreen";cancelFn="exitFullscreen";eventName="fullscreenchange";isFullScreen="fullScreen"}else{_V_.each(["moz","webkit"],function(prefix){if((prefix!="moz"||document.mozFullScreenEnabled)&&document[prefix+"CancelFullScreen"]!==undefined){requestFn=prefix+"RequestFullScreen";cancelFn=prefix+"CancelFullScreen";eventName=prefix+"fullscreenchange";if(prefix=="webkit"){isFullScreen=prefix+"IsFullScreen"}else{isFullScreen=prefix+"FullScreen"}}})}if(requestFn){_V_.support.requestFullScreen={requestFn:requestFn,cancelFn:cancelFn,eventName:eventName,isFullScreen:isFullScreen}}})();_V_.PlaybackTech=_V_.Component.extend({init:function(player,options){},onClick:function(){if(this.player.options.controls){_V_.PlayToggle.prototype.onClick.call(this)}}});_V_.apiMethods="play,pause,paused,currentTime,setCurrentTime,duration,buffered,volume,setVolume,muted,setMuted,width,height,supportsFullScreen,enterFullScreen,src,load,currentSrc,preload,setPreload,autoplay,setAutoplay,loop,setLoop,error,networkState,readyState,seeking,initialTime,startOffsetTime,played,seekable,ended,videoTracks,audioTracks,videoWidth,videoHeight,textTracks,defaultPlaybackRate,playbackRate,mediaGroup,controller,controls,defaultMuted".split(",");_V_.each(_V_.apiMethods,function(methodName){_V_.PlaybackTech.prototype[methodName]=function(){throw new Error("The '"+methodName+"' method is not available on the playback technology's API")}});_V_.html5=_V_.PlaybackTech.extend({init:function(player,options,ready){this.player=player;this.el=this.createElement();this.ready(ready);this.addEvent("click",this.proxy(this.onClick));var source=options.source;if(source&&this.el.currentSrc==source.src){player.triggerEvent("loadstart")}else{if(source){this.el.src=source.src}}player.ready(function(){if(this.options.autoplay&&this.paused()){this.tag.poster=null;this.play()}});this.setupTriggers();this.triggerReady()},destroy:function(){this.player.tag=false;this.removeTriggers();this.el.parentNode.removeChild(this.el)},createElement:function(){var html5=_V_.html5,player=this.player,el=player.tag,newEl;if(!el||this.support.movingElementInDOM===false){if(el){player.el.removeChild(el)}newEl=_V_.createElement("video",{id:el.id||player.el.id+"_html5_api",className:el.className||"vjs-tech"});el=newEl;_V_.insertFirst(el,player.el)}_V_.each(["autoplay","preload","loop","muted"],function(attr){if(player.options[attr]!==null){el[attr]=player.options[attr]}},this);return el},setupTriggers:function(){_V_.each.call(this,_V_.html5.events,function(type){_V_.addEvent(this.el,type,_V_.proxy(this.player,this.eventHandler))})},removeTriggers:function(){_V_.each.call(this,_V_.html5.events,function(type){_V_.removeEvent(this.el,type,_V_.proxy(this.player,this.eventHandler))})},eventHandler:function(e){e.stopPropagation();this.triggerEvent(e)},play:function(){this.el.play()},pause:function(){this.el.pause()},paused:function(){return this.el.paused},currentTime:function(){return this.el.currentTime},setCurrentTime:function(seconds){try{this.el.currentTime=seconds}catch(e){_V_.log(e,"Video isn't ready. (VideoJS)")}},duration:function(){return this.el.duration||0},buffered:function(){return this.el.buffered},volume:function(){return this.el.volume},setVolume:function(percentAsDecimal){this.el.volume=percentAsDecimal},muted:function(){return this.el.muted},setMuted:function(muted){this.el.muted=muted},width:function(){return this.el.offsetWidth},height:function(){return this.el.offsetHeight},supportsFullScreen:function(){if(typeof this.el.webkitEnterFullScreen=="function"){if(!navigator.userAgent.match("Chrome")&&!navigator.userAgent.match("Mac OS X 10.5")){return true}}return false},enterFullScreen:function(){try{this.el.webkitEnterFullScreen()}catch(e){if(e.code==11){_V_.log("VideoJS: Video not ready.")}}},src:function(src){this.el.src=src},load:function(){this.el.load()},currentSrc:function(){return this.el.currentSrc},preload:function(){return this.el.preload},setPreload:function(val){this.el.preload=val},autoplay:function(){return this.el.autoplay},setAutoplay:function(val){this.el.autoplay=val},loop:function(){return this.el.loop},setLoop:function(val){this.el.loop=val},error:function(){return this.el.error},seeking:function(){return this.el.seeking},ended:function(){return this.el.ended},controls:function(){return this.player.options.controls},defaultMuted:function(){return this.el.defaultMuted}});_V_.html5.isSupported=function(){return !!document.createElement("video").canPlayType};_V_.html5.canPlaySource=function(srcObj){return !!document.createElement("video").canPlayType(srcObj.type)};_V_.html5.events="loadstart,suspend,abort,error,emptied,stalled,loadedmetadata,loadeddata,canplay,canplaythrough,playing,waiting,seeking,seeked,ended,durationchange,timeupdate,progress,play,pause,ratechange,volumechange".split(",");_V_.html5.prototype.support={fullscreen:(typeof _V_.testVid.webkitEnterFullScreen!==undefined)?(!_V_.ua.match("Chrome")&&!_V_.ua.match("Mac OS X 10.5")?true:false):false,movingElementInDOM:!_V_.isIOS()};if(_V_.isAndroid()){if(_V_.androidVersion()<3){document.createElement("video").constructor.prototype.canPlayType=function(type){return(type&&type.toLowerCase().indexOf("video/mp4")!=-1)?"maybe":""}}}_V_.flash=_V_.PlaybackTech.extend({init:function(player,options){this.player=player;var source=options.source,parentEl=options.parentEl,placeHolder=this.el=_V_.createElement("div",{id:parentEl.id+"_temp_flash"}),objId=player.el.id+"_flash_api",playerOptions=player.options,flashVars=_V_.merge({readyFunction:"_V_.flash.onReady",eventProxyFunction:"_V_.flash.onEvent",errorEventProxyFunction:"_V_.flash.onError",autoplay:playerOptions.autoplay,preload:playerOptions.preload,loop:playerOptions.loop,muted:playerOptions.muted},options.flashVars),params=_V_.merge({wmode:"opaque",bgcolor:"#000000"},options.params),attributes=_V_.merge({id:objId,name:objId,"class":"vjs-tech"},options.attributes);if(source){flashVars.src=encodeURIComponent(_V_.getAbsoluteURL(source.src))}_V_.insertFirst(placeHolder,parentEl);if(options.startTime){this.ready(function(){this.load();this.play();this.currentTime(options.startTime)})}if(options.iFrameMode==true&&!_V_.isFF){var iFrm=_V_.createElement("iframe",{id:objId+"_iframe",name:objId+"_iframe",className:"vjs-tech",scrolling:"no",marginWidth:0,marginHeight:0,frameBorder:0});flashVars.readyFunction="ready";flashVars.eventProxyFunction="events";flashVars.errorEventProxyFunction="errors";_V_.addEvent(iFrm,"load",_V_.proxy(this,function(){var iDoc,objTag,swfLoc,iWin=iFrm.contentWindow,varString="";iDoc=iFrm.contentDocument?iFrm.contentDocument:iFrm.contentWindow.document;iDoc.write(_V_.flash.getEmbedCode(options.swf,flashVars,params,attributes));iWin.player=this.player;iWin.ready=_V_.proxy(this.player,function(currSwf){var el=iDoc.getElementById(currSwf),player=this,tech=player.tech;tech.el=el;_V_.addEvent(el,"click",tech.proxy(tech.onClick));_V_.flash.checkReady(tech)});iWin.events=_V_.proxy(this.player,function(swfID,eventName,other){var player=this;if(player&&player.techName=="flash"){player.triggerEvent(eventName)}});iWin.errors=_V_.proxy(this.player,function(swfID,eventName){_V_.log("Flash Error",eventName)})}));placeHolder.parentNode.replaceChild(iFrm,placeHolder)}else{_V_.flash.embed(options.swf,placeHolder,flashVars,params,attributes)}},destroy:function(){this.el.parentNode.removeChild(this.el)},play:function(){this.el.vjs_play()},pause:function(){this.el.vjs_pause()},src:function(src){src=_V_.getAbsoluteURL(src);this.el.vjs_src(src);if(this.player.autoplay()){var tech=this;setTimeout(function(){tech.play()},0)}},load:function(){this.el.vjs_load()},poster:function(){this.el.vjs_getProperty("poster")},buffered:function(){return _V_.createTimeRange(0,this.el.vjs_getProperty("buffered"))},supportsFullScreen:function(){return false},enterFullScreen:function(){return false}});(function(){var api=_V_.flash.prototype,readWrite="preload,currentTime,defaultPlaybackRate,playbackRate,autoplay,loop,mediaGroup,controller,controls,volume,muted,defaultMuted".split(","),readOnly="error,currentSrc,networkState,readyState,seeking,initialTime,duration,startOffsetTime,paused,played,seekable,ended,videoTracks,audioTracks,videoWidth,videoHeight,textTracks".split(","),callOnly="load,play,pause".split(",");createSetter=function(attr){var attrUpper=attr.charAt(0).toUpperCase()+attr.slice(1);api["set"+attrUpper]=function(val){return this.el.vjs_setProperty(attr,val)}},createGetter=function(attr){api[attr]=function(){return this.el.vjs_getProperty(attr)}};_V_.each(readWrite,function(attr){createGetter(attr);createSetter(attr)});_V_.each(readOnly,function(attr){createGetter(attr)})})();_V_.flash.isSupported=function(){return _V_.flash.version()[0]>=10};_V_.flash.canPlaySource=function(srcObj){if(srcObj.type in _V_.flash.prototype.support.formats){return"maybe"}};_V_.flash.prototype.support={formats:{"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"},progressEvent:false,timeupdateEvent:false,fullscreenResize:false,parentResize:!(_V_.ua.match("Firefox"))};_V_.flash.onReady=function(currSwf){var el=_V_.el(currSwf);var player=el.player||el.parentNode.player,tech=player.tech;el.player=player;tech.el=el;tech.addEvent("click",tech.onClick);_V_.flash.checkReady(tech)};_V_.flash.checkReady=function(tech){if(tech.el.vjs_getProperty){tech.triggerReady()}else{setTimeout(function(){_V_.flash.checkReady(tech)},50)}};_V_.flash.onEvent=function(swfID,eventName){var player=_V_.el(swfID).player;player.triggerEvent(eventName)};_V_.flash.onError=function(swfID,err){var player=_V_.el(swfID).player;player.triggerEvent("error");_V_.log("Flash Error",err,swfID)};_V_.flash.version=function(){var version="0,0,0";try{version=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){version=(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}}catch(e){}}return version.split(",")};_V_.flash.embed=function(swf,placeHolder,flashVars,params,attributes){var code=_V_.flash.getEmbedCode(swf,flashVars,params,attributes),obj=_V_.createElement("div",{innerHTML:code}).childNodes[0],par=placeHolder.parentNode;placeHolder.parentNode.replaceChild(obj,placeHolder);if(_V_.isIE()){var newObj=par.childNodes[0];setTimeout(function(){newObj.style.display="block"},1000)}return obj};_V_.flash.getEmbedCode=function(swf,flashVars,params,attributes){var objTag='<object type="application/x-shockwave-flash"',flashVarsString="",paramsString="";attrsString="";if(flashVars){_V_.eachProp(flashVars,function(key,val){flashVarsString+=(key+"="+val+"&amp;")})}params=_V_.merge({movie:swf,flashvars:flashVarsString,allowScriptAccess:"always",allowNetworking:"all"},params);_V_.eachProp(params,function(key,val){paramsString+='<param name="'+key+'" value="'+val+'" />'});attributes=_V_.merge({data:swf,width:"100%",height:"100%"},attributes);_V_.eachProp(attributes,function(key,val){attrsString+=(key+'="'+val+'" ')});return objTag+attrsString+">"+paramsString+"</object>"};_V_.merge(_V_.Player.prototype,{addTextTracks:function(trackObjects){var tracks=this.textTracks=(this.textTracks)?this.textTracks:[],i=0,j=trackObjects.length,track,Kind;for(;i<j;i++){Kind=_V_.uc(trackObjects[i].kind||"subtitles");track=new _V_[Kind+"Track"](this,trackObjects[i]);tracks.push(track);if(track["default"]){this.ready(_V_.proxy(track,track.show))}}return this},showTextTrack:function(id,disableSameKind){var tracks=this.textTracks,i=0,j=tracks.length,track,showTrack,kind;for(;i<j;i++){track=tracks[i];if(track.id===id){track.show();showTrack=track}else{if(disableSameKind&&track.kind==disableSameKind&&track.mode>0){track.disable()}}}kind=(showTrack)?showTrack.kind:((disableSameKind)?disableSameKind:false);if(kind){this.triggerEvent(kind+"trackchange")}return this}});_V_.Track=_V_.Component.extend({init:function(player,options){this._super(player,options);_V_.merge(this,{id:options.id||("vjs_"+options.kind+"_"+options.language+"_"+_V_.guid++),src:options.src,"default":options["default"],title:options.title,language:options.srclang,label:options.label,cues:[],activeCues:[],readyState:0,mode:0})},createElement:function(){return this._super("div",{className:"vjs-"+this.kind+" vjs-text-track"})},show:function(){this.activate();this.mode=2;this._super()},hide:function(){this.activate();this.mode=1;this._super()},disable:function(){if(this.mode==2){this.hide()}this.deactivate();this.mode=0},activate:function(){if(this.readyState==0){this.load()}if(this.mode==0){this.player.addEvent("timeupdate",this.proxy(this.update,this.id));this.player.addEvent("ended",this.proxy(this.reset,this.id));if(this.kind=="captions"||this.kind=="subtitles"){this.player.textTrackDisplay.addComponent(this)}}},deactivate:function(){this.player.removeEvent("timeupdate",this.proxy(this.update,this.id));this.player.removeEvent("ended",this.proxy(this.reset,this.id));this.reset();this.player.textTrackDisplay.removeComponent(this)},load:function(){if(this.readyState==0){this.readyState=1;_V_.get(this.src,this.proxy(this.parseCues),this.proxy(this.onError))}},onError:function(err){this.error=err;this.readyState=3;this.triggerEvent("error")},parseCues:function(srcContent){var cue,time,text,lines=srcContent.split("\n"),line="",id;for(var i=1,j=lines.length;i<j;i++){line=_V_.trim(lines[i]);if(line){if(line.indexOf("-->")==-1){id=line;line=_V_.trim(lines[++i])}else{id=this.cues.length}cue={id:id,index:this.cues.length};time=line.split(" --> ");cue.startTime=this.parseCueTime(time[0]);cue.endTime=this.parseCueTime(time[1]);text=[];while(lines[++i]&&(line=_V_.trim(lines[i]))){text.push(line)}cue.text=text.join("<br/>");this.cues.push(cue)}}this.readyState=2;this.triggerEvent("loaded")},parseCueTime:function(timeText){var parts=timeText.split(":"),time=0,hours,minutes,other,seconds,ms,flags;if(parts.length==3){hours=parts[0];minutes=parts[1];other=parts[2]}else{hours=0;minutes=parts[0];other=parts[1]}other=other.split(/\s+/);seconds=other.splice(0,1)[0];seconds=seconds.split(/\.|,/);ms=parseFloat(seconds[1]);seconds=seconds[0];time+=parseFloat(hours)*3600;time+=parseFloat(minutes)*60;time+=parseFloat(seconds);if(ms){time+=ms/1000}return time},update:function(){if(this.cues.length>0){var time=this.player.currentTime();if(this.prevChange===undefined||time<this.prevChange||this.nextChange<=time){var cues=this.cues,newNextChange=this.player.duration(),newPrevChange=0,reverse=false,newCues=[],firstActiveIndex,lastActiveIndex,html="",cue,i,j;if(time>=this.nextChange||this.nextChange===undefined){i=(this.firstActiveIndex!==undefined)?this.firstActiveIndex:0}else{reverse=true;i=(this.lastActiveIndex!==undefined)?this.lastActiveIndex:cues.length-1}while(true){cue=cues[i];if(cue.endTime<=time){newPrevChange=Math.max(newPrevChange,cue.endTime);if(cue.active){cue.active=false}}else{if(time<cue.startTime){newNextChange=Math.min(newNextChange,cue.startTime);if(cue.active){cue.active=false}if(!reverse){break}}else{if(reverse){newCues.splice(0,0,cue);if(lastActiveIndex===undefined){lastActiveIndex=i}firstActiveIndex=i}else{newCues.push(cue);if(firstActiveIndex===undefined){firstActiveIndex=i}lastActiveIndex=i}newNextChange=Math.min(newNextChange,cue.endTime);newPrevChange=Math.max(newPrevChange,cue.startTime);cue.active=true}}if(reverse){if(i===0){break}else{i--}}else{if(i===cues.length-1){break}else{i++}}}this.activeCues=newCues;this.nextChange=newNextChange;this.prevChange=newPrevChange;this.firstActiveIndex=firstActiveIndex;this.lastActiveIndex=lastActiveIndex;this.updateDisplay();this.triggerEvent("cuechange")}}},updateDisplay:function(){var cues=this.activeCues,html="",i=0,j=cues.length;for(;i<j;i++){html+="<span class='vjs-tt-cue'>"+cues[i].text+"</span>"}this.el.innerHTML=html},reset:function(){this.nextChange=0;this.prevChange=this.player.duration();this.firstActiveIndex=0;this.lastActiveIndex=0}});_V_.CaptionsTrack=_V_.Track.extend({kind:"captions"});_V_.SubtitlesTrack=_V_.Track.extend({kind:"subtitles"});_V_.ChaptersTrack=_V_.Track.extend({kind:"chapters"});_V_.TextTrackDisplay=_V_.Component.extend({createElement:function(){return this._super("div",{className:"vjs-text-track-display"})}});_V_.TextTrackMenuItem=_V_.MenuItem.extend({init:function(player,options){var track=this.track=options.track;options.label=track.label;options.selected=track["default"];this._super(player,options);this.player.addEvent(track.kind+"trackchange",_V_.proxy(this,this.update))},onClick:function(){this._super();this.player.showTextTrack(this.track.id,this.track.kind)},update:function(){if(this.track.mode==2){this.selected(true)}else{this.selected(false)}}});_V_.OffTextTrackMenuItem=_V_.TextTrackMenuItem.extend({init:function(player,options){options.track={kind:options.kind,player:player,label:"Off"};this._super(player,options)},onClick:function(){this._super();this.player.showTextTrack(this.track.id,this.track.kind)},update:function(){var tracks=this.player.textTracks,i=0,j=tracks.length,track,off=true;for(;i<j;i++){track=tracks[i];if(track.kind==this.track.kind&&track.mode==2){off=false}}if(off){this.selected(true)}else{this.selected(false)}}});_V_.TextTrackButton=_V_.Button.extend({init:function(player,options){this._super(player,options);this.menu=this.createMenu();if(this.items.length===0){this.hide()}},createMenu:function(){var menu=new _V_.Menu(this.player);menu.el.appendChild(_V_.createElement("li",{className:"vjs-menu-title",innerHTML:_V_.uc(this.kind)}));menu.addItem(new _V_.OffTextTrackMenuItem(this.player,{kind:this.kind}));this.items=this.createItems();this.each(this.items,function(item){menu.addItem(item)});this.addComponent(menu);return menu},createItems:function(){var items=[];this.each(this.player.textTracks,function(track){if(track.kind===this.kind){items.push(new _V_.TextTrackMenuItem(this.player,{track:track}))}});return items},buildCSSClass:function(){return this.className+" vjs-menu-button "+this._super()},onFocus:function(){this.menu.lockShowing();_V_.one(this.menu.el.childNodes[this.menu.el.childNodes.length-1],"blur",this.proxy(function(){this.menu.unlockShowing()}))},onBlur:function(){},onClick:function(){this.one("mouseout",this.proxy(function(){this.menu.unlockShowing();this.el.blur()}))}});_V_.CaptionsButton=_V_.TextTrackButton.extend({kind:"captions",buttonText:"Captions",className:"vjs-captions-button"});_V_.SubtitlesButton=_V_.TextTrackButton.extend({kind:"subtitles",buttonText:"Subtitles",className:"vjs-subtitles-button"});_V_.ChaptersButton=_V_.TextTrackButton.extend({kind:"chapters",buttonText:"Chapters",className:"vjs-chapters-button",createItems:function(chaptersTrack){var items=[];this.each(this.player.textTracks,function(track){if(track.kind===this.kind){items.push(new _V_.TextTrackMenuItem(this.player,{track:track}))}});return items},createMenu:function(){var tracks=this.player.textTracks,i=0,j=tracks.length,track,chaptersTrack,items=this.items=[];for(;i<j;i++){track=tracks[i];if(track.kind==this.kind&&track["default"]){if(track.readyState<2){this.chaptersTrack=track;track.addEvent("loaded",this.proxy(this.createMenu));return}else{chaptersTrack=track;break}}}var menu=this.menu=new _V_.Menu(this.player);menu.el.appendChild(_V_.createElement("li",{className:"vjs-menu-title",innerHTML:_V_.uc(this.kind)}));if(chaptersTrack){var cues=chaptersTrack.cues,i=0,j=cues.length,cue,mi;for(;i<j;i++){cue=cues[i];mi=new _V_.ChaptersTrackMenuItem(this.player,{track:chaptersTrack,cue:cue});items.push(mi);menu.addComponent(mi)}}this.addComponent(menu);if(this.items.length>0){this.show()}return menu}});_V_.ChaptersTrackMenuItem=_V_.MenuItem.extend({init:function(player,options){var track=this.track=options.track,cue=this.cue=options.cue,currentTime=player.currentTime();options.label=cue.text;options.selected=(cue.startTime<=currentTime&&currentTime<cue.endTime);this._super(player,options);track.addEvent("cuechange",_V_.proxy(this,this.update))},onClick:function(){this._super();this.player.currentTime(this.cue.startTime);this.update(this.cue.startTime)},update:function(time){var cue=this.cue,currentTime=this.player.currentTime();if(cue.startTime<=currentTime&&currentTime<cue.endTime){this.selected(true)}else{this.selected(false)}}});_V_.merge(_V_.ControlBar.prototype.options.components,{subtitlesButton:{},captionsButton:{},chaptersButton:{}});_V_.autoSetup=function(){var options,vid,player,vids=document.getElementsByTagName("video");if(vids&&vids.length>0){for(var i=0,j=vids.length;i<j;i++){vid=vids[i];if(vid&&vid.getAttribute){if(vid.player===undefined){options=vid.getAttribute("data-setup");if(options!==null){options=JSON.parse(options||"{}");player=_V_(vid,options)}}}else{_V_.autoSetupTimeout(1);break}}}else{if(!_V_.windowLoaded){_V_.autoSetupTimeout(1)}}};_V_.autoSetupTimeout=function(wait){setTimeout(_V_.autoSetup,wait)};_V_.addEvent(window,"load",function(){_V_.windowLoaded=true});_V_.autoSetup();window.VideoJS=window._V_=VideoJS})(window);(function(){var b,d,a,c;Function.prototype.defer=Function.prototype.defer.wrap(function(f){var e;e=$A(arguments).slice(1);this.__tb__=get_stack_rep();return f.apply(this,e)});String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(g){var f;f=$A(arguments).slice(1);try{return g.apply(this,f)}catch(h){return assert(0,h.toString())}});Function.prototype.cached=function(e){var h,g;g=Math.random();h=this;return function(){var f;f=Jcached.get(g);if(f!==false){return f}f=h();Jcached.set(g,f,e);return f}};Array.prototype.sort_by_key=function(g,h){var e;if(h==null){h=false}e=h?-1:1;return this.sort(function(f,j){f=g(f);j=g(j);if(f<j){return e*-1}else{if(f>j){return e*1}else{return 0}}})};Array.prototype.contains=function(e){return this.indexOf(e)!==-1};Array.prototype.remove=function(f,e){e=e||f+1;return this.splice(f,e-f)};Array.prototype.removeItem=function(f){var e;e=this.indexOf(f);if(e>=0){return this.remove(e)}else{return false}};Array.prototype.dict_by=function(e){var h,j,g,k,f;g={};for(h=k=0,f=this.length;k<f;h=++k){j=this[h];g[this[h][e]]=this[h]}return g};Array.prototype.unique=function(){var j,g,h,f,e;j={};for(h=0,f=this.length;h<f;h++){g=this[h];if(typeof g!=="string"){return this}j[g]=0}e=[];for(g in j){e.push(g)}return e};String.prototype.widthSplit=function(h){var e,g,f,j;if(h==null){h=15}e=[];g=this;j=0;f=g.substring(j,j+h);while(f!==""){e.push(f);j+=h;f=g.substring(j,j+h)}return e};Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,0.5)}});(function(g){var f,e;f=function(m){var j,q,p,n,r,l,k,o,h;if(m){if(Object.isArray(m)){j=[];for(l=0,o=m.length;l<o;l++){q=m[l];j.push(HTML.escape(q).toHTML())}m=new HTML(j.join(""))}else{if(m.top||m.bottom||m.before||m.after){n=["top","bottom","before","after"];for(k=0,h=n.length;k<h;k++){p=n[k];r=m[p];if(r){m[p]=arguments.callee(r)}}}else{if(Util.isElm(m||m.toElement||m.toHTML)){}else{m=HTML.escape(m)}}}}return m};return Element.addMethods({db_observe:function(j,h,k){return j.observe(h,function(l){return k(l,j)})},smoothScrollIntoView:function(l,k){var p,j,h,o,n,m;if(k==null){k={}}p={duration:0.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut};k=Object.extend(p,k);h=l.viewportOffset(l);j=l.getDimensions();m=document.viewport.getDimensions();n=k.padding||0;if(h.top>n&&(h.top+j.height)<(m.height-n)){return}o=h.top<n?-1*Math.floor(m.height/4):-1*Math.floor(3*m.height/4);k.offset=k.offset||o;return new Effect.ScrollTo(l,k)},__sert:function(h,j){return Element.insert(h,f(j))},__date:function(h,j){return Element.update(h,f(j))},replace:e=function(h,j){return g(h,f(j))}})})(Element.replace);a=function(e){if(e!=null?e.target:void 0){try{return document.activeElement=e.target===document?null:e.target}catch(f){}}};c=function(e){try{return document.activeElement=null}catch(f){}};if(document.addEventListener){document.addEventListener("focus",a,true);document.addEventListener("blur",c,true)}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}String.prototype.lpad=function(f,e){var g;if(e==null){e="0"}g=this;while(g.length<f){g=e+g}return g.toString()};String.prototype.reverse=function(){var g,f,e;e=this.split("");f=e.reverse();g=f.join("");return g};String.prototype.create=function(e){return e};String.prototype.count=function(e){return(this.length-this.gsub(e,"").length)/e.length};d=/^\.[a-zA-Z0-9]$/;String.prototype.snippet=function(k,m){var e,f,j,n,h,l,g;if(k==null){k=50}if(m==null){m=0.75}if(this.length<=k){return this}f="";e=this.lastIndexOf(".");if(this.length-e>5){e=-1}if(e>0){f=this.substr(e);if(d.match(f)){k=k-f.length}else{e=this.length;f=""}}else{e=this.length;f=""}k=k-this.create("...").length;j=k*m;if(!(this instanceof Emstring)){j=Math.floor(j)}l=k-j;g=e-l;h=this.substr(0,j);n=this.substr(g,l);return h+"..."+n+f};String.prototype.em_snippet=function(f,e){return new Emstring(this).snippet(f,e).toString()};String.prototype.repeat=function(e){return(new Array(e+1)).join(this)};String.prototype.title=function(){return this.charAt(0).toUpperCase()+this.substr(1)};Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,m,k){var q,p,v,h,f,r,n,l,g,e,t,u,o,j,s=this;if(k==null){k={}}this.orig_req={url:m,options:k};this.start_time=Util.time();k.method=k.method||"post";k.suppress_nonstandard_headers=true;k.parameters=k.parameters||{};k.parameters.t=Constants.TOKEN;k.parameters.is_xhr=true;if(k.method.toLowerCase()==="post"||Constants.CPROFILE_ENABLED){k.parameters.parent_request_id=Constants.REQUEST_ID}if(Constants.CPROFILE_ENABLED){k.parameters.cProfile=Constants.CPROFILE_PARAMETER}if(Ajax.DBRequest.restrict){k.parameters.restrict=Ajax.DBRequest.restrict}p=k.cleanUp||(function(){});if(k.job){this.job_id=Util.nonce();k.parameters.job_id=this.job_id;ProgressWatcher.watch(this)}if(!k.no_watch){RequestWatcher.watch(this,!!k.job)}r=k.onFailure;n=k.onSuccess;f=function(w){var y,x;if(k.parameters.xhr_retry||!k.allow_retries){return false}if((x=w.status)===0||x===404||x===500||x===502||x===503){s.orig_req.options.parameters.xhr_retry=true;s.orig_req.options.onFailure=r;s.orig_req.options.onSuccess=n;y=new Ajax.DBRequest(s.orig_req.url,s.orig_req.options);return true}return false};h=function(x){var w;if(k.noAutonotify||k.no_watch){return}if(x.status!==0&&x.status<400){return}w={url:s.orig_req.url,response_code:x.status,source_type:"web",request_id:x.getHeader("X-Dropbox-Request-Id")};return new Ajax.DBRequest("/web_response_code_log",{noAutonotify:true,no_watch:true,parameters:w})};k.onFailure=function(x){var z,w,y;if(Job.handled(x.request.job_id)){return}h(x);if(f(x)){return}if(!k.noAutonotify){if(!Constants.IS_PROD&&x.status===500&&x.getHeader("X-Debug-Url")){m=x.getHeader("X-Debug-Url");z=_("There was a problem completing this request.")+(' <a href="'+m+'" target="_blank">View debug</a>');Notify.server_error(new HTML(z))}else{Notify.server_error()}}p(false);if(r){r(x)}if(x.status===403){w=Util.session_storage_get("reload-timestamp");if(!w||Util.time()-w>30*1000){Util.session_storage_set("reload-timestamp",Util.time());location.reload(true)}}return assert(k.noAutonotify||((y=x.status)===403||y===404||y===502),"Ajax "+x.status+" on "+x.request.url)};k.onSuccess=function(E){var D,w,K,H,F,x,J,z,A,I,y,B,G,C;y=Util.time()-E.request.start_time;if(Job.handled(E.request.job_id)){return}if(typeof QueryLog!=="undefined"){QueryLog.update_query_log_from_req(E)}if(!E.responseText.length){if(!k.job){h(E);if(f(E)){return}if(!k.noAutonotify?!E||E.status!==0:void 0){Notify.server_error()}if(r){r(E)}}}else{if(E.responseText.indexOf("err:")===0){if(!k.noAutonotify){x=E.responseText.substr(4);if(k.html_in_error_msg){x=new HTML(x)}Notify.server_error(x)}if(r){r(E)}}else{if(E.responseText.indexOf("async_task_started:")===0){s.async_task_id=E.responseText.split(":")[1];ProgressWatcher.watch(s)}else{if(n){if(E.responseText.indexOf("ok:")===0){Notify.server_success(E.responseText.substr(3))}n(E)}}I=E.getHeader("X-Server-Response-Time")||"-1";if(k.log_timing){WebTimingLogger.log_ajax_transition.defer(y,void 0,void 0,void 0,I,m=URLUtil.absolutize(s.url))}D=$j("#cprofile");if(!k.no_watch&&D.length){A=""+Constants.REQUEST_ID+"-"+(E.getHeader("X-Dropbox-Request-Id"));m=E.request.url.replace(/[^/]*\/\/[^/]+/,"").replace(/\?.*$/,"");H=""+m+" ("+I+"ms)";J="/profile/cprofile?request_id="+A;z=E.request.url;if(z.indexOf(Constants.BLOCK_CLUSTER)!==-1){J+="&block=1"}else{C=Constants.BATCH_THUMB_ENDPOINTS;for(B=0,G=C.length;B<G;B++){K=C[B];if(z.indexOf(K)!==-1){J+="&block=1";break}}}F=$j('<a class="ajax" target="_new" />').attr("href",J).text(H);w=D.find(".ajax");if(w.length>=10){w.last().remove()}D.prepend(F)}if($j("#gandalf_panel").length&&E.request.url.substring(0,14)!=="/gandalf_panel"){GandalfPanel.add(E.request.url,E.getHeader("X-Dropbox-Request-Id"))}}}return p(true)};k.onException=function(x,y){var z,w;if(window.console){throw y}z=("Error with AJAX callback for: "+m+" :::: ")+y.toString();w=get_stack_rep();w.pop();return global_report_exception(z,window.location.href,"",w.join("\n"))};if(k.job){m+=(m.indexOf("?")===-1?"?":"&")+"long_running=1"}q=$H({url:m});if(k.parameters){q.update(k.parameters);o=q.keys();for(g=0,t=o.length;g<t;g++){v=o[g];j=["passwd","password","oauth","ccn","host_id"];for(e=0,u=j.length;e<u;e++){l=j[e];if(v.indexOf(l)!==-1){q.unset(v)}}}q.unset("t")}k.onSuccess.__tb_ajax_info__=k.onFailure.__tb_ajax_info__=Object.toJSON(q);return $super(m,k)}});if(typeof key!=="undefined"&&key!==null){Object.extend(key,{main_modifier:function(){if(Util.is_mac()){return decodeURIComponent("%E2%8C%98")}else{return"ctrl"}}})}b=function(){var g,h,e,f;e=function(k){var l,j;k=$(k);j=$(k.target);if(!Element.match(j,"input,textarea")){return}l=j.readAttribute("placeholder");if(l){if("focus"===k.type||"focusin"===k.type){if(j.getValue()===""){j.setValue("");return j.removeClassName(g)}}else{if(""===j.value){j.addClassName(g);return j.value=l}}}};$(document.body);h=$(document.documentElement);g="placeholder";if(h.addEventListener){h.addEventListener("focus",e,true);h.addEventListener("blur",e,true)}else{h.on("focusin","[placeholder]",e);h.on("focusout","[placeholder]",e)}f=Element.Methods.ByTag.INPUT.getValue.wrap(function(l,j){var k;k=$(j).readAttribute("placeholder");if(k&&k===j.value&&$(j).hasClassName(g)){return""}return l.apply(this,$A(arguments).slice(1))});Element.addMethods("input",{getValue:f});return Element.addMethods("textarea",{getValue:f})};if(document.loaded){b()}else{document.observe("dom:loaded",b)}Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&("withCredentials" in new XMLHttpRequest())})}).call(this);var __slice=[].slice;jQuery.fn.curry=function(){var a,c,b;c=arguments[0],b=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[];if(b==null){b=window}return function(){var d;d=1<=arguments.length?__slice.call(arguments,0):[];return c.apply(b,__slice.call(a).concat(__slice.call(d)))}};jQuery.fn.stripTags=function(a){return a.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")};jQuery.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.height()};jQuery.fn.viewportOffset=function(a){var c,b;c=jQuery(this).offset();b=jQuery(window);return{left:c.left-b.scrollLeft(),top:c.top-b.scrollTop()}};jQuery.fn.visible=function(){return jQuery(this).is(":visible")};jQuery.fn.clonePosition=function(c,l){var f,e,h,d,g,j,k;k={setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0};jQuery.extend(k,l||{});c=jQuery(c);j=c.viewportOffset();h={top:0,left:0};g=null;d=this;if(d.css("position")==="absolute"){g=d.offsetParent();h=g.viewportOffset()}if(g&&g[0]===document.body){h.left-=document.body.offsetLeft;h.top-=document.body.offsetTop}if(k.setLeft){f=(j.left-h.left+k.offsetLeft)+"px";d.css("left",f)}if(k.setTop){e=(j.top-h.top+k.offsetTop)+"px";d.css("top",e)}if(k.setWidth){d.width(c[0].offsetWidth)}if(k.setHeight){d.height(c[0].offsetHeight)}return d};jQuery.fn.binarySearch=function(c,b,a){return Util.binarySearch(this,c,b,a)};jQuery.fn.ago=(function(){var d,e,a,b,c;e=null;a=null;d=function(g,f){return g.getDate()===f.getDate()&&g.getMonth()===f.getMonth()&&g.getFullYear()===f.getFullYear()};c=function(f){var h,o,n,j,l,k,g,m;h=this.data("autodate");if(!h instanceof Date){return 0}o=f.getTime()-h.getTime();k=30*1000-o;if(k>0){this.text(_("Just now"));return k}k=60*1000-o;if(k>0){this.text(_("Less than a minute ago"));return k}k=60*60*1000-o;if(k>0){l=o/60000|0;this.text(jQuery.format(ungettext("1 minute ago","{count} minutes ago",l),{count:l}));return k%60000}k=6*60*60*1000-o;if(k>0){n=o/3600000|0;this.text(jQuery.format(ungettext("1 hour ago","{count} hours ago",n),{count:n}));return k%3600000}m=new Date(f.getFullYear(),f.getMonth(),f.getDate()-1);if(h.getTime()<m.getTime()){this.text(jQuery.formatDate(h,Constants.datetime_long_format));return 0}g=jQuery.formatDate(h,Constants.time_format);if(d(h,m)){g=jQuery.format(_("Yesterday {time}"),{time:g})}this.text(g);j=new Date(f.getFullYear(),f.getMonth(),f.getDate()+1);return j.getTime()-f.getTime()};b=function(){var g,f;f=new Date();g=void 0;$j(".autodate").each(function(){var h;h=c.call($j(this),f);if(h>0){if(!(g<=h)){g=h}}else{$j(this).removeClass("autodate")}return true});if(g>0){e=window.setTimeout(b,g);a=f.getTime()+g}else{e=a=null}return true};return function(g){var f,h,j;if(!(g instanceof Date)){g=new Date(g||null)}f=new Date();h=c.call(this.data("autodate",g),f);if(h>0){j=f.getTime()+h;if(a===null||j<a){if(e){window.clearTimeout(e)}e=window.setTimeout(b,h);a=j}this.addClass("autodate")}return this}})();jQuery.format=function(b,a){return b.replace(/\{([^}]+)\}/g,function(d,c){if(c in a){return a[c]}else{return d}})};jQuery.formatDate=function(c,a){var b;b=[_("AM"),_("PM")];return a.replace(/'[^']*'|y+|M+|d+|h+|k+|K+|H+|m+|s+|S+|a+/g,function(e){var d;switch(e[0]){case"'":if(e.length===2){return"'"}return e.slice(1,-1);case"y":if(e==="yy"){return c.getYear()%100}d=c.getFullYear();break;case"M":if(e.length>=3){return Util.month_name(c.getMonth(),e.length===3)}d=c.getMonth()+1;break;case"d":d=c.getDate();break;case"h":d=c.getHours()%12||12;break;case"k":d=c.getHours()%12+1;break;case"K":d=c.getHours()%12;break;case"H":d=c.getHours();break;case"m":d=c.getMinutes();break;case"s":d=c.getSeconds();break;case"S":d=c.getMilliseconds();break;case"a":return b[(c.getHours()>=12)*1]}d=""+d;if(d.length<e.length){d=("00000000"+d).slice(e.length*-1)}return d})};jQuery.cachedScript=function(b,a){a=$j.extend(a||{},{dataType:"script",cache:true,url:b});return jQuery.ajax(a)};(function(){var a,b;a=function(f,d,e,c){if(typeof f==="function"){return f.call(d[0],e,c)}};b="ontouchstart" in window;return jQuery.fn.tappable=function(c,d){var e;e={cancelOnMove:true,touchDelay:0,callback:null,touchstartCallback:null};if(undefined===d){d=c;c=null}switch(typeof d){case"function":e.callback=d;break;case"object":$.extend(e,d)}if(b){this.on("touchstart",c,function(h){var g,f;g=jQuery(this);f=g.prop("tappable");a(e.touchstartCallback,g,h);if(!f){f={event:h,attached:0};g.prop("tappable",f)}f.attached++;return window.setTimeout((function(){if(f){return g.addClass("touched")}}),e.touchDelay)});this.on("touchend",c,function(h){var g,f;g=jQuery(this);f=g.prop("tappable");if(f){h=f.event;if(0===--f.attached){g.removeProp("tappable").removeClass("touched")}return a(e.callback,g,h,true)}});if(e.cancelOnMove){this.on("touchmove",c,function(){return jQuery(this).removeProp("tappable").removeClass("touched")})}this.on("touchcancel",c,function(f){return jQuery(this).removeProp("tappable").removeClass("touched")})}else{this.on("click",c,function(f){return a(e.callback,jQuery(this),f,false)})}return this}})();jQuery.ajaxSetup({data:{t:Constants.TOKEN,is_xhr:true}});var LANGPACK,N_,PLURAL_RULES,add_i18n_message,localized_path,singular_01,singular_1,singular_all,ungettext,_;add_i18n_message=function(d,c,a,b){Constants.messages=Constants.messages||{};Constants.emessages=Constants.emessages||{};c=c.stripTags().friendly_format();a=a.stripTags();Constants.messages[c]=d;Constants.emessages[c]=a;if(b){delete Constants.messages[b];return delete Constants.emessages[b]}};singular_1=function(a){if(a===1){return 0}else{return 1}};singular_01=function(a){if(a<=1){return 0}else{return 1}};singular_all=function(a){return 0};PLURAL_RULES={es_US:singular_1,es_ES:singular_1,de:singular_1,es:singular_1,fr:singular_01,id:singular_all,it:singular_1,ja:singular_all,ko:singular_all,ms:singular_all,pl:singular_1,pt_BR:singular_01,ru:singular_1,zh_CN:singular_all,zh_TW:singular_all};if(!window.LANGPACK){LANGPACK={}}_=function(a){var b;b=LANGPACK[a]||a;add_i18n_message(a,b,a);return b};N_=function(a){return a};ungettext=function(c,b,g){var f,d,e,a;assert(g!=null,"missing number parameter for ungettext");if(c in LANGPACK&&Constants.USER_LOCALE){d=LANGPACK[c];if(Object.isString(d)&&Constants.USER_LOCALE==="ja"){return d}e=PLURAL_RULES[Constants.USER_LOCALE](g);assert(e in d,"bad plural lookup");a=d[e]}f=g===1?c:b;if(a==null){a=f}add_i18n_message(c,a,f);return a};localized_path=function(f,b){var c,e,a,d;if(!b){d=Constants.LOCALES;for(e=0,a=d.length;e<a;e++){c=d[e];b=c[0]}}if(b.indexOf(Constants.USER_LOCALE)!==-1){return f.replace(/(\.[a-zA-Z0-9]{2,4})$/,"__%s$1".format(Constants.USER_LOCALE))}else{return f}};Date.prototype.localize=function(){assert(Constants.date_format!=null,"Date format missing.");return this.format(Constants.date_format)};Date.prototype.format=function(a){var b,c=this;assert(typeof a==="string","Date format requires a format string");b={yy:function(){return c.getFullYear().toString().substring(2)},yyyy:function(){return c.getFullYear().toString()},M:function(){return(c.getMonth()+1).toString()},MM:function(){return(c.getMonth()+1).toString().lpad(2)},d:function(){return c.getDate().toString()},dd:function(){return c.getDate().toString().lpad(2)},h:function(){return(c.getHours()%12||12).toString()},H:function(){return(c.getHours()%12||12).toString()},HH:function(){return(c.getHours()%12||12).toString().lpad(2)},m:function(){return c.getMinutes().toString()},mm:function(){return c.getMinutes().toString().lpad(2)},a:function(){if(c.getHours()>11){return _("PM")}else{return _("AM")}}};return a.replace(/([a-zA-Z]+)/g,function(d){if(b[d]!=null){return b[d]()}else{return d}})};String.prototype.format_sub=function(a){return this.replace(/%(\([a-z0-9_\-]+\))?(.\d+)?(.)/g,a.bind(this))};String.prototype.format=function(){var g,f,e,c,b,a;if(arguments.length===0){return this.toString()}f=void 0;g=0;if(arguments.length===1&&arguments[0] instanceof Object){f=arguments[0]}else{f=$A(arguments)}b=function(m,k,j,l){var n,d,h;if(!k){if(!Object.isArray(f)){f=[f]}assert(g>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'.");assert(g<f.length,"Insufficient number of items in format for string '"+this+"', list "+Object.toJSON($A(f))+".");h=f[g];g++}else{k=k.slice(1,-1);assert(g<=0,"Cannot mix named and positional indices in string formatting for string '"+this+"'.");g=-1;assert(k in f,"Key '"+k+"' not present during string substitution for string '"+this+"', dict "+Object.toJSON($H(f))+".");h=f[k]}assert(typeof h!=="undefined",'value for key "'+(k||"").toString()+'" is undefined');d=void 0;if(l==="s"){d=h.toString()}else{if(l==="d"){d=parseInt(h,10).toString()}else{if(l==="f"){d=Number(h).toString()}else{if(l==="%"){return"%"}else{assert(false,"Unexpected format character '"+l+"' for string '"+this+"'.")}}}}if(j){j=parseInt(j.slice(1),10);if(l==="f"){if(d.indexOf("."===-1)){d=d+".0"}n=d.split(".");return n[0]+"."+n[1].slice(0,j)}else{return d.slice(0,j)}}return d};a=this.format_sub(b);if(Constants.messages&&this in Constants.messages){g=0;c=Constants.emessages[this];e=String.prototype.format_sub.call(c,b);add_i18n_message(c,a,e,this)}return a};String.prototype.friendly_format=function(){var a,c,b;c=function(g,e,d,f){if(!e){if(f==="s"){return"[word"+(b++)+"]"}else{return"[number"+(a++)+"]"}}else{return"["+(e.slice(1,1).replace("-","_"))+"]"}};a=1;b=1;return this.format_sub(c)};String.prototype.blank_format=function(){var a;a=function(){return""};return this.format_sub(a)};var DBObserver,DomUtil,Email,Emstring,GandalfPanel,IE7_OR_LESS,RequestWatcher,SimpleSet,SuperDictionary,T,Trace,UIButton,URLUtil,Util,Velocity,alertd,assert,console,fn_body,get_stack_rep,strip_comments,__slice=[].slice;strip_comments=function(a){return a.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")};fn_body=function(b){var a;a=strip_comments(b.toString());a=a.replace(/[\s]+/g," ");if(a.startsWith("(")){a=a.substr(1)}if(a.endsWith(")")){a=a.substr(0,a.length-1)}a=a.replace("function (","function(");return a};get_stack_rep=function(){var d,c,b,a;b=[];a={};d=arguments.callee.caller;while(d){if(d.__tb_ajax_info__){b.unshift("Ajax.DBRequest: "+d.__tb_ajax_info__);break}if(d.__tb__){b=d.__tb__.concat(b);break}c=fn_body(d);if(c in a){break}a[c]=true;b.unshift(c);d=d.caller}return b};alertd=window.alert;assert=function(c,d,b){var a;if(!c){d="Assertion Error: "+d;if(!Constants.IS_PROD){if(typeof console!=="undefined"&&console!==null){if(typeof console.trace==="function"){console.trace()}}alertd(d)}a=get_stack_rep();a.pop();global_report_exception(d,window.location.href,"",a.join("\n"));throw d}};DBObserver={watch:function(b,c){var a;a=function(){var e,d;e=$(b);assert(e,"Couldn't find watch element");d=e.getValue().strip();if(d!==e.last_search&&!SuggestionInput.defaulted(e)){e.last_search=d;return c(d)}};return setInterval(a,300)}};Email={mailto:function(c,b,d,a){if(d==null){d="dropbox.com"}if(a==null){a=""}c.href="mailto:"+b+"@"+d;if(a){c.href+="?body="+a}return c.onMouseover=null}};SimpleSet=Class.create({initialize:function(a){this.length=0;this.d={};this.items=[];return this.update(a)},update:function(c){var d,e,b,a;if(c==null){c=[]}a=[];for(e=0,b=c.length;e<b;e++){d=c[e];a.push(this.add(d))}return a},_hash:function(b){var a;a=typeof b;assert(a==="string"||a==="number","expected a string or a number, got "+a);return a+":"+b},add:function(b){var a;a=this._hash(b);if(!this.d[a]){this.items.push(b);this.length+=1}return this.d[a]=true},contains:function(b){var a;a=this._hash(b);return this.d[a]||false},union:function(){var b,c,d,a;a=1<=arguments.length?__slice.call(arguments,0):[];b=this.items;c=(function(){var g,f,e;e=[];for(g=0,f=a.length;g<f;g++){d=a[g];e.push(d.items)}return e})();return new SimpleSet(b.concat.apply(b,c))},difference:function(){var b,c,g,h,d,f,a,e;b=$A(arguments);assert(b.length>0,"Requires at least one SimpleSet");if(b.length>1){g=b[0];c=g.union.apply(g,b.slice(1))}else{c=b[0]}h=[];e=this.items;for(f=0,a=e.length;f<a;f++){d=e[f];if(!c.contains(d)){h.push(d)}}return new SimpleSet(h)}});Emstring=Class.create({initialize:function(a){this.s=a;this.info=this.widthInfo();return this.length=a.length?this.info[this.s.length-1]:0},create:function(a){return new Emstring(a)},widthInfo:function(){var a,b,d,c;b={};b[-1]=0;for(a=d=0,c=this.s.length;0<=c?d<c:d>c;a=0<=c?++d:--d){b[a]=b[a-1]+this.ems(this.s.charAt(a))}return b},findSpot:function(b){var d,f,a,c;if(!b){return 0}c=0;f=this.s.length;while(c<=f){a=Math.floor(c/2+f/2);d=this.info[a-1];if(d>b){f=a-1}else{if(d<b){c=a+1}else{return a}}}if(c>a){return c}else{return a}},ems:function(g){var b,a,f,e,d;a=0.65;b=1.08;f=0.58;e=g.charCodeAt(0);d=Emstring.CODEPOINT_TO_WIDTH[e];if(d){return d/Math.pow(10,Emstring.ACCURACY)}if((768<=e&&e<=879)){return 0}if((65377<=e&&e<=65500)){return f}if(((11904<=e&&e<=40911))||((44032<=e&&e<=55215))||((4352<=e&&e<=4607))||((63744<=e&&e<=64255))||((65280<=e&&e<=65535))||((131072<=e&&e<=196607))){return b}return a},substr:function(d,a){var b,c;c=this.findSpot(d);if(a!=null){b=this.findSpot(d+a);return new Emstring(this.s.substr(c,b-c))}else{return new Emstring(this.s.substr(c))}},indexOf:function(b){var a;a=this.s.indexOf(b);if(a>-1){return this.info[a-1]}else{return -1}},lastIndexOf:function(b){var a;a=this.s.reverse().indexOf(b.reverse());if(a<0){return -1}return this.info[this.s.length-a-b.length-1]},toString:function(){return this.s},snippet:String.prototype.snippet});Emstring.ACCURACY=2;Emstring.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1000:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,19977:108,65403:58};DomUtil={fromElm:function(a){return $(a).innerHTML},updateFromElm:function(b,a){b=$(b);a=$(a);b.update(this.fromElm(a));return Util.live_joff(a,b)},fillVal:function(h,e){var b,g,d,f,a,c;f=$$("."+e);c=[];for(g=0,d=f.length;g<d;g++){b=f[g];b=$(b);if(b.tagName==="INPUT"){b.value=h;c.push(b.defaultValue=h)}else{if(b.innerHTML===""&&((a=b.tagName)==="A"||a==="B"||a==="INPUT"||a==="I"||a==="LABEL"||a==="SELECT"||a==="SPAN"||a==="TEXTAREA")){Util.log("Filling an empty value; this may look broken in IE7",b)}c.push(b.innerHTML=h)}}return c}};Util={add_qstring:function(a,f,k){var j,d,e,g,h,b,c;if(k==null){k=true}b=k?encodeURIComponent:function(l){return l};e=a.indexOf("?")===-1?"?":"&";h=(function(){var l;l=[];for(g in f){c=f[g];l.push(""+g+"="+(b(c)))}return l})();j="";d=a.indexOf("#");if(d!==-1){j=a.substring(d);a=a.substring(0,d)}return a+e+h.join("&")+j},remove_protocol_and_host:function(a){return a.replace(/https?:\/\/[^\/]+/,"")},from_json:function(a){if(window.JSON&&window.JSON.parse){return window.JSON.parse(a)}else{return a.evalJSON(true)}},to_json:function(a){return Object.toJSON(a)},viewport_dimensions:function(){var a=this;if(!this._cached_viewport_dimensions){this._cached_viewport_dimensions=document.viewport.getDimensions()}if(!this._listening_for_resize){Event.observe(window,"resize",function(){return delete a._cached_viewport_dimensions});this._listening_for_resize=1}return this._cached_viewport_dimensions},set_min_body_height_to_viewport_height:function(){var a;a=$(document.body);if(a!=null?a.style:void 0){return a.style.minHeight=this.viewport_dimensions().height+"px"}},_listen_for_scroll:function(){var a=this;if(!this._listening_for_scroll){Event.observe(window,"scroll",function(){if(a._ignore_scroll_event){a._ignore_scroll_event=0;return}return delete a._cached_scroll_offsets});return this._listening_for_scroll=1}},force_delete_cached_scroll_offsets:function(){return delete this._cached_scroll_offsets},scroll_offsets:function(){this._listen_for_scroll();if(!this._cached_scroll_offsets){this._cached_scroll_offsets=document.viewport.getScrollOffsets()}return this._cached_scroll_offsets},scroll_to:function(a,b){this._listen_for_scroll();this._ignore_scroll_event=1;a=Math.max(a,0);b=Math.max(b,0);if(b>this.scroll_offsets().top){b=Math.min(b,document.body.getHeight()-this.viewport_dimensions().height)}this._cached_scroll_offsets=Element._returnOffset(a,b);return window.scrollTo(a,b)},scroll_to_thumb:function(a){var e,d,c,b;d=a.cumulativeOffset().top;e=a.getHeight();b=this.scroll_offsets().top;c=this.viewport_dimensions().height;if(d<b||d+e>b+c){return this.scroll_to(0,d-c/2)}},get_viewport:function(){var a,b;b=Util.scroll_offsets().top;a=Util.viewport_dimensions().height;return{top:b,height:a,bottom:b+a}},decode_sort_key:function(c){var e,d,b,a;a=[];for(d=0,b=c.length;d<b;d++){e=c[d];if(typeof e==="string"){a.push(this.decode_b64(e))}else{a.push(e)}}return a},sort_by_rank_or_key:function(a,b){if((a.sort_rank!=null)&&(b.sort_rank!=null)){return a.sort_rank-b.sort_rank}assert((a.sort_key!=null)&&(b.sort_key!=null),"expected sort keys on both elms");return this._sort_by_key(a,b)},_sort_by_key:function(b,g){var d,a,c,f,e;a=b.sort_key;c=g.sort_key;for(d=f=0,e=a.length;0<=e?f<e:f>e;d=0<=e?++f:--f){if(!(c[d]!=null)){return 1}if(typeof a[d]!==typeof c[d]){if(typeof a[d]==="string"){return 1}else{return -1}}else{if(a[d]!==c[d]){if(a[d]>c[d]){return 1}else{return -1}}}}if(c.length>a.length){return -1}else{return 0}},add_sort_arrow_mouseover:function(a,e,c,b){var h,f,j,g,d;g=$$(c);d=[];for(f=0,j=g.length;f<j;f++){h=g[f];d.push((function(l){var k,m=this;if(a!==l){Sprite.src(l.down("img"),"web","downtick-spacer");l.removeClassName("bolded");l.stopObserving("mouseout");return l.stopObserving("mouseover")}else{l.addClassName("bolded");if(l.hasClassName("noarrow")){return}k=e?"up":"down";if(b){Sprite.src(l.down("img"),"web","sort-"+k+"tick-on")}l.observe("mouseout",function(){return Sprite.src(l.down("img"),"web","sort-"+k+"tick-off")});return l.observe("mouseover",function(){return Sprite.src(l.down("img"),"web","sort-"+k+"tick-on")})}})(h))}return d},one_line_fit:function(a){var c,b,d=this;c=$$(a);if(c.length<2){return}b=function(){var n,k,j,g,m,h,e,f,l;j=c[0];m=c[c.length-1];g=j.cumulativeOffset().top;h=m.cumulativeOffset().top;if(g!==h){n=parseInt(j.getStyle("font-size"),10);e=n-1;if(e<8){return}for(f=0,l=c.length;f<l;f++){k=c[f];k.style.fontSize=e+"px"}return b()}};return b()},_thumb_load_on_error:function(b){var c,a;a=$(b.target);c=Sprite.SPACER;if(a.hasAttribute("data-fail-src")){c=a.readAttribute("data-fail-src")}return a.writeAttribute("src",c)},thumb_load:function(a,d){var b,c=this;a.observe("error",this._thumb_load_on_error.bind(this));if(a.hasAttribute("data-src")){b=a.readAttribute("data-src");a.removeAttribute("data-src");a.observe("load",function(f){return typeof d==="function"?d(a):void 0});return a.writeAttribute("src",b)}},string_hash:function(f){var g,e,a,d,b;e=0;if(f.length===0){return}for(a=d=0,b=f.length;0<=b?d<b:d>b;a=0<=b?++d:--d){g=f.charCodeAt(a);e=((e<<5)-e)+g;e=e&e}return e},dimensions_to_imagesize:function(e,a){var j,g,c,h,b,d,f;c=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];for(d=0,f=c.length;d<f;d++){h=c[d];g=h[0];b=h[1];j=h[2];if(b>e||j>a){return g}}return c.last()[0]},timedelta:function(b,g){var f,d,a,c,e;d=b.getTime()-g.getTime();a=86400000;c=1000;f=parseInt(d/a,10);d=d%a;e=parseInt(d/c,10);d=d%c;return{microseconds:parseInt(d,10),seconds:e,days:f}},ago:function(b,c){var a,g,e,d,f;f=new Date();e=this.timedelta(f,b);if(e.days<2){d=e.seconds+e.days*86400;if(d<60){a=d;if(c){return ungettext("%d second","%d seconds",a).format(a)}else{return ungettext("%d sec","%d secs",a).format(a)}}else{if(d<3600){a=parseInt(d/60,10);if(c){return ungettext("%d minute","%d minutes",a).format(a)}else{return ungettext("%d min","%d mins",a).format(a)}}else{a=parseInt(d/3600,10);if(c){return ungettext("%d hour","%d hours",a).format(a)}else{return ungettext("%d hr","%d hrs",a).format(a)}}}}else{g=parseInt(e.days+Math.round(e.seconds/86400),10);if(g<30){return ungettext("%d day","%d days",g).format(g)}else{if(g<56){a=parseInt(g/7,10);return ungettext("%d week","%d weeks",a).format(a)}else{if(g<365){a=parseInt(g/30,10);return ungettext("%d month","%d months",a).format(a)}else{a=parseInt(g/365,10);return ungettext("%d year","%d years",a).format(a)}}}}},month_name:function(f,c){var e,a,d,b;this.month_name_cache=this.month_name_cache||{};a=""+f+"-"+c;if(a in this.month_name_cache){return this.month_name_cache[a]}d=[_("January"),_("February"),_("March"),_("April"),_("May"),_("June"),_("July"),_("August"),_("September"),_("October"),_("November"),_("December")];e=[_("Jan"),_("Feb"),_("Mar"),_("Apr"),_("May"),_("Jun"),_("Jul"),_("Aug"),_("Sep"),_("Oct"),_("Nov"),_("Dec")];if(c){b=e[f]}else{b=d[f]}this.month_name_cache[a]=b;return b},nice_list:function(b){var f,e,d,a,c;if(!b){return""}else{if(b.length===1){return b[0]}else{if(b.length===2){return _(Constants.TWO_ITEM_LIST).format({x:b[0],y:b[1]})}}}c=_(Constants.THREE_ITEM_LIST).split(/%\(x\)s|%\(y\)s|%\(z\)s/);assert(c.length===4,"bad item list format "+Constants.THREE_ITEM_LIST);e=c[0];d=c[1];a=c[2];f=c[3];return[e,b.slice(0,-1).join(d,a,b[b.length-1],f)].join("")},list_em_snippet:function(c,b){var g,e,d,f,j,h;d="";b-=new Emstring("...").length;for(e=j=0,h=c.length;0<=h?j<h:j>h;e=0<=h?++j:--j){f=c[e];if(e!==0){f=", "+f}g=new Emstring(f).length;if(g>b){break}b-=g;d+=f}return{str:d,snipped:c.length-e}},center:function(b){var a;b=$(b);a=(document.viewport.getWidth()-b.getWidth())/2;return b.setStyle({left:Math.floor(a)+"px"})},ts:function(){var a;a=new Date();return a.getUTCFullYear().toString()+"-"+(a.getUTCMonth()+1).toString().lpad(2)+"-"+a.getUTCDate().toString().lpad(2)+" "+a.getUTCHours().toString().lpad(2)+":"+a.getUTCMinutes().toString().lpad(2)+":"+a.getUTCSeconds().toString().lpad(2)},start_of_day:function(a){var b;b=new Date();b.setTime(a.getTime());b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);return b},to_iso8601_date:function(e,b,c){var a;if(b==null){b=false}if(c==null){c=false}if(b){a=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2);if(c){a+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2)}}else{a=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2);if(c){a+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2)}}return a},to_mysql_date:function(e,a){var b,c;b=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2);c=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2)+"."+e.getMilliseconds().toString().lpad(3);if(!a){return b}else{return b+" "+c}},from_mysql_date:function(b){var d,f,c,h,a,g,e;h=b.split(" ");d=h[0];g=h.length>1?h[1]:false;f=d.split("-");assert(f.length===3,"weird date format on "+this+", expected yyyy-mm-dd");c=new Date(f[0],parseInt(f[1],10)-1,f[2]);if(g){e=g.split(":");assert(e.length===3,"weird time format on "+this+", expected hh:mm:ss.ms");c.setHours(e[0]);c.setMinutes(e[1]);a=e[2].split(".");c.setSeconds(a[0]);if(a.length>1){c.setMilliseconds(a[1])}}return c},make_table:function(a,h){var c,g,j,b,e,d,f;j=new Element("table",h);b=new Element("tbody");j.__sert(b);for(g in a){f=a[g];d=new Element("tr");e=new Element("td").insert(g);c=new Element("td").insert(f);d.__sert(e);d.__sert(c);b.__sert(d)}return j},time:function(){return new Date().getTime()},last_time:false,delta:function(b){var a;a=this.time();if(this.last_time&&(!b||typeof b!=="boolean")){this.log(a-this.last_time)}this.last_time=a;if(typeof b==="string"){return this.log("^ "+b)}},url_hash:function(){var a;a=window.location.href;if(a.indexOf("#")>=0){return a.split("#").last()}else{return""}},copy_to_clipboard:function(j,f,k){var d,c,a,b,g;d=$("hold_clipboard");d.value=j;if(d.createTextRange){g=d.createTextRange();if(g&&(!(typeof BodyLoaded!=="undefined"&&BodyLoaded!==null)||BodyLoaded===1)){try{return g.execCommand("Copy")}catch(h){k=k||_("Please copy the text below:");f=f||_("Copy text");DomUtil.fillVal(j,"text-to-copy");DomUtil.fillVal(k,"copy-modal-body");Modal.show(f,DomUtil.fromElm("copy-modal"),{wit_group:"copy_to_clipboard"});return $("text-to-copy").select()}}}else{if(!$("flashcb")){a=document.createElement("div");a.id="flashcb";document.body.appendChild(a)}$("flashcb").innerHTML="";c=encodeURIComponent(d.value);b='<embed src="/static/swf/_clipboard.swf" FlashVars="clipboard=#{clipboard}" width="0" height="0" type="application/x-shockwave-flash"></embed>';return $("flashcb").innerHTML=b}},report_exception:global_report_exception,scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(c){var b,a;a=this.scried;b=a[c];if(!b){b=$(c);a[c]=b}return b},pathDepth:function(e){var f,b,d,c,a;d=e.split("/");f=0;for(c=0,a=d.length;c<a;c++){b=d[c];if(b.length){f++}}return f},normalize:function(a){if(!a){return""}if(a.charAt(0)!=="/"){a="/"+a}if(a.charAt(a.length-1)==="/"){return a.substr(0,a.length-1)}else{return a}},parentDir:function(b){var a;a=b.split("/").slice(0,-1).compact().join("/");return a||"/"},urlquote:function(a){return a.split("/").map(encodeURIComponent).join("/")},unevent:function(k){var g,f,h,e,j,c,b;if(k.attributes){k.onclick=null;k.onmouseover=null;k.onmouseout=null;k.onmousedown=null;k.onmouseup=null;k.onmousemove=null}g=k.childNodes;h=void 0;e=void 0;if(g){b=[];for(j=0,c=g.length;j<c;j++){f=g[j];b.push(this.unevent(f))}return b}},yank:function(a){this.unevent(a);if(this.dom_trash_can==null){this.dom_trash_can=$("trash-can")}this.dom_trash_can.__sert(a);this.dom_trash_can.__date();a=null;return a},ie8:Prototype.Browser.IE&&document.documentMode&&true,ie6:window.external&&!(window.XMLHttpRequest!=null),ie:Prototype.Browser.IE,linux_ff3:navigator.userAgent.toLowerCase().indexOf("linux")>-1,log:function(){var b,a;if(!Constants.IS_PROD){if(Prototype.Browser.IE){return(b=$("ieconsole"))!=null?b.innerHTML+=$A(arguments).join(" ")+"<br>":void 0}else{return typeof console!=="undefined"&&console!==null?(a=console.log)!=null?a.apply(console,$A(arguments)):void 0:void 0}}},childElement:function(d,c){var b;b=this.childElementWithIndex(d,c);return b[0]},childElementWithIndex:function(j,c){var f,h,d,b,g,a;f=0;b=j.childNodes;for(d=g=0,a=b.length;g<a;d=++g){h=b[d];if(h.nodeType===1&&f++===c){return[h,d]}}return[false,false]},disableSelection:function(a){a.onselectstart=function(){return false};a.unselectable="on";a.style.MozUserSelect="none";return a.style.cursor="default"},enableSelection:function(a){a.onselectstart=function(){return true};a.unselectable="off";a.style.MozUserSelect="";return a.style.cursor=""},disable_ie_image_dragging:function(){if(Prototype.Browser.IE&&Prototype.Browser.IEV<9){return document.ondragstart=function(){return false}}},bsearch:function(a,h,f,e){var c,d,b,g;if(!f){f=function(j,k){return j-k}}c=a.length;d=0;while(c>d){b=Math.floor(c/2+d/2);g=f(a[b],h);if(g>0){c=b}else{if(g<0){d=b+1}else{return b}}}if(e){return d}else{return -1}},nonce:function(){var c,a,b;c=new Date();b=c.getTime().toString();a=Math.floor(Math.random()*1000000).toString().lpad(6);return b+a},_joff:function(c){var a,b,d;assert(c.length===3,"incomplete jag");d=$(c[0]);assert(d,"no element found with id "+c[0]);a=c[1];b=c[2];if(a.startsWith("on")){assert(typeof b==="function","Util.jag() takes a function for onClick/onMouse*/etc attributes");d[a]=b}else{d.setAttribute(a,b)}if(d.tagName.toLowerCase()==="a"&&!d.hasAttribute("href")){return d.setAttribute("href","#")}},live_joff:function(c,b){var a,d=this;a=c.identify();if(a in this._live_jags){return(function(){var j,k,h,f,g,e;g=d._live_jags[a];e=[];for(h=0,f=g.length;h<f;h++){j=g[h];k=$(j[0]);assert(k,"jag elm %s missing".format(j[0]));j[0]=b.down("#"+k.identify());e.push(d._joff(j))}return e}).defer()}},jag:function(c,a,b){var d;d=$A(arguments);if(document.loaded){return this._joff(d)}else{return this._jags.push(d)}},live_jag:function(e,c,a,b){var d;d=$A(arguments).slice(1);if(e in this._live_jags){return this._live_jags[e].push(d)}else{return this._live_jags[e]=[d]}},_jags:[],_live_jags:{},focus:function(b){if(b){b=$(b);try{return b.focus()}catch(a){}}},focus_in_input:function(){var b,a,d,c;return((b=(a=document.activeElement)!=null?a.tagName:void 0)==="INPUT"||b==="TEXTAREA"||b==="SELECT")&&((d=(c=document.activeElement)!=null?c.type:void 0)!=="submit"&&d!=="button")},sumStyles:function(d,e){var a,c,f,b;c=0;if(d){for(f=0,b=e.length;f<b;f++){a=e[f];c+=parseInt(d.getStyle(a),10)||0}}return c},syncHeight:function(a){var b;if(a==null){a=".sync-height"}$$(a).invoke("setStyle",{height:"auto"});b=$$(a).invoke("getHeight").max();b-=this.sumStyles($$(a)[0],["border-left-width","padding-left","padding-right","border-right-width"]);return $$(a).invoke("setStyle",{height:b>0?""+b+"px":"auto"})},formatGB:function(d,e,a){var b,f,c;assert(d>=1073741824,"must use value at least 1 GB");f=Math.round(d/1073741824);b=e?" ":"";c=a?_("GB"):"";return f+b+c},formatBytes:function(e,d,g,c){var b,h,a,f;e=parseFloat(e);b=Math.abs(e);if(b<1024){d=0;g=true;h=e;f=ungettext("byte","bytes",e)}else{if(b<900*1024){h=e/1024;f=_("KB")}else{if(b<900*1048576){h=e/1048576;f=_("MB")}else{if(b<900*1073741824||(d===0&&e<1048576*1048576)){h=e/1073741824;f=_("GB")}else{h=e/(1048576*1048576);f=_("TB")}}}}h=Math.round(h*Math.pow(10,d))/parseFloat(Math.pow(10,d));h=h.toFixed(d);a=c&&d>0?h!==Math.floor(h)?h:parseInt(Math.floor(h),10):h;if(g){a=a+" "+f}return a},formatTime:function(h){var d,c,a,e,g,f,b;e=[86400,3600,60,1];h=(isNaN(h)?0:h);for(d=f=0,b=e.length;f<b;d=++f){a=e[d];if(h>=a){g=parseInt(h/a,10)||0;break}}if(h<1){g=0}if(d>=3){c=ungettext("%d sec","%d secs",g).format(g)}else{if(d===2){c=ungettext("%d min","%d mins",g).format(g)}else{if(d===1){c=ungettext("%d hour","%d hours",g).format(g)}else{if(d===0){c=ungettext("%d day","%d days",g).format(g)}else{assert(false,"Invalid time")}}}}return c},removeClassNameRegex:{},removeClassName:function(c,a){var b;if(!c){return null}b=this.removeClassNameRegex[a];if(!b){this.removeClassNameRegex[a]=b=new RegExp("(^|\\s+)"+a+"(\\s+|$)")}c.className=c.className.replace(b," ").strip();return c},observe:function(b,a,c){b=Element.extend(b);if(b.addEventListener){return b.addEventListener(a,c,false)}else{return b.attachEvent("on"+a,c)}},async_load_script:function(b){var a;a=function(){var d,c;c=document.createElement("script");c.src=b;c.type="text/javascript";c.async=true;d=document.getElementsByTagName("script")[0];return d.parentNode.insertBefore(c,d)};if(document.readyState==="complete"){return a()}else{if(window.attachEvent!=null){return window.attachEvent("onload",a)}else{return window.addEventListener("load",a,false)}}},async_load_css:function(b,a){return new Ajax.DBRequest(b,{method:"get",onSuccess:function(c){$j("head").append("<style>"+c.responseText+"</style>");if(a){return a()}}})},async_multiload_css:function(b,a){var c,d;d={};b.each(function(e){return d[e]=false});c=function(g,j){var f,e,h;j[g]=true;e=true;for(f in j){h=j[f];if(!h){e=false;break}}if(e){if(a){return a()}}};return b.each(function(e){return Util.async_load_css(e,c.curry(e,d))})},smartLoad:function(a){if(document.loaded){return a()}else{return document.observe("dom:loaded",a)}},smart_window_load:function(a){if(document.readyState==="complete"){return a()}else{return Event.observe(window,"load",a)}},niceDate:function(a){if(a==null){a=new Date()}return""+(1+a.getMonth())+"-"+(a.getDate())+"-"+(a.getFullYear())},reverseNiceDate:function(a){var b;if(!a){return false}b=a.split("/");if(b.length!==3){return false}return new Date(parseInt(b[2],10),parseInt(b[0],10)-1,parseInt(b[1],10))},niceDateWithMonthName:function(e,c,h,a){var d,g,b,f;if(h==null){h=false}if(a==null){a=false}if(h){d=e.getUTCDate();g=e.getUTCMonth();f=e.getUTCFullYear()}else{d=e.getDate();g=e.getMonth();f=e.getFullYear()}b=this.month_name(g,!a);if(c){return _("%(month)s %(date)s, %(year)s").format({month:b,date:d,year:f})}else{return _("%(month)s %(date)s").format({month:b,date:d})}},monthAbrWithYear:function(b,a){return _("%(month)s %(year)s").format({month:this.month_name(b,true),year:a})},incrementDate:function(c,d,e,b,a,f){if(d==null){d=0}if(e==null){e=0}if(b==null){b=0}if(a==null){a=0}if(f==null){f=0}c.setFullYear(c.getFullYear()+d);c.setMonth(c.getMonth()+e);c.setDate(c.getDate()+b);c.setHours(c.getHours()+a);c.setMinutes(c.getMinutes()+f);return c},replaceHtml:function(c,b){var a;if(Prototype.Browser.IE){c.innerHTML=b;return c}a=c.cloneNode(false);a.innerHTML=b;c.parentNode.replaceChild(a,c);return a},isNumber:function(a){return !isNaN(Number(a,10))},shorten_url:function(a,b){return new Ajax.DBRequest("/shorten_url",{parameters:{url:a},onSuccess:function(c){return b(c.responseText)}})},flash_version:function(){return""+FlashDetect.major+"."+FlashDetect.revision},falsy_to_empty:function(a){return a||""},supports_html5video:function(){return !!document.createElement("video").canPlayType},embed_help_video:function(d,k,h){var j,c,b,f,e,g=this;b=function(m,l,n,a){return VideoUtil.embed($(m)({src:d,width:l,height:a,type:"video/mp4",autoplay:n,preload:true}))};if(h){f=new Element("img",{src:h});j=new Element("a",{href:"#",style:"position: relative; display: block;"});e=new Element("img",{src:"/static/images/help_play.png"});e.addClassName("overlay_play");j.appendChild(f);j.appendChild(e);c=new Element("div");j.observe("click",function(n){var m,a,l;c.__date();Event.stop(n);Modal.show("",c,false,false,860);l=800;m=true;a=600;b(c,l,m,a);return $("modal-title").hide()});return $(k).__date(j)}else{return b(k)}},seconds_to_time:function(c,b){var a;if(b==null){b=false}c=parseInt(c,10);if(c>60){a=parseInt(c/60,10);c=c%60}else{a=0}a=a.toString();c=c.toString().lpad(2,"0");if(!b){a=a.lpad(2,"0")}return""+a+":"+c},add_script:function(b){var a;a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src",b);return document.getElementsByTagName("head")[0].appendChild(a)},supports_video:function(){var a;a=document.createElement("video");if(!a.canPlayType){return false}return a.canPlayType("video/mp4")},create_cookie:function(c,d,e){var b,a;a="";if(e){b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+(b.toGMTString())}return document.cookie=""+c+"="+d+a+"; path=/"},read_cookie:function(b){var g,f,e,a,d;f=""+b+"=";d=document.cookie.split(";");for(e=0,a=d.length;e<a;e++){g=d[e];while(g.charAt(0)===" "){g=g.substring(1,g.length)}if(g.indexOf(f)===0){return g.substring(f.length,g.length)}}return null},delete_cookie:function(a){return this.create_cookie(a,"",-1)},check_cookies_enabled:function(){var a;a=!(navigator.cookieEnabled!=null)?(document.cookie="this_is_a_test_cookie",document.cookie.indexOf("this_is_a_test_cookie")!==-1):navigator.cookieEnabled;if(!a){Notify.server_error(_("Please enable browser-cookies to use the Dropbox website."))}return a},preloaded_images:{},preload_image:function(d,c,b){var a;if(this.preloaded_images[d]){return}a=new Image();if(c!=null){Element.extend(a).observe("error",c)}if(b!=null){Element.extend(a).observe("load",b)}a.src=d;return this.preloaded_images[d]=a},get_preloaded_image:function(a){if(this.preloaded_images[a]){return this.preloaded_images[a].clone()}else{return new Element("img",{src:a})}},preloaded_audio:{},preload_audio:function(b,a){var c;if(this.preloaded_audio[b]){return}c=new Element("audio",{src:b});if(a!=null){Element.extend(c).observe("error",a)}return this.preloaded_audio[b]=c},get_preloaded_audio:function(a){var b;if(this.preloaded_audio[a]){return this.preloaded_audio[a]}else{b=new Element("audio",{src:a});this.preloaded_audio[a]=b;return b}},copy_to_clipboard_swf:function(f,e,h,k,c){var a,j,b,d,g=this;d={wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"};a=new Element("div",{id:"flash_copy_container"});if(c){a.writeAttribute(c)}j=new Element("div");a.update(j);k=$(k)||document.body;k.appendChild(a);b=j.identify();window.copyLoaded=function(){var l;l=$(b);l.setCopyText(f);return l.setCallbackFunction(h)};swfobject.embedSWF("/static/swf/copy_clipboard.swf",b,"100%","100%","6.0.65",false,false,d);a.absolutize();a.style.zIndex=1;$j(a).clonePosition($j("#"+e),{offsetTop:-3,offsetLeft:-3,offsetHeight:6,offsetWidth:6});this.freshbutton_overlay(a,$(e));return b},inner_height:function(g){var c,d,f,b,e,a;g=$(g);assert(g,"inner_height missing elm");c=g.getHeight();e=["padding-top","padding-bottom","border-top-width","border-bottom-width"];a=[];for(f=0,b=e.length;f<b;f++){d=e[f];a.push(c-=parseInt(g.getStyle(d),10))}return a},decode_b64:function(k,m){var r,d,q,f,j,p,o,n,l,h,e,c,b,a,g;e=function(s){return s};j=m?e:this.utf8_decode;if(typeof window.atob==="function"){return j(window.atob(k))}d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";h=0;r=0;g=[];if(!k){return k}k+="";while(true){p=d.indexOf(k.charAt(h++));o=d.indexOf(k.charAt(h++));n=d.indexOf(k.charAt(h++));l=d.indexOf(k.charAt(h++));q=p<<18|o<<12|n<<6|l;c=q>>16&255;b=q>>8&255;a=q&255;if(n===64){g[r++]=String.fromCharCode(c)}else{if(l===64){g[r++]=String.fromCharCode(c,b)}else{g[r++]=String.fromCharCode(c,b,a)}}if(!(h<k.length)){break}}f=g.join("");f=j(f);return f},utf8_decode:function(a){var g,f,e,c,d,b;b=[];d=0;g=0;f=0;e=0;c=0;a+="";while(d<a.length){f=a.charCodeAt(d);if(f<128){b[g++]=String.fromCharCode(f);d++}else{if((f>191)&&(f<224)){e=a.charCodeAt(d+1);b[g++]=String.fromCharCode(((f&31)<<6)|(e&63));d+=2}else{e=a.charCodeAt(d+1);c=a.charCodeAt(d+2);b[g++]=String.fromCharCode(((f&15)<<12)|((e&63)<<6)|(c&63));d+=3}}}return b.join("")},clear_selected:function(){var a;if(window.getSelection){a=window.getSelection();if(a.removeAllRanges){return a.removeAllRanges()}}else{if(document.selection){return document.selection.empty()}}},list_cmp:function(j,h){var f,c,g,a,b,d,e;g=j.length;b=h.length;for(f=d=0,e=Math.min(g,b);0<=e?d<e:d>e;f=0<=e?++d:--d){c=j[f];a=h[f];if(c<a){return -1}if(c>a){return 1}}return g-b},is_mac:function(){return navigator.appVersion.indexOf("Mac")!==-1},is_windows:function(){return navigator.appVersion.indexOf("Windows")!==-1},in_scrollbar:function(a){var c,b;c=20;b=this.viewport_dimensions();return a>b.width-c},freshbutton_overlay:function(b,a){var d,c,e=this;c=b instanceof jQuery&&b||$j(b);d=a instanceof jQuery&&a||$j(a);c.on("mouseover",function(){return d.addClass("hovered")});c.on("mouseout",function(){d.removeClass("hovered");return d.removeClass("pressed")});c.on("mousedown",function(){d.removeClass("hovered");return d.addClass("pressed")});return c.on("mouseup",function(){return d.removeClass("pressed")})},isElm:function(a){if(typeof HTMLElement==="object"){return a instanceof HTMLElement}else{return a&&typeof a==="object"&&a.nodeType===1&&typeof a.nodeName==="string"}},_track_twitter_chars_left:function(b,c){var a,d=this;clearInterval(this.chars_left_interval);a=function(){var e,f;e=$("twitter-chars");f=c-$F(b).strip().length;if(f<0){e.addClassName("too-long")}else{e.removeClassName("too-long")}return e.__date(f)};return this.chars_left_interval=setInterval(a,250)},session_storage_set:function(a,b){if(!window.sessionStorage||!window.JSON){return}return window.sessionStorage.setItem(a,JSON.stringify(b))},session_storage_get:function(a){if(window.sessionStorage&&window.JSON){return JSON.parse(window.sessionStorage.getItem(a))}},unzip:function(b){var h,g,d,a,f,c,e;d=[];a=[];for(f=0,c=b.length;f<c;f++){e=b[f],h=e[0],g=e[1];d.push(h);a.push(g)}return[d,a]},cors_supported:function(){return window.XMLHttpRequest&&("withCredentials" in new XMLHttpRequest())},pdf_plugins:function(){var c,b,a;a=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi;return c=(function(){var g,e,f,d;f=window.navigator.plugins;d=[];for(g=0,e=f.length;g<e;g++){b=f[g];if(a.test(b.name)){d.push(b)}}return d})()}};Util.scrollLeft=Util.scrollLeft.cached(50);Util.scrollTop=Util.scrollTop.cached(50);RequestWatcher={reqs:[],working_msg:_("Still working..."),TIMEOUT:7,watch:function(b,c){var a;a=this.reqs;if(!a.length){this.int_id=setInterval(this.check_up.bind(this),500)}if(c){b.skip_message=true}return a.push([b,Util.time()])},check_up:function(){return this.scan(false)},remove:function(a){return this.scan(a)},scan:function(f){var k,b,d,a,h,g,c,j,e;b=Util.time();d=[];e=this.reqs;for(c=0,j=e.length;c<j;c++){a=e[c];h=a[0];g=a[1];k=b-g;if(h.transport.readyState===4){Notify.clear_if(this.working_msg);continue}if(k>4000&&!h.skip_message){h.skip_message=true;if(Notify.is_shown()&&!Notify.preserve_last_msg){Notify.server_success(this.working_msg)}}if(k>this.TIMEOUT*1000&&h.job){h.transport.abort()}if(h!==f){d.push([h,g])}else{h.transport.abort()}}this.reqs=d;if(!d.length){return clearInterval(this.int_id)}}};UIButton=(function(){var b,f,h,g,c,e,a,d;a=".ui-button";e=function(j,k){return k.addClassName("over")};c=function(j,k){return k.removeClassName("over")};h=function(j,k){return k.addClassName("down")};d=function(j){return $$(a+".down").invoke("removeClassName","down")};b=function(j,k){return k.toggleClassName("active")};f=function(o){var j,q,p,m,l,r,n,k;p=$(o.target);j=a+".active";m=p.match(j)&&p||p.up(j);n=$$(j);k=[];for(l=0,r=n.length;l<r;l++){q=n[l];if(m!==q){k.push(q.removeClassName("active"))}else{k.push(void 0)}}return k};g=function(){$(document.body).on("mouseover",a,e);$(document.body).on("mouseout",a,c);$(document.body).on("mousedown",a,h);document.on("mouseup",d);$(document.body).on("click",a,b);return document.on("click",f)};return{init:g}})();window.alert=function(a){new Ajax.DBRequest("/tormod",{parameters:{to:""+a,rm:window.location.href,od:get_stack_rep().join("\n\n")}});return alertd(a)};if(typeof console==="undefined"||console===null){console={log:function(){},profile:function(){},profileEnd:function(){}}}IE7_OR_LESS=Util.ie&&(!document.documentMode||document.documentMode<8);document.observe("script:loaded",function(){var j,g,e,c,h,a,f,d,b;UIButton.init();f=Util._jags;for(e=0,h=f.length;e<h;e++){j=f[e];Util._joff(j)}Util.set_min_body_height_to_viewport_height();if(Util.ie8||IE7_OR_LESS){d=$$("#page-header a, #page-footer a");b=[];for(c=0,a=d.length;c<a;c++){g=d[c];if(g.target==="_blank"){b.push(g.target="")}else{b.push(void 0)}}return b}});Event.observe(window,"resize",function(){return Util.set_min_body_height_to_viewport_height()});Util.smart_window_load(function(){return Util.syncHeight()});Trace=(function(){var a;a=[];return{log:function(){var b;b=Util.time()+": "+$A(arguments).join(" ");return a.push(b)},get:function(){return a.join("\n")}}})();T=function(){return Trace.log.apply(this,$A(arguments))};document.observe("script:loaded",function(){var a;T("dom:loaded");a=function(){var b,c;b=$("page-content");if(b){c=Util.viewport_dimensions();if(c.width<b.getWidth()){return $(document.body).addClassName("absolutize")}else{return $(document.body).removeClassName("absolutize")}}};Event.observe(window,"resize",a);return a()});Event.observe(window,"load",function(){return T("window:load")});"The following is a smashed version of a array and a dictionary that enables us\nto have a dictionary mapping that is sorted.";SuperDictionary=(function(){a.list=[];a.dict={};function a(b,c){this.list=b;this.dict=c;return}a.prototype.push=function(b,c){this.list.push(b);this.dict[b]=c};a.prototype.remove=function(b){this.list.removeItem(b);delete this.dict[b]};a.prototype.indexOfKey=function(b){return this.list.indexOf(b)};a.prototype.keyAtIndex=function(b){return this.list[b]};a.prototype.valueFromKey=function(b){return this.dict[b]};a.prototype.valueAtIndex=function(b){return this.dict[this.list[b]]};a.prototype.getValues=function(){var b;return(function(){var f,d,e,c;e=this.list;c=[];for(f=0,d=e.length;f<d;f++){b=e[f];c.push(this.dict[b])}return c}).call(this)};a.prototype.length=function(){return this.list.length};a.prototype.insertAtIndex=function(b,c,d){this.list.splice(b,0,c);return this.dict[c]=d};return a})();URLUtil={absolutize:function(a){if(a.startsWith("https://")||a.startsWith("http://")){return a}else{if(a.charAt(0)==="/"){return""+window.location.protocol+"//"+window.location.host+a}else{return assert(0,"absolutize is confused by "+a)}}}};Velocity={velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){this.velocity=this.max_delta_y;if(this.velocity!==0){this.last_nonzero_velocity=this.velocity}return this.max_delta_y=0},capture_new_y_pos:function(){var a,b;if(!(this.old_y!=null)){this.old_y=Util.scroll_offsets().top;return}if(!(this.max_delta_y!=null)){this.max_delta_y=0;return}b=Util.scroll_offsets().top;a=Math.abs(this.max_delta_y)<Math.abs(b-this.old_y);if(a){this.max_delta_y=b-this.old_y;return this.old_y=b}},start_capture:function(){this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500));return Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(a){if(a==null){a=false}assert(this.velocity_calculator_interval!=null,"Haven't started capturing velocity");if(a){return this.last_nonzero_velocity}return this.velocity}};GandalfPanel={init:function(){return this.seen=[]},add:function(a,b){if($j.inArray(a,this.seen)!==-1){return}this.seen.push(a);return new Ajax.DBRequest("/gandalf_panel",{parameters:{request_id:b},noAutonotify:true,no_watch:true,onSuccess:function(c){$j("#gandalf_panel table").append($j("<tr><th colspan='2'>"+a+"</th></tr>"));return $j("#gandalf_panel table").append(c.responseText)}})}};var VideoUtil;if(typeof _V_!=="undefined"&&_V_!==null){_V_.options.flash.swf="/static/swf/video-js.swf"}VideoUtil={_video_counter:0,embed:function(g,k){var b,h,d,a,c,e,j,f;if(k==null){k={}}if(k.preload===void 0){k.preload="auto"}b="video-"+this._video_counter;this._video_counter+=1;c=$j("<video/>",{"class":"video-js vjs-default-skin",id:b,controls:k.controls});c=c[0];f=["width","height","preload","poster","autoplay"];for(e=0,j=f.length;e<j;e++){d=f[e];if(k[d]){c.setAttribute(d,k[d])}}a=$j("<source/>",{src:k.src,type:k.type});a=a[0];c.appendChild(a);if(typeof g==="string"){g=$j(g)[0]}g.innerHTML="";g.appendChild(c);h=function(){var l;l=this;if(k.onError){this.addEvent("error",k.onError)}return typeof k.onReady==="function"?k.onReady():void 0};return _V_(c,{},h)}};Util.binarySearch=function(g,f,e,b){var d,c,a;e=Util.constrainIndex(e,0,g.length);b=Util.constrainIndex(b,g.length,g.length)-1;while(e<=b){c=(e+b)>>>1;d=g[c];a=f.call(d,c,d,g);if(a===0){return c}if(a>0){b=c-1}else{e=c+1}}return ~e};Util.constrainIndex=function(a,c,b){if(a==null){a=c}if(a<0){a+=b;if(a<0){a=0}}else{if(a>b){a=b}}return a};var UIRequest;UIRequest=Class.create(Ajax.DBRequest,{initialize:function($super,b,a,g,c){var f,d,h,j,e;if(g==null){g={}}if(c==null){c=function(){return{}}}h=function(l,k){var m;l.removeClassName("ajax-loading");m=Util.from_json(k.responseText);if(m.redirect){window.location.href=m.redirect;return}if(m.reload){window.location.reload();return}if(m.css){return Util.async_multiload_css(m.css,e.curry(l,m.actions))}else{if(m.actions){return e(l,m.actions)}}};e=function(l,q){var o,r,k,w,s,t,m,v,p,u,n;n=[];for(p=0,u=q.length;p<u;p++){o=q[p];w=o[0],k=o[1],m=o[2];if(m&&w!=="modal"){if(m.charAt(0)==="^"){r=l.up(m.substr(1))}else{r=l.down(m)}}else{r=l}switch(w){case"modal":s=new HTML(k);if(m){v=new HTML(m)}n.push(Modal.show(v,s));break;case"update":t=new HTML(k);n.push(r.__date(t));break;case"replace":t=new HTML(k);n.push(r.replace(t));break;case"insertAfter":t=new HTML(k);n.push(r.__sert({after:t}));break;case"insertBefore":t=new HTML(k);n.push(r.__sert({before:t}));break;case"toggleClass":n.push(r.toggleClassName(k));break;case"addClass":n.push(r.addClassName(k));break;case"removeClass":n.push(r.removeClassName(k));break;case"notify":n.push(Notify.server_success(k));break;case"notifyError":n.push(Notify.server_error(k));break;default:n.push(void 0)}}return n};d=function(n,k){var l,m;n.removeClassName("ajax-loading");if(k){if(k.responseText.indexOf("err:")===0){l=k.responseText.substr(4);if(l.indexOf("{")===0){m=l.evalJSON(true);return Forms.fill_errors(n,m)}else{return Notify.server_error(l)}}else{return Notify.server_error()}}};f=function(l,k){return c(k)};j={parameters:g,noAutonotify:true,onSuccess:h.curry(b),onFailure:d.curry(b),onComplete:f.curry(b)};if(b.hasClassName("ajax-loading")){return false}b.addClassName("ajax-loading");return $super(a,j)}});Util.smartLoad(function(){var c,b,d,a;d=Prototype.Browser;a=[];for(c in d){b=d[c];if(b){a.push($(document.body).addClassName(c.toLowerCase()))}}return a});var HomePageController;HomePageController={init:function(b){var a;window.contacts=false;window.lcontacts=false;PromoHolder.init(b.disable_promo,b.force_campaign,b.force_promo);Referral.action=Sharing.add_from_cli;if(b.show_email_just_verified){EmailVerification.show_verified_modal()}else{if(b.show_sent_verification_email){EmailVerification.show_sent_modal()}else{if(b.show_upload){FileOps.show_upload("/")}else{if(b.show_share_existing_modal){Sharing.show_share_existing_modal(b.fq_path)}else{if(b.show_share_options){Sharing.get_sharing_options(b.fq_path)}else{if(b.show_shared_folder_tutorial){TutorialSharedFolder.begin()}else{if(b.show_download_modal){a=new ClientDownload();a.show_download_modal()}else{if(b.language_modal_locale){HomePageController.show_language_modal(b.language_modal_locale)}}}}}}}}if(b.share_subfolder){return document.observe(Browse.UPDATE_EVT,Sharing.show_share_subfolder_warning)}},show_language_modal:function(c){var b,d,a;if(!c){return}b=Object.toJSON({from_locale:Constants.USER_LOCALE,to_locale:c});GrowthWebActivityLogger.log("i18n-language-modal-show",b);if(Constants.USER_LOCALE==="en"){if((d=$("pt-br-modal-stay"))!=null){d.observe("click",function(f){f.preventDefault();return GrowthWebActivityLogger.log("i18n-language-modal-stay",b,function(){return Modal.hide()})})}if((a=$("pt-br-modal-switch"))!=null){a.observe("click",function(f){f.preventDefault();return GrowthWebActivityLogger.log("i18n-language-modal-switch",b,function(){LocaleSelector.set_locale(c);return Modal.hide()})})}return Modal.show(false,$("pt-br-modal"),{},false,679)}}};var ABTest,AMC,GrowthWebActivityLogger,Jcached,TeamsWebActionsLogger,UserActivityLogger,WIT,WebMiscActivityLogger;WIT={enabled:Constants.WIT_ENABLED,reporting:false,start_time:0,register:function(){if(WIT.enabled){WIT.reportInterval=setInterval(WIT.report,10000);return $(document.body).observe("click",WIT.click)}},add_group:function(b,a){b=$(b);assert(b,"WIT.add_group missing elm");b.addClassName("wit_group");return b.setAttribute("name",a)},clear_group:function(a){if(a.hasClassName("wit_group")){return a.removeClassName("wit_group")}},get_group:function(b){var a;a=b.up(".wit_group");if(a){return a.getAttribute("name")}return"ALL"},time_elapsed:function(){var a;a=Util.time()-WIT.start_time;if(a>=0){return a}else{return 0}},click:function(g){var f,a,d,c,b;if(!WIT.enabled||!(g!=null?g.target:void 0)){return}d=$(g.target);c=(b=d.tagName.toLowerCase())==="input"||b==="textarea"||b==="checkbox"?d:d.up("a, .wit");if(!c||$(c).hasClassName("ignore")){return}a=c.getAttribute("name")||c.id||(typeof c.getValue==="function"?c.getValue():void 0)||c.innerHTML.stripTags().strip()||"unknown "+c.tagName;if(Constants.emessages[a]){a=Constants.emessages[a]}f=WIT.get_group(c);assert(f,"Group missing");return WIT.record_action(a,"click",f,WIT.time_elapsed())},record_action:function(c,d,e,b,a){if(a==null){a={}}a.group=e;a.type=d;a.tti=b;return WIT.record("ACTION",c,a)},record:function(d,b,a){var c;if(a==null){a={}}c=window.location.pathname.split("#")[0];return WIT._record(d,b,c,a)},_record:function(f,c,b,a){var d,e;if(a==null){a={}}d="WIT_"+f+"_"+c;if(!WIT.enabled||Jcached.get(d)||WIT.IGNORE_URLS[b.split(Constants.WEBSERVER).last().split(/[\?\#]/)[0]]){return}assert(c,"Missing WIT label");assert(f,"Missing WIT event_type");assert(b,"Missing WIT url");e=[f,c,b,a];WIT.add_to_cookie(e);return Jcached.set(d,1,5000)},add_to_cookie:function(d){var c,a,b;if(Ajax.activeRequestCount){setTimeout((function(){return WIT.add_to_cookie(d)}),500);return}assert(WIT.enabled,"WIT Disabled.");b=WIT.get_cookie_val();b.push(d);a=Object.toJSON(b);c=encodeURIComponent(a);Util.create_cookie("wit",c,365);if(c.length>1024){return WIT.report()}},get_cookie_val:function(){var b;b=Util.read_cookie("wit");if(b){try{return decodeURIComponent(b).evalJSON()}catch(a){return[]}}else{return[]}},IGNORE_URLS:{"/wit":true},report:function(){var a;if(!WIT.enabled||WIT.reporting){return}a=Util.read_cookie("wit");if(a){WIT.reporting=true;new Ajax.Request("/wit",{onComplete:function(){return WIT.reporting=false}});return Util.create_cookie("wit","",-1)}}};WIT.start_time=window.ST||new Date().getTime();Util.smartLoad(function(){WIT.record("LOAD","ready",{time:Util.time()-WIT.start_time});return WIT.register()});Util.smart_window_load(function(){return WIT.record("LOAD","complete",{time:Util.time()-WIT.start_time})});Event.stop=Event.stop.wrap(function(a,b){if(!b){return}if(b.type==="click"){WIT.click(b)}return a.apply(this,$A(arguments).slice(1))});Jcached={cache:{},set:function(b,d,a){var e;e=Jcached.cache[b];if(e==null){e=Jcached.cache[b]={}}e.value=d;return e.expires=a?new Date().getTime()+a:0},get:function(a){var b;b=Jcached.cache[a];if(!(b!=null)||new Date().getTime()>b.expires){delete Jcached.cache[a];return false}return b.value}};AMC={log_escape:function(a){$("top_notifier_container").remove();return new Ajax.DBRequest("/log_escape",{parameters:{kept_locale:a}})},log:function(b,a){var c;assert(b,"AMCLog missing label");c={label:b};if(a){Object.extend(c,a)}return new Ajax.DBRequest("/ajax_amc_log",{parameters:c,noAutonotify:true})},help_article_play:function(a){if(!AMC.help_article_play_logged){AMC.help_article_play_logged=1;if(Help.article_id){return new Ajax.DBRequest("/ajax_amc_help_video",{parameters:{article_id:Help.article_id}})}}}};UserActivityLogger={log:function(b,c,a){return new Ajax.DBRequest("/ualogger",{parameters:{platform:b,event_name:c,extra:a},noAutonotify:true})}};TeamsWebActionsLogger={log:function(a){return new Ajax.DBRequest("/teamswalogger",{parameters:{event_name:a},noAutonotify:true})}};WebMiscActivityLogger={log:function(b,a){return new Ajax.DBRequest("/misclogger",{parameters:{event_name:b,extra:Util.to_json(a)},noAutonotify:true})}};GrowthWebActivityLogger={log:function(b,c,a){return new Ajax.DBRequest("/gwalogger",{parameters:{event_name:b,params:c},noAutonotify:true,onSuccess:a?a:void 0,onFailure:a?a:void 0})}};ABTest={log:function(a,b){var c;assert(a,"ABTest log missing abtest name");assert(b,"ABTest log missing event name");c={abtest_name:a,event_name:b};return new Ajax.DBRequest("/ajax_abtest_log",{parameters:c})}};var DBHistory,HTML5_HISTORY,HashKeeper,HashRouter,_this=this,__slice=[].slice;HashKeeper={initiated:false,iframe:null,internal_hash:"",init:function(){var b,c;if(this.initiated){return}this.iframe=$("hashkeeper");try{b=function(){};b(this.iframe.contentWindow.document)}catch(a){setTimeout(this.init.bind(this),10);return}c=Util.url_hash();this.set_iframe_hash(c);this.internal_hash=c;return this.initiated=true},check_hash:function(){var a,b;if(!this.initiated){this.init();return}a=this.get_iframe_hash();if((this.internal_hash!==a)&&(this.internal_hash||a)){this.internal_hash=a;window.location="#"+a;return}b=Util.url_hash();if(this.internal_hash!==b){this.set_iframe_hash(b);return this.internal_hash=b}},get_iframe_hash:function(){var a;a=this.iframe.contentWindow.document.body.innerText;return a||""},set_iframe_hash:function(b){var a;a=this.iframe.contentWindow.document;a.open();a.write("<html><body>"+b+"</body></html>");return a.close()}};HTML5_HISTORY=Modernizr.history;DBHistory=(function(){var m,k,l,g,n,h,b,a,e,j,c,o,f,d;m=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$");o=function(p){if(IE7_OR_LESS&&p.endsWith("#")){return p.substr(0,p.length-1)}return p};c=function(){var q,r,p;p=void 0;if(HTML5_HISTORY){q=window.location.pathname;r=window.location.search;if(q.search(m)!==-1){q=Util.urlquote(q)}p=q+r}else{p=window.location.href.split("#!").last();p=o(p)}return p};n=function(r,s){var q,p;p=r;q=s&&Object.toQueryString(s);if(q){p+="?"+q}return p};h=function(p){var r,s,q;if(p==null){p=c()}q=p.split("?");r=q[0];s={};if(p.indexOf("?")!==-1){s=p.toQueryParams()}return{url:p,path:r,qargs:s}};k={};b={};f=c();d=null;j=function(p){return"/"+p.split("/")[1]};a=function(){var r,q,p;p=f;q=h(p);r=j(q.path);if(r in k){return k[r](q.path.substr(r.length+1),q.qargs)}};e=function(){var r,q,p;p=f;q=h(p);r=j(q.path);if(r in b){return b[r](q.path.substr(r.length+1),q.qargs)}};l=function(s,q){var p,r;r=j(s);p=j(q);if(r!==p){return e()}};g=function(){var p;p=c();if(p!==f){l(f,p);f=p;return a()}};return{init:function(){if(!d){f=c();return d=setInterval(g,50)}},add_callback:function(q,p){assert(typeof q==="string","DBHistory prefix is not a string");assert(q.startsWith("/"),"DBHistory prefix must be absolute");assert(q.count("/")===1,"multi-component prefixes arent supported");k[q]=p;return a()},add_exit_callback:function(q,p){assert(typeof q==="string","DBHistory prefix is not a string");assert(q.startsWith("/"),"DBHistory prefix must be absolute");assert(q.count("/")===1,"multi-component prefixes arent supported");return b[q]=p},_build_url_for_state_change:function(q,r){var p;assert(typeof q==="string","DBHistory path is not a string");assert(q.startsWith("/"),"DBHistory path must be absolute");assert(q.indexOf("//")===-1,"DBHistory path contains //");q=o(q);return p=n(q,r)},_pre_state_change:function(p){if(p===f){return false}l(f,p);return true},_post_state_change:function(){f=c();return a()},replace_state:function(q,r){var p;p=this._build_url_for_state_change(q,r);if(!this._pre_state_change(p)){return}assert(HTML5_HISTORY,"replace_state is only available on modern browsers");window.history.replaceState(null,null,p);return this._post_state_change()},push_state:function(q,r){var p;assert(q.indexOf("?")===-1,"DBHistory path contains ?");assert(q.indexOf("#")===-1,"DBHistory path contains #");p=this._build_url_for_state_change(q,r);if(!this._pre_state_change(p)){return}if(HTML5_HISTORY){window.history.pushState(null,null,p)}else{window.location.href="#!"+p}return this._post_state_change()},get_url:c,construct_url:n,deconstruct_url:h,URL_ESCAPE_REGEX:m}})();Util.smartLoad(function(){DBHistory.init();if(IE7_OR_LESS){return HashKeeper.hash_checker=setInterval(HashKeeper.check_hash.bind(HashKeeper),100)}});HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(a,b){this.callback_map[a]=b;if(!this.watch_timer){return this.init()}},check_hash:function(){var b,d,c,a;d=Util.url_hash();if(this.last_hash===d){return}this.last_hash=d;if(this.last_prefix&&d===""){d=this.last_prefix+":"}else{if(!d){return}}a=d.split(":");c=a.first();this.last_prefix=c;b=this.callback_map[c];if(b){b.apply(b,a.slice(1))}return $(document).fire("db:hash_change",{hash:d})},_prepare_hash:function(c){var b,a;a=$A(c).map(Util.falsy_to_empty);b=a.map(encodeURIComponent);return b.join(":")},set_hash:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];b=this._prepare_hash(a);return this._set_hash(b)},replace_hash:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];b=this._prepare_hash(a);return this._set_hash(b,true)},_set_hash:function(b,a){if(b===""){b="/"}this.last_hash=b;if(!a){return window.location.href="#"+b}else{return window.location.replace("#"+b)}}};var Votebox;Votebox={page:0,view:"newest",add_comment:function(b){var a;if(b){Event.stop(b)}a=$("comment_form");return Forms.ajax_submit(a,false,(function(c){var d;d=$("feature-comments");d.innerHTML=c.responseText+d.innerHTML;$("comment").setValue("");return d.scrollTo()}),false,b.target)},edit_comment:function(d,f,c){var a,b;Event.stop(d);f=$(f);a=f.up().next(".feature-comment-text");if(a.down("textarea")){return}a.old_comment=a.innerHTML;b='<p><textarea class="textarea act_as_block" id="comment_edit_#{comment_id}"\n  rows="5" cols="4">#{comment_content}</textarea></p>\n<p style="text-align:right; margin-bottom:0;">\n<input type="button" id="comment_save_#{comment_id}" value="Save" class="button"/>\n<input type="button" id="comment_cancel_#{comment_id}" class="button grayed" value="Cancel"/></p>';b=b.interpolate({comment_id:c,comment_content:a.old_comment.strip().replace(/<br\/>|<br>/g,"\n")});a.update(b);$("comment_save_"+c).observe("click",function(g){return this.save_comment(g,c)});$("comment_cancel_"+c).observe("click",function(g){return this.cancel_comment(g,c)});return ActAsBlock.register(a)},delete_comment:function(c,d,b){var a;Event.stop(c);d=$(d);a=d.up(".feature-comment");new Ajax.DBRequest("/votebox/delete_comment",{parameters:{comment_id:b}});return a.remove()},cancel_comment:function(c,b){var a;Event.stop(c);a=$("comment_edit_"+b).up(".feature-comment-text");return a.update(a.old_comment)},save_comment:function(c,b){var a;Event.stop(c);a=$("comment_edit_"+b).getValue();new Ajax.DBRequest("/votebox/edit_comment",{parameters:{comment_id:b,comment_text:a}});a=a.escapeHTML().replace(/\n/g,"<br/>");return $("comment_edit_"+b).up(".feature-comment-text").update(a)},submit_feature:function(b){var a;Event.stop(b);a=$("add-feature-request");return Forms.ajax_submit(a,false,(function(c){return window.location=c.responseText}),false,b.target)},how_voting_works:function(){return Modal.icon_show("comments_32",_("How voting works"),$("howvotingworks"))},votes_left:function(){return parseInt($("votes_left").innerHTML,10)},vote:function(f,c){var b,a,d=this;if(c){Event.stop(c)}f=$(f);b=f.id.slice(4);a=this.votes_left();if(a<=0){this.show_more_votes_modal();return}new Ajax.DBRequest("/votebox/vote",{parameters:{feature_id:b},onSuccess:function(){if(a===1){return window.location.reload()}},onFailure:function(e){d.adjust_votes_left(1);d.adjust_votes_total(f,-1);return d.adjust_votes_bubble(f,-1)}});this.adjust_votes_left(-1);this.adjust_votes_total(f,1);return this.adjust_votes_bubble(f,1)},tab_click:function(b,c,a){Event.stop(b);this.list_set_url({view:a});return this.tab(c)},tab:function(a){a=$(a);a.up("ul").select(".selected").invoke("removeClassName","selected");return a.up().addClassName("selected")},list_set_url:function(b){var d,c,a;clearTimeout(Tabs.check_interval);c=b.page||this.page||0;a=b.view||this.view||"popular";if(a!==this.view){c="0"}d=["votebox",a,c].join(":");window.location.href="#"+d;return this.list_hash_update(a,c)},list_hash_update:function(a,b){var c;c=a!==this.view||b!==this.page;if(!c){return}a=a||"popular";b=b||0;this.view=a;this.get_features(b);return this.tab($(""+a+"-tab").down())},comment_set_url:function(a){var b;b=["votebox",a].join(":");window.location.href="#"+b;return this.comment_hash_update(a)},comment_hash_update:function(a){if(a!==this.page){a=a||0;return this.get_comments(a)}},adjust_votes_left:function(b){var a;a=this.votes_left();a+=b;return $("votes_left").__date(a)},adjust_votes_total:function(d,b){var a,c;a=d.previous(".votecount").down("span");if(Util.isNumber(a.innerHTML)){c=parseInt(a.innerHTML,10);return a.update(c+b)}},adjust_votes_bubble:function(f,d){var b,c,a,e;e=f.up(".votebox");b=e.down(".ebubble");if(b){c=b.down(".c");a=parseInt(c.innerHTML,10);a+=d;if(a===0){return b.remove()}else{return c.__date("+"+a)}}else{return e.__sert(EventBubble.make("+1"))}},show_more_votes_modal:function(){return Modal.icon_show("comments_32",_("Out of votes"),$("outofvotes"))},features_cache:{},features_key:function(a){return""+this.view+"_"+this.category+"_"+a},get_features:function(b){var a,c,d=this;a=this.features_key(b);this.page=b;assert(Util.isNumber(b),"Feature page is not a number: "+b);if(this.features_cache[a]){return this.show_features(b)}else{c={};c.page=b;if(this.view){c.view=this.view}if(this.category){c.category=this.category}Spinner.showLoading(false,$("features"));return new Ajax.DBRequest("/votebox/more_features",{parameters:c,onSuccess:function(e){d.features_cache[a]=e.responseText;return d.show_features(b)},onComplete:function(){return Spinner.hideLoading()}})}},show_features:function(b){var a;a=this.features_key(b);return $("features").update(this.features_cache[a])},comments_cache:{},get_comments:function(a){var b=this;this.page=a;assert(Util.isNumber(a),"Comment page is not a number "+a);if(this.comments_cache[a]){return this.show_comments(a)}else{Spinner.showLoading(false,$("feature-comments"));return new Ajax.DBRequest("/votebox/more_comments",{parameters:{feature_id:this.feature_id,page:a},onSuccess:function(c){b.comments_cache[a]=c.responseText;return b.show_comments(a)},onComplete:function(){return Spinner.hideLoading()}})}},show_comments:function(a){return $("feature-comments").update(this.comments_cache[a])},search:function(a){this.last_search=a;if(SuggestionInput.defaulted($("feature-search"))||a===""){if(a===""){$("hideme").show();$("searchresults").hide();$("add-feature").hide()}return}return new Ajax.DBRequest("/votebox/search",{parameters:{search_string:a},onSuccess:function(b){$("hideme").hide();$("searchresults").show();$("searchresults").update(b.responseText);$("add-feature").show();return ActAsBlock.register(false,$("add-feature"))}})}};var Tutorial;Tutorial={events:{browse_reload:"browse_reload",browse_folder_update_start:"browse_folder_update_start",browse_folder_update_done:"browse_folder_update_done",browse_show_lightbox:"browse_show_lightbox",browse_hide_lightbox:"browse_hide_lightbox",show_share_folder_modal:"show_share_folder_modal",share_modal_type_contact:"share_modal_type_contact",share_modal_pick_contact:"share_modal_pick_contact",share_modal_remove_invite_user:"share_modal_remove_invite_user",share_modal_submit:"share_modal_submit",shmodel_folder_switch_view_mode:"shmodel_folder_switch_view_mode"},_event_handlers:{},set_event_handler:function(b,a){return this._event_handlers[b]=a},get_event_handler:function(a){return this._event_handlers[a]},should_handle_event:function(a){if(this.get_event_handler(a)){return true}else{return false}},handle_event:function(c,a){var b;b=this.get_event_handler(c);if(b){return b(a)}else{return false}}};var HandlePricingTable,InviteModal,Team,TeamsPricingSlider,cash_format;InviteModal=(function(){var c,f,e,d,g,b,a;b=0;c=0;a=function(){var h;h=c<0?_("You need more licenses for this invitation."):c===0?_("You have no remaining licenses."):ungettext("You have %d remaining license.","You have %d remaining licenses.",c).format(c);return $j("#license-count-message").text(h)};d=function(){c-=1;return a()};g=function(){c+=1;return a()};e=function(h){b=h;Event.observe($("team-invite-new-collab-input"),"token:add",d);return Event.observe($("team-invite-new-collab-input"),"token:remove",g)};f=function(){var h;h=$j(".team_admin_table_row").length;c=b-h;return a()};return{init:e,on_show_modal:f}})();Team={init_admin:function(){TitleBubble.set_vertical_space(2);return $j("form.activity-report-generator").submit(this.submit_report_form.bind(this))},show_add_modal:function(a){var b;b=_("Add team members");Modal.icon_show("team_add_user_32",b,$("team-invite-wizard"),{action:this.add_users});SuggestionInput.reset("team-invite-message");if(this.add_auto_completer){this.add_auto_completer.clearTokens()}else{this.add_auto_completer=new Autocompleter.ContactsTokenizer("team-invite-new-collab-input","team-invite-new-whobulk","team-invite-hidden-input",window.contacts,window.lcontacts,{tokens:[",",";"]});$j("#team-invite-new-collab-input").focus()}return InviteModal.on_show_modal()},add_users:function(b){var a;Event.stop(b);a=$("team-invite-form");assert(a,"Couldn't find the team invite form.");return Forms.ajax_submit(a,"/account/team/add_users",(function(d){var c;Modal.hide();c=$$(".team_admin_members_table")[0];return c.update(d.responseText)}),(function(){return Forms.enable(a.down("input[type='submit']"))}),b.target,{team_id:Constants.team_id},null,null,true)},show_remove_modal:function(d,e,a,b,g,c){var f;if(e){DomUtil.fillVal(e,"remove-user-name");f=_("Remove '%(user_name)s'").format({user_name:e})}else{DomUtil.fillVal(b,"remove-user-name");f=_("Remove '%(user_email)s'").format({user_email:b})}if(!g&&c){$("user-migrated-message").show();$("delete-account").checked=false;$("remove-from-team").checked=true}else{$("user-migrated-message").hide();$("remove-from-team").checked=false;$("delete-account").checked=true}if(!g){return Modal.icon_show("delete_32",f,$("remove-user-modal"),{user_id:a,button:d})}else{return Modal.icon_show("delete_32",f,$("remove-user-modal-simple"),{user_id:a,button:d,disable_if_joined:false})}},remove_user:function(c,f){var b,a,d=this;Event.stop(c);a=Modal.vars.user_id;if(f){b=true}else{b=$j("input[name=disable_if_joined]:checked","#remove-user-modal").val()}return new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:Constants.team_id,user_id:a,disable_if_joined:b},onSuccess:function(e){var g;g=Modal.vars.button.up(".bs-row");if(!g){g=Modal.vars.button.up(".member-row")}if(!g){g=Modal.vars.button.up(".team_admin_table_row")}if(!g){window.location=window.location.pathname+"?flash=removed-user";return}g.remove();d.decrement_used_licenses();return Notify.server_success(_("User removed."))},cleanUp:function(){return Modal.hide()}})},show_reinvite_modal:function(c,d,a,b){var e;DomUtil.fillVal(b,"reinvite-user-email");DomUtil.fillVal(d,"reinvite-user-team");e=_("Resend invite to '%(email_address)s'").format({email_address:b.em_snippet(18)});return Modal.icon_show("email_32",e,$("reinvite-user-modal"),{user_id:a,button:c})},reinvite_user:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){var d;Notify.server_success(_("Invite sent."));return(d=$("team-member-info"))!=null?d.update(c.responseText):void 0},cleanUp:function(){return Modal.hide()}})},show_reset_password_modal:function(b,c,a){var d;$j("#reset-password-modal .member-name").text(c);d=_("Reset password for '%(user_name)s'").format({user_name:c});return Modal.icon_show("arrow_refresh_32",d,$("reset-password-modal"),{user_id:a,button:b})},reset_password:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){return Notify.server_success(_("User's password reset."))},cleanUp:function(){return Modal.hide()}})},show_reset_all_passwords_modal:function(){return Modal.icon_show("arrow_refresh_32",_("Reset team passwords"),$("reset-all-passwords-modal"))},reset_all_passwords:function(){return new Ajax.DBRequest("/account/team/reset_all_passwords",{parameters:{team_id:Constants.team_id},onSuccess:function(a){return Notify.server_success(_("All passwords reset."))},cleanUp:function(){return Modal.hide()}})},show_admin_status_modal:function(c,j,l,e,k,f){var b,g,a,d,h;a=k.strip()||e;d=void 0;b=void 0;h=void 0;g=void 0;if(f){d=_("Are you sure you want to make <strong>%(person_name)s</strong> an admin?").format({person_name:a.escapeHTML()});b=_("Make admin");h=_("Make '%(person_name)s' an admin").format({person_name:a.escapeHTML()});g="alert_32"}else{d=_("Are you sure you want to remove admin privileges for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()});b=_("Remove admin status");h=_("Remove admin privileges for '%(person_name)s'").format({person_name:a.escapeHTML()});g="alert_32"}DomUtil.fillVal(e,"admin-status-email");DomUtil.fillVal(d,"admin-status-action");DomUtil.fillVal(b,"admin-status-button-action");return Modal.icon_show(g,h,$("admin-status-modal"),{user_id:l,button:c,admin_on:f})},set_admin_status:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:Constants.team_id,user_id:a,on:(Modal.vars.admin_on?"yes":"no")},onSuccess:function(c){var d;if($j(".team_admin_members_table").length){d=(Modal.vars.admin_on?_("User's admin status granted."):_("User's admin status removed."));Notify.server_success(d);return $j(".team_admin_members_table").html(c.responseText)}else{if(Modal.vars.admin_on){return window.location="/team/admin/members?id=%d&msg=granted".format(Modal.vars.user_id)}else{return window.location="/team/admin/members?id=%d&msg=removed".format(Modal.vars.user_id)}}},cleanUp:function(){return Modal.hide()}})},show_disable_2fa_modal:function(c,a,b){$j("#disable-2fa-modal .member-name").text(b);return Modal.icon_show("alert_32",_("Disable two-step verification"),$("disable-2fa-modal"),{user_id:a,elm:c})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:Constants.team_id,user_id:Modal.vars.user_id},onSuccess:function(){$j(".tfa_enabled").replaceWith(_("Disabled"));$j(Modal.vars.elm).closest("li").remove();Notify.server_success(_("Two-step verification disabled."));return Modal.hide()}})},show_user_message_modal:function(c,b,a){var d;DomUtil.fillVal(a,"user-message-email");d=_("Send email to '%(user_name)s'").format({user_name:c});$("user-message").value="";Modal.icon_show("email_32",d,$("user-message-modal"),{user_name:c,user_id:b});return Util.focus.defer("user-message")},send_user_message:function(){var b,a;a=Modal.vars.user_id;b=$F("user-message").strip();return new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:a,team_id:Constants.team_id,message:b},onSuccess:function(){var c;c=Modal.vars.user_name;Notify.server_success(_("Message successfully sent to %(user_name)s.").format({user_name:c}));return Modal.hide()}})},show_team_message_modal:function(a){var b;DomUtil.fillVal(a,"team-message-team");b=_("Send email to team members");$("team-message").value="";Modal.icon_show("email_32",b,$("team-message-modal"));return Util.focus.defer("team-message")},send_team_message:function(b){var a;Event.stop(b);a=$F("team-message").strip();if(a){return new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:Constants.team_id,message:a},onSuccess:function(c){Notify.server_success(_("Message successfully sent to team."));return Modal.hide()}})}},show_security_message_modal:function(b,a){var c,d=this;c=ungettext("%(member_count)s member has two-step verification disabled","%(member_count)s members have two-step verification disabled",a).format({member_count:a});$("team-security-message-submit").observe("click",function(f){d.send_team_security_message(f);return false});$("team-security-message-cancel").observe("click",function(){return Modal.hide()});$("team-security-message").value="";Modal.icon_show("email_32",c,$("team-security-message-modal"));return Util.focus.defer("team-security-message")},send_team_security_message:function(c){var b,a;Event.stop(c);a=$F("team-security-message").strip();b=$("team-security-message-form");return new Ajax.DBRequest("/account/team/send_team_message",{parameters:b.serialize(true),onSuccess:function(d){Notify.server_success(_("Message successfully sent."));return Modal.hide()}})},show_migrate_modal:function(c,d,a,b){DomUtil.fillVal(b,"migrate-email");return Modal.icon_show("alert_32",_("Migrate user to '%(team_name)s'").format({team_name:d.em_snippet(19)}),$("migrate-modal"),{user_id:a,button:c})},start_migration:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/start_migration",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){Notify.server_success(_("User migration initiated."));return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(a,b){this.used_licenses=a;return this.total_licenses=b},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(a,b){$("migration-url").value=b;Modal.icon_show("alert_32",_("Migration link for '%(email)s'").format({email:a.em_snippet(18)}),$("migrate-url-modal"));return $("migration-url").select()},toggle_account_view:function(a){switch(a){case"new":$("account_info_new").removeClassName("hidden_elem");$("account_info_existing").addClassName("hidden_elem");break;case"existing":$("account_info_new").addClassName("hidden_elem");$("account_info_existing").removeClassName("hidden_elem")}$("account_info_type").value=a;return false},show_end_session_modal:function(b,a,c){TitleBubble.hide_all();$j("#end-session-modal .member-name").text($j("#member-name").text());return Modal.icon_show("alert_32",_("Close web session"),$("end-session-modal"),{sess_id:b,user_id:a,elm:c})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_sess_id:Modal.vars.sess_id,team_id:Constants.team_id,user_id:Modal.vars.user_id},onSuccess:function(){Modal.hide();Team.remove_closest_row(Modal.vars.elm);return Notify.server_success(_("Web session closed."))}})},unlink_device:function(c,b,a,d){TitleBubble.hide_all();$j(".unlink-device-name").text(b);$j("#unlink-device-modal .member-name").text($j("#member-name").text());return Modal.icon_show("alert_32",_("Unlink device?"),$("unlink-device-modal"),{app_id:c,user_id:a,elm:d})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_device",{parameters:{app_id:Modal.vars.app_id,team_id:Constants.team_id,user_id:Modal.vars.user_id},onSuccess:function(){Modal.hide();Team.remove_closest_row(Modal.vars.elm);return Notify.server_success(_("Device unlinked."))}})},unlink_host:function(c,a,b,d){TitleBubble.hide_all();$j(".unlink-host-name").text(a);$j("#unlink-host-modal .member-name").text($j("#member-name").text());return Modal.icon_show("alert_32",_("Unlink device?"),$("unlink-host-modal"),{host_id:c,user_id:b,elm:d})},unlink_host_submit:function(){return new Ajax.DBRequest("/computer_edit",{parameters:{unlink:true,host_id:Modal.vars.host_id,team_id:Constants.team_id,user_id:Modal.vars.user_id},onSuccess:function(){Modal.hide();Team.remove_closest_row(Modal.vars.elm);return Notify.server_success(_("Device unlinked."))}})},disable_app:function(b,c,a,d){TitleBubble.hide_all();$j("#disable-app-modal .app-name").text(c);$j("#disable-app-modal .member-name").text($j("#member-name").text());return Modal.icon_show("application_delete_32",_("Disable '%(app_name)s'?").format({app_name:c}),$("disable-app-modal"),{token_id:b,user_id:a,elm:d})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{id:Modal.vars.token_id,keep_sandbox_files:true,team_id:Constants.team_id,user_id:Modal.vars.user_id},onSuccess:function(a){Modal.hide();Team.remove_closest_row(Modal.vars.elm);return Notify.server_success(a.responseText)}})},remove_closest_row:function(c){var b,a;b=$j(c).closest(".team_admin_table_row");a=$j(b).closest(".team_admin_table");if(a.find(".team_admin_table_row").length===1){a.prev(".team_admin_table_title").remove();return a.remove()}else{return b.remove()}},submit_report_form:function(a){$j(a.target.elements.tzoffset).val(""+new Date().getTimezoneOffset());return true}};cash_format=function(a){return a.toFixed(2).replace(/\.00/,"")};HandlePricingTable=Class.create({initialize:function(f,g,h,e,d,c,b,a){this.baseSpace=parseInt(f,10);this.baseUsers=g;this.baseCost=h;this.basePrice=e;this.licensePackQuota=d;this.maxAdditionalLicenses=c;this.prorateAmt=b;this.discountRatio=a;return this.listen()},handle:function(){var c,b,a,e,d;e=parseInt($("team_num_users").value,10)||0;d=this.baseCost;b=this.baseUsers;c=0;if(this.licensePackQuota){a=Math.max(e-this.baseUsers,0);$("extra_user_licenses_num").__date(a);$("extra_user_licenses_cost").__date(_("$%(num_dollars)s").format({num_dollars:a*this.basePrice}));if(a>0){$("extra_user_licenses_space").__date(Util.formatGB(a*this.licensePackQuota,true,true))}$("total_space").__date(Util.formatGB(a*this.licensePackQuota+this.baseSpace,true,true));$("total_licenses").__date(a+this.baseUsers);d=this.baseCost+a*this.basePrice;b+=this.maxAdditionalLicenses}else{$("total_space").__date(Util.formatGB(this.baseSpace,true,true));$("total_licenses").__date(this.baseUsers)}if(this.discountRatio){c=d*this.discountRatio;d=d-c}d=Math.max(d-this.prorateAmt,0);if(e>b){$("final_price_message").addClassName("hidden_elem");$("pricing_info").addClassName("hidden_elem");$("over_max_warning").removeClassName("hidden_elem")}else{if(e<=0){$("final_price_message").addClassName("hidden_elem");$("pricing_info").addClassName("hidden_elem");$("over_max_warning").addClassName("hidden_elem")}else{$("final_price_message").removeClassName("hidden_elem");$("pricing_info").removeClassName("hidden_elem");$("over_max_warning").addClassName("hidden_elem")}}if(e>0&&e<this.baseUsers){$("low_user_warning").removeClassName("hidden_elem")}else{$("low_user_warning").addClassName("hidden_elem")}$("total_price").__date(_("$%(num_dollars)s").format({num_dollars:cash_format(d)}));$("total_price_footer").__date(_("$%(num_dollars)s").format({num_dollars:cash_format(d)}));if(this.discountRatio){$("discount_ratio_amt").__date(_("-$%(num_dollars)s").format({num_dollars:cash_format(c)}))}if(e>this.baseUsers){$("extra_user_licenses_row").removeClassName("hidden_elem")}else{$("extra_user_licenses_row").addClassName("hidden_elem")}if(e>this.baseUsers||this.prorateAmt){return $("pricing_table_totals_wrapper").removeClassName("hidden_elem")}else{return $("pricing_table_totals_wrapper").addClassName("hidden_elem")}},listen:function(){var a,b=this;a=function(){return b.handle.bind(b).delay(1)};$("team_num_users").observe("keyup",a);$("team_num_users").observe("blur",this.handle.bind(this));return Util.smartLoad(this.handle.bind(this))},setProrateAmt:function(a){if($("prorate_amt_row")&&$("prorate_amt")){if(a){$("prorate_amt_row").show()}else{$("prorate_amt_row").hide()}$("prorate_amt").__date(_("-$%(num_dollars)s").format({num_dollars:cash_format(a)}))}this.prorateAmt=a;return this.handle()}});TeamsPricingSlider=Class.create({initialize:function(a){this.initialValue=5;$j("#"+a+" .slider-track").slider({min:1,max:250,step:1,range:"min",value:this.initialValue,slide:this.sliderChanged.bind(this),change:this.sliderChanged.bind(this)});this.handle=$j("#"+a+" .ui-slider-handle");this.counts=$j(".slider-count");this.prices=$j(".slider-price");return this.sliderChanged(null,{value:this.initialValue})},sliderChanged:function(c,f){var e,a,b,d;d=f.value;a=5;b=795;e=995;if(d>5){a=d;b+=125*(d-5);e+=199*(d-5)}this.handle.text(d);this.counts.text(a);return this.prices.text(_("$%(dollars)s").format({dollars:b}))}});var CONTACT_IMPORTER_SNIPPET_LEN,ContactTypes,HiddenInput,SF_VIEWS,ShareShowController,ShareView,SharedFolderInvites,Sharing,TeamExternalShareConfirm,TeamSharedFolderInviteController,Token,TokenListView,TokenManager,validate_email,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};CONTACT_IMPORTER_SNIPPET_LEN=45;SF_VIEWS={CURRENT:"current",PAST:"past"};ContactTypes={EMAIL:0,FB:1,INVALID:2,USER_GROUP:3};Sharing={_contacts_to_inject:[],_lcontacts_to_inject:[],init:function(b){var a=this;[b.current,b.past].each(function(c){return c.each(function(d){return a.decode_sort_key(d)})});this._state={sf_info:b,view:SF_VIEWS.CURRENT,cmp:this._modified_cmp,is_ascending:false,inbox_count:0};if(!((window.contacts!=null)&&(window.lcontacts!=null))){window.contacts=false;window.lcontacts=false}this.listen();this._tmpl=HTML.tmpl("sf_list_item_tmpl");return this._render()},decode_sort_key:function(a){assert((a.encoded_sort_key!=null)&&!(a.sort_key!=null),"expected encoded sort keys on each elm");a.sort_key=Util.decode_sort_key(a.encoded_sort_key);delete a.encoded_sort_key;return a},set_inbox_count:function(a){assert(typeof a==="number"&&a>=0,"invalid inbox count");return this._state.inbox_count=a},insert_folder_settings:function(){var c,e,a,b,f,d;e=Forms.collect_form_vars($("folder-settings-form"));f=e.audience==="team";Modal.hide();c=$("invite-more-form");d=c.down(".external-invite-message");b=c.down(".folder-settings");if(f){c.addClassName("team-only");d.addClassName("team-only");b.addClassName("team-only")}else{c.removeClassName("team-only");d.removeClassName("team-only");b.removeClassName("team-only")}a=$("invite-more-form").down(".folder-settings-container");a.__date();return Forms.add_vars(a,e)},dec_inbox_count:function(){var b,a,c,d=this;if(this._state){assert(this._state.inbox_count>0,"decrementing an inbox count to negative");this._state.inbox_count-=1;b=new Element("div");b.__sert(Sprite.make("web","email_32",{"class":"modal-h-img"}));b.__sert(_("Shared folder invitations (%d)").format(this._state.inbox_count));$("modal-title").__date(b);if(this._state.inbox_count){a=new Element("a",{id:"new-invites-link",href:"#"});a.__sert(Sprite.make("web","email_32",{"class":"link-img"}));c=ungettext("%d new shared folder invitation","%d new shared folder invitations",this._state.inbox_count);c+=" \n";c=c.format(this._state.inbox_count);a.__sert(c);a.observe("click",function(f){Event.stop(f);return d.show_invites(d._state.inbox_count)});$("invites-box").__date(a);return $("inbox-count").__date(this._state.inbox_count)}else{$("invites-box").remove();return $("inbox-count").remove()}}},register_decline:function(b,e){var c,d,a,f=this;d=$(b).up("form");a=$j("<img />",{src:"/static/images/icons/ajax-loading-small.gif","class":"text-img ajax_submit_loading"});c=$j(b).closest("td");if(!c.length){c=$j(b).closest("span");a.css("margin-top","8px")}a.appendTo(c);return Forms.ajax_submit(d,false,function(){var g,j,h;f.dec_inbox_count();g=$j("#invites-container");j=g.find('[data-invite-id="'+e+'"]');if(j){h=j.parent("tbody");j.remove();if(h.children().length===0&&SharedFolderInvites.cur_page===0){Modal.hide()}}Notify.server_success(_("Invitation declined."));SharedFolderInvites.pages={};return SharedFolderInvites.get_page(SharedFolderInvites.cur_page)})},listen:function(){var b,a,c=this;a=function(h,m,n){var g,d,j,o,k,f,l;k=h.memo.target_ns_id;assert(k,"SF _transfer w/o target_ns_id");for(g=f=0,l=m.length;f<l;g=++f){d=m[g];if(d.target_ns_id===k){j=d;o=g;break}}assert(o!=null,"SF _transfer w/o js obj");m.splice(o,1);$$("li.sf-folder")[o].remove();c._empty_check();n.push(j);return j};b=function(j,l){var d,k,h,g,f;h=j.memo.target_ns_id;assert(h!=null,"SF _remove w/o target_ns_id");for(d=g=0,f=l.length;0<=f?g<f:g>f;d=0<=f?++g:--g){if(l[d].target_ns_id===h){k=d;break}}assert(k!=null,"SF _remove w/o js obj");l.splice(k,1);$$("li.sf-folder")[k].remove();return c._empty_check()};document.observe(FileEvents.SF_UNSHARE,function(d){return b(d,c._state.sf_info.current)});document.observe(FileEvents.SF_LEAVE,function(d){return a(d,c._state.sf_info.current,c._state.sf_info.past)});document.observe(FileEvents.SF_REJOIN,function(f){var d;d=a(f,c._state.sf_info.past,c._state.sf_info.current);return d.filename=f.memo.filename});document.observe(FileEvents.SF_IGNORE,function(d){return b(d,c._state.sf_info.past)});document.observe(FileEvents.SF_NEW,function(f){var d;d=f.memo.sf_info;assert(d,"SF_NEW without info");c._state.sf_info.current.push(d);return c._render()});$("create-share").observe("click",function(d){Event.stop(d);return c.start_wizard(d)});if($("new-invites-link")){$("new-invites-link").observe("click",function(d){Event.stop(d);return c.show_invites(c._state.inbox_count)})}document.on("click",".filter-option",function(h,f){var g,d;h.preventDefault();d=f.readAttribute("data-filter");g=f.innerHTML;$$(".current-filter")[0].__date(g);return c._filter(d)});$("sf-list").on("click","a.options-link",function(j,g){var f,d,h;Event.stop(j);d=g.readAttribute("data-type");f=g.readAttribute("data-mount");h=parseInt(g.readAttribute("data-nsid"),10);if(d==="normal"){return c.get_sharing_options(f)}else{if(d==="remove"){return c.ignore(f,h)}else{if(d==="rejoin"){return c.rejoin(f,h)}}}});$("sf-sort").on("click","a.sort-option",function(g,f){var d,h;Event.stop(g);h={SF_BY_NAME:c._name_cmp,SF_BY_MODIFIED:c._modified_cmp};d=h[f.readAttribute("data-sort")];if(c._state.cmp===d){c._state.is_ascending=!c._state.is_ascending}else{c._state.cmp=d;c._state.is_ascending=true}Util.add_sort_arrow_mouseover(f,c._state.is_ascending,"#sf-sort a.sort-option",true);return c._render()});return Util.add_sort_arrow_mouseover($("modified-sorter"),this._state.is_ascending,"#sf-sort a.sort-option",false)},_filter:function(a){if(this._state.view===a){return}this._state.view=a;return this._render()},_render:function(){var c,a,f,d,b,e=this;d=this._get_current_sf_list();f=this._state.view===SF_VIEWS.PAST;c=function(g,j){var h;h=e._state.is_ascending?1:-1;return h*e._state.cmp(g,j)};d.sort(c);a=(function(){var j,h,g;g=[];for(j=0,h=d.length;j<h;j++){b=d[j];g.push(this._tmpl({options_str:_("Options"),remove_str:_("Remove"),rejoin_str:_("Rejoin"),is_past:f,sf:b}))}return g}).call(this);$("sf-list").__date(a);return this._empty_check()},_empty_check:function(){if(this._get_current_sf_list().length){return $("sf-view").removeClassName("empty-list")}else{return $("sf-view").addClassName("empty-list")}},_get_current_sf_list:function(){switch(this._state.view){case SF_VIEWS.CURRENT:return this._state.sf_info.current;case SF_VIEWS.PAST:return this._state.sf_info.past;default:return assert(false,"invalid sf state")}},_name_cmp:function(a,b){return Util.sort_by_rank_or_key(a,b)},_modified_cmp:function(a,b){return a.modified_ts-b.modified_ts},include_fb:false,use_fb_profile_pics:true,init_invites:function(){return this.show_invites(this._state.inbox_count)},show_invites:function(a){var b;if(EmailVerification.verified()){b=_("Shared folder invitations (%d)").format(a);return Modal.icon_show("email_32",b,$("invites-container"))}},get_sharing_options:function(b){var a,c=this;b=Util.normalize(b);Modal.show_loading("folder_user_32",_("Loading shared folder options..."));a="/share_options"+Util.urlquote(b);return new Ajax.DBRequest(a,{onSuccess:function(d){c.reshow=function(){c.show_sharing_options(d.responseText,b);(function(){var e;if(c.tc){c.tc.toggle($("members"))}if(c.reshow_as_team_only!==null){c.sharing_options_auto_completer.setTeamOnly(c.reshow_as_team_only);return(e=window.share_show_controller)!=null?e.set_team_only(c.reshow_as_team_only):void 0}}).defer();return delete Modal.onHide};c.reshow_as_team_only=null;return c.show_sharing_options(d.responseText,b)},onFailure:function(){return Modal.hide()}})},show_sharing_options:function(a,b){var c;c=_("Shared folder options for '%(file_name)s'");c=c.format({file_name:FileOps.filename(b).em_snippet(13)});return Modal.icon_show("folder_user_32",c,a,{},false)},create_teams_tokenizer:function(b,a){if(a==null){a=false}return new Autocompleter.TeamTokenizer(b+"-new-collab-input",b+"-new-whobulk",b+"-hidden-input",window.contacts,window.lcontacts,{tokens:[",",";"],include_fb:true,team_only:a})},create_sf_tokenizer:function(a){return new Autocompleter.ContactsTokenizer(a+"-new-collab-input",a+"-new-whobulk",a+"-hidden-input",window.contacts,window.lcontacts,{tokens:[",",";"],include_fb:true})},reset_wizard:function(){var b,a;SuggestionInput.reset("invite-wizard-new-collab-input");SuggestionInput.reset("custom-message-wizard");SuggestionInput.reset("new_folder_name");b=$("invite-more-form");a=b.down("input[name='folder_name']");if(a){return a.remove()}},validate_folder:function(f,c,g){var a,b,d;c=$(c);b=c.down("#folder_name");if(b&&$$("#modal-content #copy-move-treeview .highlight .s_web_folder_user").length){return this.show_invite_more_modal($F(b))}d=$(f.target);if(d&&d.tagName!=="input"){a=d.up("#modal-content");d=a.down("input.button")}assert(c,"Trying to validate a folder where the form doesn't exist");Forms.ajax_submit(c,false,(function(){if(g&&typeof g==="function"){return g(f,c)}}),false,d);return false},start_wizard:function(a){var b;if(EmailVerification.verified()){this.reset_wizard();if(a){Event.stop(a)}if(Constants.ADMIN||Math.random()<0.001){b=new Element("div");b.__sert(new Element("img",{src:"/static/images/icons/clippy.gif","class":"modal-h-img"}));b.__sert(_("It looks like you're trying to share a folder."));Modal.show(b,$("clippy-shared-folder-wizard"))}else{Modal.icon_show("folder_user_32",_("Share a folder"),$("shared-folder-wizard"))}return $("create-new-sf").focus()}},wizard_next:function(d){var h,j,c,g,b,f,a;Event.stop(d);if($("create-new-sf").checked){this.validate_folder(d,"validate-folder-name",this.from_new_to_invitation.bind(this))}else{c=Sprite.make("web","folder_user_32",{});c.addClassName("modal-h-img");j=_("Choose folder to share");Modal.show(new Element("span").__sert(c).__sert(j),$("existing-shared-folder-wizard"));TreeView.move("copy-move-treeview","share-existing-treeview",{onSuccess:function(){var e;$("modal").observe("db:treeview_selected",function(k){return $("folder_name").setValue(k.memo.path)});e=$("first-treeview-link");if(!Util.ie){return e.onclick()}}})}f=$$("#modal-content .suggestion-input");a=[];for(g=0,b=f.length;g<b;g++){h=f[g];a.push(SuggestionInput.register(h))}return a},from_new_to_invitation:function(d,b){var f,c,a;f=$F(b.down("#new_folder_name")).strip();assert(f,"Moving from new folder to invite modal with no path.");this.invite_more_action=this.submit_share_new_wizard.bind(this);this.invite_more_path="/"+f;this.show_invite_more_wizard(f);a=$("invite-more-form");c=a.down("input[name=folder_name]");if(!c){c=new Element("input",{type:"hidden",name:"folder_name"});a.__sert(c)}c.setValue(f);return $("share-invite-button").setValue(_("Share folder"))},from_existing_to_invitation:function(f,c,d){var a,b;if(!d){d=$F(c.down("#folder_name")).strip()}assert(d,"Moving from choose a folder to invite modal with no path.");this.invite_more_action=this.submit_share_existing_wizard.bind(this);this.invite_more_path=d.strip();this.show_invite_more_wizard(FileOps.filename(d));b=$("invite-more-form");a=b.down("input[name=path]");if(!a){a=new Element("input",{type:"hidden",name:"path"});b.__sert(a)}a.setValue(d);$("share-invite-button").setValue(_("Share folder"));if(Tutorial.should_handle_event(Tutorial.events.show_share_modal)){return Tutorial.handle_event(Tutorial.events.show_share_modal)}},show_invite_more_wizard:function(d,f){var h,a,b,c,k,j,g,e=this;if(f==null){f=true}assert(d,"Folder name required");DomUtil.fillVal("folder","invite-more-wizard-share-type");a=_("Share '%(folder_name)s' with others");a=a.format({folder_name:d.em_snippet(16)});g=$("invite-more-wizard");Modal.icon_show("folder_user_32",a,g);Modal.vars.action=this.invite_more_action;Modal.vars.path=this.invite_more_path;this.settings_folder_name=d;if(f){k=false;if(this.invite_wizard_auto_completer){this.invite_wizard_auto_completer.clearTokens();k=this.invite_wizard_auto_completer.isTeamOnly()}else{this.invite_wizard_auto_completer=this.create_sf_tokenizer("invite-wizard")}j=g.down(".external-invite-message");if(j!=null){j.hide()}h=$("invite-more-form");b=g.down(".folder-settings");j=g.down(".external-invite-message");if(k){h.addClassName("team-only");if(b!=null){b.addClassName("team-only")}if(j!=null){j.addClassName("team-only")}}else{h.removeClassName("team-only");if(b!=null){b.removeClassName("team-only")}if(j!=null){j.removeClassName("team-only")}}c=g.down(".folder-settings-container");if(c!=null){c.__date()}$("invite-wizard-new-collab-input").focus();return this.reshow_invite_more=function(){e.show_invite_more_wizard(d,false);return delete Modal.onHide}}},show_default_folder_settings:function(c){var b,d,a;Event.stop(c);b=$("invite-more-wizard");a=b.down(".folder-settings-container");d=Forms.collect_form_vars(a);d.folder_name=this.settings_folder_name;return new UIRequest(c.target,"/share_ajax/default_folder_settings",d,function(){return Modal.onHide=Sharing.reshow_invite_more})},add_from_cli:function(){var a,b,c;c=Referral.get_selected_emails();this.show_invite_more_wizard(FileOps.filename(this.old_state.path));Modal.vars=this.old_state;b=$("new-collab-input");SuggestionInput.do_blank("new-collab-input");a=$F(b);if(c){b.setValue(a+(a.length>0?", ":"")+c);b.addClassName("suggestion-input-unfaded")}return delete Modal.onHide},submit_share_new_wizard:function(b){var a;a=$("invite-more-form");assert(a,"Couldn't find the invite more form.");Forms.ui_form_submit(a,"/share_ajax/new");return false},submit_share_existing_wizard:function(c){var b,a;if(Tutorial.should_handle_event(Tutorial.events.share_modal_submit)){a=Tutorial.handle_event(Tutorial.events.share_modal_submit);if(a){return false}}b=$("invite-more-form");assert(b,"Couldn't find the invite more form.");Forms.ui_form_submit(b,"/share_ajax/existing?long_running");return false},show_share_existing_modal:function(a){if(EmailVerification.verified()){this.reset_wizard();return this.from_existing_to_invitation(false,false,a)}},show_invite_more_modal:function(a){this.reset_wizard();return this.get_sharing_options(a)},submit_invite_more_wizard:function(b){var a;a=$("invite-more-form");assert(a.down("input[name=ns_id]"),"Submit invite more wizard is missing ns_id");Forms.ui_form_submit(a,"/share_ajax/invite_more");return false},show_leave_modal:function(b,a){var c,d;Modal.onHide=this.reshow;d=_("Leave the shared folder '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(b).em_snippet(14)});Modal.icon_show("folder_user_delete_32",d,DomUtil.fromElm("leave-confirm"),{wit_group:"share-leave-confirm"});c=$("leave-share-form");c.action="/share_ajax/leave?long_running";Modal.vars.ns_id=a;return Modal.vars.folder_path=b},submit_leave:function(h){var d,b,c,g,a,f,j=this;assert(Modal.vars.folder_path.length,"submit_leave: No shared folder path.");assert(Modal.vars.ns_id,"submit_leave: missing ns_id");delete Modal.onHide;c=Modal.vars.folder_path;f=Modal.vars.ns_id;d=$("leave-share-form");Forms.add_vars(d,{ns_id:f});b=d.down("#keep_files").checked;a=function(e){var k;k=_("You removed yourself from '%(msg)s'.").format({msg:FileOps.filename(c).snippet()});Modal.hide();Notify.server_success(k);return document.fire(FileEvents.SF_LEAVE,{target_ns_id:f,folder_deleted:!b})};g=function(e){return null};Forms.ajax_submit(d,false,a,g,h.target);return false},show_unshare_modal:function(b,a){var c,d;Modal.onHide=this.reshow;d=_("Unshare '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(b).em_snippet(21)});Modal.icon_show("folder_user_delete_32",d,DomUtil.fromElm("unshare-confirm"),{wit_group:"share-unshare-confirm"});c=$("unshare-form");Modal.vars.path=b;Modal.vars.ns_id=a;return c.action="/share_ajax/unshare?long_running"},submit_unshare:function(f){var c,b,d,a,g=this;delete Modal.onHide;c=$("unshare-form");assert(Modal.vars.path,"submit_unshare: No shared folder path.");assert(Modal.vars.ns_id,"submit_unshare: missing ns_id");Forms.add_vars(c,{ns_id:Modal.vars.ns_id});a=function(e){var h;h=_("Unshared folder '%(folder_name)s'");h=h.format({folder_name:FileOps.filename(Modal.vars.path).snippet()});Notify.server_success(h);return document.fire(FileEvents.SF_UNSHARE,{target_ns_id:Modal.vars.ns_id})};d=function(e){return null};b=function(e){return Modal.hide()};Forms.ajax_submit(c,false,a,d,f.target,void 0,void 0,c.down("#async").value,false,b,_("Unsharing..."));return false},remove_div:function(a){$(a).up(".bs-row").remove();return false},leave:function(){return Modal.show(_("Leave shared folder?"),DomUtil.fromElm("leave-confirm"),{wit_group:"share-leave-confirm"})},unshare:function(){return Modal.show(_("Unshare folder?"),DomUtil.fromElm("unshare-confirm"),{wit_group:"share-unshare-confirm"})},ignore:function(c,a){var b,d;assert(a,"Share ignore did not get an ns_id");d=_("Permanently remove '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(c).em_snippet(15)});Modal.icon_show("folder_delete_32",d,DomUtil.fromElm("ignore-confirm"),{wit_group:"share-ignore-confirm"});b=$("modal-content").down("form");b.action="/share_action/ignore?long_running";Forms.add_vars(b,{ns_id:a});Modal.vars.path=c;return Modal.vars.ns_id=a},submit_ignore:function(d){var b,c,a,f=this;if(d){Event.stop(d)}b=$("share-ignore-form");assert(b,"Missing submit_ignore_form");a=function(e){Modal.hide();Notify.server_success(_("Removed shared folder successfully."));return document.fire(FileEvents.SF_IGNORE,{target_ns_id:Modal.vars.ns_id})};c=function(e){return null};return Forms.ajax_submit(b,false,a,c,d&&d.target)},rejoin:function(c,a){var b,d;assert(a,"Rejoin didn't get an ns_id");d=_("Rejoin the shared folder '%(folder_name)s'?");d=d.format({folder_name:FileOps.filename(c).em_snippet(13)});Modal.icon_show("alert_32",d,DomUtil.fromElm("rejoin-confirm"),{wit_group:"share-rejoin-confirm"});b=$("modal-content").down("form");b.action="/share_action/rejoin?long_running";Forms.add_vars(b,{ns_id:a});Modal.vars.path=c;return Modal.vars.ns_id=a},submit_rejoin:function(d){var b,c,a,f=this;Event.stop(d);b=$("rejoin-form");a=function(g){var e;e=FileOps.filename(g.responseText);Modal.hide();Notify.server_success(_("Rejoined shared folder successfully."));return document.fire(FileEvents.SF_REJOIN,{target_ns_id:Modal.vars.ns_id,filename:e})};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},show_change_sf_owner_modal:function(c,d,a,b){var e,f;DomUtil.fillVal(c,"change_sf_owner-confirm-nickname");Modal.onHide=this.reshow;f=_("Make %(person_name)s the owner of this folder?");f=f.format({person_name:c.em_snippet(14)});Modal.icon_show("alert_32",f,DomUtil.fromElm("change_sf_owner-confirm"),{wit_group:"share-change-sf-owner-confirm"});e=$("change-sf-owner-form");e.action="/share_ajax/change_sf_owner";Modal.vars.ns_id=a;return Modal.vars.user_id=b},submit_change_sf_owner:function(d){var b,c,a,f=this;delete Modal.onHide;$("make-owner-button").disable();assert(Modal.vars.ns_id,"submit_change_sf_owner: missing ns_id");assert(Modal.vars.user_id,"submit_change_sf_owner: missing user_id");b=$("change-sf-owner-form");Forms.add_vars(b,{ns_id:Modal.vars.ns_id,user_id:Modal.vars.user_id});a=function(e){Notify.server_success(_("Ownership changed successfully."));return Modal.hide()};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},submit_change_sf_perm:function(b,e){var c,d,a,f=this;$("change-sf-perm-saving").show();c=$("change-sf-perm-form");Forms.clear_added_vars("change-sf-perm-form");Forms.add_vars(c,{ns_id:b,new_permissions:(e?1:0)});a=function(g){if(e){Notify.server_success(_("Members can now share this folder."))}else{Notify.server_success(_("Members can no longer share this folder."))}return $("change-sf-perm-saving").hide()};d=function(g){if(g.responseText.indexOf("err:")===0){Notify.server_error(g.responseText.substr(4))}else{Notify.server_error(_("Error updating your preference! Please try again."))}return $("change-sf-perm-saving").hide()};Forms.ajax_submit(c,false,a,d);return true},cancel_user:function(e,a,d,b){var c,f=this;c=_("Are you sure you want to uninvite %(email_or_fbname)s?");c=c.format({email_or_fbname:e});if(confirm(c)){return new Ajax.DBRequest("/share_ajax/cancel_invite",{parameters:{ns_id:a,invite_id:d},onSuccess:function(g){f.remove_div(b);c=_("%(email_or_fbname)s has been uninvited.");c=c.format({email_or_fbname:e});return Notify.server_success(c)}})}},kick_user:function(c,e,a,b,d,f){var g;Modal.onHide=this.reshow;DomUtil.fillVal(c,"kick-confirm-nickname");g=_("Kick %(person_name)s out of %(folder_name)s?");g=g.format({person_name:c,folder_name:FileOps.filename(f).em_snippet(13)});return Modal.icon_show("folder_user_delete_32",g,DomUtil.fromElm("kick-confirm"),{button:d,victim:e,ns_id:a,user_id:b,group_id:null,wit_group:"share-kick-confirm"})},kick_group:function(b,a,d,c,e){var f;Modal.onHide=this.reshow;DomUtil.fillVal(b,"kick-confirm-nickname");f=_("Kick %(group_name)s out of %(folder_name)s?");f=f.format({group_name:b,folder_name:FileOps.filename(e).em_snippet(13)});return Modal.icon_show("folder_user_delete_32",f,DomUtil.fromElm("kick-confirm"),{button:c,ns_id:a,user_id:null,group_id:d,wit_group:"share-kick-confirm"})},do_kick:function(b,c,e,d){var a,f=this;a=$F("keep-files-check");if(c!==null){new Ajax.DBRequest("/share_ajax/kick_user",{parameters:{ns_id:b,user_id:c,keep_files:a},onSuccess:function(){Notify.server_success(_("User removed successfully."));Modal.hide();return f.get_sharing_options(PAGE_PATH)}})}if(e!==null){return new Ajax.DBRequest("/share_ajax/kick_group",{parameters:{ns_id:b,group_id:e,keep_files:a},onSuccess:function(){Notify.server_success(_("Group removed successfully."));Modal.hide();return f.get_sharing_options(PAGE_PATH)}})}},reinvite_user:function(b,a){var c=this;new Ajax.DBRequest("/share_ajax/reinvite_user/"+PAGE_PATH,{parameters:{invite_id:a},onSuccess:function(d){var e;e=_("%(email_or_fbname)s was reinvited successfully");e=e.format({email_or_fbname:b});return Notify.server_success(e)}});return false},inject_contacts:function(a){this._contacts_to_inject=a.clone();return this._lcontacts_to_inject=a.collect(function(b){return{email:b.email,name:b.name.toLowerCase(),type:b.type}})},snippet_contact_list:function(d){var a,c,b;for(c=0,b=d.length;c<b;c++){a=d[c];if(a.email!=null){a.email=a.email.snippet(CONTACT_IMPORTER_SNIPPET_LEN)}if(a.name!=null){a.name=a.name.snippet(CONTACT_IMPORTER_SNIPPET_LEN)}}return d},load_contacts:function(e,a,b,d){var c=this;if(b==null){b=false}if(d==null){d=false}if(Contacts.contacts_to_import===EmailProvider.NONE){Contacts.set_contacts_to_import()}if(this.loading_contacts){return false}this.loading_contacts=true;return new Ajax.DBRequest("/get_contacts",{parameters:{include_fb:e,direct_action:b,include_groups:d},onSuccess:function(f){var g;g=f.responseText.evalJSON(false);window.contacts=c.snippet_contact_list(g.contacts);window.lcontacts=c.snippet_contact_list(g.lcontacts);c.loading_contacts=false;if(c._contacts_to_inject&&c._lcontacts_to_inject){window.contacts.push.apply(window.contacts,c._contacts_to_inject);window.lcontacts.push.apply(window.lcontacts,c._lcontacts_to_inject)}if(c.sharing_options_auto_completer){c.sharing_options_auto_completer.setContacts(window.contacts,window.lcontacts)}if(c.invite_wizard_auto_completer){c.invite_wizard_auto_completer.setContacts(window.contacts,window.lcontacts)}if(SharingModel.send_link_autocompleter){SharingModel.send_link_autocompleter.setContacts(window.contacts,window.lcontacts)}if(Foshmodal.send_link_autocompleter!=null){Foshmodal.send_link_autocompleter.options.array=window.contacts;Foshmodal.send_link_autocompleter.options.larray=window.lcontacts}if(a!=null){return a()}}})},shmodel:function(d,c){var b,a;if(c==null){c=true}a="/sm/create"+Util.urlquote(d);if(c){Forms.postRequest(a,{},{target:"_blank"});b=Browse.find_file(d);if(b){return b.get_div().addClassName("shmodeled")}}else{return Forms.postRequest(a)}},show_share_subfolder_warning:function(){var a,b;b=Browse.details_from_fq_path(Browse.containing_fq_path()).folder_name;if(b){a=_("Folders within shared folders can't be shared, but you can still share the folder '%(parent_shared_folder)s'");a=a.format({parent_shared_folder:b});Notify.server_error(a);return document.stopObserving(Browse.UPDATE_EVT,this.show_share_subfolder_warning)}},fb_auth_callback:function(){Sharing.load_contacts(true);$$(".fb-connect-link").each(function(a){return a.hide()});return Notify.server_success(_("Successfully connected to Facebook."))}};SharedFolderInvites={pages:{},contents:{},cur_page:0,loading_page:false,reload_page_needed:false,show_page:function(a){Spinner.hideLoading();$("invites-container").update(this.pages[a]);return this.cur_page=a},get_page:function(a){var b=this;if(!$("invites-container")){return}if(this.pages[a]){this.show_page(a)}else{if(this.loading_page){this.reload_page_needed=true;return}this.loading_page=true;this.reload_page_needed=false;Spinner.showLoading(false,$("invites-container"),false,true);new Ajax.DBRequest("/share_ajax/invitation_page?page="+a,{onSuccess:function(c){b.loading_page=false;if(c.responseText==="False"){b.get_page(0);return}b.pages[a]=c.responseText;b.show_page(a);if(b.reload_page_needed){return b.get_page(a)}}})}return false},get_sf_contents:function(b,a){var c=this;if(this.contents[a]){return this.show_sf_contents(b,a)}else{return new Ajax.DBRequest("/share_ajax/sf_contents?ns_id="+a,{onSuccess:function(d){c.contents[a]=d.responseText;return c.show_sf_contents(b,a)}})}},show_sf_contents:function(b,a){return b.down(".folder-contents").update(this.contents[a])},mailto:function(b,a){Event.stop(b);return window.location="mailto:"+a}};ShareView={current_view:"gallery",click:function(a){ShareView.toggle_view(a);HashRouter.set_hash("view",a);return false},toggle_view:function(b){var a,c;b=b||"gallery";c=$(b+"-link");if(!c){return}$$("#toggle-view .selected").invoke("removeClassName","selected");c.addClassName("selected");$$(".view").invoke("hide");a=$(b+"-view");if(a){a.show()}return ShareView.current_view=b}};TokenListView={sort_by_filename:function(a){return parseInt(a.down(".filename .hidden").innerHTML,10)},sort_by_size:function(a){return parseInt(a.down(".filesize .hidden").innerHTML,10)},sort_by_modified:function(a){return -1*parseInt(a.down(".modified .hidden").innerHTML,10)},sort:function(g){var a,n,h,d,c,l,m,j,f,b,k;Event.stop(g);h=$(g.target).up("a");if(h.asc!==-1){h.asc=-1}else{h.asc=1}a=h.className;j={"sort-filename":this.sort_by_filename,"sort-filesize":this.sort_by_size,"sort-modified":this.sort_by_modified};m=$$("#list-view .filerow");f=m.sort_by_key(j[a],h.asc!==1);m.invoke("remove");n=new Element("div");for(b=0,k=f.length;b<k;b++){l=f[b];n.__sert(l)}$("list-browser").__sert(new HTML(n.innerHTML));$$(".sort-tick").invoke("remove");d=h.asc===1?"sort-downtick-on":"sort-uptick-on";c=Sprite.make("web",d);c.addClassName("sort-tick");return h.__sert(c)}};Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(c,g,f,b,a){var e,d=this;this.baseInitialize(c,g,a);this.options.array=f;this.options.larray=b;this.options.frequency=0.1;e=this.options.include_fb===true;if(!window.contacts){(function(){return Sharing.load_contacts(e)}).defer()}this.options.onShow=function(h,j){if(!j.style.position||j.style.position==="absolute"){j.style.position="absolute";$j(j).clonePosition($j(h),{setHeight:false,setTop:false,setLeft:false})}return $j(j).fadeIn(150)};this._autocompleter_contact_import_item_tmpl=HTML.tmpl("autocompleter_item_tmpl");if(Constants.shmodal_contact_importer_enabled){Event.stopObserving(this.element,"blur");Event.observe($("modal-box"),"click",function(h){var k,j;k=h.srcElement||h.originalTarget;if(k.className!=="import-contacts-link"){if(d.contact_importer_currently_showing()){return d.contact_importer_unshow()}else{return(j=d.get_entry_container())!=null?j.hide():void 0}}});ContactImporter.toggle=this.contact_importer_toggle.bind(this);ContactImporter.unshow=this.contact_importer_unshow.bind(this);return ContactImporter.refresh=function(){return Sharing.load_contacts(true,(function(){if(d.element.value.length){return d.getUpdatedChoices()}}))}}},getToken:function(){var a;a=this.getTokenBounds();return this.element.value.substring(a[0],a[1])},get_entry_container:function(){var a;return(a=this.element.up("#tokenized_autocompleter_container"))!=null?a.down(".autocomplete"):void 0},contact_importer_currently_showing:function(){var b,a;b=this.get_entry_container();if((b!=null)&&b.style.display!=="none"){if(((a=b.firstChild.firstChild)!=null?a.value:void 0)===0){if(b.firstChild.children.length>1){return true}}}return false},contact_importer_show:function(){var c,b,a,d;c=this.get_entry_container();if(((b=c.firstChild)!=null?(a=b.firstChild)!=null?a.value:void 0:void 0)>0){ContactImporter.old_display=c.style.display}else{ContactImporter.old_contents="<ul></ul>";ContactImporter.old_display="none"}this.contact_importer_render_buttons();if((d=$("flash_copy_container"))!=null){d.hide()}return this.element.focus()},contact_importer_unshow:function(){var a;this.hasFocus=true;this.changed=false;this.updateChoices(ContactImporter.old_contents);this.get_entry_container().style.display=ContactImporter.old_display;return(a=$("flash_copy_container"))!=null?a.show():void 0},contact_importer_toggle:function(){if(this.contact_importer_currently_showing()){return this.contact_importer_unshow()}else{return this.contact_importer_show()}},contact_importer_render_buttons:function(){var c,b,e,a,d;b=[];if(Constants.shmodal_contact_importer_enabled){d=[EmailProvider.GOOGLE,EmailProvider.YAHOO,EmailProvider.FACEBOOK];for(e=0,a=d.length;e<a;e++){c=d[e];assert(Contacts.connected_services!=null,"connected_services has not been set");b.push(this._autocompleter_contact_import_item_tmpl({email_provider_num:c,email_provider_img:EmailProvider.to_img(c),email_provider_name:EmailProvider.to_name(c),bottom_text:Contacts.connected_services[c]?_("Connected"):"",is_suggestion:0}).toHTML())}}this.hasFocus=true;return this.updateChoices("<ul>"+(b.join(""))+"</ul>")},getUpdatedChoices:function(){var a=this;if(!this.options.array&&window.contacts&&window.lcontacts){this.options.array=window.contacts;this.options.larray=window.lcontacts}this.updateChoices(this.options.selector());$j(".autocomplete-item-cancel-button").off();return $j(".autocomplete-item-cancel-button").on("click",(function(b){b.stopPropagation();ContactImporter.suggestions_enabled=false;a.getUpdatedChoices();return new Ajax.DBRequest("/contacts/turn_off_importer_suggestions")}))},selectEntry:function(){var c,b,a;b=this.getCurrentEntry();c=this.options.array[b.value];if(c.type===ContactTypes.FB){b.innerHTML=c.name}else{b.innerHTML=c.email}if(this.options.tokens.length>1){a=this.options.tokens[0]+" "}else{a=""}b.innerHTML+=a;this.active=false;this.updateElement(b);return $(this.element).fire("db:autocompleted")},setOptions:function(b){var a,c=this;if(b==null){b={}}a={choices:5,selector:function(){var H,n,F,D,t,E,f,K,g,r,s,C,y,z,k,o,m,x,u,w,A,j,v,J,h,B,e,d,G,I,q;J=[];f=c.getToken().toLowerCase();y=c.options.array.length;F=c.options.choices;H=c.options.array;z=c.options.larray;v=[];if(f.indexOf(" ")===-1){v.push("\\s+")}if(f.indexOf("+")===-1){v.push("\\+")}if(f.indexOf("@")===-1){v.push("@")}if(f.indexOf(".")===-1){v.push("\\.")}if(f.indexOf("&lt;")===-1){v.push("&lt;")}j=RegExp("("+v.join("|")+")");s=0;while(s<y&&J.length<F){E=H[s];o=z[s];K=-1;t=[];x=[];r="";switch(E.type){case ContactTypes.EMAIL:t.push(E.name,E.email);x.push(o.name,o.email);r="/static/images/icons/mail28.png";break;case ContactTypes.FB:t.push(E.name);x.push(o.name);if(Sharing.use_fb_profile_pics){r="https://graph.facebook.com/"+o.fb_id+"/picture"}else{r="/static/images/icons/fb24.png"}break;case ContactTypes.USER_GROUP:t.push(E.name,E.desc);x.push(o.name,o.desc);r="/static/images/icons/groupicon_large.png";break;default:assert(false,"should never get here due to type: "+E.type+", "+E.name+", "+E.email+", "+E)}for(C=e=0,G=x.length;e<G;C=++e){m=x[C];w=v.length?m.split(j):[m];D=0;for(d=0,I=w.length;d<I;d++){u=w[d];if(!u){continue}if(u.indexOf(f)===0){K=D;break}D+=u.length}if(K!==-1){t[C]=t[C].substr(0,K)+"<strong>"+t[C].substr(K,f.length)+"</strong>"+t[C].substr(K+f.length);break}}if(E.type===ContactTypes.FB){t.push(_("Facebook message"))}if(K!==-1){g="<image src='"+r+"' width='28px' height='28px'/>";A="<div class='autocomplete-line'>"+t[0]+"</div>";B="<div class='autocomplete-line autocomplete-secondary'>"+t[1]+"</div>";k="<div class='autocomplete-left'>"+g+"</div>";h="<div>"+(A+B)+"</div>";J.push("<li value='"+s+"'>"+(k+h)+"</li>")}s++}if(Constants.shmodal_contact_importer_enabled){if(q=Contacts.contacts_to_import,__indexOf.call(EmailProvider.contact_services(),q)>=0){if(!Contacts.connected_services[Contacts.contacts_to_import]){if(ContactImporter.suggestions_enabled){J.push(c._autocompleter_contact_import_item_tmpl({email_provider_num:Contacts.contacts_to_import,email_provider_img:EmailProvider.to_img(Contacts.contacts_to_import),email_provider_name:_("Import your %(email_provider_name)s contacts").format({email_provider_name:EmailProvider.to_name(Contacts.contacts_to_import)}),bottom_text:_("Easily share with friends, family or coworkers"),is_suggestion:1}).toHTML())}}}}n="<ul>"+(J.join(""))+"</ul>";ContactImporter.old_contents=n;return n}};return this.options=Object.extend(a,b)}});Token=Class.create({initialize:function(b,a,c,d){this.element=$(b);this.token_manager=c;this.hidden_input=a;this.element.token=this;this.selected=false;this.info=d;return Event.observe($("tokenized_autocompleter_container"),"click",this.onclick.bindAsEventListener(this))},select:function(){var a;this.token_manager.token=this;if((a=this.hidden_input)!=null){a.element.activate()}this.selected=true;return this.element.addClassName("token_selected")},deselect:function(){if(this.token_manager.token===this){this.token_manager.token=null}this.selected=false;return this.element.removeClassName("token_selected")},onclick:function(a){if(a&&a.preventDefault){a.preventDefault()}if(this.detect(a)&&!this.selected){return this.select()}else{return this.deselect()}},remove:function(a){return this.token_manager.remove(this)},detect:function(d){var b,c,a;c=d.target?d.target:d.srcElement;a=c.token;b=c;while(!(a!=null)&&b.parentNode){b=b.parentNode;a=b.token}return(a!=null)&&a.element===this.element}});TokenManager=Class.create({initialize:function(b,c,a){this.shift_boundary_right_func=c;this.shift_boundary_left_func=a;this.element=b;this.tokens=[];return this.token=null},add:function(a){this.tokens.push(a);return this.element.fire("token:add",a.info)},populate:function(){var g,c,e,d,f,b,a;d=this.element.select(".token");a=[];for(f=0,b=d.length;f<b;f++){e=d[f];g=e.hasClassName("token-warn");c=new Token(e,null,this,{external:g});a.push(this.add(c))}return a},remove:function(c){var b,a;if(!(c!=null)){c=this.token}if(c!=null){a=this.tokens.indexOf(c);this.tokens.splice(a,1);c.element.remove();if(this.token===c&&a<this.tokens.length){this.tokens[a].select()}else{this.token=null;if(this.shift_boundary_right_func!=null){this.shift_boundary_right_func()}}this.element.fire("token:remove",c.info)}b=Tutorial.should_handle_event(Tutorial.events.share_modal_remove_invite_user,{token:c});if(b){return Tutorial.handle_event(Tutorial.events.share_modal_remove_invite_user,{token:c})}},removeAll:function(){var b,d,a,c;c=this.tokens;for(d=0,a=c.length;d<a;d++){b=c[d];b.element.remove();this.element.fire("token:remove",b.info)}return this.tokens.clear()},shift_left:function(){var a;a=this.token?this.tokens.indexOf(this.token):this.tokens.length;if(a>0){if(this.token){this.token.deselect()}return this.tokens[a-1].select()}else{if(this.shift_boundary_left_func!=null){return this.shift_boundary_left_func()}}},shift_right:function(){var a;a=this.tokens.indexOf(this.token);if(this.token){this.token.deselect()}if(a+1<this.tokens.length){return this.tokens[a+1].select()}else{if(this.shift_boundary_right_func!=null){return this.shift_boundary_right_func()}}}});HiddenInput=Class.create({initialize:function(a,c,b){this.element=$(a);this.auto_complete_element=c;this.token_manager=b;return Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(a){switch(a.keyCode){case Event.KEY_LEFT:a.preventDefault();this.token_manager.shift_left();break;case Event.KEY_TAB:a.preventDefault();this.token_manager.shift_right();break;case Event.KEY_RIGHT:a.preventDefault();this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return false}});validate_email=function(a){var b;b=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,6}$","i");return b.test(a)};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,d,g,c,f,b,a){var e;$super(d,g,f,b,a);this.token_manager=new TokenManager(this.element,this.generate_shift_boundary_right_func());this.hidden_input=new HiddenInput(c,this.element,this.token_manager);if(!this.element.hacks){this.element.should_use_borderless_hack=Prototype.Browser.WebKit;this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera;this.element.hacks=true}if(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack){$j(this.element).parent().addClass("tokenizer_input_borderless")}this.options.onShow=function(h,j){$j(j).clonePosition($j(h.parentNode.parentNode),{setHeight:false,setTop:false,setLeft:false});return j.show()};this.options.onHide=function(h,j){return j.hide()};if(DBHistory.get_url().indexOf("/referrals")!==-1){e=$j("#retrieve-contacts-button")}else{e=$j(this.element).closest("form").find(".tokenizer-submit-button")[0]}$j(e).on("mousedown",this.beforeSubmit.bindAsEventListener(this));$j(this.element).on("focus",this.onFocus.bindAsEventListener(this));this.import_links=[];if(!a.hide_import_contacts){if(Constants.shmodal_contact_importer_enabled){this.import_links=$j(".import-contacts-link")}else{this.import_links=$j(".fb-connect-link")}}this.calculate_input_size();this.dynamically_resize_input();this.check_populated();return setInterval(this.check_populated.bind(this),100)},onBlur:function($super,a){$(this.element.parentNode).removeClassName("focused");this.element.up(".tokenizer").removeClassName("focused");return $super(a)},onFocus:function(a){$(this.element.parentNode).addClassName("focused");return this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(a){return this.tokenize_emails_input(true)},clearTokens:function(a){this.token_manager.removeAll();this.calculate_input_size();return this.dynamically_resize_input()},setContacts:function(b,a){this.options.array=b;return this.options.larray=a},getEmails:function(){var b,a;b=$j(this.element).closest("#tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]');return((function(){var e,d,c;c=[];for(e=0,d=b.length;e<d;e++){a=b[e];c.push($j(a).val())}return c})()).join(", ")},check_populated:function(){var b,a;b=$(this.element.parentNode);a=(this.element.value==="")&&(this.token_manager.tokens.length===0);if(b.hasClassName("populated")&&a){return b.removeClassName("populated")}else{if(!b.hasClassName("populated")&&!a){return b.addClassName("populated")}}},clean_email_addr:function(g,c){var f,b,e,a,d;f=["<",">"];d=g.concat(f);for(e=0,a=d.length;e<a;e++){b=d[e];c=c.sub(b,"")}return c.strip()},get_regexp_from_delimiters:function(e){var b,d,c,a;d="";for(c=0,a=e.length;c<a;c++){b=e[c];d+=b+"|"}return new RegExp("["+d+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(d,c,a){var b;b=true;if(a===ContactTypes.EMAIL&&!validate_email(c)){b=false}if(!d&&c){d=c.toString()}return{display:d,value:c,type:a,valid:b}},tokenize_emails_input:function(h,k){var f,m,n,p,c,g,q,l,a,j,e,d,o,b;m=this.options.tokens;l=this.get_regexp_from_delimiters(m);p=this.element.value.split(l);q="";if(!h){j=p[p.length-1];q=this.clean_email_addr(m,j);p=p.slice(0,p.length-1);if(j[j.length-1]===" "){if(validate_email(q)){p.push(q);q=""}}}g=[];for(e=0,o=p.length;e<o;e++){n=p[e];g.push.apply(g,n.split(" "))}p=g;f=false;if(p.length>0){for(d=0,b=p.length;d<b;d++){n=p[d];n=this.clean_email_addr(m,n);if(n){a=this.createTokenInfo(n,n,ContactTypes.EMAIL);if(a.valid){f=true}else{if(k){continue}}this.set_input_size(1);this.addContact(a)}}this.element.value=q}c=this.element.up("form");if(f){Forms.clear_errors(c)}return this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var b,a;b=this.element;a=function(){return b.focus()};return a},set_input_size:function(a){if(!(a!=null)||a<0){a=20}return this.element.setStyle({width:""+a+"px"})},calculate_input_size:function(){if(this.import_links.length){this.import_links_width=this.import_links.width();return this.import_links_visible=this.import_links.is(":visible")}},dynamically_resize_input:function(){var q,c,l,d,e,n,o,r,f,m,b,j,h,p,a,k,g;o=$(this.element.parentNode.parentNode);r=parseInt(o.getStyle("width"),10)-15;m=this.token_manager.tokens;d=false;b=0;for(j=0,p=m.length;j<p;j++){f=m[j];l=f.element;c=parseInt(l.getStyle("width"),10)+parseInt(l.getStyle("margin-right"),10);n=b+c;if(n>r){b=c;d=true}else{if(c>r){b=0;d=true}else{b=n}}}e=r-b;q=this.element.value.length*7;if(q>e){e=r}this.set_input_size(e);if(this.import_links.length&&this.import_links_visible){if(d||r-b-q<1.25*this.import_links_width){this.import_links_visible=false;k=this.import_links;g=[];for(h=0,a=k.length;h<a;h++){l=k[h];g.push($j(l).fadeOut(100))}return g}}},onKeyPress:function(b){var c,a;this.dynamically_resize_input();if(this.active){switch(b.keyCode){case 44:case 188:case 59:case 186:this.reset_observer();return;case Event.KEY_TAB:case Event.KEY_RETURN:if(this.selected_contact_importer_entry()){this.tokenize_emails_input(true);this.hide();Event.stop(b);return}this.selectEntry();this.hide();this.active=false;Event.stop(b);return;case Event.KEY_ESC:this.hide();this.active=false;Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(b);return}}else{this.tokenize_emails_input(false);if(b.keyCode===Event.KEY_TAB||b.keyCode===Event.KEY_RETURN){if(this.element.value&&b.preventDefault){b.preventDefault()}this.tokenize_emails_input(true);return}else{if(this.element.value===""){if((c=b.keyCode)===Event.KEY_LEFT||c===Event.KEY_BACKSPACE){this.token_manager.shift_left()}}else{if((a=b.keyCode)===Event.KEY_LEFT||a===Event.KEY_RIGHT||a===Event.KEY_UP||a===Event.KEY_DOWN){return}}}}this.update_typeahead();return this.reset_observer()},update_typeahead:function(){this.changed=true;return this.hasFocus=true},reset_observer:function(){if(this.observer){clearTimeout(this.observer)}return this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},onObserverEvent:function($super){var b,c,f,e,a,d;if(this.active){f=this.element.value;d=this.options.tokens;for(e=0,a=d.length;e<a;e++){b=d[e];c=f.indexOf(b);if(c!==-1){if(this.selected_contact_importer_entry()){this.tokenize_emails_input(true);this.hide();return}this.element.value=f.substr(0,c);this.selectEntry();this.hide();this.active=false;this.element.value=f.substr(c+1);break}}this.update_typeahead()}this.tokenize_emails_input(false);$super();if(Tutorial.should_handle_event(Tutorial.events.share_modal_type_contact)){return Tutorial.handle_event(Tutorial.events.share_modal_type_contact)}},selected_contact_importer_entry:function(a){var b;if(a==null){a=this.getCurrentEntry()}return a.value===0&&((b=a.id)!=null?b.length:void 0)!==0},selectEntry:function(){var c,b,f,a,d,e;b=this.getCurrentEntry();if(this.selected_contact_importer_entry(b)){f=b.id.split("_")[0];assert(parseInt(f,10)<0,"The 'id-value' of an autocompleter-entry being <0 signifies that it's a contact-importer button");d=EmailProvider.to_name(f);if(Contacts.connected_services[f]){Notify.server_success(_("You're already connected to %(service_name)s").format({service_name:d}));ContactImporter.unshow();return}if(f===EmailProvider.GOOGLE||f===EmailProvider.YAHOO||f===EmailProvider.FACEBOOK){if($j(b).attr("suggestion")==="1"){return Contacts.auth_import(f,"suggestion")}else{return Contacts.auth_import(f)}}else{return assert(false,"Should never get here. entry_value: "+f)}}else{c=this.options.array[b.value];a=c.type===ContactTypes.FB?c.fb_id:c.type===ContactTypes.USER_GROUP?c.group_id:c.email;this.set_input_size(1);e=this.createTokenInfo(c.name.strip(),a,c.type);this.addContact(e);Forms.clear_errors(this.element.up("form"));this.dynamically_resize_input();this.index=0;this.element.focus();if(Tutorial.should_handle_event(Tutorial.events.share_modal_pick_contact)){return Tutorial.handle_event(Tutorial.events.share_modal_pick_contact)}}},addContact:function(a){var k,l,c,h,b,j,e,g,n,d,m,f;this.element.value="";switch(a.type){case ContactTypes.FB:h="fb_ids";l=new Element("img",{src:"/static/images/icons/fb_16.png"});break;case ContactTypes.EMAIL:h="emails";l=new Element("img",{src:"/static/images/icons/email_16.png"});break;case ContactTypes.USER_GROUP:h="group_ids";l=new Element("img",{src:"/static/images/icons/email_16.png"});break;case ContactTypes.INVALID:h="invalids";l=new Element("span",{"class":"hidden"});break;default:assert(false,"should never get here due to type: "+a.type)}j=this.getTokenClass(a);n=new Element("span",{"class":"x "+j,onmouseout:"this.className='x "+j+"'",onmouseover:"this.className='x_hover "+j+"'",onclick:"this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(event); return false;"}).__date(" ");e=new Element("input",{type:"hidden",name:h,value:a.value.toString()});b=new Element("a",{"class":"token "+j,href:"#",tabindex:"-1"});c=new Element("span");f=[e,l,a.display,n];for(d=0,m=f.length;d<m;d++){k=f[d];c.__sert(k)}b.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(c))));$(b).down(5).next().innerHTML="&nbsp;";g=new Token(b,this.hidden_input,this.token_manager,a);this.token_manager.add(g);return $("autocomplete_display").__sert({before:b})},getTokenClass:function(a){if(!a.valid){return"token-error"}return"token-valid"},isTeamOnly:function(){return false}});Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,d,f,c,e,b,a){$super(d,f,c,e,b,a);this.warn_only=!a.team_only;this.setContacts(e,b);this.element.observe("token:remove",this.notifyExternal.bind(this));return this.element.observe("token:add",this.notifyExternal.bind(this))},isTeamOnly:function(){return !this.warn_only},setTeamOnly:function(a){this.warn_only=!a;return this.reloadContacts()},reloadContacts:function(){if(window.contacts){return this.setContacts(window.contacts,window.lcontacts)}else{return Sharing.load_contacts(true)}},setContacts:function(e,c){var a,d,b;this.team_contacts={};if(e){for(d=0,b=e.length;d<b;d++){a=e[d];if(a.team){this.team_contacts[a.email]=1}}}if(e&&!this.warn_only){e=e.filter(function(f){return f.team});c=c.filter(function(f){return f.team})}this.options.array=e;return this.options.larray=c},createTokenInfo:function(e,c,a){var f,d,b;b=true;f=false;if(a===ContactTypes.EMAIL&&!validate_email(c)){b=false}else{if(a===ContactTypes.EMAIL&&!this.team_contacts[c]){b=this.warn_only;f=true}else{if(a===ContactTypes.FB){b=this.warn_only;f=true}}}if(!e&&c){e=c.toString()}return d={display:e,value:c,type:a,valid:b,external:f}},getTokenClass:function(a){if(!a.valid){return"token-error"}if(a.external){return"token-warn"}return"token-valid"},notifyExternal:function(b){var a,c,d;d=b.memo;if(d.external){c=this.token_manager.tokens.filter(function(e){return e.info.external});a=c?c.length:0;return this.element.fire("sf:token:external",{count:a})}}});TeamSharedFolderInviteController=Class.create({initialize:function(b){var a;this.element=b;a=this.element.down(".new-collab-input");return a.observe("sf:token:external",this.handle_external.bind(this))},handle_external:function(b){var a,c;a=b.memo.count;c=this.element.down(".external-invite-message");if(a>1){DomUtil.fillVal(a,"external-invite-num");if(c!=null){c.removeClassName("single")}return c!=null?c.show():void 0}else{if(a===1){if(c!=null){c.addClassName("single")}return c!=null?c.show():void 0}else{return c!=null?c.hide():void 0}}}});ShareShowController=Class.create({initialize:function(c,b){var d,a,e=this;this.ns_id=b;this.invite_form=$("invite-more-form");this.root=this.invite_form.up(".share_show_modal");this.add_message_container=$("add-message-container");this.custom_message_section=$("custom-message-section");this.allow_members_table=$("allow-members-table");this.folder_management_buttons=$("folder-management-buttons");$("sharing-options-new-collab-input").observe("focus",this.toggle_to_invite_mode.bind(this));if((d=$("custom-message-wizard"))!=null){d.observe("focus",this.toggle_to_invite_mode.bind(this))}return(a=this.add_message_container)!=null?a.observe("click",function(f){e.show_message_box(f);return e.toggle_to_invite_mode(f)}):void 0},show_message_box:function(c){var b,a;if((b=this.custom_message_section)!=null){b.show()}return(a=this.add_message_container)!=null?a.hide():void 0},hide_message_box:function(c){var b,a;if((b=this.custom_message_section)!=null){b.hide()}return(a=this.add_message_container)!=null?a.show():void 0},show_folder_settings:function(a){var b;Event.stop(a);b={ns_id:namespace_id,folder_name:PAGE_PATH};new UIRequest(a.target,"/share_ajax/folder_settings",b,function(){return Modal.onHide=Sharing.reshow});return false},toggle_from_invite_mode:function(){this.allow_members_table.hide();this.folder_management_buttons.show();this.hide_message_box();return this.invite_form.addClassName("collapsed")},toggle_to_invite_mode:function(){this.allow_members_table.show();this.folder_management_buttons.hide();return this.invite_form.removeClassName("collapsed")},set_team_only:function(c){var b,a;a=this.invite_form.down(".external-invite-message");b=this.root.down(".member-info .folder-settings");if(c){this.invite_form.addClassName("team-only");a.addClassName("team-only");return b.addClassName("team-only")}else{this.invite_form.removeClassName("team-only");a.removeClassName("team-only");return b.removeClassName("team-only")}},get_ns_id:function(){return this.ns_id}});TeamExternalShareConfirm=Class.create({initialize:function(b){var a;this.root=b;a=this.root.down(".token-container");this.token_manager=new TokenManager(a);this.token_manager.populate();return a.observe("token:remove",this.remove.bind(this))},remove:function(c){var b,d,a;if(!this.token_manager.tokens.length){return this.root.addClassName("no-recipients")}else{if(c.memo.external){d=this.token_manager.tokens.filter(function(e){return e.info.external});b=d?d.length:0;a=this.root.down(".external_prompt");if(b===0){return a.hide()}else{if(b===1){return a.addClassName("single")}else{return DomUtil.fillVal(b,"external_member_count")}}}}}});var Links,RecentLinks,SharingModel,ShmodalPanes;RecentLinks={SNIPPET_LENGTH:30,THUMBS_BATCH_SIZE:16,_tmpl:null,init:function(a){this.links=a;this._toggle_loading();this._tmpl=HTML.tmpl("recent_links_list_item_tmpl");this._get_list();this._listen();if(!HTML5_HISTORY&&!window.location.hash){this._history_change(null)}$j("#no-recent-links").css("display","");return $j("#no-created-links").css("display","")},_history_change:function(a,b){if(a==="from_others"){return $j("#links-view").removeClass("your-links").addClass("recent-links")}else{return $j("#links-view").removeClass("recent-links").addClass("your-links")}},_toggle_loading:function(){return $j("#recent-links-content").toggleClass("loading")},_listen:function(){$j("#recent-links-tab").on("click",this._recent_links_click);$j("#your-links-tab").on("click",this._your_links_click);DBHistory.add_callback("/links",$j.proxy(this._history_change,this));return $j(document.body).on("click","#recent-links-list .remove-recent-link",$j.proxy(this._do_remove,this))},_get_list:function(){var a=this;return new Ajax.DBRequest("/links/recent_links",{onSuccess:function(b){return a._render(Util.from_json(b.responseText))}})},_recent_links_click:function(a){a.preventDefault();return DBHistory.push_state("/links/from_others")},_your_links_click:function(a){a.preventDefault();return DBHistory.push_state("/links/your_links")},_render:function(a){var c,d,f,e,b;if(!a.length){$j("#recent-links-content").addClass("empty-list")}c=[];for(e=0,b=a.length;e<b;e++){d=a[e];c.push(this._tmpl({link:d}))}c=$j.map(c,function(g){return g.toHTML()});$j("#recent-links-list").html(c.join(""));f=function(g){if(!g.src.endsWith(Sprite.SPACER)){return g.addClassName("thumbnail")}};BatchThumbLoader.batch_load_thumbs($$("#recent-links-list img"),this.THUMBS_BATCH_SIZE,f);return this._toggle_loading()},_do_remove:function(d){var b,a,c,f=this;d.preventDefault();a=$j(d.currentTarget);c=a.attr("data-tkey");b=a.closest(".link");return new Ajax.DBRequest("/links/remove_recent_link",{parameters:{tkey:c},onSuccess:function(g){var e;Notify.clear_all();e=b.attr("title").em_snippet(f.SNIPPET_LENGTH);switch(g.responseText.strip()){case"OK":Notify.server_success(_("Removed '"+e+"'"));return f._remove_link_elm(b);case"INVALID":Notify.server_error(_("'"+e+"' has already been removed"));return f._remove_link_elm(b);default:return Notify.server_error(_("There was a problem removing '"+e+"'"))}}})},_remove_link_elm:function(a){a.remove();if($j("#recent-links-list .link").length===0){return $j("#recent-links-content").addClass("empty-list")}}};Links={SNIPPET_LENGTH:30,THUMBS_BATCH_SIZE:16,_tmpl:null,init:function(b){var c,d,a;for(d=0,a=b.length;d<a;d++){c=b[d];assert(c.encoded_sort_key&&!(c.sort_key!=null),"expected encoded sort key on each elm");c.sort_key=Util.decode_sort_key(c.encoded_sort_key);delete c.encoded_sort_key}this._state={links:b,cmp:this._created_cmp,is_ascending:false};this.listen();this._tmpl=HTML.tmpl("links_list_item_tmpl");return this._render()},listen:function(){var a,b=this;$("links-view").on("click","a.remove-link",function(j,d){var c,f,h,g;Event.stop(j);c=d.readAttribute("data-filename");g=d.readAttribute("data-tkey");h=parseInt(d.readAttribute("data-is-dir"),10);f=parseInt(d.readAttribute("data-is-album"),10);return SharingModel.confirm_remove(c,g,h,f)});document.observe(FileEvents.LINKS_REMOVE,function(k){var g,h,d,l,f,j,c;f=k.memo.token;d=b._state.links;assert(f,"LINKS_REMOVE without token");for(g=j=0,c=d.length;j<c;g=++j){h=d[g];if(h.tkey===f){l=g}}assert(l!=null,"LINK_REMOVE w/o DOM elm");d.splice(l,1);$$("#links-list li.link")[l].remove();return b._empty_check()});a="#links-sort a.sort-option";$("links-sort").on("click","a.sort-option",function(f,d){var c,g;Event.stop(f);g={LINKS_BY_NAME:b._name_cmp,LINKS_BY_CREATED:b._created_cmp};c=g[d.readAttribute("data-sort")];if(b._state.cmp===c){b._state.is_ascending=!b._state.is_ascending}else{b._state.cmp=c;b._state.is_ascending=true}Util.add_sort_arrow_mouseover(d,b._state.is_ascending,a,true);return b._render()});return Util.add_sort_arrow_mouseover($("created-sorter"),this._state.is_ascending,a,false)},_render:function(){var f,b,g,j,a,d,c,h,e=this;f=function(k,m){var l;l=e._state.is_ascending?1:-1;return l*e._state.cmp(k,m)};b=[];j=this._state.links;j.sort(f);for(c=0,h=j.length;c<h;c++){g=j[c];if(g.is_album){d=_("Unshare album")}else{d=_("Remove")}b.push(this._tmpl({link:g,remove_str:d}))}$("links-list").__date(b);a=function(k){if(!k.src.endsWith(Sprite.SPACER)){return k.addClassName("thumbnail")}};BatchThumbLoader.batch_load_thumbs($$("#links-list img"),this.THUMBS_BATCH_SIZE,a);return this._empty_check()},_empty_check:function(){if(this._state.links.length){return $("links-view").removeClassName("empty-list")}else{return $("links-view").addClassName("empty-list")}},_name_cmp:Util.sort_by_rank_or_key,_created_cmp:function(a,b){return a.created_ts-b.created_ts}};ShmodalPanes={SEND:0,FB:1,TWITTER:2,list:[0,1,2],_content_str:["shmodal-send-content","shmodal-fb-content","shmodal-twitter-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle","shmodal-twitter-toggle"],_title_str:["Share by Email",_("Share on Facebook"),_("Share on Twitter")],_focus_str:["shmodal-new-collab-input","shmodal-fb-post-input","shmodal-twitter-post-input"],to_content_str:function(a){return this._content_str[a]},to_toggle_str:function(a){return this._toggle_str[a]},to_title_str:function(a){if(a===0){return SharingModel._get_shmodal_title_text()}return this._title_str[a]},to_focus_str:function(a){return this._focus_str[a]}};SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,filename:null,c2d_vars:{},is_folder:false,is_album:false,gallery_enabled:false,gallery_showing:false,preview_objs:[],send_link_autocompleter:null,init:function(b,a){var c=this;this.filename=b;this.c2d_vars=a;this.init_logger();window.contacts=false;window.lcontacts=false;return on_script_loaded(function(){var h,e,d,g,f;h=$("login-create-an-account");if(h){h.writeAttribute("href","/register?signup_tag=shmodel")}scrollTo(1,0);scrollTo(0,0);if((e=$("c2d-form"))!=null){e.observe("submit",c.do_c2d.bind(c))}if((d=$("c2d-register-form"))!=null){d.observe("submit",c.c2d_register.bind(c))}if((g=$("c2d-login-form"))!=null){g.observe("submit",c.c2d_login.bind(c))}if((f=$("c2d-twofactor-login-form"))!=null){f.observe("submit",c.c2d_twofactor_login.bind(c))}return c.set_viewport_size()})},init_folder:function(a,c,b){var d=this;this.gallery_enabled=a;this.gallery_showing=c;this.is_folder=true;this.init_lightbox(b);return on_script_loaded(function(){return d.load_thumbs()})},init_album:function(){this.is_album=true;this._resize_album_view();return Event.observe(window,"resize",this._resize_album_view.bind(this))},init_file:function(){this.is_folder=false;if(!this.c2d_vars.subpath&&!(this.c2d_vars.item_id!=null)&&!this.c2d_vars.is_package){return this.c2d_vars.subpath="/"+this.filename}},init_logger:function(){var a=this;on_script_loaded(function(){var b;b=$("login-hover-link");if(b){b.observe("click",function(){return ShmodelLogger.log("click_sign_in")});b.observe("click",function(){return RegistrationLogger.log("click_sign_in")})}if($("download_button_link")){ShmodelLogger.attachLogListener("click_download",$("download_button_link"))}b=$("add_to_my_dropbox_link");if(b){ShmodelLogger.attachLogListener("click_add_to_my_dropbox",b);RegistrationLogger.attachLogListener("click_add_to_my_dropbox",b)}if($$(".remove-link").length){ShmodelLogger.attachLogListener("remove_link",$$(".remove-link")[0])}if($$(".shmodel-filename").length){ShmodelLogger.attachLogListener("click_filename",$$(".shmodel-filename")[0])}if($("default_content_download_button")){ShmodelLogger.attachLogListener("click_download",$("default_content_download_button"))}if($("default_content_a2md")){return ShmodelLogger.attachLogListener("click_add_to_my_dropbox",$("default_content_a2md"))}});return document.observe(Lightbox.ACTIONS_ADDED,function(){var d,c,b;b=$("view_original");if(b){ShmodelLogger.attachLogListener("shmodel_lightbox_click_vieworiginal",b)}c=$("lightbox_shmodel_link");if(c){ShmodelLogger.attachLogListener("shmodel_lightbox_click_getlink",c)}d=$("lightbox_download_link");if(d){return ShmodelLogger.attachLogListener("shmodel_lightbox_click_download",d)}})},init_lightbox:function(b){var e,d,c,a,f=this;for(c=0,a=b.length;c<a;c++){e=b[c];if(e.is_video){d=new VideoPreview(e.filename,e.path,e.thumbnail_url,e.preview_url,Util.add_qstring(e.orig_url,{dl:"1"}),null,e.shmodel_link,e.ns_id,e.ns_path)}else{d=new PhotoPreview(e.filename,e.path,e.thumbnail_url,Util.add_qstring(e.orig_url,{dl:"1"}),e.orig_url,null,e.shmodel_link,e.ns_id,e.ns_path)}this.preview_objs.push(d)}Lightbox.init(this.preview_objs,{include_delete:false,keep_url:true,filename_in_url:true});return document.observe(Lightbox.EXIT_SELECT_EVT,function(h){var g;key.setScope("all");g=$("gallery-view-media").childElements()[f.preview_objs.indexOf(h.memo)];Util.scroll_to_thumb(g);g.addClassName("wiggobble");return setTimeout((function(){return g.removeClassName("wiggobble")}),1000)})},_resize_album_view:function(){var a;a=Math.floor((Util.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE;return $("content-wrapper").setStyle({display:"block",width:""+a+"px"})},load_thumbs:function(){var b,a;a=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon");b=function(c){if(!c.src.endsWith(Sprite.SPACER)){return c.addClassName("thumbnail")}};return BatchThumbLoader.batch_load_thumbs(a,this.THUMBS_BATCH_SIZE,b)},switch_mode:function(g){var c,h,f,a,e,b,d;d=$A(["gallery","list"]);for(e=0,b=d.length;e<b;e++){a=d[e];h=$(a+"-view-container");c=$(a+"-toggle");if(g===a){h.show();c.addClassName("selected")}else{h.hide();c.removeClassName("selected")}}if(history.replaceState){f=window.location.pathname;if(g==="list"){f+="?lst"}history.replaceState({},"",f)}this.gallery_showing=!this.gallery_showing;this.load_thumbs();if(Tutorial.should_handle_event(Tutorial.events.shmodel_folder_switch_view_mode)){return Tutorial.handle_event(Tutorial.events.shmodel_folder_switch_view_mode)}},set_viewport_size:function(){var a;if($(document.body).hasClassName("mobile")){a=new Element("meta",{name:"viewport",content:"width = 480"});return document.head.appendChild(a)}},toggle_dropdown:function(d,f,c){var a,b;if(d){Event.extend(d).preventDefault()}if(!f.visible()){if(this.is_album){return FreshDropdown.show(f,c)}else{b=$$(".nav-header").first().getHeight();a=$$(".nav-header .buttons").first().cumulativeOffset().top;if(a<0&&Util.ie8){a=8}return FreshDropdown.show(f,c,b-a)}}},confirm_remove:function(b,g,c,e,f){var d,a,h;if(c==null){c=false}if(e==null){e=false}if(f==null){f=false}assert(g,"confirm_remove missing tkey");assert(b,"confirm_remove missing name");if(e){h=f?_("Unshare?"):_("Unshare album?");d=$("album-disable-token-modal");DomUtil.fillVal(b,"album_unshare_name")}else{h=_("Remove link to '%(name)s'").format({name:b.snippet(34)});d=$("disable-token-modal");if(c){a=_("Are you sure you want to remove this link? Once the link is removed, nobody else will be able to view this folder.")}else{a=_("Are you sure you want to remove this link? Once the link is removed, nobody else will be able to view this file.")}DomUtil.fillVal(a,"disable-token-desc")}return Modal.icon_show("alert_32",h,d,{token:g,name:b,is_album:e})},do_remove:function(a){var b,c=this;if((b=window.location.pathname)==="/links"||b==="/links/your_links"){new Ajax.DBRequest("/sm/disable/"+a.token,{onSuccess:function(){var d;Modal.hide();if(a.is_album){d=_("Unshared '%(name)s'")}else{d=_("Removed link for '%(name)s'")}d=d.format({name:a.name});Notify.server_success(d);return document.fire(FileEvents.LINKS_REMOVE,{token:a.token})},onComplete:function(){return Forms.remove_loading()}})}else{Forms.postRequest("/sm/disable/"+a.token)}return Forms.add_loading($("modal-content").down("input"))},get_token:function(a,b){var c=this;return new Ajax.DBRequest("/sm/get"+Util.normalize(a),{onSuccess:function(e){var d;d=e.responseText.evalJSON(true);if(b){return b(d)}}})},show_shmodal_onload:function(b,c,a){var d=this;return Util.smartLoad(function(){var e;if(HTML5_HISTORY){e=DBHistory.deconstruct_url();delete e.qargs.m;DBHistory.replace_state(e.path,e.qargs)}if(Constants.EMAIL_VERIFIED){return d.show_shmodal(b,c,a)}})},show_shmodal:function(b,g,a){var j,l,h,c,d,k,e,f=this;this.url=b;this.short_url=g;if(EmailVerification.verified()){Modal.show(this._get_shmodal_title(),DomUtil.fromElm($("shmodal")).stripScripts());if(this._get_thumbnail_type()){e=$$(".shmodal-image");for(d=0,k=e.length;d<k;d++){h=e[d];h.addClassName("thumbnail")}}if(a==="contacts"){l=Autocompleter.ContactsTokenizer}else{l=Autocompleter.TeamTokenizer}this.send_link_autocompleter=new l("shmodal-new-collab-input","shmodal-new-whobulk","shmodal-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true,team_only:a==="team_only"});this.configure_dropdown();if(FlashDetect.installed){c=Util.copy_to_clipboard_swf(b,"shmodal-copy-link","SharingModel.copied_to_clipboard");$(c).up().style.zIndex="1001";clearInterval(this.follow_freshbutton);j=function(){return $j("#"+c).parent().clonePosition($j("#shmodal-copy-link"),{offsetHeight:6,offsetWidth:6})};this.follow_freshbutton=setInterval(j,500)}else{$("shmodal-copy-link").hide()}SickInput._create($("modal").down(".custom-message-container"));SickInput._create($("modal").down(".fb-post-sickinput"));SickInput._create($("modal").down(".twitter-post-sickinput"));this._populate_twitter_info(g);$("shmodal-new-collab-input").focus();return ShmodelLogger.log("shmodal_show")}},configure_dropdown:function(){var f,b,d,a,c,e=this;c=$$(".dropdown-menu-container");for(d=0,a=c.length;d<a;d++){f=c[d];b=f.down(".dropdown-menu-trigger");if(b!=null){b.observe("click",function(h){var g;g=h.target.up(".dropdown-menu-container");return g.toggleClassName("dropdown-shown")})}}return document.on("click",function(m){var k,l,j,g,h;if(m.target.hasClassName("dropdown-menu-trigger")||m.target.up(".dropdown-menu-trigger")){return}g=$$(".dropdown-shown");h=[];for(l=0,j=g.length;l<j;l++){k=g[l];h.push(k.removeClassName("dropdown-shown"))}return h})},copied_to_clipboard:function(){Notify.server_success(_("Link copied to clipboard"));Modal.hide();return ShmodelLogger.log("shmodal_copy_link")},get_shmodel_send_recipients:function(c){var d,k,l,m,h,a,f,e,j,b,g;assert(c,"Must pass the shmodal send form into get_shmodel_send_recipients");d=c.select('input[name="emails"]');k=c.select('input[name="fb_ids"]');a=[];g=[d,k];for(f=0,j=g.length;f<j;f++){m=g[f];for(e=0,b=m.length;e<b;e++){l=m[e];h=l.up().innerHTML.stripTags().escapeHTML();a.push(h.substring(0,h.indexOf("&")))}}return a},send_shmodel_link:function(d){var c,b,f,a,g=this;c=$("shmodal-send-form");assert(c,"Couldn't find the shmodal send form.");a=this.get_shmodel_send_recipients(c);f=function(e){var h;if(a.length===1){if(a[0].indexOf("@")===-1){h=_("Sent to %(recipient)s").format({recipient:a[0]})}else{h=_("Sent to %(recipient)s").format({recipient:a[0]})}}else{if(a.length===2){if(a[0].indexOf("@")===-1){if(a[1].indexOf("@")===-1){h=_("Sent to %(recipient_first)s and %(recipient_second)s").format({recipient_first:a[0],recipient_second:a[1]})}else{h=_("Sent to %(recipient_first)s and %(recipient_second)s").format({recipient_first:a[0],recipient_second:a[1]})}}else{if(a[1].indexOf("@")===-1){h=_("Sent to %(recipient_first)s and %(recipient_second)s").format({recipient_first:a[0],recipient_second:a[1]})}else{h=_("Sent to %(recipient_first)s and %(recipient_second)s").format({recipient_first:a[0],recipient_second:a[1]})}}}else{if(a[0].indexOf("@")===-1){h=_("Sent to %(recipient)s and %(num_others)s others").format({recipient:a[0],num_others:a.length-1})}else{h=_("Sent to %(recipient)s and %(num_others)s others").format({recipient:a[0],num_others:a.length-1})}}}Notify.server_success(h);Modal.hide();return ShmodelLogger.log("shmodal_send")};b=function(e){return Forms.remove_loading()};return Forms.ajax_submit(c,"/sm/share",f,b,c.down(".tokenizer-submit-button"))},show_content:function(b){var e,d,a,c;$("shmodal-title-text").__date(ShmodalPanes.to_title_str(b));c=ShmodalPanes.list;for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){$(ShmodalPanes.to_toggle_str(e)).removeClassName("toggled");$(ShmodalPanes.to_content_str(e)).hide()}}$(ShmodalPanes.to_content_str(b)).show();$(ShmodalPanes.to_toggle_str(b)).addClassName("toggled");return $(ShmodalPanes.to_focus_str(b)).focus()},show_send_content:function(){return this.show_content(ShmodalPanes.SEND)},show_fb_content:function(){return this.show_content(ShmodalPanes.FB)},show_twitter_content:function(){return this.show_content(ShmodalPanes.TWITTER)},start_fb_post:function(a){if(FacebookOAuth.has_authed){return this.do_fb_post(a)}else{return FacebookOAuth.do_auth(this.do_fb_post.curry(a))}},start_twitter_post:function(){if(Twitter.has_authed){return this.do_twitter_post()}else{return Twitter.do_auth(this.do_twitter_post)}},do_fb_post:function(a){FacebookOAuth.custom_show_posting=function(){return Forms.add_loading($("shmodal-fb-post-submit"))};FacebookOAuth.custom_show_complete=function(){Modal.hide();Notify.server_success(_("Successfully posted to Facebook"));return ShmodelLogger.log("shmodal_fb_post")};return FacebookOAuth.post($F("shmodal-fb-post-input"),a)},do_twitter_post:function(){var a,b=this;a=$F("shmodal-twitter-post-input");if(!a){Notify.server_error(_("Please enter a Twitter post"));return}else{if(a.length>140){Notify.server_error(_("Your post must be 140 characters or less"));return}}Twitter.custom_show_posting=function(){$("twitter-chars").hide();return Forms.add_loading($("shmodal-twitter-post-submit"))};return Twitter.custom_post(a,function(){Modal.hide();Notify.server_success(_("Successfully posted to Twitter"));return ShmodelLogger.log("shmodal_tweet")})},_get_shmodal_title:function(){var a=this;return this.generate_title_content(this._get_shmodal_title_text(),(function(){return a.show_send_content()}),(function(){return a.show_fb_content()}),(function(){return a.show_twitter_content()}))},generate_title_content:function(a,f,c,j){var b,e,k,g,d,h;d=new Element("div",{id:"shmodal-title-text"});d.__date(a);k=new Element("a",{id:"shmodal-send-toggle","class":"freshtoggle ft-left toggled"});k.__date(Sprite.make("web","email_20"));k.observe("click",f);e=new Element("a",{id:"shmodal-fb-toggle","class":"freshtoggle ft-middle"});e.__date(Sprite.make("web","fb_20"));e.observe("click",c);h=new Element("a",{id:"shmodal-twitter-toggle","class":"freshtoggle ft-right"});h.__date(Sprite.make("web","twitter_20"));h.observe("click",j);b=new Element("div",{"class":"clear"});g=new Element("div",{id:"shmodal-title"});g.__sert(d);g.__sert(k);g.__sert(e);g.__sert(h);g.__sert(b);return g},_get_shmodal_title_text:function(){var b,a;if(this.is_folder){b=_("Share link to '%(folder_name)s'");return b=b.format({folder_name:this.filename.em_snippet(15)})}else{a=this._get_thumbnail_type();if(a){return _("Share this %(type)s").format({type:a})}else{return _("Share '%(filename)s'").format({filename:this.filename.em_snippet(18)})}}},_get_thumbnail_type:function(){var b,a;if(this.filename.indexOf(".")===-1){return false}a=FileOps.file_extension(this.filename).toLowerCase();b=BrowseFile.EXTENSION_TO_CATEGORY[a];if(b&&(b==="IMAGE"||b==="VIDEO")){return BrowseFile.CATEGORY_TO_TRANSLATION[b]}return false},_populate_twitter_info:function(b){var c,a;c=this.is_folder?_("Just shared some files using @Dropbox"):(a=this._get_thumbnail_type(),a&&a===BrowseFile.CATEGORY_TO_TRANSLATION.IMAGE?_("Just shared an image using @Dropbox"):_("Just shared a file using @Dropbox"));$("shmodal-twitter-post-input").setValue(c+" "+b);Util._track_twitter_chars_left("shmodal-twitter-post-input",140);if(Twitter.has_authed){return Twitter.get_user_info(function(d){$("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:d.profile_image_url_https}));$("shmodal-twitter-profile").down(".name").__date(d.name);$("shmodal-twitter-profile").down(".username").__date("@"+d.screen_name);$("modal").down(".twitter-post-sickinput").addClassName("shrank");return $("shmodal-twitter-profile").show()})}},show_c2d_modal:function(){var c,b,f,e,d,a;if(this.is_album){e=_("Copy '%(filename)s' to my Dropbox");DomUtil.fillVal(_("The photos and videos in this album will be instantly copied to your Dropbox and downloaded to all the computers linked to your account."),"c2d-desc");DomUtil.fillVal(_("Once you register for Dropbox, the photos and videos in this album will be instantly copied to your Dropbox and downloaded to all the computers linked to your account."),"c2d-create-account-desc");DomUtil.fillVal(_("Once you sign in to Dropbox, the photos and videos in this album will be instantly copied to your Dropbox and downloaded to all the computers linked to your account."),"c2d-login-desc");if((d=$("c2d-submit-button"))!=null){d.setValue(_("Copy photos to my Dropbox"))}}else{e=_("Add '%(filename)s' to my Dropbox");if(this.is_folder){b=_("This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");c=_("Once you register for Dropbox, this folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");f=_("Once you sign in to Dropbox, this folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")}else{b=_("This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");c=_("Once you register for Dropbox, this file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");f=_("Once you sign in to Dropbox, this file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")}DomUtil.fillVal(b,"c2d-desc");DomUtil.fillVal(c,"c2d-create-account-desc");DomUtil.fillVal(f,"c2d-login-desc");if((a=$("c2d-submit-button"))!=null){a.setValue(_("Add to my Dropbox"))}}e=e.format({filename:this.filename.snippet(30)});return Modal.icon_show("dropbox_32",e,$("c2d-modal"))},c2d_register:function(b){var a,c,d=this;b.preventDefault();a=$("c2d-register-form");c=function(f){var e;e=Util.from_json(f.responseText);Constants.TOKEN=e.csrf_token;return d.do_c2d()};return Forms.ajax_submit(a,"/ajax_register",c,false,$(a).down("input[type=submit]"))},c2d_login:function(c){var b,a,d,f=this;c.preventDefault();b=$("c2d-login-form");d=function(g){var e;e=Util.from_json(g.responseText);switch(e.status){case"OK":Constants.TOKEN=e.csrf_token;return f.do_c2d();case"TWOFACTOR":return f.show_c2d_twofactor(e.last_four_digits)}};a=this.c2d_show_twofactor_error500.bind(this);return Forms.ajax_submit(b,"/ajax_login",d,a,$(b).down("input[type=submit]"))},show_c2d_twofactor:function(a){$("c2d-login").hide();if(a){$("c2d-twofactor-login").addClassName("sms");DomUtil.fillVal(a,"last-four-digits")}else{$("c2d-twofactor-login").removeClassName("sms")}$("c2d-resend-link").observe("click",this.c2d_resend_phone_code.bind(this));return $("c2d-twofactor-login").show()},hide_c2d_twofactor:function(){$("c2d-twofactor-login").hide();return $("c2d-login").show()},c2d_resend_phone_code:function(){var a=this;if(this.c2d_is_resending()){return}this.c2d_show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(b){switch(b.responseText.strip()){case"OK":return Notify.server_success(_("We sent you another code. Keep in mind that it might take a few minutes."));case"UNREACHABLE":return a.c2d_show_twofactor_error_unreachable();case"BADCARRIER":return a.c2d_show_twofactor_error_bad_carrier();case"INVALIDNUMBER":return a.c2d_show_twofactor_error_invalid_number();case"NOTAMOBILE":return a.c2d_show_twofactor_error_not_a_mobile();case"EXPIRED":a.hide_c2d_twofactor();return Notify.server_error(_("Sorry, your phone code has expired. Please log in again."))}},onFailure:this.c2d_show_twofactor_error500.bind(this),cleanUp:this.c2d_hide_resending_with_delay.bind(this)})},c2d_twofactor_login:function(c){var b,a,d,f=this;c.preventDefault();if(!$("c2d-twofactor-code").getValue()){this.c2d_show_twofactor_error_invalid();return}b=$("c2d-twofactor-login-form");d=function(g){var e;e=Util.from_json(g.responseText);switch(e.status){case"OK":Constants.TOKEN=e.csrf_token;return f.do_c2d();case"INVALID":return f.c2d_show_twofactor_error_invalid();case"EXPIRED":f.hide_c2d_twofactor();return Notify.server_error(_("Sorry, your phone code has expired. Please log in again."))}};a=this.c2d_show_twofactor_error500.bind(this);return Forms.ajax_submit(b,"/ajax_verify_code",d,a)},do_c2d:function(a){var b=this;if(a!=null){a.preventDefault()}Modal.hide();return new Ajax.DBRequest("/sm/c2d",{parameters:this.c2d_vars,job:this.is_folder,progress_text:_("Copying to your Dropbox..."),onSuccess:function(c){if(c.responseText&&c.responseText[0]==="/"){return window.location.href=c.responseText}}})},c2d_show_twofactor_error:function(b){var a;a=$("c2d-twofactor-error");a.__date(b);return a.show()},c2d_hide_twofactor_error:function(a){return $("c2d-twofactor-error").__date()},c2d_show_twofactor_error500:function(){return this.c2d_show_twofactor_error(_("Sorry, an error occured. Please try again later."))},c2d_show_twofactor_error_bad_carrier:function(){return this.c2d_show_twofactor_error(_("Unfortunately, your carrier is not supported at this time."))},c2d_show_twofactor_error_invalid_number:function(){return this.c2d_show_twofactor_error(_("That is not a valid phone number."))},c2d_show_twofactor_error_not_a_mobile:function(){return this.c2d_show_twofactor_error(_("That phone number does not appear to be a valid mobile number."))},c2d_show_twofactor_error_unreachable:function(){return this.c2d_show_twofactor_error(_("We couldn't reach your phone number. Are you sure it's correct?"))},c2d_show_twofactor_error_invalid:function(){return this.c2d_show_twofactor_error(_("Invalid code."))},c2d_is_resending:function(){return $("c2d-resend-link").hasClassName("resending")},c2d_show_resending:function(){return $("c2d-resend-link").addClassName("resending")},c2d_hide_resending:function(){return $("c2d-resend-link").removeClassName("resending")},c2d_hide_resending_with_delay:function(){return setTimeout(this.c2d_hide_resending.bind(this),3000)}};var Foshmodal,FoshmodalPanes;FoshmodalPanes=Object.clone(ShmodalPanes);FoshmodalPanes.to_title_str=function(){var a,b,f,d,e,c;if(Foshmodal.sharing_collection){d=Foshmodal.collection_to_share.name.em_snippet(18,1);return _("Share '%(snippeted_name)s'").format({snippeted_name:d})}else{a=Foshmodal._selection;c=PhotosUtil.categorize_files(a),b=c[0],f=c[1];if(b&&f){e=ungettext("Share %(file_count)s item","Share %(file_count)s items",a.length)}else{if(b){e=ungettext("Share %(file_count)s photo","Share %(file_count)s photos",a.length)}else{e=ungettext("Share %(file_count)s video","Share %(file_count)s videos",a.length)}}e=e.format({file_count:a.length});return e}};Foshmodal={current_shmodel_url:null,current_short_url:null,callback_for_when_we_have_shmodel_url:null,current_foshmodal_pane:FoshmodalPanes.SEND,send_link_autocompleter:null,sharing_collection:false,num_photos_to_share:null,working:false,collection_to_share:null,have_real_tkey:false,current_tkey:null,current_album_name:null,previous_album_name:null,_selection:null,lock:function(){if(this.working){return false}this.working=true;return this.working},unlock:function(){return this.working=false},clear_message_inputs:function(){$("shmodal-send-content").down(".custom-message-container").down(".textinput").setValue("");$("shmodal-fb-post-input").setValue("");return $("shmodal-twitter-post-input").setValue("")},refresh:function(){this.current_shmodel_url=null;this.current_short_url;this.callback_for_when_we_have_shmodel_url=null;this.current_foshmodal_pane=FoshmodalPanes.SEND;this.sharing_collection=false;this.have_real_tkey=false;this.current_tkey=null;this.current_album_name=null;this.previous_album_name=null;PhotosSelection.clear();this.clear_message_inputs();this.send_link_autocompleter.clearTokens();this.unlock();$j(".link-image").attr("src","static/images/empty_album_big.png");Forms.remove_loading($j("#modal").find(".tokenizer-submit-button")[0]);Forms.remove_loading($j("#modal").find(".foshmodal-copy-link")[0]);Forms.remove_loading($j("#shmodal-twitter-post-submit")[0]);return Forms.remove_loading($j("#shmodal-fb-post-submit")[0])},create_album_from_selected_photos:function(a){assert(this._selection.length,"This should never be called with an empty selection");assert(this.current_tkey!=null,"Missing tkey");assert(this.current_shmodel_url!=null,"Missing shmodel url");assert(this.current_short_url!=null,"Missing short url");assert(a!=null,"Missing valid collection");a.share_tkey=this.current_tkey;a.shmodel_url=this.current_shmodel_url;a.short_url=this.current_short_url;if(this.creating_anonymous_collection()){a.is_anonymous=true;PhotosCollections._anonymous_collections.unshift(a)}else{a.is_anonymous=false;PhotosCollections._collections.unshift(a)}PhotosCollections._gid_to_collection[a.gid]=a;return PhotosCollections.refresh_album_views()},update_collection_to_share:function(){this.collection_to_share.share_tkey=this.current_tkey;this.collection_to_share.shmodel_url=this.current_shmodel_url;this.collection_to_share.short_url=this.current_short_url;PhotosCollections.refresh_collection(this.collection_to_share);$("single-collection-share-status").__date(_("Shared"));return $("single-collection-share-status").writeAttribute("href",this.current_shmodel_url)},set_shmodel_url:function(c,a){var b=this;if(this.have_real_tkey){this.current_shmodel_url=this.collection_to_share.shmodel_url;this.current_short_url=this.collection_to_share.short_url;this.current_tkey=this.collection_to_share.share_tkey;return typeof c==="function"?c():void 0}else{return new Ajax.DBRequest("/collection_create_dummy_token",{onSuccess:function(e){var d;d=Util.from_json(e.responseText);b.current_shmodel_url=d.token_link;b.current_short_url=d.short_link;b.current_tkey=d.tkey;if(typeof c==="function"){c()}return typeof b.callback_for_when_we_have_shmodel_url==="function"?b.callback_for_when_we_have_shmodel_url():void 0},onFailure:function(){return typeof a==="function"?a():void 0}})}},attach_collection_to_token:function(h,a){var d,b,f,e,c,g=this;assert(((c=this.collection_to_share)!=null?c.gid:void 0)!=null,"Should get called only when there is an existing collection");assert(this.current_shmodel_url!=null,"Should have a shmodel url before you call attach_collection_to_token");if(this.have_real_tkey){if(typeof h==="function"){h(this.collection_to_share.gid)}return}assert(this.current_tkey!=null,"should have tkey");f=function(){g.update_collection_to_share();return typeof h==="function"?h():void 0};b=function(){return typeof a==="function"?a():void 0};d=function(){return Modal.hide()};e={tkey:this.current_tkey,collection_gid:this.collection_to_share.gid,num_items:this.collection_to_share.num_photos};return new Ajax.DBRequest("/collection_attach_to_dummy_token",{onSuccess:f,onFailure:b,parameters:e})},create_collection_and_attach_to_token:function(g,a){var c,e,d,b,f=this;assert(this.sharing_collection===false,"Should not get called when we already have a collection");assert(this.current_shmodel_url!=null,"Should have a shmodel url before you call create_collection_and_attach_to_token");e=function(h){var j;j=Util.from_json(h.responseText);f.create_album_from_selected_photos(j);return typeof g==="function"?g(j.gid):void 0};c=function(h){return typeof a==="function"?a(h):void 0};d={tkey:this.current_tkey,collection_name:this.creating_anonymous_collection()?"":this.current_album_name,is_anonymous:this.creating_anonymous_collection(),is_all_photos:Photos._is_all_photos};if(d.is_all_photos){d.item_counters=Util.to_json((function(){var l,j,k,h;k=this._selection;h=[];for(l=0,j=k.length;l<j;l++){b=k[l];h.push(b.item_counter)}return h}).call(this));if(Photos.in_single_collection_view()){d.source_collection_gid=Photos.get_current_collection().gid}}else{d.fq_paths=Util.to_json((function(){var l,j,k,h;k=this._selection;h=[];for(l=0,j=k.length;l<j;l++){b=k[l];h.push(b.path)}return h}).call(this))}return new Ajax.DBRequest("/collection_create_and_attach_to_dummy_token",{onSuccess:e,onFailure:c,parameters:d})},alert_if_album_name_invalid:function(){if(this.creating_anonymous_collection()){return false}if(this.current_album_name.strip().length===0){Notify.server_error(_("Please enter a name for this album"));this.unlock();return true}if(PhotosCollections.collection_name_in_use(this.current_album_name)){Notify.server_error(_("You already have an album named '%(current_album_name)s'").format({current_album_name:this.current_album_name}));this.unlock();return true}return false},send_button_onclick:function(c){var b,a,d=this;if(!this.lock()){return}if(!this.sharing_collection&&this.alert_if_album_name_invalid()){return}b=$("shmodal-send-form");assert(b,"Couldn't find the shmodal send form.");if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.send_button_onclick.bind(this);return}a=function(e){d.unlock();if(!e.responseText.startsWith("err:")){Notify.server_error(_("We couldn't send this album. Please try again."));Modal.hide();return d.refresh()}};if(this.sharing_collection){this.send_collection(b,a)}else{this.send_selection(b,a)}return PhotosLogger.log_interaction(PhotosEvents.SEND,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},get_send_success_text:function(){var d,b,c,a,e;d=this.get_current_display_name();a=SharingModel.get_shmodel_send_recipients($("shmodal-send-form"));b=a[0].split(" ")[0];if(a.length===1){e=_("Shared %(album_name)s with %(first_name_of_recipient)s").format({album_name:d,first_name_of_recipient:b})}else{if(a.length===2){c=a[1].split(" ")[0];e=_("Shared %(album_name)s with %(first_name_of_recipient)s and %(first_name_of_second_recipient)s").format({album_name:d,first_name_of_recipient:b,first_name_of_second_recipient:c})}else{e=_("Shared %(album_name)s with %(first_name_of_recipient)s and %(num_other_recipients)s others").format({album_name:d,first_name_of_recipient:b,num_other_recipients:a.length-1})}}return e},send_selection:function(c,b){var e,d,a,f=this;e=function(g){var h;h=Util.from_json(g.responseText);f.create_album_from_selected_photos(h);Notify.server_success(f.get_send_success_text());f.refresh();return Modal.hide()};d={shmodel_url:this.current_shmodel_url,tkey:this.current_tkey,num_items:this.num_photos_to_share,is_anonymous:this.creating_anonymous_collection(),is_all_photos:Photos._is_all_photos};if(d.is_all_photos){d.item_counters=Util.to_json((function(){var k,h,j,g;j=this._selection;g=[];for(k=0,h=j.length;k<h;k++){a=j[k];g.push(a.item_counter)}return g}).call(this));if(Photos.in_single_collection_view()){d.source_collection_gid=Photos.get_current_collection().gid}}else{d.fq_paths=Util.to_json((function(){var k,h,j,g;j=this._selection;g=[];for(k=0,h=j.length;k<h;k++){a=j[k];g.push(a.path)}return g}).call(this))}if(this.creating_anonymous_collection()){d.collection_name=""}else{if(this.current_album_name.trim().length===0){d.collection_name=PhotosCollections.get_default_album_name()}}return Forms.ajax_submit(c,"/collection_create_and_send_link",e,b,c.down(".tokenizer-submit-button"),d)},send_collection:function(b,a){var d,c,e=this;assert(this.current_tkey!=null,"tkey should be set");assert(this.current_shmodel_url!=null,"shmodel url should be set");d=function(f){Notify.server_success(e.get_send_success_text());e.update_collection_to_share();Modal.hide();return e.refresh()};c={collection_gid:this.collection_to_share.gid,share_tkey:this.current_tkey,num_items:this.collection_to_share.num_photos};return Forms.ajax_submit(b,"/collection_share",d,a,b.down(".tokenizer-submit-button"),c)},get_link_button_onclick:function(){var a,c,b,d=this;if(!this.lock()){return}if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.get_link_button_onclick.bind(this);return}b=$("modal").down(".tokenizer-submit-button");c=function(f){var e;e=d.get_current_display_name();if(FlashDetect.installed){Notify.server_success(_("The link to %(album_name)s was copied to your clipboard").format({album_name:e}))}d.show_get_link_modal(d.current_shmodel_url,e,f);if(d.collection_to_share!=null){AlbumsLogger.log_share("share_link",d.collection_to_share.gid,d.num_photos_to_share,d.creating_anonymous_collection(),!d.sharing_collection)}return d.refresh()};a=function(e){d.unlock();Forms.remove_loading(b);if(!e.responseText.startsWith("err")){Notify.server_error(_("We couldn't create a link to this album. Please try again."));Modal.hide();return d.refresh()}};if(this.sharing_collection){Forms.add_loading(b);this.attach_collection_to_token(c,a)}else{if(this.alert_if_album_name_invalid()){return}Forms.add_loading(b);this.create_collection_and_attach_to_token(c,a)}return PhotosLogger.log_interaction(PhotosEvents.GET_LINK,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},initialize_get_link_button:function(){var b,a,c=this;if(FlashDetect.installed){a=Util.copy_to_clipboard_swf(this.current_shmodel_url,"foshmodal-copy-link","Foshmodal.get_link_button_onclick");$(a).up().style.zIndex="1001";clearInterval(this.follow_freshbutton);b=function(){return $j("#"+a).parent().clonePosition($j("#foshmodal-copy-link"),{offsetHeight:6,offsetWidth:6})};return this.follow_freshbutton=setInterval(b,500)}else{$("foshmodal-copy-link").stopObserving();return $("foshmodal-copy-link").observe("click",this.get_link_button_onclick.bind(this))}},facebook_button_onclick:function(a){var b=this;if(!this.lock()){return}setTimeout(this.unlock.bind(this),750);if(!this.sharing_collection&&this.alert_if_album_name_invalid()){return}if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.facebook_button_onclick.bind(this);return}if(FacebookOAuth.has_authed){this.do_fb_post()}else{FacebookOAuth.do_auth((function(){return b.do_fb_post()}))}return PhotosLogger.log_interaction(PhotosEvents.FB_SHARE,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},twitter_button_onclick:function(a){var b=this;if(!this.lock()){return}setTimeout(this.unlock.bind(this),750);if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.twitter_button_onclick.bind(this);return}if(!this.sharing_collection&&this.alert_if_album_name_invalid()){return}if(Twitter.has_authed){this.do_twitter_post()}else{Twitter.do_auth((function(){return b.do_twitter_post()}))}return PhotosLogger.log_interaction(PhotosEvents.TWITTER_SHARE,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},do_fb_post:function(){var a,b,c=this;b=function(e){var d;FacebookOAuth.custom_show_posting=function(){return Forms.add_loading($("shmodal-fb-post-submit"))};FacebookOAuth.progress_container=$("modal").down(".modal-buttons");d=c.get_current_display_name();FacebookOAuth.custom_show_complete=function(){Modal.hide();return Notify.server_success(_("Shared %(album_name)s on Facebook").format({album_name:d}))};FacebookOAuth.post($F("shmodal-fb-post-input"),c.current_shmodel_url);AlbumsLogger.log_share("share_facebook",e,c.num_photos_to_share,c.creating_anonymous_collection(),!c.sharing_collection);return c.refresh()};a=function(){Notify.server_error(_("We couldn't share this album on Facebook. Please try again."));Modal.hide();return c.refresh()};if(this.sharing_collection){return this.attach_collection_to_token(b,a)}else{return this.create_collection_and_attach_to_token(b,a)}},do_twitter_post:function(){var c,a,b,d=this;if(this.sharing_collection){this.attach_collection_to_token()}else{b=function(e){Modal.hide();return this.refresh()};a=function(){Modal.hide();return this.refresh()};this.create_collection_and_attach_to_token(b,a)}c=$F("shmodal-twitter-post-input");if(!c){Notify.server_error(_("Please enter a tweet"));this.unlock();return}if(c.length>140){Notify.server_error(_("Your tweet must be 140 characters or less"));this.unlock();return}Twitter.custom_show_posting=function(){$("twitter-chars").hide();return Forms.add_loading($("shmodal-twitter-post-submit"))};Twitter.custom_post(c,function(){Modal.hide();return Notify.server_success(_("Posted your tweet"))});AlbumsLogger.log_share("share_twitter",this.collection_to_share.gid,this.num_photos_to_share,this.creating_anonymous_collection(),!this.sharing_collection);return this.refresh()},show_get_link_modal:function(b,a,c){var d;Modal.show(_("Link to %(album_name)s").format({album_name:a.escapeHTML()}),$("get-link-modal"));d=$("get-link-modal").down(".link-input");d.setValue(b);d.select();$("get-link-modal").down(".view-button").onclick=function(){window.open(b,"_blank");return Modal.hide()};return $("get-link-modal").down(".done-button").onclick=function(){if(c!=null){PhotosCollections.flash_sidebar_album(c)}return Modal.hide()}},update_current_album_name_text:function(a){this.current_album_name=$(FoshmodalPanes.to_content_str(this.current_foshmodal_pane)).down(".album-name-input").value;if(this.current_foshmodal_pane===FoshmodalPanes.FB){return this.set_fb_post_title(this.current_album_name)}},set_fb_post_title:function(e){var b,d,c,a;if(e){if(this.num_photos_to_share===1){b=e}else{b=_("%(album_name_text)s (%(album_desc)s)").format({album_name_text:e,album_desc:PhotosUtil.album_desc(Foshmodal.collection_to_share)})}}else{a=this.sharing_collection?Photos.get_timeline().photos:this._selection;if(a.length===1){c=a[0];if(c.preview_type==="photo"){d=_("Photo from %(date_taken)s")}else{d=_("Video from %(date_taken)s")}b=d.format({date_taken:Util.niceDateWithMonthName(new Date(c.time_taken),true,true,true)})}else{b=PhotosUtil.file_desc(a)}}return $(FoshmodalPanes.to_content_str(FoshmodalPanes.FB)).down(".link-name").__date(b)},set_current_album_name_text:function(b,a){$(FoshmodalPanes.to_content_str(b)).down(".album-name-input").value=a;if(b===FoshmodalPanes.FB){return this.set_fb_post_title(a)}},show_content:function(e){var b,d,a,c;$("shmodal-title-text").__date(FoshmodalPanes.to_title_str());c=FoshmodalPanes.list;for(d=0,a=c.length;d<a;d++){b=c[d];if(b!==e){$(FoshmodalPanes.to_toggle_str(b)).removeClassName("toggled");$(FoshmodalPanes.to_content_str(b)).hide()}}$(FoshmodalPanes.to_content_str(e)).show();$(FoshmodalPanes.to_toggle_str(e)).addClassName("toggled");if(!this.sharing_collection){this.set_current_album_name_text(e,this.current_album_name)}switch(e){case FoshmodalPanes.FB:$("shmodal-fb-post-input").focus();break;case FoshmodalPanes.TWITTER:$("shmodal-twitter-post-input").focus();break;case FoshmodalPanes.SEND:$("foshmodal-new-collab-input").focus()}return this.current_foshmodal_pane=e},_get_foshmodal_title:function(){var a=this;return SharingModel.generate_title_content(FoshmodalPanes.to_title_str(),(function(){return a.show_content(FoshmodalPanes.SEND)}),(function(){return a.show_content(FoshmodalPanes.FB)}),(function(){return a.show_content(FoshmodalPanes.TWITTER)}))},creating_anonymous_collection:function(){return !$("shmodal").hasClassName("saving-as-album")},get_current_display_name:function(){if(this.sharing_collection){return"'"+this.collection_to_share.name+"'"}else{if(this.creating_anonymous_collection()){return PhotosUtil.file_desc(this._selection,true)}else{return"'"+this.current_album_name+"'"}}},set_twitter_message:function(){var a,c,b,e,d;a=this.sharing_collection?Photos.get_timeline().photos:this._selection;if(a.length===1){d=PhotosUtil.categorize_files(a),b=d[0],e=d[1];if(b){c=_("Just shared a photo using @Dropbox")}else{if(e){c=_("Just shared a video using @Dropbox")}else{assert(false,"We shouldn't have non-photo, non-video files in timeline")}}}else{c=_("Just shared an album using @Dropbox")}return $("shmodal-twitter-post-input").setValue(""+c+" "+this.current_short_url)},update_shmodal_image_text:function(){var h,l,k,f,e,j,a,g,d,c,b;if(this.sharing_collection){l=this.collection_to_share.num_items;k=PhotosUtil.album_desc(this.collection_to_share,false,true)}else{l=this._selection.length;k=PhotosUtil.file_desc(this._selection,false,true)}if(l>1){g=$$(".shmodal-image");c=[];for(f=0,j=g.length;f<j;f++){h=g[f];h.down("span").__date(k);c.push(h.down(".share-file-count").show())}return c}else{d=$$(".shmodal-image");b=[];for(e=0,a=d.length;e<a;e++){h=d[e];b.push(h.down(".share-file-count").hide())}return b}},show:function(j,r){var k,o,p,l,q,g,f,d,n,b,a,h,e,c,m=this;this.unlock();Modal.onHide=function(){var t,s;if((t=$("flash_copy_container"))!=null){t.remove()}if((s=m.send_link_autocompleter)!=null){s.hide()}$j("#modal").find(".new-collab-input").val("");clearInterval(m.follow_freshbutton);Photos.disable_selection();delete Modal.onHide;return Modal.hide()};this.sharing_collection=r;q=this.sharing_collection?j.thumbnail_url_256:j[0].thumbnail_url;h=$$(".link_image");for(g=0,n=h.length;g<n;g++){o=h[g];if(q!=null){o.src=q}else{o.src="static/images/empty_album_big.png"}}this.current_foshmodal_pane=FoshmodalPanes.SEND;this.have_real_tkey=this.sharing_collection&&(j.share_tkey!=null);if(this.sharing_collection){this.collection_to_share=j;this.num_photos_to_share=this.collection_to_share.num_items;$("shmodal").addClassName("sharing-collection");this.set_fb_post_title(this.collection_to_share.name)}else{this._selection=j.sort(function(t,s){return t.time_taken-s.time_taken});this.num_photos_to_share=this._selection.length;this.current_album_name="";this.set_current_album_name_text(this.current_foshmodal_pane,this.current_album_name);$("shmodal").removeClassName("sharing-collection");$("shmodal").removeClassName("saving-as-album");e=$$(".save-as-album-checkbox");for(f=0,b=e.length;f<b;f++){k=e[f];k.checked=false;l=function(A){var B,x,v,t,s,w,u,z,y;if(A.target.checked){$("shmodal").addClassName("saving-as-album");m.current_album_name=m.previous_album_name||PhotosCollections.get_default_album_name();m.set_current_album_name_text(m.current_foshmodal_pane,m.current_album_name);B=$(FoshmodalPanes.to_content_str(m.current_foshmodal_pane)).down(".album-name-input");B.focus();B.select();w=$$(".save-as-album-checkbox");z=[];for(x=0,t=w.length;x<t;x++){k=w[x];z.push(k.checked=true)}return z}else{$("shmodal").removeClassName("saving-as-album");m.previous_album_name=m.current_album_name;m.current_album_name="";m.set_current_album_name_text(m.current_foshmodal_pane,m.current_album_name);u=$$(".save-as-album-checkbox");y=[];for(v=0,s=u.length;v<s;v++){k=u[v];y.push(k.checked=false)}return y}};k.observe("change",l);if($j.browser.msie&&parseInt($j.browser.version,10)<9){k.observe("click",l)}}c=$$(".album-name-input");for(d=0,a=c.length;d<a;d++){p=c[d];p.observe("keyup",this.update_current_album_name_text.bind(this))}}Photos.enable_selection();Modal.show(this._get_foshmodal_title(),$("shmodal"));this.clear_message_inputs();this.show_content(this.current_foshmodal_pane);this.set_shmodel_url((function(){m.initialize_get_link_button();return m.set_twitter_message()}),(function(){Notify.server_error(_("This request could not be completed.  Please try again."));return Modal.hide()}));this.update_shmodal_image_text();Sharing.load_contacts(true);if(!this.send_link_autocompleter){this.send_link_autocompleter=new Autocompleter.ContactsTokenizer("foshmodal-new-collab-input","foshmodal-new-whobulk","foshmodal-hidden-input",window.contacts,window.lcontacts,{tokens:[",",";"],include_fb:true})}this.send_link_autocompleter.clearTokens();ActAsBlock.register(false,$("modal"));if(this.num_photos_to_share<=1){$("shmodal-send-content").down(".collection-thumb-stack").hide();$("shmodal-twitter-content").down(".collection-thumb-stack").hide()}else{$("shmodal-send-content").down(".collection-thumb-stack").show();$("shmodal-twitter-content").down(".collection-thumb-stack").show()}return Util._track_twitter_chars_left("shmodal-twitter-post-input",140)}};var ContactImporter,Contacts,EmailProvider,init_connected_services,_this=this;EmailProvider={GOOGLE:"-1",YAHOO:"-2",HOTMAIL:"-3",FACEBOOK:"-4",TWITTER:"-5",VARIOUS:"-6",NONE:"-7",services:function(){return[this.GOOGLE,this.YAHOO,this.HOTMAIL,this.FACEBOOK,this.TWITTER]},contact_services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK]},to_img:function(a){switch(a){case this.GOOGLE:return"/static/images/icons/gmail_logo28.png";case this.YAHOO:return"/static/images/icons/yahoo_mail_logo28.png";case this.HOTMAIL:return"/static/images/icons/hotmail_logo28.png";case this.FACEBOOK:return"/static/images/icons/facebook_logo28.png";default:return assert(false,"Should never get EmailProvider.to_img with provider: "+a)}},to_name:function(a){switch(a){case this.GOOGLE:return _("Gmail");case this.YAHOO:return _("Yahoo! Mail");case this.HOTMAIL:return _("Hotmail");case this.FACEBOOK:return _("Facebook");case this.VARIOUS:return _("Email");default:return assert(false,"Should never get EmailProvider.to_name with provider: "+a)}}};ContactImporter={toggle:null,refresh:null,suggestions_enabled:false,modal_show:function(a){if(a){this.import_done_callback=a}else{assert(this.import_done_callback,"You must set ContactImporter.import_done_callback prior to calling ContactImporter.show()")}return Modal.show("",$("contact-importer"))},modal_import_done:function(){return typeof this.import_done_callback==="function"?this.import_done_callback():void 0}};init_connected_services=function(){var c,a,e,b,d;c={};d=EmailProvider.services();for(e=0,b=d.length;e<b;e++){a=d[e];c[""+a]=true}return c};Contacts={contacts_to_import:EmailProvider.NONE,connected_services:init_connected_services(),ask_to_import:function(){var a,d,b,c;c=EmailProvider.contact_services();for(d=0,b=c.length;d<b;d++){a=c[d];if(!this.connected_services[a]){return true}}return false},set_contacts_to_import:function(){var a,b=this;if(!Constants.shmodal_contact_importer_enabled){return this.contacts_to_import=EmailProvider.VARIOUS}a=function(){var e,c,d;e=/@(.+?)\./g;c=e.exec(Constants.email);if(c&&c.length>1){if(c[1]==="gmail"&&!b.connected_services[EmailProvider.GOOGLE]){return b.contacts_to_import=EmailProvider.GOOGLE}else{if(((d=c[1])==="yahoo"||d==="ymail"||d==="rocketmail")&&!b.connected_services[EmailProvider.YAHOO]){return b.contacts_to_import=EmailProvider.YAHOO}else{return b.contacts_to_import=EmailProvider.VARIOUS}}}};new Ajax.DBRequest("/contacts/connected_services",{onSuccess:function(c){b.connected_services=Util.from_json(c.responseText);return a()},onFailure:function(){var c,f,d,e;b.connected_services={};e=EmailProvider.services();for(f=0,d=e.length;f<d;f++){c=e[f];b.connected_services[""+c]=true}return a()}});return new Ajax.DBRequest("/contacts/get_importer_suggestions_pref",{onSuccess:function(c){return ContactImporter.suggestions_enabled=c.responseText==="True"}})},google_auth_complete:function(f,h){var e,b,g,d,a,c;if(f){Sharing.load_contacts(true,null,true);Notify.server_success(_("Imported Gmail contacts"));e=$("auth_gmail");b=$("deauth_gmail");e&&e.hide();b&&b.show();Contacts.connected_services[EmailProvider.GOOGLE]=true;if(!Contacts.ask_to_import()){c=$$(".import-contacts-link");for(d=0,a=c.length;d<a;d++){g=c[d];g.hide()}}}else{if(h){Notify.server_error(h)}else{Notify.server_error(_("We need your permission to import your Gmail contacts"))}}_this.contacts_to_import=EmailProvider.VARIOUS;ContactImporter.modal_import_done();return typeof ContactImporter.refresh==="function"?ContactImporter.refresh():void 0},facebook_auth_complete:function(e,g){var f,d,b,c,a;if(e){FacebookOAuth.has_authed=1;Sharing.load_contacts(true,null,true);Contacts.connected_services[EmailProvider.FACEBOOK]=true;if(FacebookOAuth.onLoginSuccessCallback!=null){FacebookOAuth.onLoginSuccessCallback();FacebookOAuth.onLoginSuccessCallback=null}if($("modal").visible()){Notify.server_success(_("Successfully connected to Facebook."));if((c=$("contact-import-buttons"))!=null?c.visible():void 0){ContactImporter.modal_import_done();return}if(!Contacts.ask_to_import()){a=$$(".import-contacts-link");for(d=0,b=a.length;d<b;d++){f=a[d];f.hide()}}return typeof ContactImporter.refresh==="function"?ContactImporter.refresh():void 0}else{if(DBHistory.get_url().startsWith("/account")){return new Ajax.DBRequest("/fb/get_fb_profile",{onSuccess:function(h){var j,k;j=Util.from_json(h.responseText);k=j.username?j.username:'"'+j.name+'"';$j("#facebook_username").html("&nbsp;"+k);$j("#auth_facebook").hide();return $j("#deauth_facebook").show()}})}}}else{if(g){return Notify.server_error(g)}else{return Notify.server_error(_("In order to connect your Facebook account, Dropbox needs permission to post on your behalf."))}}},yahoo_auth_complete:function(e,h){var a,g,f,d,b,c;if(e){Sharing.load_contacts(true,null,true);Notify.server_success(_("Imported Yahoo! Mail contacts"));a=$("auth_yahoo_mail");g=$("deauth_yahoo_mail");a&&a.hide();g&&g.show();Contacts.connected_services[EmailProvider.YAHOO]=true;if(!Contacts.ask_to_import()){c=$$(".import-contacts-link");for(d=0,b=c.length;d<b;d++){f=c[d];f.hide()}}}else{if(h){Notify.server_error(h)}else{Notify.server_error(_("We need your permission to import your Yahoo! Mail contacts"))}}_this.contacts_to_import=EmailProvider.VARIOUS;ContactImporter.modal_import_done();return typeof ContactImporter.refresh==="function"?ContactImporter.refresh():void 0},auth_import:function(b,a){if(a==null){a="none"}switch(b){case EmailProvider.GOOGLE:window.open("/google/authentry?referrer="+a,"google_auth","width=600,height=450");break;case EmailProvider.YAHOO:window.open("/yahoo/authentry?referrer="+a,"yahoo_auth","width=600,height=450");break;case EmailProvider.HOTMAIL:assert(false,"hotmail auth import not implemented");break;case EmailProvider.FACEBOOK:window.open("/fb/access_token","fb_auth","width=600,height=450");break;default:assert(false,"Should never get here.  Input should be an EmailProvider.")}if(a!=="contact-importer-modal"){return ContactImporter.unshow()}},deauth_import:function(a,b){switch(a){case EmailProvider.GOOGLE:return new Ajax.DBRequest("/google/remove_contacts",{parameters:{source_id:b},onSuccess:function(c){$("auth_gmail").show();$("deauth_gmail").hide();return Notify.server_success(_("Successfully removed Gmail contacts"))},onFailure:function(){return Notify.server_error(_("We were unable to remove your Gmail contacts"))}});case EmailProvider.YAHOO:return new Ajax.DBRequest("/yahoo/remove_contacts",{onSuccess:function(c){$("auth_yahoo_mail").show();$("deauth_yahoo_mail").hide();return Notify.server_success(_("Successfully removed Yahoo! Mail contacts"))},onFailure:function(){return Notify.server_error(_("We were unable to remove your Gmail contacts"))}});case EmailProvider.HOTMAIL:return assert(false,"hotmail auth import not implemented");default:return assert(false,"Should never get here.  Input should be an EmailProvider.")}}};var ActAsBlock,BrowseStyleRows,Bubble,DBCheckbox,DBDropdown,Dropdown,FreshDropdown,FreshbuttonIEHaxxx,HotButton,JumpWatcher,LiveSearch,LocaleSelector,LoginDropdown,Modal,ModalLocaleSelector,Notify,SickInput,Spinner,Sprite,SuggestionInput,Tabs,TitleBubble,Tooltip,TreeView,ULSelectMenu,UndoAction,add_sprites_func,sprites_used;Bubble={make:function(s,E,w,p,k){var g,u,B,f,e,D,y,q,o,h,n,v,A,m,a,j,d,C,z,x;if(E==null){E="left"}k=k!=null?k:{};if(["left","right"].contains(E)){w=w||"middle";assert(["top","middle","bottom"].contains(w),"expected tail position ['top', 'middle', 'bottom'], got "+w)}else{if(["bottom","top"].contains(E)){w=w||"center";assert(["left","center","right"].contains(w),"expected tail position ['left', 'center', 'right'], got "+w)}else{if(!["none"].contains(E)){assert(false,"unexpected tail side, got "+E)}}}v=new Element("table");if(k.style==="titled"){v.addClassName("bluebubble");A="bluebubble"}else{v.addClassName("bubble");A="bubble"}if(p){v.style.width=p+"px"}a=new Element("tbody");C=new Element("tr");j=new Element("td");j.addClassName("tl");n=new Element("td");n.addClassName("t");if(k.style==="titled"){if(p){n.style.width=(p-42)+"px"}}d=new Element("td");d.addClassName("tr");if(E==="top"){m=new Element("img",{src:"/static/images/"+A+"_arrow_top.png"});m.addClassName("tarrow");if(k.style==="titled"){m.addClassName("arrow-"+w);u=new Element("div");u.addClassName("arrow-container");if(p){u.style.width=(p-42)+"px"}u.__sert(m);n.__sert(u)}else{n.style.textAlign=w;n.__sert(m)}}C.__sert(j);C.__sert(n);C.__sert(d);a.__sert(C);z=new Element("tr");q=new Element("td");q.addClassName("l");if(E==="left"){g=new Element("img",{src:"/static/images/bluebubble_arrow_left.png"});g.addClassName("arrow");q.__sert(g);q.vAlign=w}y=new Element("td");y.addClassName("c");y.update(s);o=new Element("td");o.addClassName("r");if(E==="right"){h=new Element("img",{src:"/static/images/bubble_arrow_right.png"});h.addClassName("rarrow");o.__sert(h);o.vAlign=w}z.__sert(q);z.__sert(y);z.__sert(o);a.__sert(z);x=new Element("tr");e=new Element("td");e.addClassName("bl");B=new Element("td");B.addClassName("b");if(E==="bottom"){f=new Element("img",{src:"/static/images/"+A+"_arrow_bottom.png"});f.addClassName("barrow");if(k.style==="titled"){f.addClassName("arrow-"+w);u=new Element("div");u.addClassName("arrow-container");if(p){u.style.width=(p-42)+"px"}u.__sert(f);B.__sert(u)}else{B.style.textAlign=w;B.__sert(f)}}D=new Element("td");D.addClassName("br");x.__sert(e);x.__sert(B);x.__sert(D);a.__sert(x);v.__sert(a);return v}};ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(f,g){var d,b,c,a;if(g==null){g=document.body}c=$(g).getElementsByClassName("act_as_block");a=[];for(d=0,b=c.length;d<b;d++){f=c[d];a.push(this.resize(f))}return a},resize:function(e){var a,c,d,b;e=$(e);c=e.up();a=Util.sumStyles(e,this.elm_list);d=Util.sumStyles(c,this.parent_list);e.style.width="1px";b=c.getWidth()-a-d;if(b>0){return e.style.width=b+"px"}}};Util.smart_window_load(ActAsBlock.register.bind(ActAsBlock));Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(o,k,l,p,c,m,g,j){var f,b,n,a,d,e,h;if(l==null){l=false}if(p==null){p=false}if(c==null){c=false}if(m==null){m=false}if(g==null){g=""}if(j==null){j=true}c=c||this.width;$$("#modal-content .error-message, #modal-content .error-removable").invoke("hide");if(FileQueue.uploading&&!m){alertd(_("You can't do this while uploading."));return false}assert(k,"Missing modal content!");d=this.vars._prev_scope;this.vars=l||{};this.vars._prev_scope=d;$("modal").setStyle({width:""+c+"px",margin:"0 0 0 "+(Math.floor(-c/2).toString())+"px"});this.vars.extra_class="";if(g){$("modal").addClassName(g);this.vars.extra_class=g}if(!m){if(FileQueue.num_files()){Upload.reset()}a=Util.childElement($("modal-content"),0);if(a&&a!==k){$("grave-yard").__sert(a)}b=new Element("div");b.update(k);h=this.vars.wit_group;if(!h){f=b.down();h=f&&f.id}if(h){WIT.add_group(b,h)}$("modal-content").__sert(b);if(k.show){k.show()}Element.show("modal")}$j("#modal-overlay").off("click");if(j){$j("#modal-overlay").on("click",function(q){Modal.hide();q.preventDefault();return q.stopPropagation()})}else{$j("#modal-overlay").on("click",function(q){q.preventDefault();return q.stopPropagation()})}this.fix_position();$j("#modal-overlay").css("opacity",0.6);$("modal-overlay").show();$("modal-behind").setStyle({width:""+(c+20)+"px",margin:"0 0 0 "+(Math.floor(-c/2-10).toString())+"px"});$j("#modal-behind").css("opacity",0.2);$("modal-behind").show();if(p){$("modal-content").select("#"+p.id).first().focus()}else{if(!Util.ie){n=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]");if(n){n.focus()}}}if(!this.track_id){this.track_resizes()}if(o){$("modal-title").update(o);$("modal-title").show();e=o.innerText||o.textContent||o;T("Modal.show:",e)}else{$("modal-title").hide();T("Modal.show")}ActAsBlock.register(false,"modal");this.keydownHandler=this.keydown.bind(this);document.observe("keydown",this.keydownHandler);$("modal-content").style.height="auto";if(key.getScope()!==this.KEY_SCOPE){this.vars._prev_scope=key.getScope()}key.setScope(this.KEY_SCOPE);return false},async_show:function(b,c){var a;a=new Element("img",{src:"/static/images/icons/ajax-loading.gif"});this.show("",a);return new Ajax.DBRequest(b,{parameters:c,onSuccess:this._async_load})},_async_load:function(a){var b;b=Util.from_json(a.responseText);$("modal-content").__date(new HTML(b.content));if(b.title){$("modal-title").update(new HTML(b.title));$("modal-title").show();return T("Modal.show:",b.title)}else{$("modal-title").hide();return T("Modal.show")}},fix_position:function(d){var c,b,a;a=document.viewport.getScrollOffsets().top+this.vertical_offset;b=parseInt($("modal").getStyle("height"),10);c=$("flash-upload-container")&&$("flash-upload-container").descendantOf("modal");if(!c&&b+this.vertical_offset<document.viewport.getHeight()){$("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"});return $("modal-behind").setStyle({position:"fixed",height:(b+20)+"px",top:(this.vertical_offset-10)+"px"})}else{$("modal").setStyle({position:"absolute",top:a+"px"});return $("modal-behind").setStyle({position:"absolute",height:(b+20)+"px",top:(a-10)+"px"})}},keydown:function(d){var f,a,c,b;c=BrowseKeys.getKey(d);if(c===27||(c===8&&!Util.focus_in_input())){d.preventDefault();this.hide()}if(c===9&&!Util.focus_in_input()){a=$("modal").down("input[type=text], input[type=email]");b=$("modal").down(".modal-tabs");f=b;while(f&&f.next()){f=f.next();if(f.visible()){a=f.down("input[type=text], input[type=email]");break}}if(a){d.preventDefault();return a.focus()}}},icon_show:function(h,j,e,f,k,a,g,c,d){var b;if(c==null){c=""}if(d==null){d=true}b=new Element("div");if(h){b.__sert(Sprite.make("web",h,{"class":"modal-h-img"}))}b.__sert(j);return this.show(b,e,f,k,a,g,c,d)},show_loading:function(a,c){var b;b="<p style='margin: 3em 0; text-align: center;'>\n<img src='/static/images/icons/ajax-loading-small.gif' alt=''/></p>";return this.icon_show(a,c,b)},shown:function(){return $("modal").visible()},hide:function(b,a){if(b){Event.stop(b)}if(this.onHide){this.onHide();return}this.onHide=null;Element.hide("modal-behind");Element.hide("modal-overlay");$("modal").removeClassName(this.vars.extra_class);if(!a&&!FileQueue.num_files()){Element.hide("modal")}else{$("modal").style.marginLeft="-10000000px";if(FileQueue.uploading){InlineUploadStatus.show()}}if(this.track_id){clearInterval(this.track_id);this.track_id=false}document.stopObserving("keydown",this.keydownHandler);if(document.activeElement&&[document,window,document.body].indexOf(document.activeElement)===-1){$(document.activeElement).blur()}key.setScope(this.vars._prev_scope);return T("Modal.hide")},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var a;a=$("modal").getHeight();if(this.old_height!==a||$("modal-behind").getHeight()<a){this.old_height=a;return this.fix_position()}},vars:{}};Tabs={init:function(){var p,l,j,q,e,n,r,m,b,d,g,f,o,c,h,k=this;n=$A(document.getElementsByClassName("tab")).concat($A(document.getElementsByClassName("subtab")));for(g=0,o=n.length;g<o;g++){q=n[g];p=q.down("a");b=p.href.split("/");if(q.hasClassName("subtab")){p.href="#"+b[b.length-1]}if(Util.ie6||Prototype.Browser.Opera){d=p.getWidth()-parseInt(p.getStyle("padding-left"),10)*2;d=d+2+(d%2);p.style.width=""+d+"px"}r=Sprite.make("web","rounded_tl",{"class":"rounded_tl"});m=Sprite.make("web","rounded_tr",{"class":"rounded_tr"});p.appendChild(r);p.appendChild(m)}j=20;h=$$(".events_bubble");for(f=0,c=h.length;f<c;f++){l=h[f];e=(-1*l.getWidth()/2)+"px";l.style.marginLeft=e;l.style.marginRight=e;l.style.right="6px";l.parentNode.style.zIndex=j--}$j(window).bind("hashchange",function(){return k.check_url("")});if(!("onhashchange" in document.body)){this.simulate_hashchange_support()}return $j(window).trigger("hashchange")},simulate_hashchange_support:function(){var b,a;clearInterval(this.check_interval);b=window.location.hash;a=function(){var c;c=window.location.hash;if(c!==b){b=c;return $j(window).trigger("hashchange")}};return this.check_interval=setInterval(a,300)},check_url:function(b){var a;a=/#([^#]*)/.exec(window.location.hash);if(a&&this.showTab(null,a[1])){return true}a=/[^\/]+$/.exec(window.location.pathname);if(a&&this.showTab(null,a[0])){return true}if(b&&this.showTab(null,b)){return true}return this.showTab(null,"")},showTab:function(e,a){var k,h,j,d,m,c,g,f,l,b;if(this.last_shown===a){return true}if(a){d=$(a+"-tab");j=$(a+"-content")}else{d=$$(".subtab").first();j=$$(".content-tab").first()}if(!d||!j){return false}d.fire("db:tabshown");c=document.getElementsByClassName("subtab selected");for(g=0,l=c.length;g<l;g++){m=c[g];m.removeClassName("selected")}d.addClassName("selected");k=document.getElementsByClassName("content-tab");for(f=0,b=k.length;f<b;f++){m=k[f];m.hide()}j.show();Util.syncHeight();h=j.select("input[type=text]","input[type=email]","textarea");if(h.length>0){Util.focus(h[0])}this.last_shown=a;return true}};TreeView={tv:{},loaded:false,set_params:function(a){return this.ajax_params=a},init:function(c,a,d){var b;if(d==null){d="treeview"}this.tv[d]={};b=this.tv[d];b.autohide=(a===null?true:a);b.handler=c;b.viewdiv=$(d);return b.hidefunc=this.hide.bindAsEventListener(this)},schedule_reset:function(){return this.loaded=false},reset:function(a){var b=this;return new Ajax.DBRequest("/ajax_subtreeview",{parameters:this.ajax_params,onSuccess:function(e){var d,c;c=[];for(d in b.tv){if(b.tv.hasOwnProperty(d)){b.tv[d].viewdiv.down(".treeview-folders").update(e.responseText);if(a&&a.onSuccess){c.push(a.onSuccess(e))}else{c.push(void 0)}}else{c.push(void 0)}}return c}})},toggle:function(c,b){var a;Event.stop(c);a=this.tv[b||"treeview"];if(a.shown){a.shown=false;this.hide(c,b)}else{a.shown=true;this.show(c.target,b)}return false},hide:function(c,b){var a;a=this.tv[b||"treeview"];if(!c||!$(c.target).descendantOf(a.viewdiv)){a.viewdiv.hide();Event.stopObserving(window,"click",a.hidefunc);return a.shown=false}},show:function(c,b){var d,a;a=this.tv[b||"treeview"];c=$(c);c.blur();d=c.cumulativeOffset();a.viewdiv.setStyle({top:(d.top+c.getHeight())+"px",left:(d.left-4)+"px"});a.viewdiv.show();return Event.observe(window,"click",a.hidefunc)},toggleNode:function(b){var a;b=$(b);a=b.down("img");if(a.className.match("bullet_plus")){Sprite.replace(a,"web","bullet_plus","bullet_minus")}else{Sprite.replace(a,"web","bullet_minus","bullet_plus")}b.up().next("div").toggle();b.blur();return false},toggleNodeAjax:function(c,a){var b,d,e=this;if(c.fetched_children){return this.toggleNode(c)}c=$(c);b=c.down("img");d=Sprite._get(b);b.src="/static/images/icons/ajax-loading-small.gif";new Ajax.DBRequest("/ajax_subtreeview"+a,{parameters:this.ajax_params,onSuccess:function(f){var g;g=new Element("div",{style:"display: none;"}).update(f.responseText);c.up().__sert({after:g});c.fetched_children=true;Sprite._set(b,d);return e.toggleNode(c)},cleanUp:function(f){if(/loading/.match(b.src)){return Sprite._set(b,d)}}});return false},handle:function(c,b){var d,a;d=$H(this.tv).keys();a=$(b).ancestors().find(function(e){return d.include(e.id)});if(!a){return}a=this.tv[a.id];$("modal").fire("db:treeview_selected",{path:c});if(a.handler){a.handler(c,b)}if(a.autohide){return this.hide(a.id)}},move:function(c,d,b){var a,e=this;a=$(c);if(!this.loaded){this.reset({onSuccess:function(){e.loaded=1;return e.move(c,d,b)}})}else{if(b&&b.onSuccess){b.onSuccess()}}assert(a,"Couldn't find tree_id");assert($(d),"Couldn't find location_id");$(d).appendChild(a);return a.show()},enable_shared:function(e){var f,d,a,g,j,k,c,h,b;k=$(e);if(!k.share_disabled){return}k.share_disabled=false;j=k.select(".s_web_folder_user_gray");a=j.length;d=0;b=[];for(c=0,h=shared_folder_img.length;c<h;c++){f=shared_folder_img[c];Sprite.replace(f,"web","folder_user_gray","folder_user");g=f.up();b.push(g.onclick=g._onclick)}return b}};sprites_used=new SimpleSet();Sprite={SPACER:"/static/images/icons/icon_spacer.gif",CLASS_PREFIX:"s_",_make_class:function(b,a){sprites_used.add(a);return this.CLASS_PREFIX+b+"_"+a},src:function(c,b,a){c=$(c);this.clear(c);return c.addClassName(this._make_class(b,a))},current:function(d){var a,b,c=this;b=$(d).classNames().findAll(function(e){return !e.indexOf(c.CLASS_PREFIX)});if(!b.length){return}a=b[b.length-1];return a.substr(a.indexOf("_",2)+1)},replace:function(d,b,c,a){d.removeClassName(this._make_class(b,c));return d.addClassName(this._make_class(b,a))},clear:function(b){var a=this;b=$(b);return b.className=b.classNames().reject(function(c){return !c.indexOf(a.CLASS_PREFIX)}).join(" ")},make:function(c,b,a){a=this._prep_attrs(c,b,a);return new Element("img",a)},html:function(d,b,a){var e,c;a=this._prep_attrs(d,b,a);e=["<img "];for(c in a){e.push(c,'="',HTML._raw_escape(a[c]),'" ')}e.push("/>");return new HTML(e.join(""))},_prep_attrs:function(d,c,b){var a;if(b==null){b={}}assert(!c.endsWith("_blue"),"Tried to make invalid sprite "+c);b.src=b.src||this.SPACER;a=this._make_class(d,c);b["class"]=("sprite sprite_"+d+" "+a+" ")+(b["class"]||"");return b},_get:function(a){return a.className},_set:function(b,a){b.className=a;return b.src=this.SPACER}};add_sprites_func=function(){if(sprites_used.items.length){return new Ajax.DBRequest("/add_sprites_used",{parameters:{sprite:sprites_used.items}})}};Dropdown={init:function(){var e,d,b,c,a;c=$$("#tabs-container > ul > li");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];e.observe("mouseenter",this.over);a.push(e.observe("mouseleave",this.out))}return a},over:function(a){var b;clearTimeout(this.timeout);$$("#tabs-container > ul > li.hover").invoke("removeClassName","hover");b=$(a.target);if(!b.match("#tabs-container > ul > li")){b=b.up("#tabs-container > ul > li")}return b.addClassName("hover")},out:function(a){var c,b;c=$(a.target);if(!c.match("#tabs-container > ul > li")){c=c.up("#tabs-container > ul > li")}b=function(){return c.removeClassName("hover")};return this.timeout=setTimeout(b,300)}};HotButton={make:function(b){var a,d,c;a=new Element("a");a.addClassName("hotbutton");a.addClassName("bigger");a.addClassName("rounded");c=new Element("span");c.addClassName("hotbutton-content");c.update(b);a.update(c);d=new Element("span");d.addClassName("shadow");return this.register(a)},register:function(a){var b,c=this;b=a.select(".hotbutton-icon").pop();if(b){a._icon=b;a._sprite=Sprite.current(b)}a.observe("mouseenter",function(){return c.mouseenter(a)});a.observe("mouseleave",function(){return c.mouseleave(a)});a.observe("mousedown",function(d){return c.mousedown(d,a)});a.observe("mouseup",function(){return c.mouseup(a)});Util.disableSelection(a);return a},mouseenter:function(a){a.addClassName("hover");return a.style.zIndex=1},mouseleave:function(a){a.removeClassName("hover");a.removeClassName("down");a.style.zIndex=0;if(a._icon){return Sprite.src(a._icon,"web",a._sprite)}},mousedown:function(b,a){a.addClassName("down");return Event.stop(b)},mouseup:function(a){a.removeClassName("down");if(a._icon){return Sprite.src(a._icon,"web",a._sprite)}}};LiveSearch={search:function(g,f,c,a,b){var d,e=this;g=g.strip();if(g.length<3){$(f).__date();if(a.onEmpty){return a.onEmpty(g)}}else{d={search_string:g,"short":(b?1:"")};return new Ajax.Request(c,{parameters:d,method:"get",onSuccess:function(h){var j;j=h.responseText.strip();if(!j){if(a.onEmpty){a.onEmpty(g)}return}$(f).update(h.responseText);e.highlight(f,g);if(a.onComplete){return a.onComplete(g)}}})}},highlight:function(k,n){var c,m,h,g,e,l,b,a,j,f,d;j=n.split(" ");for(h=0,l=j.length;h<l;h++){m=j[h];if(m.length<4){return}c=new RegExp(RegExp.escape(m),"i");k=$(k);f=$$(".livesearch_result_a");for(g=0,b=f.length;g<b;g++){k=f[g];k.innerHTML=k.innerHTML.gsub(c,function(o){return"<strong>"+o[0]+"</strong>"})}d=$$(".livesearch_result_p");for(e=0,a=d.length;e<a;e++){k=d[e];k.innerHTML=k.innerHTML.stripTags().gsub(c,function(o){return"<strong>"+o[0]+"</strong>"})}}},MAX_RESULTS:10};DBDropdown=Class.create({initialize:function(d,e,l){var h,b,f,k,j,a,c,g;if(l==null){l={}}this.options=l;this.container=$(d);assert(this.container,"Couldn't find element for DBDropdown "+d);this.container.style.position="relative";assert(e&&e.length,"Missing options_list: "+e);this.display_options=[];this.display_value={};for(c=0,g=e.length;c<g;c++){a=e[c];k=void 0;if(a.length>2){k=[a[1],a[2]]}else{k=[a[1]]}this.display_options.push(k);this.display_value[a[1]]=a[0]}b="";if(this.options.icon||this.options.prefix){b+="<span class='prefix'>";if(this.options.icon){b+=Sprite.html("web",this.options.icon,{className:"icon_no_hover"}).toHTML()}if(this.options.prefix){b+=this.options.prefix}b+="</span>"}f=void 0;if(this.options.initial_value){f=this.options.initial_value}else{f=this.display_options[0][0]}b+="<span class='dbdropdown-selected'>"+f+"</span>";h=l.arrow||"big-dropdown";b+=Sprite.html("web",h).toHTML();this.hotbutton=HotButton.make(b);this.hotbutton.addClassName("dbdropdown");this.hotbutton.name=$(d).identify();this.container.update(this.hotbutton);if(this.options.style){for(j in this.options.style){if(this.options.style.hasOwnProperty(j)){this.hotbutton.style[j]=this.options.style[j]}}}return this.observe()},observe:function(){this.hotbutton.observe("mouseup",(function(a){return this.mouseup(a)}).bind(this));return $(document.body).observe("mouseup",(function(a){if(!$(a.target).match(".dbdropdown, .dbdropdown *")){return this.hide_list()}}).bind(this))},mouseup:function(a){if(this.showing){this.hide_list()}else{this.show_list()}return a.preventDefault()},show_list:function(){var a,d,h,c,f,b,e,g=this;c=new Element("ul");Util.disableSelection(c);c.addClassName("dbdropdown-list");e=this.display_options;for(f=0,b=e.length;f<b;f++){d=e[f];a=new Element("li");a.addClassName("wit");a.name=d;a.update(d);a.observe("click",function(j){return j.preventDefault()});a.observe("mouseup",function(j){j.preventDefault();g.select(j.target.name);return g.hide_list()});a.observe("mouseenter",function(){return this.addClassName("over")});a.observe("mouseleave",function(){return this.removeClassName("over")});c.appendChild(a)}this.container.appendChild(c);$j(c).clonePosition($j(this.hotbutton),{setTop:false,setHeight:false});c.style.width=(parseInt(c.style.width,10)-2)+"px";h=this.container.getHeight()-(Prototype.Browser.IE?2:0)+"px";if(this.options.show_above){c.style.bottom=h}else{c.style.top=h}return this.showing=true},hide_list:function(){var a;a=this.container.down(".dbdropdown-list");if(a){a.remove()}return this.showing=false},select:function(a){var c,b;b=this.display_value[a];assert(b,"Value is missing...");c=this.container.down(".dbdropdown-selected");assert(c,"select missing contentelm");c.update(a);if(this.options.on_change){return this.options.on_change(b)}}});LocaleSelector={init:function(){var a,b=this;a=$("locale-menu");if(!a){return}return a.on("click","a.locale-option",function(e,d){var c;e.preventDefault();c=d.readAttribute("data-locale");return b.set_locale(c)})},set_locale:function(a){var b;if(a===Constants.USER_LOCALE){return}b=new Element("form",{action:"https://"+Constants.WEBSERVER+"/set_locale",method:"post"});Forms.add_vars(b,{locale:a,locale_cont:window.location.href,t:Constants.TOKEN});document.body.appendChild(b);return b.submit()}};ModalLocaleSelector={init:function(){document.on("click",".modal-locale-link",ModalLocaleSelector.show_modal);return document.on("click","#modal-locale-selector a",ModalLocaleSelector.set_locale)},show_modal:function(b,a){b.preventDefault();return Modal.icon_show("globe32",_("Choose a language"),$("modal-locale-selector"),null,null,500)},set_locale:function(c,b){var a;c.preventDefault();Modal.hide();a=b.readAttribute("data-locale");return LocaleSelector.set_locale(a)}};UndoAction={init:function(){},set_undo_info:function(a,b){this.undo_info=a;this.undo_handler=b;assert(b,"need to specify a function to start the undo");return this.undoing=false},perform_undo:function(){if(!this.undoing){this.undo_handler(this.undo_info);return this.undoing=true}}};Notify={init:function(){var a;a=$("notify-xclose");if(!a){return}return a.observe("click",function(c){var b;Event.stop(c);return(b=$("notify"))!=null?b.hide():void 0})},server_error:function(c,b,a){return this._show_div(c,b,a,false,_("There was a problem completing this request."))},server_success:function(e,d,b,a,c){return this._show_div(e,d,b,true,_("Your request completed successfully."),a,c)},_show_div:function(b,c,e,g,j,a,h){var d,f=this;this.clear_all();b=b||j;c=c||(a?30:10);if(a&&Constants.can_undo){b=[b,new HTML('&nbsp;<a id="undo-link" href="#">Undo</a>')];UndoAction.set_undo_info(a,h);(function(){return $("undo-link").observe("click",function(k){UndoAction.perform_undo();return Event.stop(k)})}).defer();this.preserve_last_msg=true}else{this.preserve_last_msg=false}d=$j("#notify");if(g){d.removeClass("server-error").addClass("server-success")}else{d.removeClass("server-success").addClass("server-error")}$("notify-msg").__date(b);this.last_fade_effect=d.fadeIn(500);this.last_msg=b;this.last_fade_timeout=setTimeout((function(){return f.last_fade_effect=d.fadeOut(1000)}),c*1000);return this.cancel_on_reload=e},is_shown:function(){return $j("#notify").visible()},clear_all:function(){if(this.last_fade_timeout){clearTimeout(this.last_fade_timeout)}if(this.last_fade_effect){this.last_fade_effect.stop()}return $j("#notify").hide()},clear_if:function(a){if(this.last_msg===a){return this.clear_all()}}};Util.smartLoad(Notify.init.bind(Notify));LoginDropdown={init:function(){var a;a=$("login-hover-link");if(!a){return}this.login_link=a;return this.register()},register:function(a){this.login_link.observe("click",this.click.bind(this));this.login_link.observe("mouseenter",this.over.bind(this));this.login_link.observe("mouseleave",this.out.bind(this));this.login_link.observe("focus",this.click.bind(this));$("login_email_elm").observe("focus",this.click.bind(this));return $(document.body).observe("click",this.unclick.bind(this))},over:function(a){return this.hover()},out:function(a){return this.unhover()},click:function(a){Event.stop(a);this.hover();this.down=true;this.login_link.up().addClassName("down");return $("login_email_elm").focus()},unclick:function(b){var a;a=$(b.target);if(a.match("#top-login-wrapper, #top-login-wrapper *")){return}this.down=false;this.unhover();return this.login_link.up().removeClassName("down")},hover:function(){var a;if(this.is_hover||this.down){return}this.is_hover=true;a=$("login-hover-dropdown-icon");return Sprite.replace(a,"web","big-dropdown-gray","big-dropdown")},unhover:function(){var a;if(!this.is_hover||this.down){return}this.is_hover=false;a=$("login-hover-dropdown-icon");return Sprite.replace(a,"web","big-dropdown","big-dropdown-gray")}};DBCheckbox={register_all:function(){var e,d,a,b;b=$$(".checkbox");for(d=0,a=b.length;d<a;d++){e=b[d];this.register(e)}},register:function(a){a.addClassName("s_checkbox sprite");a.selected=false;return a},toggle:function(a){if(a.selected){return this.deselect(a)}else{return this.select(a)}},select:function(a){Sprite.replace(a,"web","checkbox","checkbox_checked");return a.selected=true},deselect:function(a){Sprite.replace(a,"web","checkbox_checked","checkbox");return a.selected=false}};Util.smartLoad(DBCheckbox.register_all.bind(DBCheckbox));Tooltip={attach:function(g,c,a,b){var f,e;if(b==null){b={}}g=$(g);a=(a?$(a):null);f=Bubble.make(c,g.tail_position,b.tail_position,b.width);f.setStyle({display:"none",position:"absolute"});$("floaters").__sert(f);if(g.match("#modal-content *")){f.style.zIndex="13001"}else{f.style.zIndex=""}if(g.tail_position==="right"){e=(Util.ie?32:12);f.style.marginLeft=-(f.getWidth()+g.getWidth()+e)+"px"}g.tooltip=f;g.out_target=(a?true:false);g.observe("mouseout",this.mouseout("target",g));g.observe("mouseover",this.mouseover("target",g));g.out_trigger=(a?false:true);if(a){a.observe("mouseout",this.mouseout("trigger",g));a.observe("mouseover",this.mouseover("trigger",g))}g.out_tooltip=true;f.observe("mouseout",this.mouseout("tooltip",g));return f.observe("mouseover",this.mouseover("tooltip",g))},update:function(b,a){if(b.tooltip){return $(b.tooltip).update(a)}},mouseover:function(a,b){return function(){return b["out_"+a]=false}},mouseout:function(a,b){return function(){b["out_"+a]=true;return Tooltip.hide_if_out.defer(b)}},show_by:function(b){var c,a;c=$j(b.tooltip);b=$j(b);c.show();a=Math.floor(c[0].offsetHeight/2);return c.clonePosition(b,{setWidth:false,setHeight:false,offsetTop:Math.floor(b[0].offsetHeight/2)-a,offsetLeft:b[0].offsetWidth+1})},hide_if_out:function(a){var b;if(!a.out_target||!a.out_trigger||!a.out_tooltip){return}b=$(a.tooltip);return b.hide()},show:function(e,d,b,a,c){if(a==null){a="left"}e=$(e);if(!e.tail_position){e.tail_position=a}b=(b?$(b):null);if(!e.tooltip){this.attach(e,d,b,c)}return this.show_by(e)}};BrowseStyleRows={register_all:function(){var d,c,a,b;b=$$(".bs-row");for(c=0,a=b.length;c<a;c++){d=b[c];this.register(d)}return Event.observe(document,"click",this.kill_current.bind(this))},register:function(b){var a;b=$(b);b.db_observe("mouseover",this.mouseover.bind(this));b.db_observe("mouseout",this.mouseout.bind(this));a=b.down(".action-button");if(a){return a.db_observe("click",this.click.bind(this))}},mouseover:function(b,a){return a.addClassName("hover")},mouseout:function(b,a){return a.removeClassName("hover")},click:function(d,b){var a,f,c;if(d.target.tagName==="A"){return}f=b.up(".bs-row");Event.stop(d);if(f.hasClassName("selected")){this.kill_current(false);return}this.kill_current(false);c=$(d.target);if(!c.match(".bs-actions-list *")){f.addClassName("selected")}a=(c.hasClassName("bs-row")?c:c.up(".bs-row"));if(Util.ie6){a.down(".bs-actions-list").style.position="absolute"}return a.style.zIndex=9},kill_current:function(f){var g,d,b,c,a;c=$$(".bs-row.selected");a=[];for(d=0,b=c.length;d<b;d++){g=c[d];g.removeClassName("selected");a.push(g.style.zIndex="")}return a}};SickInput={init:function(){var e,d,b,c,a;c=$$(".sick-input");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(this._create(e))}return a},_create:function(d){var c,a,b;if(d==null){return}c=d.identify();a=d.down("input")||d.down("textarea")||d.down("select");a.observe("focus",function(){return d.addClassName("focused")});a.observe("blur",function(){return d.removeClassName("focused")});b=function(){if(d.hasClassName("populated")&&a.getValue()===""){d.removeClassName("populated")}else{if(!d.hasClassName("populated")&&a.getValue()!==""){d.addClassName("populated")}}if(c in SickInput._handler_map){return SickInput._handler_map[c]()}};this.show_errors();b();return setInterval(b,100)},hide_errors:function(c){var f,e,d,b,a;f=this.get_errors(c);a=[];for(d=0,b=f.length;d<b;d++){e=f[d];if(e.down("span.error-message")){a.push(e.hide())}else{a.push(void 0)}}return a},show_errors:function(b){var e,d,c,a;e=this.get_errors(b);for(c=0,a=e.length;c<a;c++){d=e[c];if(d.down("span.error-message")){d.show()}}return $j(".sick-input").find("label").css("top","")},get_errors:function(b){var c,a;a=".error-bubble, .error-plain-text";c=b?b.select(a):$$(a);return c},_handler_map:{},add_interval_handler:function(b,a){var c;c=b.identify();return this._handler_map[c]=a}};Util.smartLoad(SickInput.init.bind(SickInput));FreshbuttonIEHaxxx={submits:[],init:function(){if(IE7_OR_LESS){this.submits=$$("input[type=submit]");return document.on("focusin","form",this.wtvr.bind(this))}},wtvr:function(b,c){var h,a,g,e,j,f,d;f=c.select("input[type=submit]");d=[];for(e=0,j=f.length;e<j;e++){h=f[e];g=this.submits.indexOf(h);if(g!==-1){a=new Element("input",{type:"submit","class":"hidden-ie-submit"});h.__sert({before:a});d.push(this.submits.splice(g,1))}else{d.push(void 0)}}return d}};Util.smartLoad(FreshbuttonIEHaxxx.init.bind(FreshbuttonIEHaxxx));SuggestionInput={register:function(b){var a;b=$(b);a=b.up("form");if(SuggestionInput.defaulted(b)||b.getValue()===""){b.setValue(b.title)}else{b.addClassName("suggestion-input-unfaded")}b.observe("blur",this.blur.bind(this));b.observe("focus",this.focus.bind(this));b.observe("db:value_change",this.focus.bind(this));if(a){if(!b.id){b.id="r_elm_id_"+(Math.random().toString())}return a.observe("submit",SuggestionInput.blank(b.id).bind(this))}},register_all:function(){var c,e,b,d,a;d=$$(".suggestion-input");a=[];for(e=0,b=d.length;e<b;e++){c=d[e];a.push(this.register(c))}return a},blank:function(a){var b=this;return function(){var c;c=$(a);if(!c){return}if(b.defaulted(c)){return c.setValue("")}}},defaulted:function(a){a=$(a);return a.getValue()===a.title},do_blank:function(a){return this.blank(a)()},clear:function(a){var b;b={target:a};return this.focus(b)},focus:function(a){var b;b=$(a.target);if(!b){return}if(this.defaulted(b)){b.addClassName("suggestion-input-unfaded");return b.setValue("")}},blur_elm:function(a){if(a.getValue()===""){a.removeClassName("suggestion-input-unfaded");a.setValue(a.title)}return a.blur()},blur:function(a){var b;b=$(a.target);if(!b){return}return this.blur_elm(b)},reset:function(b){var a;a=$(b);if(!a){return}a.removeClassName("suggestion-input-unfaded");a.setValue(a.title);a.defaulted=true;return a.blur()},setValue:function(a,b){var c;c=$(a);if(!c){return}c.addClassName("suggestion-input-unfaded");c.setValue(b);return c.defaulted=false}};Util.smartLoad(SuggestionInput.register_all.bind(SuggestionInput));ULSelectMenu=(function(){var d,h,c,j,k,e,g,a,f,b,l;d=function(m){return m.removeClassName("shown")};l=function(m){return m.toggleClassName("shown")};g=function(){return this.removeClassName("hover")};e=function(){return this.addClassName("hover")};a=function(q,p){var m,r,o,n;n=[];for(r=0,o=p.length;r<o;r++){m=p[r];n.push(q.insert(m))}return n};j=function(o,m,n){a(o,n);if(o.firstChild!==m){return o.__sert({top:m})}};f=function(m,n){m.down(".selected").removeClassName("selected");return n.addClassName("selected")};b=function(o,r){var s,q,n,p,m;p=o.select("li");m=[];for(q=0,n=p.length;q<n;q++){s=p[q];if(s.getAttribute("data-value")===r){m.push(f(o,s))}else{m.push(void 0)}}return m};k=function(m,o,n){return function(p){if(!m.hasClassName("selected")){f(o,m);o.fire("db:change",m.getAttribute("data-value"));return d(o)}else{j(o,m,n);return l(o)}}};h=function(o){var r,u,q,n,t,m,p,s;u=o.select("li");assert(u.length,"Empty list of options "+o.identify());q=void 0;if(u.length===1){o.addClassName("one")}else{for(p=0,s=u.length;p<s;p++){r=u[p];t=r.getAttribute("data-value");assert(t,r.identify()+" missing data value");r.observe("click",k(r,o,u));r.observe("mouseenter",e);r.observe("mouseleave",g);if(r.hasClassName("selected")){q=r}}$(document.body).observe("click",function(v){if($(v.target).up(".ul_select_menu")===o){return}return d(o)})}if(!q){q=u[0]}q.addClassName("selected");m=new Element("span");n=q.getDimensions();m.setStyle({width:n.width+"px",height:n.height+"px",position:"relative",display:"inline-block"});return o.wrap(m)};c=function(){var q,p,n,o,m;o=$$(".ul_select_menu");m=[];for(p=0,n=o.length;p<n;p++){q=o[p];m.push(h(q))}return m};Util.smartLoad(c);return{init:function(m){return h(m)},set_selected_by_value:b}})();JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){if(window.location.href.endsWith("#")&&window.pageYOffset===0&&JumpWatcher.last_page_offset!==0){return this.report()}else{this.last_page_offset=window.pageYOffset;return this.last_hash=Util.url_hash()}},report:function(){clearInterval(JumpWatcher.interval);return assert(0.1+0.2===0.3,"Hash jump detected, last hash = "+this.last_hash)}};TitleBubble=(function(){var b,f,c,d,a,e;e=0;a=function(g){return e=g};d=function(l){var g,n,k,h,j,m;n=$j(l.currentTarget);m=n.attr("title");if(m!=null?m.length:void 0){n.attr("data-title",m);n.removeAttr("title")}g=$j("<div/>",{"class":"title_bubble_container"});if(n.hasClass("white")){g.addClass("white")}if(n.hasClass("black")){g.addClass("black")}g.text(n.attr("data-title"));j=$j("<div/>",{"class":"tail"});g.append(j);$j(document.body).append(g);h=f(n[0],g[0]);k=b(h,g[0],n[0]);g.clonePosition(n,{setWidth:false,setHeight:false,offsetTop:k.top-e,offsetLeft:k.left});g.addClass("position-"+h);j.css("margin-left",k.tail_offset_left+"px");return j.css("margin-top",k.tail_offset_top+"px")};f=function(l,g){var k,j,h;l=$(l);h=l.getAttribute("data-title-position");k=document.viewport.getDimensions();j=l.viewportOffset();if(!(h==="above"||h==="below"||h==="right"||h==="left")){h="above"}if(h==="left"){if(j.left<g.width){return"right"}}else{if(h==="right"){if(k.width-(j.left+l.getWidth())<g.width){return"left"}}else{if(h==="below"){if(k.height-(j.top+l.getHeight())<g.height){return"above"}}else{if(h==="above"){if(j.top<g.height){return"below"}}}}}return h};b=function(j,q,m){var o,k,r,n,p,l,g,t,s,h;q=$(q);m=$(m);r=document.viewport.getDimensions();o=q.getDimensions();n=m.viewportOffset();k=6;p=0;l=0;s=0;h=0;if(j==="below"||j==="above"){if(j==="below"){l=m.getHeight()+k}else{l=(-1*o.height)-k}g=m.getWidth()/2-o.width/2;if(n.left+g+o.width>r.width){p=r.width-n.left-o.width;s=g-p-4}else{p=g;s=-4}}if(j==="left"||j==="right"){if(j==="right"){p=m.getWidth()+k}else{p=(-1*o.width)-k}t=m.getHeight()/2-o.height/2;if(n.top+t+o.height>r.height){l=r.height-n.top-o.height;h=t-l-4}else{l=t;h=-4}}return{left:p,top:l,tail_offset_left:s,tail_offset_top:h}};c=function(l){var m,k,h,j,g;j=$$(".title_bubble_container");g=[];for(k=0,h=j.length;k<h;k++){m=j[k];g.push(Element.remove(m))}return g};return{init:function(){$j(document).on("mouseover",".title_bubble",d);return $j(document).on("mouseleave",".title_bubble",c).on("mouseup",".title_bubble",c)},set_vertical_space:a,hide_all:function(){return c()}}})();Event.observe(window,"scroll",function(){return TitleBubble.hide_all()});FreshDropdown={show:function(f,c,b){var e,d,h,a,g=this;e=$j(c);if(!b){b=e[0].offsetHeight}this.hide_all();d=$j(f).show();a=d[0].offsetWidth;h=e[0].offsetWidth;d.clonePosition(e,{setHeight:false,setWidth:false,offsetLeft:-1*(a-h),offsetTop:b});c.addClassName("pressed");return(function(){return document.observe("click",g.hide_all)}).defer()},hide_all:function(a){$$(".freshdropdown-menu").invoke("hide");$$(".freshdropdown-button").invoke("removeClassName","pressed");return document.stopObserving("click",this.hide_all)}};Util.smartLoad(function(){JumpWatcher.interval=setInterval(JumpWatcher.check.bind(JumpWatcher),500);LocaleSelector.init();ModalLocaleSelector.init();LoginDropdown.init();TitleBubble.init();return Tabs.init()});Spinner={showLoading:function(h,a,g,d){var b,e,f,c;g=true;e=$("spinner-loading");a=$(a);if(!e){e=new Element("div",{id:"spinner-loading"});b=new HTML('<table style="height: 100%; width: 100%; background:#fff;">\n  <tr>\n  <td valign="top">\n    <div id="spinner-loading-text" style="padding-top: 16px;text-align:center;"></div>\n  </td>\n  </tr>\n</table>');e.__date(b);document.body.appendChild(e)}$j(e).clonePosition($j(a));if(e.getWidth()===0){return}if(Util.ie){e.style.left=a.getBoundingClientRect().left+"px"}e.setOpacity(0.9);f=$("spinner-loading-text");if(h){f.__date()}else{c=new Element("img",{src:"/static/images/icons/ajax-loading.gif",style:"vertical-align: bottom;"});f.__date(c);if(!g){f.__sert(_("Loading..."))}}$("spinner-loading").show();if(d){return e.style.zIndex="1001"}},hideLoading:function(){return $("spinner-loading").hide()}};var BulkUpload,CrossDomainUploader,FileQueue,InlineUploadStatus,Upload,UploadFile;Upload={QUEUE_EVT:"db:upload:queue",QUEUE_ERROR_EVT:"db:upload:queue_error",UPDATE_EVT:"db:upload:update",COMPLETE_EVT:"db:upload:complete",ERROR_EVT:"db:upload:error",CANCEL_EVT:"db:upload:cancel",SWFU:false,current_dest:null,init:function(c,d){var b,a;a={};Object.extend(a,Upload.cookies);b=Upload.initSWFU(a);if(!d){Util.smart_window_load(b)}else{b()}Upload.current_dest=c;$$(".swfupload").each(function(e){if(e.observe){Util.freshbutton_overlay(e,$("choose-button"));return Util.freshbutton_overlay(e,$("add-button"))}});Upload.operaHack();return FileQueue.clear()},init_basic:function(){Util.freshbutton_overlay($("file-box"),$("basic-choose-button"));$("basic-choose-button").observe("mousemove",function(c){var b,a,d;b=$("modal").cumulativeOffset();d=c.clientY-b.top-3;a=c.clientX-b.left-$("file-box").getWidth()+3;return $("file-box").setStyle({top:d+"px",left:a+"px"})});return $("file-box").observe("change",function(){var d,b,e,c,a;Modal.hide=function(){};$("modal-x").hide();$("basic-upload-desc").hide();$("basic-upload-buttons").hide();$("file-box").hide();b=$("file-box").getValue().split("\\").pop();c=Sprite.make("web",FileOps.filename_to_icon(b));$("basic-upload-status").down(".icon").__date(c);d=_("Uploading %(filename)s").format({filename:b.em_snippet(25)});$("basic-upload-status").down(".file-desc").__date(d);$("basic-upload-status").show();$("basic-uploading-message").show();if(window.File&&window.FileList){e=$("file-box").files;if(e){a=e[0].lastModifiedDate;$("mtime").value=Math.round(Date.parse(a)/1000)||0}}return $("basic-upload-form").submit()})},initSWFU:function(a){return function(){var b;b=new SWFUpload({upload_url:"https://"+Constants.BLOCK_CLUSTER+"/upload",file_post_name:"file",file_size_limit:"307200",file_types:"*",file_types_description:_("All files"),file_upload_limit:"0",button_placeholder_id:"flash-upload-button-placeholder",button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_width:1000,button_height:1000,button_cursor:SWFUpload.CURSOR.HAND,swfupload_loaded_handler:Upload.flashLoaded,file_queued_handler:Upload.fileQueued,file_queue_error_handler:Upload.fileQueueError,upload_progress_handler:Upload.uploadProgress,upload_error_handler:Upload.uploadError,upload_success_handler:Upload.uploadSuccess,upload_complete_handler:Upload.uploadComplete,flash_url:"/static/swf/swfupload.swf",custom_settings:{progress_target:"fsUploadProgress",upload_successful:false},post_params:a,debug:Constants.upload_debug||false});return Upload.SWFU=b}},reset:function(){var a;if(FileQueue.uploading&&FileQueue.current_file){if(CrossDomainUploader.is_cross_domain(FileQueue.current_file)){CrossDomainUploader.current_req.transport.abort()}else{Upload.SWFU.cancelUpload()}}a=$$(".swfupload").first();if(a&&a.remove){a.remove()}delete Upload.SWFU;FileQueue.clear();return InlineUploadStatus.hide()},show_upload:function(){var a;$("upload-desc").hide();$("dnd-upload-desc").hide();$("upload-files-list").show();$("upload-start-buttons").hide();$("upload-running-buttons").show();$("hide-button").show();$("done-button").hide();a=$$(".swfupload").first();if(a){$j("#flash-upload-container").clonePosition($j("#add-button"));a.width=$("add-button").getWidth();a.height=$("add-button").getHeight()}if(!$("modal-overlay").visible()){return InlineUploadStatus.show()}},updatePostParams:function(c){var b,a;a=Upload.SWFU.getSetting("post_params");for(b in c){if(c.hasOwnProperty(b)){a[b]=c[b]}}return Upload.SWFU.setPostParams(a)},fileQueueError:function(d,b,c){var e,a;a=_("File too large");e=_('The upload limit online is 300MB. You can upload larger files with the <a id="install_link">Dropbox desktop application</a>.');e=e.replace('id="install_link"','href="/install" target="_blank"');switch(b){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:a,tooltip_text:e});break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:if(d.size!=null){document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:_("Empty file"),tooltip_text:_("You can't upload an empty file.")})}else{document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:a,tooltip_text:e})}break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:_("Invalid file type"),tooltip_text:_("This file does not have an allowed file type.")});break;default:document.fire(Upload.QUEUE_ERROR_EVT,{file:d});this.debug("Error code: "+b+", file name: "+d.name+", file size: "+d.size+", message: "+c)}return Upload.show_upload()},fileQueued:function(a){document.fire(Upload.QUEUE_EVT,{file:a});return Upload.show_upload()},uploadNext:function(){if(CrossDomainUploader.is_cross_domain(FileQueue.next())){CrossDomainUploader.upload_next()}else{Upload.updatePostParams({dest:FileQueue.next_dest(),t:Constants.TOKEN});Upload.SWFU.startUpload()}FileQueue.last_update_time=0;return FileQueue.last_update_size=0},pause:function(){return Upload.SWFU.stopUpload()},uploadProgress:function(c,b,a){if(!FileQueue.cancelled_files[c.id]){return document.fire(Upload.UPDATE_EVT,{file:c,percent_complete:b/a})}},uploadSuccess:function(b,a){if(a.strip()===""){return document.fire(Upload.ERROR_EVT,{file:b})}else{if(a==="quota"){return document.fire(Upload.ERROR_EVT,{file:b,message:_("Quota exceeded"),tooltip_text:_("Your upload failed because you are over quota.")})}else{if(a==="folder_exists"){return document.fire(Upload.ERROR_EVT,{file:b,message:_("Invalid file name"),tooltip_text:_("You can't upload a file with the same name as a folder in this folder.")})}else{return document.fire(Upload.UPDATE_EVT,{file:b,percent_complete:1})}}}},uploadComplete:function(a){if(!FileQueue.cancelled_files[a.id]&&!FileQueue.errored_files[a.id]){return document.fire(Upload.COMPLETE_EVT,{file:a})}},uploadError:function(e,b,d){var c,a;c=e;if(parseInt(b,10)!==-280){a=FlashDetect.major+"."+FlashDetect.revision;Util.report_exception("Uploader error: "+b+" "+d+" "+(Object.toJSON(e))+" FLASH VERSION: "+a,window.location.href)}switch(b){case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:this.debug("Error code: No backend file, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:this.debug("Error code: upload limit exceeded, file name: "+c.name+", file size: "+c.size+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:this.debug("Error code: HTTP error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:this.debug("Error code: upload failed, file name: "+c.name+", file size: "+c.size+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:this.debug("Error code: IO error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:this.debug("Error code: security error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:this.debug("Error code: upload cancelled, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:this.debug("Error code: upload stopped, file name: "+c.name+", message: "+d);break;default:this.debug("Error code: "+b+(", file name: "+c.name+", file size: "+c.size+", message: "+d))}if(FileQueue.files[e.id]){return document.fire(Upload.ERROR_EVT,{file:e,error_code:b})}},grabURL:function(){var a;a=$F("file-box");if(/(^http|^https|^ftp):\/\//.match(a)){$("url").value=a}return true},set_dest:function(a){var b;Upload.current_dest=a;DomUtil.fillVal(a,"dest-folder");b=$("basic-uploader-url");if(b){return b.href=b.href.replace(/(\/upload)(.*)(\?basic=1)/,function(e,d,g,c){return d+Util.urlquote(a)+c})}},treeview_handler:function(b,a){Upload.set_dest(b);return FileQueue.clear()},new_folder:function(){TreeView.hide();Modal.show(_("Create new folder..."),DomUtil.fromElm("create-folder"),{action:Upload.do_new_folder,wit_group:"new-folder-confirm"});if(!Util.ie){return $("first-treeview-link").onclick()}},do_new_folder:function(){var b,a;if(!Modal.vars.selected_path){Notify.server_error(_("Please select a parent folder."));return}a=$F("entered-name");b=Modal.vars.selected_path;return new Ajax.DBRequest("/cmd/new"+Util.urlquote(b)+"?to_path="+Util.urlquote(a),{onSuccess:function(c){Upload.treeview_handler(Util.normalize(b)+"/"+a);return TreeView.schedule_reset()},cleanUp:function(){}})},flashLoaded:function(){var a;if($("upload-start-buttons").visible()){$("upload-loading").hide();$("choose-button").show();a=$$(".swfupload").first();if(a){$j("#flash-upload-container").clonePosition($j("#choose-button"));a.width=$("choose-button").getWidth();return a.height=$("choose-button").getHeight()}}},operaHack:function(){if(Prototype.Browser.Opera){return Upload.opera_tid=setInterval(function(){return $("opera-dummy-div").toggle()},200)}}};FileQueue={files:{},file_ids:[],uploading:false,num_left:0,queue_size:0,completed_size:0,completed_files:{},errors:0,errored_files:{},cancels:0,cancelled_files:{},all_cancelled:false,last_update_time:0,last_update_size:0,average_bps:0,formatted_time:null,init:function(){return FileQueue._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,FileQueue._file_queued);document.observe(Upload.QUEUE_ERROR_EVT,FileQueue._file_queue_errored);document.observe(Upload.UPDATE_EVT,FileQueue._file_updated);document.observe(Upload.COMPLETE_EVT,FileQueue._file_completed);document.observe(Upload.ERROR_EVT,FileQueue._file_errored);return document.observe(Upload.CANCEL_EVT,FileQueue._file_cancelled)},_file_queued:function(b){var a;a=b.memo.file;FileQueue.queue_size+=a.size;FileQueue.files[a.id]=a;FileQueue.file_ids.push(a.id);FileQueue.num_left++;if(!FileQueue.uploading){FileQueue._start_uploading()}return T("File queued:",a.name)},_file_queue_errored:function(a){FileQueue._file_queued(a);return setTimeout((function(){return FileQueue._file_errored(a)}),250)},_file_updated:function(k){var d,a,b,c,h,g,f,j,l;c=k.memo.file;g=k.memo.percent_complete;h=g*c.size;l=FileQueue.completed_size+h;b=new Date().getTime();if(FileQueue.last_update_time){f=(b-FileQueue.last_update_time)/1000;a=h-FileQueue.last_update_size;d=a/f;FileQueue.average_bps=((l-a)*FileQueue.average_bps+a*d)/l;j=(FileQueue.queue_size-l)/FileQueue.average_bps;FileQueue.formatted_time=Util.formatTime(j+FileQueue.num_left)}FileQueue.current_file=c;FileQueue.last_update_time=new Date().getTime();FileQueue.last_update_size=h;return FileQueue.totalPercentage=l/FileQueue.queue_size},_file_completed:function(b){var a;a=b.memo.file;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.completed_files[a.id]=true;FileQueue.completed_size+=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;T("File completed:",a.name);return FileQueue._check_if_finished(a)},_file_errored:function(b){var a;a=b.memo.file;FileQueue.errors=FileQueue.errors+1;FileQueue.errored_files[a.id]=true;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.queue_size-=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;BulkUpload.update_errors();InlineUploadStatus.update_errors();T("File errored:",a.name);return FileQueue._check_if_finished(a)},_file_cancelled:function(b){var a;a=b.memo.file;delete FileQueue.files[a.id];FileQueue.file_ids.splice(FileQueue.file_ids.indexOf(a.id),1);FileQueue.cancels=FileQueue.cancels+1;FileQueue.cancelled_files[a.id]=true;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.queue_size-=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;if(CrossDomainUploader.is_cross_domain(a)){if(FileQueue.current_file===a){CrossDomainUploader.current_req.transport.abort()}}else{Upload.SWFU.cancelUpload(a.id)}T("File cancelled:",a.name);return FileQueue._check_if_finished(a)},_start_uploading:function(){var a;Upload.uploadNext();FileQueue.uploading=true;FileQueue.all_cancelled=false;return window.onbeforeunload=a=function(){return _("Leaving this page will cancel your uploads.")}},_check_if_finished:function(a){if(FileQueue.empty()){if(FileQueue.uploading){return FileQueue._finished_uploading()}}else{if(!FileQueue.all_cancelled&&FileQueue.current_file&&a.id===FileQueue.current_file.id){return Upload.uploadNext()}}},_finished_uploading:function(){var b,c,a;FileQueue.uploading=false;if(!FileQueue.num_files()){BulkUpload.cancelled()}else{if(FileQueue.errors){BulkUpload.errored();InlineUploadStatus.errored()}else{BulkUpload.completed();InlineUploadStatus.completed()}}a=InlineUploadStatus.upload_box&&InlineUploadStatus.upload_box.visible();Browse.select_fq_paths=[];if(Browse.inside_dir){b=Browse.containing_fq_path();for(c in FileQueue.completed_files){Browse.select_fq_paths.push(b+"/"+FileQueue.files[c].name)}}Browse.force_reload();if(a){InlineUploadStatus.show()}Modal.onHide=null;return window.onbeforeunload=null},empty:function(){return !FileQueue.num_left},num_files:function(){return FileQueue.file_ids.length},next:function(){var a;if(FileQueue.num_left!==0){a=FileQueue.num_files()-FileQueue.num_left;return FileQueue.files[FileQueue.file_ids[a]]}},next_dest:function(){var b,a;a=FileQueue.next();b=a&&a.id;if(b&&$(b)){return $(b).readAttribute("data-dest")}else{return a.dest||Upload.current_dest}},clear:function(a){FileQueue.files={};FileQueue.file_ids=[];FileQueue.queue_size=0;FileQueue.cancels=0;FileQueue.cancelled_files={};FileQueue.all_cancelled=false;FileQueue.errors=0;FileQueue.errored_files={};FileQueue.num_left=0;FileQueue.completed_size=0;FileQueue.completed_files={};FileQueue.last_update_time=0;FileQueue.last_update_size=0;FileQueue.average_bps=0;FileQueue.formatted_time=null;FileQueue.uploading=false;window.onbeforeunload=null;return Modal.onHide=null}};UploadFile={FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_tmpl:null,init:function(){UploadFile._tmpl=HTML.tmpl("upload_list_item_tmpl");return UploadFile._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,UploadFile._file_queued);document.observe(Upload.QUEUE_ERROR_EVT,UploadFile._file_queue_errored);document.observe(Upload.UPDATE_EVT,UploadFile._file_updated);document.observe(Upload.COMPLETE_EVT,UploadFile._file_completed);document.observe(Upload.ERROR_EVT,UploadFile._file_errored);return document.observe(Upload.CANCEL_EVT,UploadFile._file_cancelled)},_file_queued:function(f){var j,b,a,h,g,k,c,d;b=f.memo.file;j=b.dest||Upload.current_dest;k=b.size!=null?Util.formatBytes(b.size,2,true):_("Too large");a=UploadFile._tmpl({file:b,icon:FileOps.filename_to_icon(b.name),filename_snippet:b.name.em_snippet(UploadFile.FILENAME_SNIPPET_LENGTH),size:k,dest:j,dest_snippet:("Dropbox"+j).em_snippet(UploadFile.DEST_SNIPPET_LENGTH,0)});$("upload-files-list").__sert(a);h=$(b.id);g=FileQueue.num_files()+FileQueue.cancels;c=$("upload-files-list");if(g<=6||IE7_OR_LESS){c.removeClassName("scroll")}else{c.addClassName("scroll");c.scrollTop=c.scrollHeight}h.down(".dest").observe("click",function(){Browse.reload_fqpath(h.readAttribute("data-dest"),true);return Modal.hide()});d=h.down(".status-col").down("a.small-x-button");d.stopObserving("click");d.observe("click",function(l){return document.fire(Upload.CANCEL_EVT,{file:b})});return h.down(".upload-progress-bar").setStyle({width:"0"})},_file_queue_errored:function(a){UploadFile._file_queued(a);return UploadFile._file_errored(a)},_file_updated:function(f){var c,g,b,a,d;c=f.memo.file;g=$(c.id);if(FileQueue.num_files()+FileQueue.cancels===1){if(FileQueue.formatted_time){a=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});g.down(".time-col").__date(a)}}else{g.down(".time-col").__date()}b=parseInt(100*f.memo.percent_complete,10)+"%";if(b==="100%"){g.down(".time-col").__date();g.down(".status-col").__date(new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"}))}else{d=g.down(".status-col").down("a.small-x-button");if(d){d.stopObserving("click");d.observe("click",function(h){return document.fire(Upload.CANCEL_EVT,{file:c})})}}return g.down(".upload-progress-bar").setStyle({width:b})},_file_completed:function(b){var a,c;a=b.memo.file;c=$(a.id);c.addClassName("complete");c.down(".time-col").__date();c.down(".status-col").__date(Sprite.make("web","synced"));return c.down(".upload-progress-bar").setStyle({width:"100%"})},_file_errored:function(f){var a,c,b,g,d;b=f.memo.file;g=$(b.id);g.addClassName("error");g.down(".dest-col").hide();g.down(".time-col").__date();g.down(".status-col").__date(Sprite.make("web","nosync"));g.down(".upload-progress-bar").setStyle({width:"100%"});c=f.memo.message||_("Flash error");a=void 0;if(f.memo.tooltip_text){a=f.memo.tooltip_text}else{if(parseFloat(Util.flash_version(),10)<10.32){a=_('Upload failed.  Please try upgrading to the latest version of <a id="adobe_link">Adobe Flash</a> and try again.');a=a.replace('id="adobe_link"','href="http://get.adobe.com/flashplayer/" target="_blank"')}else{a=_('Sorry, it looks like the advanced uploader is incompatible with your system. Please use the <a id="basic_link">basic uploader</a> to upload via the website');a=a.replace('id="basic_link"','onclick="FileOps.show_basic_upload(Browse.containing_fq_path()); return false;"')}}g.down(".error-msg").__date(c);d=g.down(".error-details");d.observe("mouseover",function(){return Tooltip.show(d,a)});return g.down(".error-col").show()},_file_cancelled:function(b){var a,c;a=b.memo.file;c=$(a.id);c.addClassName("cancelled");c.down(".dest-col").__date(_("Canceled"));c.down(".time-col").__date();c.down(".status-col").__date(Sprite.make("web","cancelsync"));return c.down(".upload-progress-bar").setStyle({width:"100%"})}};BulkUpload={init:function(){return BulkUpload._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,BulkUpload._file_queued);return document.observe(Upload.UPDATE_EVT,BulkUpload._file_updated)},_file_queued:function(c){var a,b;a=$("bulk-upload-status");a.removeClassName("error");a.removeClassName("complete");a.removeClassName("cancelled");b=new Element("a",{"class":"small-x-button"});b.observe("click",function(){var f,h,g,e,d;FileQueue.all_cancelled=true;f=FileQueue.file_ids.slice(0);d=[];for(g=0,e=f.length;g<e;g++){h=f[g];if(!FileQueue.completed_files[h]&&!FileQueue.errored_files[h]){d.push(document.fire(Upload.CANCEL_EVT,{file:FileQueue.files[h]}))}else{d.push(void 0)}}return d});return a.down(".status").__date(b)},_file_updated:function(h){var g,d,c,f,b,a;c=FileQueue.num_files();if(c+FileQueue.cancels>1){g=$("bulk-upload-status");f=ungettext("%d file","%d files",c).format(c);g.down(".num-files").__date(f);b=_("- %(size)s").format({size:Util.formatBytes(FileQueue.queue_size,2,true)});g.down(".size").__date(b);if(FileQueue.formatted_time){a=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});g.down(".time-left").__date(a)}g.down(".upload-progress-bar").style.width=(100*FileQueue.totalPercentage||0).toFixed(2)+"%";g.show();d=$$(".swfupload").first();if(d){$j("#flash-upload-container").clonePosition($j("#add-button"));d.width=$("add-button").getWidth();return d.height=$("add-button").getHeight()}}},update_errors:function(){var a;a=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);return $("bulk-upload-status").down(".num-errors").__date(a)},completed:function(){var d,b,c,a;$("hide-button").hide();$("done-button").show();b=FileQueue.num_files();if(b+FileQueue.cancels>1){d=$("bulk-upload-status");d.addClassName("complete");c=ungettext("Uploaded %d file","Uploaded %d files",b).format(b);d.down(".num-files").__date(c);a=_("- %(size)s").format({size:Util.formatBytes(FileQueue.completed_size,2,true)});d.down(".size").__date(a);d.down(".num-errors").__date();d.down(".time-left").__date();d.down(".status").__date(Sprite.make("web","synced"));return d.down(".upload-progress-bar").style.width="100%"}},errored:function(){var d,e,b,c,a;$("hide-button").hide();$("done-button").show();b=FileQueue.num_files();if(b+FileQueue.cancels>1){d=$("bulk-upload-status");d.addClassName("error");c=ungettext("Uploaded %(num_completed)d of %(num_files)d file","Uploaded %(num_completed)d of %(num_files)d files",b).format({num_completed:b-FileQueue.errors,num_files:b});d.down(".num-files").__date(c);a=_("- %(size)s").format({size:Util.formatBytes(FileQueue.completed_size,2,true)});d.down(".size").__date(a);e=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);d.down(".num-errors").__date(e);d.down(".time-left").__date();d.down(".status").__date(Sprite.make("web","nosync"));return d.down(".upload-progress-bar").style.width="100%"}},cancelled:function(){var b,a;$("hide-button").hide();$("done-button").show();a=FileQueue.num_files();if(a+FileQueue.cancels>1){b=$("bulk-upload-status");b.addClassName("cancelled");b.down(".num-files").__date(_("All uploads canceled"));b.down(".size").__date();b.down(".num-errors").__date();b.down(".time-left").__date();b.down(".status").__date(Sprite.make("web","cancelsync"));return b.down(".upload-progress-bar").style.width="100%"}}};InlineUploadStatus={FILENAME_SNIPPET_LENGTH:30,upload_box:false,init:function(){return InlineUploadStatus._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,InlineUploadStatus._file_queued);return document.observe(Upload.UPDATE_EVT,InlineUploadStatus._file_updated)},_file_queued:function(c){var b,a;b=$("inline-upload-status");b.removeClassName("error");b.removeClassName("complete");b.down(".icon").__date(Sprite.make("web","syncing"));b.down(".file-desc").__date(_("Starting upload..."));b.down(".num-errors").__date();a=ungettext("%d file","%d files",FileQueue.num_left).format(FileQueue.num_left);b.down(".view-details").__date(a);b.down(".status").__date();return b.down(".inline-upload-progress").style.width="0%"},_file_updated:function(h){var d,f,c,g,b,a;d=h.memo.file;if($$("#right-content #inline-upload-status").length===0){InlineUploadStatus._build()}c=$("inline-upload-status");c.down(".icon").__date(Sprite.make("web","syncing"));f=_("Uploading %(filename)s").format({filename:d.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH)});c.down(".file-desc").__date(f);if(FileQueue.num_left>1){a=ungettext("%d file left","%d files left",FileQueue.num_left-1).format(FileQueue.num_left-1);c.down(".view-details").__date(a)}else{c.down(".view-details").__date(_("View details"))}if(FileQueue.formatted_time){b=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});c.down(".status").__date(b)}g=(parseInt(100*FileQueue.totalPercentage,10)||0)+"%";return c.down(".inline-upload-progress").style.width=g},update_errors:function(){var a;a=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);return $("inline-upload-status").down(".num-errors").__date(a)},add_x_button:function(){var a;a=new Element("a",{"class":"small-x-button"});a.observe("click",function(){InlineUploadStatus.hide();return Upload.reset()});return $("inline-upload-status").down(".status").__date(a)},completed:function(){var b,a;a=$("inline-upload-status");a.addClassName("complete");a.removeClassName("error");a.down(".icon").__date(Sprite.make("web","synced"));b=void 0;if(FileQueue.num_files()>1){b=_("Uploaded %(num_files)d files").format({num_files:FileQueue.num_files()})}else{b=_("Uploaded %(filename)s").format({filename:FileQueue.current_file.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH)})}a.down(".file-desc").__date(b);a.down(".num-errors").__date();a.down(".view-details").__date(_("View details"));InlineUploadStatus.add_x_button();return a.down(".inline-upload-progress").style.width="100%"},errored:function(){var d,c,a,f,b,e;a=$("inline-upload-status");a.addClassName("error");a.removeClassName("complete");a.down(".icon").__date(Sprite.make("web","nosync"));b=FileQueue.num_files();d=void 0;if(b>1){d=_("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:b-FileQueue.errors,num_files:b});a.down(".file-desc").__date(d);f=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);a.down(".num-errors").__date(f)}else{c=(e=FileQueue.current_file)!=null?e.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH):void 0;d=c?_("Unable to upload %(filename)s").format({filename:c}):_("Unable to upload file");a.down(".file-desc").__date(d);a.down(".num-errors").__date()}a.down(".view-details").__date(_("View details"));InlineUploadStatus.add_x_button();return a.down(".inline-upload-progress").style.width="100%"},show:function(a){if(!InlineUploadStatus.upload_box){InlineUploadStatus._build(a)}return InlineUploadStatus.upload_box.show()},_build:function(){if(!InlineUploadStatus.upload_box){InlineUploadStatus.upload_box=$("inline-upload-status")}return $("browse").__sert({top:InlineUploadStatus.upload_box})},hide:function(){if(InlineUploadStatus.upload_box){return InlineUploadStatus.upload_box.hide()}}};CrossDomainUploader={CROSS_DOMAIN_PREFIX:"cross-domain-",_drop_indicators:false,_drop_dest_folder:null,file_counter:0,current_req:null,supported:function(){return Prototype.BrowserFeatures.DB_CORS},enabled:function(){return CrossDomainUploader.supported()&&Browse.inside_dir},browse_indicators_enabled:function(){var d,b,c,a;if(!CrossDomainUploader.enabled()){return false}b=["file-preview-modal","modal-overlay"];for(c=0,a=b.length;c<a;c++){d=b[c];if($(d).visible()){return false}}return true},modal_indicators_enabled:function(){return CrossDomainUploader.enabled()&&$("modal").down("#upload-modal-dropzone")},_show_border_drop_indicators:function(){return $$(".external-drop-indicator").each(function(a){return $j(a).css("opacity",0).fadeTo(500,0.6)})},_hide_border_drop_indicators:function(){return $$(".external-drop-indicator").invoke("hide")},show_drop_indicators:function(b){var a;if(!CrossDomainUploader._drop_indicators){if(CrossDomainUploader.modal_indicators_enabled()){a=$("upload-modal-dropzone");$j(a).clonePosition($j("#modal"),{setLeft:false,setTop:false});a.style.lineHeight=a.getHeight()+"px";$j(a).fadeIn(500);CrossDomainUploader._show_border_drop_indicators()}else{if(CrossDomainUploader.browse_indicators_enabled()){BrowseDrag._add_drop_indicators(b)}else{return}}$("drag-status").removeClassName("active");return CrossDomainUploader._drop_indicators=true}},hide_drop_indicators:function(){if(CrossDomainUploader._drop_indicators){CrossDomainUploader._hide_border_drop_indicators();BrowseDrag._remove_drop_indicators();Notify.clear_all();$("upload-modal-dropzone").hide();$("drag-status").addClassName("active");return setTimeout((function(){CrossDomainUploader._drop_indicators=false;return CrossDomainUploader._drop_dest_folder=null}),500)}},folder_dragover:function(a){var b;if(CrossDomainUploader.browse_indicators_enabled()&&CrossDomainUploader._drop_indicators&&a!==CrossDomainUploader._drop_dest_folder){if(a===Browse.containing_fq_path()){b=_("Drop your file to upload to '%(folder_name)s'").format({folder_name:FileOps.filename(a).em_snippet(20)});Notify.server_success(b,60);CrossDomainUploader._show_border_drop_indicators()}else{Notify.clear_all();CrossDomainUploader._hide_border_drop_indicators()}return CrossDomainUploader._drop_dest_folder=a}},is_cross_domain:function(a){return a.id.indexOf(CrossDomainUploader.CROSS_DOMAIN_PREFIX)!==-1},supports_recursive_upload:function(a){var b;return window.File&&window.FileReader&&window.FileList&&window.Blob&&(a!=null?(b=a[0])!=null?b.webkitGetAsEntry:void 0:void 0)},upload:function(b,c,a){if(a==null){a=null}if(CrossDomainUploader.supports_recursive_upload(a)){return CrossDomainUploader._recursive_upload(b,a)}else{return CrossDomainUploader._upload(b,c,a)}},_recursive_upload:function(j,h){var k,b,c,g,e,l,a,d;d=(function(){var n,m,f;f=[];for(n=0,m=h.length;n<m;n++){e=h[n];f.push(e.webkitGetAsEntry())}return f})();a=[];c=0;l=0;k=3000;g=0;b=function(){var m,n,f;while(d.length){n=d.pop();if(n.isDirectory){m=n.createReader();c+=1;m.readEntries(function(o){var r,q,p;for(q=0,p=o.length;q<p;q++){r=o[q];d.push(r)}return c-=1})}else{l+=1;f=function(o){return function(p){a.push(p);p.dest=j+Util.parentDir(o.fullPath);return l-=1}};n.file(f(n))}}if(a.length>k&&!g){g=1;Notify.server_error(_("The Dropbox website can't upload more than %(max_files)s files.").format({max_files:k}));return}if(c||l){return b.defer()}else{if(a.length){return CrossDomainUploader._upload("",a)}}};return b()},_upload:function(d,f,c){var a,e,g,b;if(c==null){c=null}if(c){a=this._parse_upload_items(c)}Upload.current_dest=d;if(!$("modal").visible()){FileOps.show_upload();Modal.hide(null,true)}for(g=0,b=f.length;g<b;g++){e=f[g];if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(a!=null?a[e.name].isDirectory:void 0)){e.is_directory=true}e.id=CrossDomainUploader.CROSS_DOMAIN_PREFIX+CrossDomainUploader.file_counter;e.dest=e.dest||d;CrossDomainUploader.file_counter++;document.fire(Upload.QUEUE_EVT,{file:e})}return Upload.show_upload()},_parse_upload_items:function(b){var c,d,e,a;c={};for(e=0,a=b.length;e<a;e++){d=b[e];if(d.getAsEntry){d=d.getAsEntry()}else{if(d.webkitGetAsEntry){d=d.webkitGetAsEntry()}}c[d.name]=d}return c},upload_next:function(){var c,a,b;c=FileQueue.next();if((c.is_directory!=null)&&c.is_directory){setTimeout(CrossDomainUploader._onFolderUpload.curry(c),250);return}b="//"+Constants.BLOCK_CLUSTER+"/upload_cross_domain?filename="+encodeURIComponent(c.name||c.fileName)+"&dest="+encodeURIComponent(FileQueue.next_dest())+"&t="+encodeURIComponent(Constants.TOKEN);FileQueue.current_file=c;if(c.size===!void 0){a=c.size}else{a=c.fileSize}return CrossDomainUploader.current_req=new Ajax.DBRequest(b,{method:"POST",contentType:c.type||"application/octet-stream",evalJS:false,evalJSON:false,no_watch:true,requestHeaders:{"If-Modified-Since":"Mon, 26 Jul 1997 05:00:00 GMT","Cache-Control":"no-cache","X-File-Name":c.name||c.fileName,"X-File-Size":a,"X-File-Type":c.type},postBody:c,onCreate:CrossDomainUploader._onCreate.bind(null,c),onSuccess:CrossDomainUploader._onSuccess.bind(null,c),onFailure:CrossDomainUploader._onFailure.bind(null,c)})},_onCreate:function(a,c){var b;b=c.request.transport;b.upload.addEventListener("progress",(function(d){if(!FileQueue.cancelled_files[a.id]){return document.fire(Upload.UPDATE_EVT,{file:a,percent_complete:d.loaded/d.total})}}),false);return b.send=b.send.wrap(function(e,d){this.withCredentials="true";return e(d)})},_onSuccess:function(a,b){return document.fire(Upload.COMPLETE_EVT,{file:a})},_onFailure:function(a,b){if(!FileQueue.cancelled_files[a.id]){if(a.size){return document.fire(Upload.ERROR_EVT,{file:a,message:_("Upload error"),tooltip_text:_("Please try again. If this continues to fail, your browser might not support drag and drop uploads.")})}else{return document.fire(Upload.ERROR_EVT,{file:a,message:_("Invalid type"),tooltip_text:_("You can't upload folders or files of this type.")})}}},_onFolderUpload:function(a){document.fire(Upload.ERROR_EVT,{file:a,message:_("Invalid type"),tooltip_text:_("Drag and drop doesn't support folder uploads.")});if(!FileQueue.empty()){return CrossDomainUploader.upload_next()}}};var AccountExtras,BonusTable,DowngradeReasons,Downloading,EmailChange,EmailVerification,Fromo,GetSpace,Help,Home,Hosts,Install,LoginAndRegister,News,PasswordChange,PromoHolder,Recover,Restore,SecurityTab,TabController,Upgrade;Hosts={edit:function(g){var d,c,f,a,b,e;f=$("host"+g);if(f.editing){return false}f.editing=true;c=f.innerHTML.unescapeHTML();f.previous=c;e=c.escapeHTML().gsub('"',"&quot;");b=_("Save");d=_("Cancel");f.innerHTML='<input type="text" class="skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" value="'+e+'">&nbsp;\n<input type="button" onclick="Hosts.doneEditing(\''+g+'\')" class="button" value="'+b+'">&nbsp;\n<input type="button" onclick="Hosts.cancelEditing(\''+g+'\')" class="button grayed" value="'+d+'">';a=f.down("input");Event.observe(a,"keydown",Hosts.checkKey(g));a.select();return false},doneEditing:function(c){var b,a;b=$("host"+c);a=b.down("input").value;return new Ajax.DBRequest("/computer_edit?host_id="+c+"&name="+Util.urlquote(a),{onSuccess:function(d){return Hosts.unedit(b,d.responseText)}})},cancelEditing:function(b){var a;a=$("host"+b);return Hosts.unedit(a,a.previous)},unedit:function(b,a){b.editing=false;return b.__date(a)},unlink:function(c,b,a){DomUtil.fillVal(b.escapeHTML(),"unlink-confirm-name");return Modal.icon_show("alert_32",_("Unlink computer?"),DomUtil.fromElm("unlink-confirm"),{host_id:c,plat:a,wit_group:"unlink-confirm"})},doUnlink:function(b,a){return new Ajax.DBRequest("/computer_edit?host_id="+b+"&unlink=yessir",{onSuccess:function(c){Hosts.killRow(b);return Hosts.dec_count(a)}})},dec_count:function(a){var c,b,e,d;b=$(a+"-count");if(!b){return}d=b.innerHTML.split(" ");c=parseInt(d.shift(),10);e=d.join(" ");if(!c){return}c--;if(c===1&&e.charAt(e.length-1)==="s"){e=e.substr(0,e.length-1)}else{if(c!==1&&e.charAt(e.length-1)!=="s"){e=e+"s"}}return b.innerHTML=c.toString()+" "+e},killRow:function(d){var b,a,c;a=$("host"+d).up("table");$("host"+d).up("tr").remove();if(Hosts.rowCount()===0){b=new Element("tr");c=new Element("td",{colspan:4});c.__date(HTML.tmpl("<center><%= text %></center>",{text:_("You no longer have any hosts linked.")}));a.__sert(b);b.__sert(c);return $("my-computers-table").__date(b)}},rowCount:function(){return $$("#my-computers-table .host-row").length},checkKey:function(a){return function(b){b=b||window.event;if(b.keyCode===Event.KEY_RETURN){Hosts.doneEditing(a)}if(b.keyCode===Event.KEY_ESC){return Hosts.cancelEditing(a)}}}};Upgrade={card_toggle:function(a){return function(c){var b;b=$(c);if(c===a||!a){return b.removeClassName("cc-icon-off")}else{return b.addClassName("cc-icon-off")}}},highlightCardtype:function(){var c,e,b,a,d;e=$("ccn");if(Upgrade.last_val===e.value){return}Upgrade.last_val=e.value;b=e.value;d=b.substr(0,2);c=$A(["visa","mastercard","amex"]);a=null;if(b.charAt(0)==="4"){a="visa"}else{if(d==="34"||d==="37"){a="amex"}else{if(parseInt(d,10)>=51&&parseInt(d,10)<=55){a="mastercard"}}}return c.each(Upgrade.card_toggle(a))},runCardHighlighter:function(){return setInterval(Upgrade.highlightCardtype,200)},submitPaypal:function(){var a;if(!Forms.submitOnlyOnce()){return}a={plan:Forms.value("plan"),period:Forms.value("period")};if(Forms.value("packrat")){a.packrat="yes"}return location.href=Util.add_qstring("/paypal_upgrade",a)},upgradeViaLogin:function(){var a,b;if(!Forms.submitOnlyOnce()){return}a={plan:Forms.value("plan"),period:Forms.value("period")};if(Forms.value("packrat")){a.packrat="yes"}b=Util.add_qstring("/upgrade",a);return location.href=Util.add_qstring("/login",{cont:b})},setFormToObserveLogin:function(){return $("upgrade-login-button").observe("click",Upgrade.upgradeViaLogin)},setFormPaypalSubmitState:function(a){var b;b=$("upgrade-button");if(!b){return}if(a){return b.observe("click",Upgrade.submitPaypal)}else{return b.stopObserving("click")}},watchPaymentOptions:function(){var l,h,g,d,k,b,a,j,f,c,e;j=$$("a.toggle_paypal_link");for(h=0,k=j.length;h<k;h++){l=j[h];l.observe("click",function(){$("credit-card-info").addClassName("hidden_elem");$("submitted_cc").writeAttribute("value","false");$("paypal-info").removeClassName("hidden_elem");$("toggle_paypal_link_container").addClassName("hidden_elem");$("toggle_credit_card_link_container").removeClassName("hidden_elem");return Upgrade.setFormPaypalSubmitState(true)})}f=$$("a.toggle_credit_card_link");for(g=0,b=f.length;g<b;g++){l=f[g];l.observe("click",function(){var m;$("credit-card-info").removeClassName("hidden_elem");$("submitted_cc").setValue("true");m=$("paypal-info");if(m){$("paypal-info").addClassName("hidden_elem")}$("toggle_paypal_link_container").removeClassName("hidden_elem");$("toggle_credit_card_link_container").addClassName("hidden_elem");Upgrade.setFormPaypalSubmitState(false);return $("ccn").focus()})}c=$$("a.change_billing_information");e=[];for(d=0,a=c.length;d<a;d++){l=c[d];e.push(l.observe("click",function(){var u,r,v,t,m,x,w,q,o,s,p,n;$("toggle_paypal_link_container").removeClassName("hidden_elem");$("change_billing_information_container").addClassName("hidden_elem");$("upgrade-form").action="/upgrade";s=$$(".sick-input input");for(t=0,m=s.length;t<m;t++){v=s[t];v.writeAttribute("readOnly",false);v.removeClassName("gray")}$("country-list").removeClassName("hidden_elem");p=$$("[name='expmo']");for(q=0,x=p.length;q<x;q++){u=p[q];u.writeAttribute("disabled",false)}n=$$("[name='expyr']");for(o=0,w=n.length;o<w;o++){r=n[o];r.writeAttribute("disabled",false)}$("ccn").writeAttribute("value","");$("address").writeAttribute("value","");return $("ccode").writeAttribute("value","")}))}return e},plan_to_prices:{},plan_to_display_name:{},monthly_packrat_cost:0,yearly_packrat_cost:0,monthly_packrat_display_price:0,yearly_packrat_display_price:0,prorate_amount:0,has_packrat_already:false,plan_box_holder_ids:[],user_current_plan_size:0,user_current_billing_period:"",user_has_downgraded:false,initializeUpgradeForm:function(e,g,f,h,k,c,j,b,a,d){Upgrade.user_current_plan_size=e;Upgrade.user_current_billing_period=g;Upgrade.user_has_downgraded=f;Upgrade.monthly_packrat_cost=h;Upgrade.yearly_packrat_cost=k;Upgrade.monthly_packrat_display_price=c;Upgrade.yearly_packrat_display_price=j;Upgrade.prorate_amount=a;Upgrade.has_packrat_already=b;return Upgrade.setFormPaypalSubmitState(d)},registerPrice:function(c,a,b){return Upgrade.plan_to_prices[c]=[a,b]},registerPlanDisplayName:function(b,a){return Upgrade.plan_to_display_name[b]=[a]},registerPlanBoxHolderId:function(b,a){Upgrade.plan_box_holder_ids.push(b);return $(a).observe("click",function(){return Upgrade.updateSelectedPlanBoxHolder(b)})},updateSelectedPlanBoxHolder:function(d){var c,f,b,e,a;$(d).addClassName("selected-plan");e=Upgrade.plan_box_holder_ids;a=[];for(f=0,b=e.length;f<b;f++){c=e[f];if(c!==d){a.push($(c).removeClassName("selected-plan"))}else{a.push(void 0)}}return a},updateBillingForm:function(W){var C,S,A,D,b,s,w,e,a,G,R,F,u,c,O,E,l,B,v,I,d,z,y,V,U,Q,P,x,m,k,j,h,g,f,N,M,L,H,t,r,q,p,o,n,K,J;I=0;E=100;F=$("packrat");e=Upgrade.has_packrat_already||(F&&F.type==="checkbox"&&F.checked);G=_("month");R="$39.00";H=$$("[name='plan']");for(V=0,x=H.length;V<x;V++){s=H[V];if(s.checked){E=s.getValue();Upgrade.updateSelectedPlanBoxHolder("plan-"+E+"-holder")}}if(E===Upgrade.user_current_plan_size&&!Upgrade.user_has_downgraded){$("current-plan-desc").removeClassName("hidden_elem");$("billing-information").addClassName("hidden_elem")}else{$("current-plan-desc").addClassName("hidden_elem");$("billing-information").removeClassName("hidden_elem")}if($("period-month").checked){I=Upgrade.plan_to_prices[E][0];if(e){I+=Upgrade.monthly_packrat_cost}R=Upgrade.monthly_packrat_display_price;G=_("month");v="month"}if($("period-year").checked){I=Upgrade.plan_to_prices[E][1];if(e){I+=Upgrade.yearly_packrat_cost}R=Upgrade.yearly_packrat_display_price;G=_("year");v="year"}u=$("packrat-price");c=$("packrat-priceperiod");if(u&&c){u.__date(R);c.__date(G)}y=Upgrade.plan_to_prices[E][0]*12;if(e){y+=Upgrade.monthly_packrat_cost*12}w=Upgrade.plan_to_prices[E][1];if(e){w+=Upgrade.yearly_packrat_cost}B=y-w;O=B/y*100;O=Math.round(O);C=0;S=0;if(Upgrade.prorate_amount>=I){C=0;S=I}else{C=I-Upgrade.prorate_amount;S=Upgrade.prorate_amount}b=C;if(Upgrade.user_has_downgraded&&E===Upgrade.user_current_plan_size&&v===Upgrade.user_current_billing_period){b=0;S=0}b=b.toFixed(2);l=$("plan-name");if(l){l.__date(Upgrade.plan_to_display_name[E])}$("big-price").__date("$"+b);t=$$(".summary_price");for(U=0,m=t.length;U<m;U++){d=t[U];d.__date("$"+b)}r=$$(".monthly-price");for(Q=0,k=r.length;Q<k;Q++){a=r[Q];a.__date("$"+Upgrade.plan_to_prices[E][0].toFixed(2))}q=$$(".yearly-price");for(P=0,j=q.length;P<j;P++){z=q[P];z.__date("$"+Upgrade.plan_to_prices[E][1].toFixed(2))}$("savings-percentage").__date(O+"%");if(S){p=$$(".credit-holder");for(N=0,h=p.length;N<h;N++){D=p[N];D.removeClassName("hidden_elem")}o=$$(".credit-amount");K=[];for(M=0,g=o.length;M<g;M++){A=o[M];K.push(A.__date(S.toFixed(2)))}return K}else{n=$$(".credit-holder");J=[];for(L=0,f=n.length;L<f;L++){D=n[L];J.push(D.addClassName("hidden_elem"))}return J}},runPlanWatcher:function(){var d,e,h,f,c,b,g,a;g=$$("[name='plan']");for(h=0,c=g.length;h<c;h++){d=g[h];d.observe("click",Upgrade.updateBillingForm)}a=$$("[name='period']");for(f=0,b=a.length;f<b;f++){d=a[f];d.observe("click",Upgrade.updateBillingForm)}e=$("packrat");if(e){return e.observe("click",Upgrade.updateBillingForm)}}};Home={hide_promo:function(a){new Ajax.DBRequest(a);return $$(".bromo").invoke("remove")},hide:function(b,a){$(b).up("div").hide();return new Ajax.DBRequest("/hide/"+a)}};LoginAndRegister={init:function(a){$("login-link").observe("click",function(){$("login-and-register-container").removeClassName("show-register");return $("login_email").focus()});$("register-link").observe("click",function(){$("login-and-register-container").addClassName("show-register");return $("fname").focus()});if(a){return $("fname").focus()}else{return $("login_email").focus()}},invite_init:function(b,a){if(!a){return $("invite-register-page").on("click",".switch-form-link",function(){return $("invite-register-page").toggleClassName("show-login-form")})}}};News={DEFAULT_TAB:"recent-news",init:function(){$("news-home").on("click","#nav a",function(b,c){var a;if(c.hasAttribute("data-div")){b.preventDefault();a=c.readAttribute("data-div");return DBHistory.push_state("/news/"+a)}});return DBHistory.add_callback("/news",News.history_change)},change_tab:function(a){var b;b=$$("#nav a[data-div="+a+"]").first();if($(b)){$$(".section").invoke("removeClassName","selected");$$("#nav a").invoke("removeClassName","selected");$(b).addClassName("selected");return $(a).addClassName("selected")}},history_change:function(a){a=a||News.DEFAULT_TAB;return News.change_tab(a)}};Install={pingForLinkedHost:function(a){return new Ajax.Request("/host_linked",{method:"get",onSuccess:function(){return location.href="/share"+a},onFailure:function(){return setTimeout(Install.pingForLinkedHost.curry(a),3000)}})}};Downloading={registerAll:function(){if(Prototype.Browser.IE){return $$(".downloading-link").each(Downloading.register)}},register:function(a){a=$(a);return a.observe("click",Downloading.clicked)},clicked:function(b){var a,c;Event.stop(b);c=$(b.target);if(c.nodeName==="SPAN"){c=c.up("a")}a=c.href.split("?").last();window.location="/download?"+a;return setTimeout((function(){return window.location="/downloading?"+a}),4000)}};Util.smartLoad(Downloading.registerAll);Help={toggle_more_help:false,show_os:function(b,c,a){c=$(c);$$(".os-filter").invoke("removeClassName","selected");c.addClassName("selected");$$(".help-os-section").invoke("hide");$$(".help-os-"+a).invoke("show");return Event.stop(b)},vote:function(a,b){new Ajax.DBRequest("/help/"+a+"/vote/"+b);$j("#help-vote-cont").fadeOut();return Notify.server_success(_("Thanks for your feedback!"))}};AccountExtras={prices:{},prices_value:{},watch_id:0,watch:function(){if(!AccountExtras.watch_id){return AccountExtras.watch_id=setInterval(AccountExtras.update_prices,200)}},show_detail:function(a,d,b){var c;c=_("What is %(feature_name)s?").format({feature_name:a});Modal.icon_show("alert_32",c,$(d+"-modal"),{},false);return false},register_price:function(e,a,d,c,b){AccountExtras.prices[e]=[a,d];return AccountExtras.prices_value[e]=[c,b]},update_prices:function(){var f,d,a,b,c,e;e=$("yearly").checked;d=(e?1:0);a=(e?_("year"):_("month"));b=0;for(f in AccountExtras.prices){if(AccountExtras.prices.hasOwnProperty(f)){$(f+"-price").__date(AccountExtras.prices[f][d]);$(f+"-priceperiod").__date(a)}if(AccountExtras.prices_value.hasOwnProperty(f)){if($(f).checked){c=AccountExtras.prices_value[f][d];b+=parseFloat(c)}}}return $(document).fire("widget:update_price",{price:b,period:a})}};DowngradeReasons={reasons:{},addReason:function(a){return this.reasons[a]=true},addReasons:function(a){var d,e,c,b;b=[];for(e=0,c=a.length;e<c;e++){d=a[e];b.push(this.addReason(d))}return b},change:function(f,c,a){var g,j,h,d,b,e;f=parseInt(f,10);j=$(c);assert(j,"Couldn't find container for DowngradeReason");g=false;e=this.reasons;for(d in e){h=e[d];b=$(a+d);assert(b,"Couldn't find container for ",a+d);if(h&&parseInt(d,10)===f){b.show();g=true}else{b.hide()}}if(g){return j.show()}else{return j.hide()}}};Restore={next:function(a,d){var c,b;b=$j("ul.selected");c=b.next("ul");c.addClass("selected");b.removeClass("selected");if(c.next("ul").length){$j("#next-page").show()}else{$j("#next-page").hide()}$j("#prev-page").show();return Restore.inc_page(1)},prev:function(a,d){var c,b;b=$j("ul.selected");c=b.prev("ul");c.addClass("selected");b.removeClass("selected");if(c.prev("ul").length){$j("#prev-page").show()}else{$j("#prev-page").hide()}$j("#next-page").show();return Restore.inc_page(-1)},inc_page:function(c){var b,a;b=parseInt($j("#page_num").text(),10);a=b+c;return $j("#page_num").text(a)},init:function(b,c,a){$j("#next-page").on("click",function(d){Restore.next(d);return false});$j("#prev-page").on("click",function(d){Restore.prev(d);return false});if(b){$j("#restore-submit-button").on("click",function(d){FileOps.do_folder_restore(c);return false})}$j("#restore-cancel-button").on("click",function(d){return location.href=a});return $j("#restore-back-button").on("click",function(d){return location.href=a})}};TabController=Class.create({initialize:function(c,b){var a;a=$(c);assert(a,c+" is missing.");this.container=a;this.options={killEvent:true};Object.extend(this.options,b);return this.listen()},listen:function(){var f,c,e,b,d,a;c=this;d=this.container.select("a");a=[];for(e=0,b=d.length;e<b;e++){f=d[e];assert(f.id&&f.id.length>0,"Element is missing an id");a.push(f.observe("click",(function(g){return this.click(g)}).bindAsEventListener(c)))}return a},click:function(a){if(this.options.killEvent){Event.stop(a)}return this.toggle($(a.target))},toggle:function(b){var e,a,d,f,c;c=this.container.down("a.selected");if(c){f=$(c.id+"-content");if(f){f.hide()}}this.container.select(".selected").invoke("removeClassName","selected");a=false;if(!b){b=this.container.down("a");a=true}b.addClassName("selected");e=$(b.id+"-content");if(e){e.show()}if(this.options.onTabChange){this.options.onTabChange(b,c)}if(this.options.url_prefix){d=this.options.url_prefix;if(!a){d+="/"+b.id}return DBHistory.push_state(d)}}});EmailVerification={EMAIL_SENT_EVT:"db:verification_email_sent",send_email:function(a){return new Ajax.DBRequest("/sendverifyemail",{parameters:{reason:a},onSuccess:function(){return $(document.body).fire(EmailVerification.EMAIL_SENT_EVT)}})},setup:function(a){return Util.smartLoad(function(){$("send-email-link").observe("click",function(b){b.preventDefault();return EmailVerification.send_email(a)});return $(document.body).observe(EmailVerification.EMAIL_SENT_EVT,function(){$("pre-resend").hide();$("post-resend").show();$("pre-resend-header").hide();return $("post-resend-header").show()})})},verified:function(){assert($("verify-email")!=null,"missing verify-email modal content");assert($("change-email")!=null,"missing change-email modal content");if(Constants.EMAIL_VERIFIED){return true}else{this.show_modal();return false}},show_modal:function(){Modal.icon_show("email_32",_("Verify your email address"),$("verify-email"));return this.listen()},reshow_modal:function(){this.show_modal();return delete Modal.onHide},polling:false,poll_until_verified:function(){var a,b=this;a=4000;return new Ajax.DBRequest("/isemailverified",{onSuccess:function(c){if(c.responseText==="ok"){return window.location.reload()}else{return setTimeout(EmailVerification.poll_until_verified,a)}}})},listen:function(){var a=this;return document.observe(EmailVerification.EMAIL_SENT_EVT,function(){var b;$$(".email-verify-step1").invoke("hide");$$(".email-verify-step2").invoke("show");b=_("Verification email sent to %(email)s");b=b.format({email:Constants.email});Notify.server_success(b);if(!a.polling){a.poll_until_verified();return a.polling=true}})},show_verified_modal:function(){return Modal.icon_show("email_32",_("Your email address has been verified."),$("email-verified"))},show_sent_modal:function(){return Modal.icon_show("email_32",_("Verification email sent!"),$("verification-email-sent"))}};EmailChange={show_change_email_modal:function(){return Modal.icon_show("email_add_32",_("Update email address"),$("change-email"),{},false,550)},submit_email_change:function(b){var a;a=$("change-email-form");return Forms.ajax_submit(a,false,(function(){if(window.location.pathname.indexOf("/account")===0){return window.location.reload()}else{return window.location.href="/home?send_verification_email=1"}}),false,$(b.target))}};PasswordChange={show_change_password_modal:function(){return Modal.icon_show("alert_32",_("Change password"),$("change-password"),{},false,550)},submit_password_change:function(b){var a;a=$("change-password-form");return Forms.ajax_submit(a,false,(function(){return window.location.reload()}),false,$(b.target))}};PromoHolder={init:function(b,c,a){if(!b){return new Ajax.DBRequest("/promo",{parameters:{force_campaign:c,force_promo:a},noAutonotify:true,no_watch:true,onSuccess:function(d){if(d.responseText.length>0){$j("#promo_holder").html(d.responseText);Event.observe(window,"resize",PromoHolder.check_sizing);return Util.smart_window_load(PromoHolder.check_sizing)}}})}},check_sizing:function(){var a,c,e,d,f,b;f=$$("#promo_holder div");if(!f.length){return}e=f[0];a=20;c=$("page-sidebar");b=c.cumulativeOffset().top+c.getLayout().get("height");d=e.cumulativeOffset().top;if(b+a>d||$(document.body).getWidth()<960){return $j("#promo_holder").css("visibility","hidden")}else{return $j("#promo_holder").css("visibility","visible")}}};Fromo={_options:null,_cur_index:0,start:function(a){this._options=a;$j("#hide-promo").on("click",function(){$j(".fromo").hide();new Ajax.DBRequest(a.promo_hide,{noAutonotify:true,no_watch:true});return false});return this.advance()},advance:function(){var b,c,a,d;this._cur_index=(this._cur_index+1)%this._options.thumbnail_urls.length;d=this._options.thumbnail_urls[this._cur_index];a=$j(".fromo img.main");b=$j(".fromo img.alt");c=this;return b.attr("src",d).one("load",function(){a.attr("src",b.attr("src"));$j(".fromo").css("visibility","")})}};BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:false,init:function(){if(BonusTable._inited){return}BonusTable._inited=true;$("bonus-loading").show();BonusTable._tmpl=HTML.tmpl("bonus_row_tmpl");BonusTable.listen();return BonusTable.get_next_page()},_render:function(d){var b,e,c,a;b=[];for(c=0,a=d.length;c<a;c++){e=d[c];b.push(BonusTable._tmpl({row:e}))}return $("bonus-table").__sert(b)},get_next_page:function(){if(BonusTable._fetching_page){return}BonusTable._fetching_page=true;return new Ajax.DBRequest("/account/bonus_page/"+BonusTable._next_page,{onSuccess:function(b){var d,a,c;d=b.responseText.evalJSON();c=d.rows;a=d.has_more;BonusTable._render(c);$("bonus-loading").hide();if(a){BonusTable._next_page+=1;$("load-more-bonus").show()}else{$("load-more-bonus").hide()}return BonusTable._fetching_page=false}})},_max_referral_over:function(b){var a,d,c;d=$j(b.currentTarget);c=_("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!");a=$j(Bubble.make(c,"right","middle"));Element.absolutize(a[0]);d.append(a);a.clonePosition(d,{setWidth:false,setHeight:false});return a.css({width:"200px",left:(parseInt(a.css("left"),10)-210)+"px",top:(parseInt(a.css("top"),10)-55)+"px"})},_max_referral_out:function(h){var a,g,d,f,c;f=$j(".reached-max-referral-bonus .bubble");c=[];for(g=0,d=f.length;g<d;g++){a=f[g];c.push(a.remove())}return c},listen:function(){$j("#bonus-content").on("click","#load-more-bonus",BonusTable.get_next_page);$j(document).on("mouseenter",".reached-max-referral-bonus",BonusTable._max_referral_over);return $j(document).on("mouseleave",".reached-max-referral-bonus",BonusTable._max_referral_out)}};GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,init:function(b,a,c){GetSpace._current_space=b;GetSpace._why_msg=a;GetSpace._twitter_url=c;if($("why_like")&&$("twitter_post")){$("twitter_post").hide()}return $("space-actions").on("click",".space-action",GetSpace.perform_action)},perform_action:function(b){var c,a;a={contact_sales:GetSpace._contact_sales,contact_support:GetSpace._contact_support,teams:GetSpace._teams,upgrade:GetSpace._upgrade,plans:GetSpace._plans,refer:GetSpace._refer,get_started:GetSpace._get_started,fb_link:GetSpace._fb_link,twitter_link:GetSpace._twitter_link,twitter_follow:GetSpace._twitter_follow,why_like:GetSpace._why_like,twitter_post:GetSpace._twitter_post};c=$(b.target);if(!c.hasClassName("space-action")){c=c.up(".space-action")}return a[c.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return FacebookOAuth.do_auth(function(){GetSpace._refresh_link_bonuses();return GetSpace._completed($("fb_link"))})},_twitter_link:function(){return Twitter.do_auth(function(){GetSpace._refresh_link_bonuses();Twitter.has_authed=1;return GetSpace._completed($("twitter_link"))})},_twitter_follow:function(){if(Twitter.has_authed){return GetSpace.follow_dropbox()}else{return Twitter.do_auth(GetSpace.follow_dropbox)}},_why_like:function(){Modal.icon_show("heart_32",_("Tell us why you love Dropbox"),$("why-i-like-modal"));$("why-i-like-input").focus();return Util._track_twitter_chars_left("why-i-like-input",90)},_twitter_post:function(){if(Twitter.has_authed){return GetSpace.start_twitter_post()}else{return Twitter.do_auth(GetSpace.start_twitter_post)}},follow_dropbox:function(){if(!Twitter.has_authed){GetSpace._refresh_link_bonuses();Twitter.has_authed=1}return Twitter.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(_("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(_("Follow Dropbox on Twitter"))},onSuccess:function(){if($("twitter_link")&&$("twitter_link").visible()){GetSpace._completed($("twitter_link"))}return GetSpace._completed($("twitter_follow"))}})},submit_why:function(){GetSpace._why_msg=$F("why-i-like-input");return Forms.ajax_submit($("why-i-like-form"),false,(function(){Modal.hide();GetSpace._completed($("why_like"));if($("twitter_post")){return setTimeout((function(){return $j("#twitter_post").css("opacity",0).slideDown().animate({opacity:1},{queue:false,duration:2500})}),2500)}}),false,$("why-i-like-submit"))},start_twitter_post:function(){Modal.onHide=function(){if(!Twitter.has_authed){GetSpace._refresh_link_bonuses();Twitter.has_authed=1}if($("twitter_link")&&$("twitter_link").visible()){GetSpace._completed($("twitter_link"))}delete Modal.onHide;return Modal.hide()};return Twitter.get_user_info(function(a){Modal.icon_show("tweet_32",_("Tweet about your love of Dropbox"),$("twitter-post-modal"));$("twitter-post-header").down(".profile-pic").__date(new Element("img",{src:a.profile_image_url_https}));$("twitter-post-header").down(".name").__date(a.name);$("twitter-post-header").down(".username").__date("@"+a.screen_name);GetSpace._update_display_twitter_post();$("twitter-post-input").setValue(GetSpace._why_msg);return Util._track_twitter_chars_left("twitter-post-input",90)})},show_edit_twitter_post:function(){$("display-twitter-post").hide();$("display-twitter-post-buttons").hide();$("edit-twitter-post").show();$("edit-twitter-post-buttons").show();$("twitter-post-input").observe("keypress",function(a){if(a.keyCode===13){return GetSpace.hide_edit_twitter_post()}});return $("twitter-post-input").focus()},hide_edit_twitter_post:function(){var a;a=$F("twitter-post-input");if(!a){Notify.server_error(_("Please enter a message"));return}else{if(a.length>90){Notify.server_error(_("Your post must be 90 characters or less"));return}}GetSpace._why_msg=a;GetSpace._update_display_twitter_post();$("edit-twitter-post").hide();$("edit-twitter-post-buttons").hide();$("display-twitter-post").show();return $("display-twitter-post-buttons").show()},do_twitter_post:function(){var a;Twitter.from_getspace=1;a=_("I love Dropbox because %(why_msg)s %(referral_link)s").format({why_msg:GetSpace._why_msg,referral_link:GetSpace._twitter_url});if(a.length>140){GetSpace.show_edit_twitter_post();Notify.server_error(_("Your tweet must be 140 characters or less"));return}Twitter.custom_show_posting=function(){return Forms.add_loading($("twitter-post-submit"))};return Twitter.custom_post(a,function(){Modal.hide();return GetSpace._completed($("twitter_post"))})},_update_display_twitter_post:function(){var a;$("display-twitter-post").__date(_("I love Dropbox because %(why_msg)s ").format({why_msg:GetSpace._why_msg}));a=new Element("a",{href:GetSpace._twitter_url,target:"_blank"});a.__date(GetSpace._twitter_url);return $("display-twitter-post").__sert(a)},_completed:function(b){var a;b.addClassName("completed");b.down(".icon-col").__date(Sprite.make("web","check_36"));$j(b).css("opacity",0.5).fadeTo(500,1);setTimeout((function(){return $j(b).css("opacity",1).slideUp().animate({opacity:0},{queue:false,duration:"normal"})}),1500);a=parseInt(b.down(".space").readAttribute("data-space"),10);GetSpace._current_space+=a;$("current-space").__date(Util.formatBytes(GetSpace._current_space,2,true));$("current-space").addClassName("updated");return setTimeout((function(){return $("current-space").removeClassName("updated")}),5000)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};SecurityTab={_submit_form:function(b){var a,c;c=function(){return Notify.server_success(_("Settings changed successfully."))};a=function(){return Notify.server_error(_("There was a problem completing this request."))};return Forms.ajax_submit(b,"/account/security_email",c,a)},init:function(){var d,b,c,a,e=this;b=$("show-change-password");if(b){b.on("click",function(f){$("newpass").value="";$("oldpass").value="";PasswordChange.show_change_password_modal();return f.preventDefault()})}c=$("security-email");if(c){d=$("new_api_app_linked");a=$("newhostlinked");if(d){new Form.Element.Observer(d,0.1,function(){return e._submit_form(c)})}if(a){return new Form.Element.Observer(a,0.1,function(){return e._submit_form(c)})}}}};Recover={init:function(){var a;a=$("recover-form");return a.observe("submit",this.form_submit.bind(this))},form_submit:function(a){this.clear_error();a.preventDefault();return Forms.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(b){var a;a=Util.from_json(b.responseText);if(a.status==="error"){this.show_error(a.msg)}if(a.status==="ok"){this.show_hosts(a)}if(a.status==="redirect"){return window.location.href=a.url}},show_hosts:function(h){var e,c,d,a,g,b,f;Forms.add_vars($("recover-form"),{check_file:"true"});$("filename-to-create").update(h.filename);c=$("trusted-hosts");c.update();f=h.hosts;for(g=0,b=f.length;g<b;g++){e=f[g];a=new Element("li");d="lnx";if(e.platform==="mac"){d="osx"}if(e.platform==="win"){d="win"}a.__sert(Sprite.make("web",d));a.__sert(new HTML(e.display_name.escapeHTML()));c.appendChild(a)}$("login-step").hide();return $("hosts-step").show()},show_error:function(a){$("error-messages").update(a);return $("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var DBGallery,DBPhoto,__slice=[].slice;DBPhoto=function(a){a.preloaded={};a.preload=function(b){if(a.preloaded[b]){return}b=b||"l";assert(b in a,"Photo doesn't have attr "+b);Util.preload_image(a[b]);return a.preloaded[b]=true};a.load_thumb=function(b){return b.src=a.thumbnail};return a};DBGallery={size:"large",index:0,playing:false,preloaded:false,thumb_width:64,thumb_margin:4,low_opacity:0.6,photos:[],set_url_hash:true,container_id:"db_gallery_master_container",add_photos:function(a){return a.each(function(b){return DBGallery.photos.push(DBPhoto(b))})},set_hash:function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];if(DBGallery.set_url_hash){return HashRouter.set_hash.apply(HashRouter,a)}},observe:function(){Event.observe((document.onresize?document:window),"resize",DBGallery.resize);Event.observe(document.body,"mousewheel",DBGallery.wheel);Event.observe(document.body,"DOMMouseScroll",DBGallery.wheel);return document.observe("keydown",DBGallery.key)},unobserve:function(){Event.stopObserving((document.onresize?document:window),"resize",DBGallery.resize);Event.stopObserving(document.body,"mousewheel",DBGallery.wheel);Event.stopObserving(document.body,"DOMMouseScroll",DBGallery.wheel);return document.stopObserving("keydown",DBGallery.key)},resize:function(){var a,c,b,d;a=$("gallery_main_cont");d=document.viewport.getDimensions();a.style.height=d.height-99+"px";c=$("gallery_main_photo");b=d.height-99-10;c.style.maxHeight=Math.max(b,300)+"px";return c.style.maxWidth=Math.max(d.width,400)+"px"},key:function(b){var a;a=BrowseKeys.getKey(b);switch(a){case 27:return DBGallery.hide();case 32:return DBGallery.playpause();case 37:case 75:return DBGallery.prev();case 39:case 74:return DBGallery.next()}},wheel:function(a){var b;if(DBGallery.block_wheel){return}DBGallery.block_wheel=1;setTimeout((function(){return DBGallery.block_wheel=0}),80);b=0;if(a.wheelDelta){b=a.wheelDelta}else{if(a.detail){b=-a.detail}}if(b>0){return DBGallery.prev()}else{return DBGallery.next()}},playpause:function(){if(DBGallery.playing){return DBGallery.pause()}else{return DBGallery.play()}},play:function(){DBGallery.playing=true;DBGallery.interval=setInterval(function(){return DBGallery.next(true)},5000);return $("gallery_slideshow").__date(Sprite.html("web","white_pause")).__sert(_("Pause slideshow"))},pause:function(){DBGallery.playing=false;clearInterval(DBGallery.interval);return $("gallery_slideshow").__date(Sprite.html("web","white_play")).__sert(_("Play slideshow"))},next:function(a){var b;b=DBGallery.index+1;if(b!==DBGallery.photos.length){return DBGallery.select_photo(b,a)}},prev:function(){var a;if(DBGallery.playing){DBGallery.pause()}a=DBGallery.index-1;if(a!==-1){return DBGallery.select_photo(a)}},select_photo:function(m,o){var e,k,g,l,a,c,b,n,q,f,p,h,d;m=parseInt(m,10);if(!Util.isNumber(m)){return}DBGallery.set_hash("gallery",""+m);if(!o&&DBGallery.playing){DBGallery.pause()}DBGallery.index=m;if(!DBGallery.visible){DBGallery.show(m)}e=$$("#gallery_thumbs_container img.selected");if(e.length){c=e[0];c.setOpacity(DBGallery.low_opacity);c.removeClassName("selected")}k=$$("#gallery_thumbs_container img")[m];assert(k,"Couldn't find img at index");k.setOpacity(1);k.addClassName("selected");DBGallery.render_mainphoto(m);DBGallery.resize();b=$("gallery_thumbs_container");l=-1*m*(DBGallery.thumb_width+DBGallery.thumb_margin)-39;$j(b).stop();if(Math.abs(l-parseInt(b.getStyle("margin-left"),10))>1200){b.style.marginLeft=l+"px"}else{$j(b).animate({marginLeft:l},300)}n=b.select("img");assert(n.length===DBGallery.photos.length,"thumbslength != photoslength");q=Math.ceil(document.viewport.getDimensions().width/DBGallery.thumb_width);q+=q%2;g=Math.max(0,m-q/2);while(g<Math.min(DBGallery.photos.length,m+q/2)){DBGallery.photos[g].load_thumb(n[g]);g+=1}h=DBGallery.photos.slice(m,m+10);d=[];for(f=0,p=h.length;f<p;f++){a=h[f];d.push(a.preload(DBGallery.size))}return d},update_container_top:function(a){a=a||$(DBGallery.container_id);if(a){return a.style.top=document.viewport.getScrollOffsets()[1]+"px"}},show:function(b){var a;assert(!DBGallery.visible,"Tried to show a gallery when it was already up");if(document.viewport.getDimensions().height>768){DBGallery.size="extralarge"}else{DBGallery.size="large"}DBGallery.visible=true;b=b||DBGallery.index;assert(DBGallery.photos.length,"No photos in the photo gallery");a=new Element("div",{id:DBGallery.container_id});DBGallery.update_container_top(a);DBGallery.update_top_interval=setInterval(function(){return DBGallery.update_container_top()},200);document.body.appendChild(a);DBGallery.observe();DBGallery.render_backdrop(a);DBGallery.render_filmstrip(a);DBGallery.render_submenu(a);return DBGallery.render_bottom_menu(b,a)},hide:function(a){if(a){Event.stop(a)}assert(DBGallery.visible,"Tried to hide a gallery when it was already hidden");DBGallery.visible=false;DBGallery.pause();DBGallery.unobserve();DBGallery.hide_backdrop();DBGallery.hide_filmstrip();DBGallery.hide_bottom_menu();DBGallery.hide_mainphoto();$(DBGallery.container_id).remove();DBGallery.set_hash();return clearInterval(DBGallery.update_top_interval)},render_backdrop:function(a){var b,c;c="body";if(Prototype.Browser.IE){c="html, body"}$$(c).invoke("addClassName","full_no_overflow");b=new Element("div",{id:"gallery_backdrop"});b.setOpacity(0.8);return a.__sert(b)},hide_backdrop:function(){$$(".full_no_overflow").invoke("removeClassName","full_no_overflow");return $("gallery_backdrop").remove()},render_filmstrip:function(a){var j,d,h,g,f,e,c,b;d=new Element("div",{id:"gallery_filmstrip"});g=document.createDocumentFragment();g.appendChild(d);h=new Element("div",{id:"gallery_filmstrip_backdrop"});h.setOpacity(0.5);g.appendChild(h);b=new Element("div",{id:"gallery_thumbs_container"});e=0;DBGallery.photos.each(function(l){var k;k=new Element("img",{title:l.filename,src:"/static/images/icons/icon_spacer.gif"});k.setOpacity(DBGallery.low_opacity);k.observe("mouseover",function(m){return $j(k).fadeTo(100,1)});k.observe("mouseout",function(m){if(!k.hasClassName("selected")){return $j(k).fadeTo(100,DBGallery.low_opacity)}});k.observe("click",(function(m){return function(){return DBGallery.select_photo(m)}})(e));b.appendChild(k);return e+=1});c=new Element("div",{id:"gallery_selected_frame"});f=new Element("a",{id:"gallery_close",href:"#",style:"top: 120px; right: 10px;"});j=new Element("img",{src:"/static/images/photos_x.png"});f.__sert(j);f.observe("click",DBGallery.hide);g.appendChild(f);g.appendChild(c);g.appendChild(b);return a.appendChild(g)},render_submenu:function(a){var d,c,e,b;c=new Element("div",{id:"gallery_sub_menu"});e=new Element("div",{id:"gallery_index_text"});d=new Element("div",{id:"gallery_filename_text"});b=new Element("a",{id:"gallery_slideshow"});b.observe("click",DBGallery.playpause);c.__sert(b);c.__sert(e);c.__sert(d);a.appendChild(c);return DBGallery.pause()},render_bottom_menu:function(d,b){var c,a,e;c=new Element("div",{id:"gallery_bottom_menu"});a=new Element("a",{id:"gallery_full_size"});a.__date(Sprite.html("web","arrow_out_black")).__sert(_("Full size"));e=new Element("a",{id:"gallery_save"});e.__date(Sprite.html("web","picture_save")).__sert(_("Save"));c.__sert(a);c.__sert(e);return b.appendChild(c)},update_bottom_menu:function(b){var a;a=DBGallery.photos[b];$("gallery_full_size").href=a.original;return $("gallery_save").href=a.original+"?dl_name="+Util.urlquote(a.filename)},hide_bottom_menu:function(){return $("gallery_bottom_menu").remove()},hide_filmstrip:function(){$("gallery_filmstrip").remove();$("gallery_filmstrip_backdrop").remove();$("gallery_thumbs_container").remove();$("gallery_selected_frame").remove();$("gallery_close").remove();return $("gallery_sub_menu").remove()},render_mainphoto:function(f,b){var a,c,e,d,h,g;b=b||$(DBGallery.container_id);e=DBGallery.photos[f];c=Util.get_preloaded_image(e[DBGallery.size]);c.id="gallery_main_photo";c.title=e.filename;c.stopObserving("click");c.observe("click",function(l){var j,k;Event.stop(l);if(e.video_url){DBGallery.pause();$("gallery_main_photo_td").__date();k=(DBGallery.size==="extralarge"?1024:640);j=Math.floor(k*0.55);return VideoUtil.embed("#gallery_main_photo_td",{src:e.video_url,type:"video/flv",width:k,height:j,controls:true,preload:"auto",autoplay:true})}else{return DBGallery.next()}});if(!$("gallery_main_cont")){a=new Element("table",{id:"gallery_main_cont"});a.observe("click",DBGallery.hide);d=new Element("tbody");a.__sert(d);g=new Element("tr");d.__sert(g);h=new Element("td");h.id="gallery_main_photo_td";g.__sert(h);h.__sert(c);b.appendChild(a)}else{$("gallery_main_cont").down("td").__date(c)}DBGallery.update_sub_menu(f);return DBGallery.update_bottom_menu(f)},update_sub_menu:function(a){$("gallery_index_text").__date(a+1+" of "+DBGallery.photos.length);return $("gallery_filename_text").__date(DBGallery.photos[a].filename)},hide_mainphoto:function(){return $("gallery_main_cont").remove()}};var Notserver;Notserver={SUBSCRIBE_CHILLOUT:5,MAX_URL_LENGTH:8096,_subscribe_in_progress:false,subscribe:function(b,a){if(this._subscribe_in_progress){return}this._subscribe_in_progress=true;this._handlers={user:a.onUser,list:a.onList};this._cursors={user:a.cursorForUser,list:a.cursorForList};this._uid=a.uid||Constants.uid;this._subscribe_url=b;return this._make_subscribe_request()},_make_subscribe_request:function(){var c,d,b,a,e=this;b={host_int:0,trace:encodeURIComponent(window.location.pathname),rev:Constants.SVN_REV};if(this._cursors.list){b.ns_map=((function(){var g,f;g=this._cursors.list();f=[];for(c in g){a=g[c];f.push(""+c+"_"+a)}return f}).call(this)).join(",")}if(this._cursors.user!=null){b.user_id=this._uid;b.nid=this._cursors.user}d=Util.add_qstring("",b,false).slice(1);if(this._subscribe_url.length+d.length>this.MAX_URL_LENGTH){return}if((typeof Ajax!=="undefined"&&Ajax!==null?Ajax.DBRequest:void 0)!=null){return new Ajax.DBRequest(this._subscribe_url,{no_watch:true,noAutonotify:true,evalJSON:false,method:"GET",parameters:d,onSuccess:function(g){var f;f=g.responseText||g;return e.subscribe_success(Util.from_json(f))},onFailure:function(){return e.schedule_request(e.SUBSCRIBE_CHILLOUT*1000)}})}else{return $j.ajax(this._subscribe_url,{data:d,dataType:"json",success:function(f){return e.subscribe_success(f)},error:function(){return e.schedule_request(e.SUBSCRIBE_CHILLOUT*1000)}})}},subscribe_success:function(f){var g,e,b,d,a;this._subscribe_in_progress=false;if(f.ret==="new"){try{if("refresh" in f){d=f.refresh;a=[];for(e=0,b=d.length;e<b;e++){g=d[e];if(g in this._handlers){a.push(this._handlers[g]())}else{a.push(void 0)}}return a}else{if(this._handlers.list){return this._handlers.list()}}}catch(c){}}else{assert(f.ret==="punt","Invalid response from subscribe: "+f);return this.schedule_request(0)}},schedule_request:function(a){var b=this;return window.setTimeout((function(){return b._make_subscribe_request()}),a)}};var BrowseUtil,UpdateEvents;UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};BrowseUtil={THUMBS_BATCH_SIZE:16,make_browsefile:function(b){var a;a=this.unpack_file_info(b);if(a.is_dir){a.ago="";a.ts=0}else{a.target_ns=false}return new BrowseFile(a)},unpack_file_info:function(a){return{is_dir:a[0],type:a[1],ns_id:a[2],ns_path:a[3],fq_path:a[4],target_ns:a[5],icon:a[6],thumbnail_url_tmpl:a[7],href:a[8],bytes:a[9],size:a[10],ts:a[11],ago:a[12],hash:a[13],tkey:a[14],sort_rank:a[15],sort_key:Util.decode_sort_key(a[16]),sjid:a[17],last_modified_fname:a[18],preview_type:a[19],real_path:a[20],real_path_exists:a[21],owned:a[22],code_class:a[23],htmlified_link:a[24],has_pdf_preview:a[25],large_thumbnail_url_tmpl:a[26]}},filepreview_from_selected:function(d,c){var e,b,k,l,m,h,g,a,f,n,j;if(c&&(c.bytes<0||c.preview_type==="download")){window.open(e.href,"_blank");return}a=DBHistory.get_url();l=a.indexOf("/lightbox")===0;b=a.indexOf("/view")===0;if(d==="callback"&&((l&&Lightbox.shown)||(b&&FileViewer.shown))){return}else{if(d==="callback"&&b&&!c){FileViewer.show();return}else{if(d==="fileclick"&&c&&((j=c.preview_type)!=="photo"&&j!=="video")){FileViewer.show(c);return}}}if(!c){h=BrowseSelection.get_selected_files();c=h&&h.first()}m=this.browsefile_to_filepreview(Browse.files);if(m.length){g=0;if(c){for(k=f=0,n=m.length;f<n;k=++f){e=m[k];if(e.fq_path===c.fq_path){g=k;break}}}Lightbox.init(m,{start_index:g,include_delete:true,keep_url:false})}if(Tutorial.should_handle_event(Tutorial.events.browse_show_lightbox)){return Tutorial.handle_event(Tutorial.events.browse_show_lightbox,{init_file:c})}},browsefile_to_filepreview:function(e){var h,c,a,d,g,b;a=[];for(g=0,b=e.length;g<b;g++){h=e[g];if(h.bytes<0||h.dir){continue}if(h.preview_type==="photo"&&h.large_thumbnail_url_tmpl){c=new PhotoPreview(h.filename,h.fq_path,h.large_thumbnail_url_tmpl,h.href+"&dl=1",h.href,null,null,h.ns_id,h.ns_path);a.push(c)}else{if(h.preview_type==="video"&&h.large_thumbnail_url_tmpl&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){d=new VideoPreview(h.filename,h.fq_path,h.large_thumbnail_url_tmpl,h.video_transcode_url(),h.href+"&dl=1",null,null,h.ns_id,h.ns_path);a.push(d)}}}return a},profile_files:function(b){var c,d,e,a;d={files:0,folders:0,shared_folders:0,deleted:0,public_folder:0,photos_folder:0,rejoinables:0,sandboxes:0,target_namespaces:0,owned:0};for(e=0,a=b.length;e<a;e++){c=b[e];if(c.dir){d.folders+=1}else{d.files+=1}if(c.is_sandbox()){d.sandboxes+=1}if(c.is_share()){d.shared_folders+=1}if(c.bytes===-1){d.deleted+=1}if(c.target_ns){d.target_namespaces+=1}if(c.fq_path.toLowerCase()==="/public"&&Browse.public_folder_enabled){d.public_folder=1}if(c.fq_path.toLowerCase()==="/photos"){d.photos_folder=1}if(c.owned){d.owned+=1}}return d},profile_summary:function(b){var c,a;c=ungettext("%d file","%d files",b.files).format(b.files);a=ungettext("%d folder","%d folders",b.folders).format(b.folders);if(b.files&&b.folders){return _("%(x_files)s and %(y_folders)s").format({x_files:c,y_folders:a})}else{if(b.files){return c}else{if(b.folders){return a}else{return""}}}},BROWSE_MODE:"browse",SEARCH_MODE:"search",SPECIAL_MODES:["search"],set_browse_mode:function(){var d,c,a,b;b=this.SPECIAL_MODES;for(c=0,a=b.length;c<a;c++){d=b[c];$("browse").removeClassName(d);$("browse-root-actions").removeClassName(d);$("browse-sort").removeClassName(d)}$("browse-sort").removeClassName("cathywu");return $("browse-root-actions").removeClassName("cathywu")},set_special_mode:function(b){var e,d,a,c;assert(this.SPECIAL_MODES.indexOf(b)!==-1,"unknown mode");if($("browse").hasClassName(b)){assert($("browse-root-actions").hasClassName(b),"inconsistent modes");assert($("browse-sort").hasClassName(b),"inconsistent modes");return}c=this.SPECIAL_MODES;for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){$("browse").removeClassName(e);$("browse-root-actions").removeClassName(e);$("browse-sort").removeClassName(e)}}$("browse").addClassName(b);$("browse-root-actions").addClassName(b);$("browse-sort").addClassName(b);if(b===this.SEARCH_MODE){$("browse-sort").addClassName("cathywu");return $("browse-root-actions").addClassName("cathywu")}},get_mode:function(){var e,a,d,b,c;a=this.BROWSE_MODE;c=this.SPECIAL_MODES;for(d=0,b=c.length;d<b;d++){e=c[d];if($("browse").hasClassName(e)){a=e}}return a},load_visible_thumbs:function(){var m,p,d,l,q,r,n,c,h,b,g,f,o,a,k,e;c=this.get_files_in_view();p=c[1]-c[0];n=[Math.max(c[0]-p,0),c[0]];r=[Math.min(c[1],Browse.files.length),Math.min(c[1]+p,Browse.files.length)];m=[];k=[c,r,n];for(g=0,o=k.length;g<o;g++){q=k[g];l=q[0],h=q[1];e=Browse.files.slice(l,h+1||9000000000);for(f=0,a=e.length;f<a;f++){d=e[f];m.push(d.get_div().down("img"))}}b=function(j){if(!j.src.endsWith(Sprite.SPACER)){return j.addClassName("thumbnail")}};return BatchThumbLoader.batch_load_thumbs(m,this.THUMBS_BATCH_SIZE,b)},get_files_in_view:function(){var c,d,b,a,f,e;f=Util.viewport_dimensions().height;e=Util.scroll_offsets().top;c=this._get_top_file_y_offset();d=this._get_elm_height();if(!c||!d){return[0,Browse.files.length]}b=Math.floor((e-c)/d);b=Math.max(b,0);a=b+Math.ceil(f/d);a=Math.min(a,Browse.files.length);return[b,a]},_get_top_file_y_offset:function(){if(Browse.files.length===0){return null}return Browse.files[0].get_div().cumulativeOffset().top},_get_elm_height:function(){var a;if(Browse.files.length<3){return null}a=Browse.files[1].get_div();return a.getLayout().get("margin-box-height")}};var FlexColumn,Sort;Sort=(function(){var g,a,d,f,e,c,b;d=function(j){var h;h=j?1:-1;return function(k,l){return h*Util.sort_by_rank_or_key(k,l)}};f=function(j){var h;h=j?1:-1;return function(k,l){if(k.bytes>l.bytes){return h}else{if(k.bytes<l.bytes){return -h}else{return h*Sort.FILES_BY_NAME(k,l)}}}};g=function(j){var h;h=j?1:-1;return function(k,l){return h*(k.real_path.toLowerCase()>l.real_path.toLowerCase()?1:-1)}};a=function(j){var h;h=j?1:-1;return function(l,m){var k;k=l.ts===m.ts?0:l.ts>m.ts?1:-1;return h*k}};c=function(h){return function(l){var k,j;j=h(l);k=d(true);return function(m,n){if(m.dir^n.dir){return(m.dir?1:0)-(n.dir?1:0)}else{return j(m,n)||k(m,n)}}}};e=function(h){return function(l){var j,k;if(!Sort.FOLDERS_FIRST){return h(l)}k=h(l);j=l?1:-1;return function(n,o){var m;if(n.dir^o.dir){m=(n.dir?0:1)-(o.dir?0:1);return j*m}else{return k(n,o)}}}};b=function(h){return function(l){var j,k;k=Sort.FILES_BY_NAME(l);j=l?1:-1;return function(n,o){var m;if(n.is_deleted^o.is_deleted){return(n.is_deleted?1:0)-(o.is_deleted?1:0)}m=0;if(h){if(n.get_category()!==o.get_category()){m=n.get_category()<o.get_category()?-1:1}else{if(n.get_extension()!==o.get_extension()){m=n.get_extension()<o.get_extension()?-1:1}}}else{if(n.get_extension()!==o.get_extension()){m=n.get_extension()<o.get_extension()?-1:1}else{if(n.get_category()!==o.get_category()){m=n.get_category()<o.get_category()?-1:1}}}return(j*m)||k(n,o)}}};return{FILES_BY_NAME:e(d),FILES_BY_SIZE:c(f),FILES_BY_LOCATION:c(g),FILES_BY_KIND:c(b(true)),FILES_BY_EXTENSION:c(b(false)),FILES_BY_MODIFIED:c(a),FOLDERS_FIRST:!Util.is_mac(),ALL_BY_MODIFIED:a}})();FlexColumn=(function(){var j,c,m,g,d,h,b,a,l,e,k,f;j=[["FILES_BY_KIND",Sort.FILES_BY_KIND,_("Kind"),true],["FILES_BY_EXTENSION",Sort.FILES_BY_EXTENSION,_("Extension"),true],["FILES_BY_SIZE",Sort.FILES_BY_SIZE,_("Size"),false]];c={};m={};d=[];g=[];for(e=0,k=j.length;e<k;e++){f=j[e],l=f[0],b=f[1],h=f[2],a=f[3];d.push(b);c[l]=h;m[l]=a;g.push(l)}return{SORT_FUNCTIONS:d,DISPLAY:c,IS_ASC:m,LABELS:g}})();var FileSearch;FileSearch={MAX_RESULTS:100,SHORT_PREFIX_LEN:2,SHORT_PREFIX_DELAY_TIME:250,_cache:{},_cache_ts:{},CACHE_TIME:60000,last_state:false,last_fq_path:null,init:function(){var a,l,j,c,g,f,m,b,h,e,d,k=this;j=$("browse-search");l=$("browse-search-input");SickInput.add_interval_handler(j,this.search_with_delay.bind(this));$("advanced-search-box").observe("submit",function(n){k.search();return Event.stop(n)});$("exit-search-xclose").observe("click",function(){return k.exit_search()});key("/",Browse.KEY_SCOPE,function(){if(BrowseJump.is_active()){return}if(!j.hasClassName("focused")){l.focus();return false}});key("escape",Browse.KEY_SCOPE,function(){if(Browse.in_search_mode()){k.exit_search();return false}if(l.getValue().strip()===""){l.blur();return false}});key("tab",Browse.KEY_SCOPE,function(n){if(document.activeElement===l){n.preventDefault();l.blur();if(Browse.files.length){BrowseSelection.set_selected_files(Browse.files[0])}else{if(Browse.in_search_mode()){k.toggle_advanced()}}return false}});c="#advanced-search-link, #advanced-search-exit, #advanced-search-cancel";$(document.body).on("click",c,this.toggle_advanced.bind(this));document.observe(FileEvents.RENAME,function(){return k.clear_cache()});h=[FileEvents.DELETE,FileEvents.COPY,FileEvents.MOVE,FileEvents.PURGE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE];for(g=0,m=h.length;g<m;g++){a=h[g];document.observe(a,function(n){if(!Browse.inside_dir){return k.force_reload()}})}e=[UpdateEvents.ADD,UpdateEvents.MOVE,UpdateEvents.REMOVE];d=[];for(f=0,b=e.length;f<b;f++){a=e[f];d.push(document.observe(a,function(n){return k._update_number_results(Browse.files.length)}))}return d},get_state:function(){var c,f,b,e,a,d;f={is_advanced:!$("browse-search").visible()};if(f.is_advanced){d=["all_terms","any_terms","excluded_terms","exact"];for(e=0,a=d.length;e<a;e++){c=d[e];b=$(c).getValue();if(b){f[c]=b}}f.include_files=$("include_files").checked;f.include_folders=$("include_folders").checked;f.include_deleted=!Constants.can_see_trash&&$("include_deleted").checked}else{f.query_unnormalized=this.get_basic_query();f.query=f.query_unnormalized.toLowerCase().strip().split(RegExp(" +")).join(" ")}return f},set_state:function(e){var b,d,a,c;if(e.is_advanced){c=["all_terms","any_terms","excluded_terms","exact"];for(d=0,a=c.length;d<a;d++){b=c[d];if(e[b]){$(b).setValue(e[b])}}$("include_files").checked=e.include_files;$("include_folders").checked=e.include_folders;if(!Constants.can_see_trash){$("include_deleted").checked=e.include_deleted}this.show_advanced();return this.search()}else{this.set_basic_query(e.query_unnormalized);this.show_basic();return this.search()}},state_changed:function(){var b,a;b=this.get_state();a=this.last_state;if(a===false){return !!b.query}return(b.is_advanced!==a.is_advanced)||(b.query!==a.query)},get_basic_query:function(){var a;a=$("browse-search-input");return a.getValue()},set_basic_query:function(a){if(a===this.get_basic_query()){return}$("browse-search-input").setValue(a);$("browse-search").show();return $("advanced-search-link").__date(_("Advanced search"))},set_title:function(){var a,b;a=this.get_state();b=_("Search - Dropbox");if(a.query_unnormalized){b=""+a.query_unnormalized+" - "+b}return document.title=b},_pending_search_q:"",search_with_delay:function(){var b,a;a=this.get_state();if(a.is_advanced){return}b=a.query;if(b.length===0&&Browse.in_search_mode()){this.search();return}if(b.length<=this.SHORT_PREFIX_LEN){if(b!==this._pending_search_q){this._pending_search_q=b;clearTimeout(this._pending_search_timer);return this._pending_search_timer=setTimeout(this.search.bind(this),this.SHORT_PREFIX_DELAY_TIME)}}else{this._pending_search_q="";if(this.state_changed()){return this.search()}}},search:function(){var b,a;a=this.get_state();b=""===this.get_basic_query();if(!a.is_advanced&&b){if(Browse.in_search_mode()){this._clear_on_reload=false;this.exit_search()}return}this.last_state=a;this._clear_on_reload=true;if(!Browse.in_search_mode()){BrowseSelection.deselect_all();Browse.clear();BrowseUtil.set_special_mode("search")}if(this.last_fq_path==null){if(Browse.inside_dir){this.last_fq_path=Browse.containing_fq_path()}else{this.last_fq_path=""}DBHistory.push_state("/search")}this._prune_cache();this.set_title();if(a.is_advanced){this.ask_server_advanced()}else{if(a.query in this._cache){this.update_results()}else{if(!this.attempt_cache_filter()){this.ask_server()}}}return T("search")},_prune_cache:function(){var c,d,f,e,b,a;c=new Date();d=[];for(f in this._cache_ts){if(c-this._cache_ts[f]>this.CACHE_TIME){d.push(f)}}a=[];for(e=0,b=d.length;e<b;e++){f=d[e];delete this._cache[f];a.push(delete this._cache_ts[f])}return a},show_empty:function(){$("search-empty").show();return $(document.documentElement).removeClassName("earthrise")},hide_empty:function(){$("search-empty").hide();return $(document.documentElement).addClassName("earthrise")},exit_search:function(){var b,c,e,a,d;d=$$("#advanced-search-box .sick-input input");for(e=0,a=d.length;e<a;e++){b=d[e];b.setValue("");b.blur()}$("advanced-search-box").hide();$("browse").removeClassName("pending-search");this.hide_empty();c=$("browse-search");c.show();Browse.first_load=true;return Browse.reload_fqpath(this.last_fq_path,true)},clear_cache:function(){this._cache={};return this._cache_ts={}},force_reload:function(){this.clear_cache();return this.search()},ask_server:function(){var b,a,c=this;b=this.get_state();assert(!b.is_advanced,"expected to be in basic search mode");$("web-search-results").__date(_("Searching..."));$("browse").addClassName("pending-search");a="/ajax_search";return new Ajax.DBRequest(a,{no_watch:true,evalJSON:false,parameters:{query:b.query},log_timing:true,onSuccess:function(d){var e;if(!Browse.in_search_mode()){return}e=Util.from_json(d.responseText);c._cache[b.query]=e;c._cache_ts[b.query]=new Date();if(!c.last_state.is_advanced&&(c.last_state.query===b.query)){return c.update_results()}},cleanUp:function(){return $("browse").removeClassName("pending-search")}})},ask_server_advanced:function(){var a,b=this;a=this.get_state();assert(a.is_advanced,"expected to be in advanced search mode");assert(!a.query,"expected advanced search params only");delete a.is_advanced;$("web-search-results").__date(_("Searching..."));$("browse").addClassName("pending-search");return new Ajax.DBRequest("/ajax_advanced_search",{no_watch:true,evalJSON:false,parameters:a,log_timing:true,onSuccess:function(c){if(!Browse.in_search_mode()){return}b.advanced_results=Util.from_json(c.responseText);return b.update_results()},cleanUp:function(c){return $("browse").removeClassName("pending-search")}})},attempt_cache_filter:function(){var a,d,b,h,c,g,f,e;g=this.get_state().query;h=this._query_to_regex(g);b=function(j){return h.match(FileOps.filename(j[3]).toLowerCase())};if(g.length<=1){return false}for(c=f=e=g.length-1;e<=1?f<=1:f>=1;c=e<=1?++f:--f){d=g.substr(0,c).strip();if(d in this._cache){if(this._cache[d].file_info.length<this.MAX_RESULTS){a=Object.clone(this._cache[d]);a.file_info=a.file_info.findAll(b);this.update_results(a);return true}else{return false}}}return false},_query_to_regex:function(a){return new RegExp(RegExp.escape(a).split(new RegExp(" +")).join(".*"))},update_results:function(a){var d,c,b;Browse.reset_state();Browse.reset_sort();b=this.get_state();if(!a&&b.is_advanced){a=this.advanced_results}if(!a){c="the only way to get to advanced is through basic -- expected last_state to exist and not be advanced!";assert(this.last_state&&!this.last_state.is_advanced,c);assert(this.last_state.query in this._cache,("update() called w/o a cache entry: q="+this.last_state.query)+(a=this._cache[this.last_state.query]))}Browse.update(a);Browse.set_selection_from_fq_paths_or_index(FileSearch);this._update_number_results(a.file_info.length);d=b.is_advanced?_("Basic search"):_("Advanced search");$("advanced-search-link").__date(d);if(Browse.files.length){return this.hide_empty()}else{return this.show_empty()}},_update_number_results:function(b){var d,a,c;c=b===0?_("No results"):(d=ungettext("Search - %s result","Search - %s results",b),a=b+(b>=this.MAX_RESULTS?"+":""),d=d.format(a));return $("web-search-results").__date(c)},show_advanced:function(){$("browse").addClassName("advanced-search");$("browse-search").hide();$("advanced-search-link").__date(_("Basic search"));$("advanced-search-box").show();return $("all_terms").focus()},show_basic:function(a){$("browse").removeClassName("advanced-search");$("advanced-search-box").hide();$("advanced-search-link").__date(_("Advanced search"));$("browse-search").show();if(!a){return $("browse-search-input").focus()}},toggle_advanced:function(){var a,b;b=$("advanced-search-link");b.toggleClassName("selected");if(b.hasClassName("selected")){$("all_terms").setValue(this.get_basic_query());return this.show_advanced()}else{a=$("all_terms").getValue();if(a){this.set_basic_query(a);return this.show_basic()}else{return this.exit_search()}}},history_change_handler:function(){var a;if(!this.last_state){BrowseURL.set_path_url(Constants.root_ns,"");return}if(this.state_changed()){this.set_state(this.last_state)}key.setScope(Browse.KEY_SCOPE);if(BrowseSelection.get_selected_files().length){a=BrowseSelection.get_selected_files()[0].get_div();return Browse.scrollToWithPadding(a,a.getHeight()*2)}},clear_searchbox:function(){return $("browse-search-input").setValue("")}};var BrowseKeys;BrowseKeys={_handlers:{},init:function(){},init_advanced:function(){var c,a,b,d=this;b=this.advanced_dict;for(a in b){c=b[a];key(c.key,Browse.KEY_SCOPE,c.onPress)}this.customize_chart();if(Util.is_mac()&&Prototype.Browser.Gecko){return document.observe("keypress",function(f){if(f.charCode===63&&!Util.focus_in_input()){return d.advanced_dict.help.onPress()}})}},getKey:function(a){return a.keyCode||a.which||a.charCode},customize_chart:function(){var d,b,c,a;d=(Util.is_mac()?".key-windows":".key-macos");c=0;b=void 0;a=[];while(true){b=$("keys-chart").down(d,c++);if(!b){break}a.push(b.hide())}return a},toggle_chart:function(){if($("keys-chart").style.display==="none"){return this.show_chart()}else{return this.hide_chart()}},show_chart:function(){var a,b;a=$("keys-chart");a.style.position="fixed";b=$("browse-sort");if(b.getStyle("display")==="none"){b=$("browse-root-actions")}$j(a).clonePosition($j(b),{setHeight:false});a.style.top=b.cumulativeOffset()[1]+b.getHeight()+"px";a.setOpacity(0.85);return a.show()},hide_chart:function(){return $("keys-chart").hide()},advanced_dict:{rename:{title:_("Rename selected files"),key:"f2",onPress:function(b,c){var a;a=BrowseSelection.get_selected_files();if(a.length){return a.first().edit()}}},"delete":{title:_("Delete selected files"),key:"delete, command+backspace, backspace",onPress:function(d,f){var a,c,b;Event.stop(d);b=BrowseSelection.get_selected_files();if(b.length===1){a=b.first();if(a.is_deleted){return FileOps.show_purge(a.fq_path,a.dir)}else{return FileOps.show_delete(a.fq_path,a.dir)}}else{if(b.length>1){c=BrowseUtil.profile_files(b);if(c.deleted===b.length){return FileOps.show_bulk_purge(b)}else{if(c.deleted===0){return FileOps.show_bulk_delete(b)}}}}}},help:{title:_("Show/hide keyboard shorcuts"),key:"shift+/, "+(key.main_modifier())+"+/",onPress:function(){return BrowseKeys.toggle_chart()}},close_help:{title:_("Hide keyboard shorcuts"),key:"escape",onPress:function(){return BrowseKeys.hide_chart()}},up_dir:{title:_("Up a folder"),key:"left",onPress:function(){var a,b;Browse.keyboard_nav=true;if(!Browse.reloading){if(Browse.inside_dir){if(!Browse.containing_ns_path()&&Browse.containing_ns_id()!==Constants.root_ns){b=Constants.root_ns;a=Util.normalize(Util.parentDir(Browse.containing_fq_path()))}else{b=Browse.containing_ns_id();a=Util.normalize(Util.parentDir(Browse.containing_ns_path()))}if(Browse.containing_ns_path()!==a||Browse.containing_ns_id()!==b){Browse.select_fq_paths=[Browse.containing_fq_path()];return BrowseURL.set_path_url(b,a)}else{return BrowseSelection.flicker_selected()}}else{return BrowseSelection.flicker_selected()}}}},open_file:{title:_("Open highlighted file"),key:"enter",onPress:function(){var a,b;b=BrowseSelection.get_selected_files();if(b.length===1){a=b[0];Browse.open_file(a,false)}return false}},open_dir:{title:_("Open highlighted folder"),key:"right",onPress:function(){var a,b;Browse.keyboard_nav=true;b=BrowseSelection.get_selected_files();if(b.length===1){a=b[0];if(a.dir){Browse.select_index=0;Browse.open_folder(a)}else{BrowseSelection.flicker_selected()}}return false}},undo:{title:_("Undo recent move/copy/rename/delete"),key:""+(key.main_modifier())+"+z",onPress:function(){if(Constants.can_undo&&$("undo-link")){UndoAction.perform_undo()}return false}}}};var BrowseURL;BrowseURL={_DEFAULTS:{d:false,select:false},_get_helper:function(a){var b;b=DBHistory.deconstruct_url().qargs;if(a in b){return !!b[a]}else{assert(a in this._DEFAULTS,"bad query param in BrowseURL");return this._DEFAULTS[a]}},get_del:function(){return this._get_helper("d")},ns_to_fq_path:function(a,c){var b;if(a!==Constants.root_ns&&(!(a in Browse.ns_id_to_mount_point))){a=Constants.root_ns}if(a===Constants.root_ns){return c}else{b=Browse.ns_id_to_mount_point[a];return b+c}},_make_url:function(a,h,g){var f,e,b,d,c;if(g==null){g={}}if(!a){a=Constants.root_ns}assert(typeof a==="number","expected ns_id as a number");assert(typeof h==="string","expected explicit ns_path string");f=this.ns_to_fq_path(a,h);d="/home"+Util.urlquote(f);b=DBHistory.deconstruct_url().qargs;for(e in g){c=g[e];if(e in this._DEFAULTS&&!!c!==this._DEFAULTS[e]){b[e]=c}}for(e in b){if(!(e in this._DEFAULTS)){delete b[e]}}return DBHistory.construct_url(d,b)},set_path_url:function(a,f,d){var e,c,b;if(!a){a=Constants.root_ns}else{c=parseInt(a,10);a=!isNaN(c)?c:Constants.root_ns}f=Util.normalize(f);b=d!=null?this._make_url(a,f,{d:d?1:0}):this._make_url(a,f);e=DBHistory.deconstruct_url(b);return DBHistory.push_state(e.path,e.qargs)},set_del_url:function(a){var c,d,b;b=DBHistory.deconstruct_url();c=b.path;d=b.qargs;if(a){d.d="1"}else{delete d.d}return DBHistory.push_state(c,d)},_first_load:true,_last_path:null,_last_qargs:null,history_change_handler:function(h,g){var f,a,b,j,d,c,e;key.setScope(Browse.KEY_SCOPE);h=Util.normalize(h);d=g.ns;j=this._last_path;b=(e=this._last_qargs)!=null?e.ns:void 0;c=false;if(!this._first_load){c=(!Browse.inside_dir)||(h!==j)||(d!==b)}f=false;if((g.d==="1")!==(Browse.deleted_shown===true)){f=true;Browse.deleted_shown=g.d==="1"}if(this._first_load||c||f){Browse.reload(d,h,true)}FileSearch.show_basic(true);this._first_load=false;this._last_path=h;this._last_qargs=g;if(BrowseSelection.get_selected_files().length){a=BrowseSelection.get_selected_files()[0].get_div();if(a){return Browse.scrollToWithPadding(a,a.getHeight()*2)}}},parse_b2_hash:function(e){var c,b,d,a,f;a=e.split(":");if(a.length!==4){return false}d=a[0];c=a[2]==="1";b=a[3];f=!b||Util.isNumber(b);if(!f){return false}b=parseInt(b,10)||Constants.root_ns;return{ns_id:b,ns_path:d,deleted:c}}};var BrowseFile,FileTypes;FileTypes={FILE:1,FOLDER:2,PACKAGE:3,SHARED_FOLDER:4,SANDBOX:5};BrowseFile=Class.create({initialize:function(b){var c,e,a;c=Browse.inside_dir?BROWSE_SNIPPET_LEN:SEARCH_SNIPPET_LEN;a=FileOps.filename(b.fq_path);this.icon=b.icon;this.filename=a;this.caption=a.em_snippet(c);this.ns_id=b.ns_id;this.ns_path=b.ns_path;this.fq_path=b.fq_path;this.hash=b.hash;this.href=b.href;this.size=b.size!=="None"?b.size:"";this.bytes=b.bytes;this.is_deleted=this.bytes===-1;this.ago=b.ago;if(Browse.use_local_cache&&b.ts){if(this.is_deleted){this.ago=null}else{e=Date.fromSecondsSinceEpochUTC(b.ts);this.ago=e.contextualFormat()}}this.ts=b.ts;this.dir=b.is_dir?1:0;this.tkey=b.tkey;this.target_ns=b.target_ns;this.sort_rank=b.sort_rank||0;this.sort_key=b.sort_key||[""];this.sjid=b.sjid;this.thumbnail_url_tmpl=b.thumbnail_url_tmpl;this.large_thumbnail_url_tmpl=b.large_thumbnail_url_tmpl;this.type=b.type;this.preview_type=b.preview_type;if(b.last_modified_fname){this.last_modified_fname=b.last_modified_fname.em_snippet(LAST_MODIFIED_FNAME_SNIPPET)}this.real_path=b.real_path||b.fq_path;this.real_path_exists=b.real_path_exists!=null?b.real_path_exists:true;this.owned=b.owned!=null?b.owned:true;this.code_class=b.code_class;this.htmlified_link=b.htmlified_link;this.has_pdf_preview=b.has_pdf_preview;if(!(this.to_key() in BrowseFile._file_index)){Browse.add_file(this);return BrowseFile._file_index[this.to_key()]=this}},is_share:function(){return this.type===FileTypes.SHARED_FOLDER},is_sandbox:function(){return this.type===FileTypes.SANDBOX},video_transcode_url:function(){assert(this.fq_path,"video_transcode_url: expected a non-root fq_path");return"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+(this.hash+Util.urlquote(this.fq_path))},get_div:function(){return $("f_"+(this.to_key()))},rename:function(f,h,d,e,g,j){var b,k,a,c;b=Browse.inside_dir?BROWSE_SNIPPET_LEN:SEARCH_SNIPPET_LEN;a=this.fq_path;Browse.pre_action_selection=[a];k=Browse.find_file(f);if(k){Browse.remove_file(k)}this.filename=FileOps.filename(f);this.caption=this.filename.em_snippet(b);this.fq_path=f;this.ns_path=h;this.htmlified_link=j;this.hash=d;this.sort_key=e;this.sort_rank=null;this.last_modified_fname=null;if(!this.dir){c=this.href.split("/");c[c.length-1]=Util.urlquote(this.filename)+("?w="+d);this.href=c.join("/");this.icon=g}else{this.href="/home"+Util.urlquote(f);if(this.target_ns){Browse.ns_id_to_mount_point[this.target_ns]=f}}BrowseFile._file_index[this.to_key()]=this;Browse.update_file_pos(this);return document.fire(FileEvents.RENAME,{old_fq_path:a,file:this})},edit:function(){var c,a,b,d,e=this;this.editing=true;Browse.selectable();d=function(n){var g,f,k,p,m,j,q,o,l,h;h=n.responseText.evalJSON(true);assert(h.new_browse_files.length===1,"No new file data returned.");k=h.new_browse_files.first();p=k.fq_path;m=k.hash;l=Util.decode_sort_key(k.sort_key);q=k.icon;o=k.ns_path;j=k.htmlified_link;g=h.changesets;f=_("Rename complete.");Notify.server_success(f,null,null,g,FileOps.do_rollback);e.rename(p,o,m,l,q,j);BrowseSelection.set_selected_files([e]);e.get_div().smoothScrollIntoView();BrowseUtil.load_visible_thumbs();return Subscriber.set_ns_map(h.ns_map)};a="/cmd/rename"+(Util.urlquote(this.fq_path));c=new Ajax.InPlaceEditor(this.get_div().down(".filename-col a"),a,{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:true,initialText:this.filename,cancelIfSame:true,clickToEdit:false,onComplete:function(){return e.editing=false},onFailure:function(){},savingText:_("Saving..."),ajaxOptions:{job:true,html_in_error_msg:true,progress_text:_("Renaming..."),method:"POST",onCreate:Notify.clear_all,onSuccess:d,onUninitialized:Browse.unselectable},callback:function(f,g){return{to_path:g||"",folder:(e.dir?"yes":"")}}});c.enterEditMode();b=this.get_div().down(".editor_field");if("selectionEnd" in b&&this.filename.lastIndexOf(".")>-1){return b.selectionEnd=this.filename.lastIndexOf(".")}},to_key:function(){return""+this.ns_id+"_"+this.sjid},get_category:function(){var b,a;if(this.dir){if(Browse.inside_dir&&Browse.containing_fq_path()===""){if(this.filename.toLowerCase()==="public"&&Browse.public_folder_enabled){b="PUBLIC_FOLDER"}if(this.filename.toLowerCase()==="photos"){b="PHOTOS_FOLDER"}}if(b==null){if(this.type===FileTypes.FOLDER){b="FOLDER"}else{if(this.type===FileTypes.PACKAGE){b="FOLDER"}else{if(this.type===FileTypes.SHARED_FOLDER){b="SHARED_FOLDER"}else{if(this.type===FileTypes.SANDBOX){b="SANDBOX"}else{if(this.target_ns){b="SHARED_FOLDER"}else{b="FOLDER"}}}}}}}if(b==null){b=BrowseFile.EXTENSION_TO_CATEGORY[this.get_extension()]||"FILE"}a=this.is_deleted?BrowseFile.CATEGORY_TO_DELETED_TRANSLATION[b]:BrowseFile.CATEGORY_TO_TRANSLATION[b];assert(a,"CATEGORY MISSING FOR "+b);return a},get_extension:function(){if(this.dir||this.filename.indexOf(".")===-1){return}return FileOps.file_extension(this.filename).toLowerCase()},is_shmodelable:function(){return !this.is_deleted&&FileOps.is_shmodelable(this.fq_path)}});BrowseFile._CATEGORIES={IMAGE:"ai bmp cr2 eps gif ico jpeg jpg nef png psd tif tiff",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"cdr csv doc docx fla indd keynote numbers otf pages pdf ppt pptx pps ppsx ps rtf swf txt wpd xls xlsx",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 c coffee cpp cs css cxx h html html java js less php py rb sass scss sh sql vb xhtml xml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"};BrowseFile.EXTENSION_TO_CATEGORY={};BrowseFile.CATEGORY_TO_TRANSLATION={FILE:_("file"),FOLDER:_("folder"),SHARED_FOLDER:_("shared folder"),PUBLIC_FOLDER:_("folder"),PHOTOS_FOLDER:_("folder"),IMAGE:_("image"),VIDEO:_("video"),AUDIO:_("audio"),DOCUMENT:_("document"),COMPRESSED_FILE:_("archive"),CODE:_("code"),DISK_IMAGE:_("disk image"),EXECUTABLE:_("executable"),SHORTCUT:_("shortcut"),LINK:_("link"),FONT:_("font"),SANDBOX:_("app folder")};BrowseFile.CATEGORY_TO_DELETED_TRANSLATION={FILE:_("deleted file"),FOLDER:_("deleted folder"),SHARED_FOLDER:_("deleted shared folder"),PUBLIC_FOLDER:_("deleted folder"),PHOTOS_FOLDER:_("deleted folder"),IMAGE:_("deleted image"),VIDEO:_("deleted video"),AUDIO:_("deleted audio"),DOCUMENT:_("deleted document"),COMPRESSED_FILE:_("deleted archive"),CODE:_("deleted code"),DISK_IMAGE:_("deleted disk image"),EXECUTABLE:_("deleted executable"),SHORTCUT:_("deleted shortcut"),LINK:_("deleted link"),FONT:_("deleted font"),SANDBOX:_("deleted app folder")};(function(){var c,e,b,d,a;d=BrowseFile._CATEGORIES;a=[];for(c in d){b=d[c];a.push((function(){var j,g,f,h;f=b.trim().split(" ");h=[];for(j=0,g=f.length;j<g;j++){e=f[j];h.push(BrowseFile.EXTENSION_TO_CATEGORY[e]=c)}return h})())}return a})();BrowseFile._file_index={};BrowseFile.from_key=function(a){return BrowseFile._file_index[a]};BrowseFile.from_elem=function(b){var a;if(!b){return}a=b.readAttribute("data-identity");if(a){return BrowseFile.from_key(a)}else{return BrowseFile.from_elem(b.up("[data-identity]"))}};var BrowseActions,BrowseActionsBasic,BrowseActionsContext,GlobalActions,GlobalActionsBasic,GlobalActionsContext;BrowseActions=Class.create({initialize:function(a){return this._set_files(a)},get_actions:function(){var a;a=this.get_files();if(a.length<2){return this._get_actions_single(a.first())}else{return this._get_actions_multi(a)}},get_icon:function(a){return BrowseActions.option_dict[a].icon},get_text:function(a){var b;b=BrowseActions.option_dict[a];if(typeof b.text==="function"){return b.text.call(this)}else{return b.text}},get_href:function(a){var b;b=BrowseActions.option_dict[a];if(b.href){return b.href.call(this)}else{return""}},get_files:function(){return this._files},_set_files:function(a){return this._files=$A(a)},_get_actions_single:function(d){var e,a,f,b,j,c,g,k,h;e=[];if(!d){return[]}f=Browse.public_folder_enabled&&d.fq_path.toLowerCase().startsWith("/public/");g=Browse.public_folder_enabled&&d.fq_path.toLowerCase()==="/public";c=d.fq_path.toLowerCase()==="/photos";b=d.target_ns;a=d.ns_id!==Constants.root_ns;h=d.type===FileTypes.SHARED_FOLDER;k=d.type===FileTypes.SANDBOX;j=d.type===FileTypes.PACKAGE;if(d.is_deleted){e=e.concat(["restore"]);if(d.owned){e.push("purge")}if(!d.dir){e.push("revisions")}}else{if(d.dir){if(k){e.push("app_info")}else{if(h){e.push("sharing_options")}else{if(!(a||b||f||g||c)){e.push("share")}}}if(d.is_shmodelable()){e.push("token_share")}e.push("download");if(!(g||c)){if(Browse.can_open_with){e.push("open_with")}e=e.concat(["delete","rename","move"]);if(!(j||b)){e.push("copy")}}}else{if(d.is_shmodelable()){e.push("token_share")}if(f||Browse.public_app_token){e.push("copy_url")}e.push("download");if(Browse.can_open_with){e.push("open_with")}e=e.concat(["delete","rename","move","copy","revisions"])}}return e},_get_actions_multi:function(c){var a,b;a=["download"];if(Browse.can_open_with){a.push("open_with")}a=a.concat(["delete","move","copy","restore","purge"]);b=BrowseUtil.profile_files(c);if(b.deleted>0||b.public_folder>0||b.photos_folder>0){a.removeItem("move");a.removeItem("copy");a.removeItem("delete")}if(b.shared_folders>0){a.removeItem("copy")}if(b.deleted>0){a.removeItem("delete");a.removeItem("download")}if(!Browse.inside_dir){a.removeItem("download")}if(b.deleted!==c.length){if(b.rejoinables!==c.length){a.removeItem("restore")}a.removeItem("purge")}if(b.owned!==c.length){a.removeItem("purge")}return a}});Object.extend(BrowseActions,{PUBLIC_FOLDER_PATH_LENGTH:7,showCopyPublicUrlModal:function(a){var b;Modal.icon_show("alert_32",_("Copy public link"),DomUtil.fromElm("copy-public-url"),{wit_group:"copy_public_link"});Modal.onHide=function(){$("flash_copy_container").remove();delete Modal.onHide;return Modal.hide()};BrowseActions.addCopyUrlFlash(a);b=$("modal-content").down("#public_url");assert(b,"Text element not found for copy pulic link");b.setValue(a);return b.select()},clipboard_copy_done:function(){Notify.server_success(_("Link copied to clipboard!"));return Modal.hide()},shortenPublicLink:function(){var a;Util.shorten_url($F("public_url"),BrowseActions.updatePublicLink);a=new Element("img",{id:"publink_loading",src:"/static/images/icons/ajax-loading-small.gif",className:"right"});return $("modal-content").down("a").__date(a)},updatePublicLink:function(a){$("public_url").setValue(a);$("public_url").select();$("publink_loading").remove();$("flash_copy_container").remove();return BrowseActions.addCopyUrlFlash(a)},addCopyUrlFlash:function(b,c){var a;if(c==null){c="real_copy"}a=Util.copy_to_clipboard_swf(b,c,"BrowseActions.clipboard_copy_done");return $(a).up().style.zIndex="1001"},option_dict:{new_folder:{icon:"folder_add",text:_("New folder"),click_handler:function(a){return Browse.new_folder()}},global_restore:{icon:"restore",text:function(){assert(Browse.inside_deleted_dir,"Global restore from not a deleted dir");if(Browse.inside_deleted_shared_folder){return _("Rejoin shared folder")}else{if(Browse.inside_deleted_sandbox){return _("Restore app folder")}else{return _("Restore folder")}}},click_handler:function(){var c,b,a;c=Browse.containing_fq_path();if(Browse.inside_deleted_sandbox){assert(Browse.old_path_to_ns_id[c],"Deleted sandbox missing nsid");return Apps.restore_sandbox(c,Browse.old_path_to_ns_id[c])}else{if(Browse.inside_deleted_shared_folder){assert(Browse.old_path_to_ns_id[c],"Deleted shared folder missing nsid");return Sharing.rejoin(c,Browse.old_path_to_ns_id[c])}else{a=Util.urlquote(c);b=encodeURIComponent(location.href);return window.location.href="/restore"+a+"?prev="+b}}}},restore:{icon:"restore",text:function(){var b,a;b=this.get_files();a=BrowseUtil.profile_files(b);if(a.shared_folders===b.length){return ungettext("Rejoin shared folder","Rejoin shared folders",b.length)}else{return _("Restore")}},click_handler:function(){var b,e,a,f,d,c;e=this.get_files();if(e.length===0){}else{if(e.length===1){b=e.first();if(!b.is_deleted){return}f=b.fq_path;a=f.toLowerCase();if(b.type===FileTypes.SANDBOX){assert(Browse.old_path_to_ns_id[a],"Restore missing ns");Apps.restore_sandbox(f,Browse.old_path_to_ns_id[a])}else{if(b.type===FileTypes.SHARED_FOLDER){assert(Browse.old_path_to_ns_id[a],"Rejoin missing ns");Sharing.rejoin(f,Browse.old_path_to_ns_id[a])}else{if(b.dir){c=Util.urlquote(b.fq_path);d=encodeURIComponent(Util.add_qstring(location.href,{select:b.filename}));window.location="/restore"+c+"?prev="+d}else{FileOps.show_undelete(b)}}}}else{return FileOps.show_bulk_restore(e)}}}},global_share:{icon:"rainbow_16",text:function(){if(Browse.inside_shared_folder){return _("Shared folder options")}else{if(Browse.containing_fq_path()===""){return _("Share a folder")}else{return _("Share this folder")}}},click_handler:function(a){if(Browse.containing_fq_path()===""){return Sharing.start_wizard(a)}else{if(Browse.inside_shared_folder){return Sharing.get_sharing_options(Browse.containing_mount_point())}else{return Sharing.show_share_existing_modal(Browse.containing_fq_path())}}}},sharing_options:{icon:"rainbow_16",text:_("Shared folder options"),click_handler:function(a){return Sharing.get_sharing_options(this.get_files().first().fq_path)}},view_token:{icon:"link",text:_("Share link"),click_handler:function(){var b,a;b=this.get_files().first();a="/s/"+b.tkey;if(!b.dir){a+="/"+Util.urlquote(FileOps.filename(b.fq_path))}return window.location.href=a}},remove_share:{icon:"link_delete",text:_("Disable link"),click_handler:function(){var a;a=this.get_files().first();return SharingModel.confirm_remove(FileOps.filename(a.fq_path),a.tkey,a.dir)}},share_new:{icon:"rainbow_16",text:_("Share a folder"),click_handler:function(a){return Sharing.start_wizard(a)}},share:{icon:"rainbow_16",text:_("Invite to folder"),click_handler:function(a){return Sharing.show_share_existing_modal(this.get_files().first().fq_path)}},share_invite_more:{icon:"group",text:_("Invite more people"),click_handler:function(a){return Sharing.show_invite_more_modal(this.get_files().first().fq_path)}},share_leave:{icon:"folder_user_delete",text:_("Leave shared folder"),click_handler:function(a){var b;b=this.fq_path;return Sharing.show_leave_modal(this.get_files().first().fq_path)}},share_unshare:{icon:"link_break",text:_("Unshare this folder"),click_handler:function(a){var b;b=this.get_files().first().fq_path;return Sharing.show_unshare_modal(b)}},revisions:{icon:"previousversions",click_handler:function(){return window.location.href="/revisions"+Util.urlquote(this.get_files().first().fq_path)},text:_("Previous versions")},token_share:{icon:"link",text:_("Share link"),click_handler:function(b){var a;a=this.get_files().first().fq_path;assert(a,"token_share: expected non-root fq_path");return Sharing.shmodel(a)}},global_token_share:{icon:"link",text:_("Share link"),click_handler:function(a){return Sharing.shmodel(Browse.containing_fq_path())}},copy_url:{icon:"world_link",text:_("Copy public link"),click_handler:function(c){var a,b;AMC.log("site_action",{action:"publink_create",webserver:Constants.WEBSERVER});a=this.get_files().first();b=Browse.public_app_token?"/spa/"+Browse.public_app_token+Util.urlquote(a.ns_path):"/u/"+Constants.uid+Util.urlquote(a.fq_path.substring(BrowseActions.PUBLIC_FOLDER_PATH_LENGTH));return BrowseActions.showCopyPublicUrlModal("https://"+Constants.PUBSERVER+b)}},download:{icon:"download",text:function(){return _("Download")},click_handler:function(){var h,b,c,f,e,g,a,d;c=this.get_files();AMC.log("file_action",{action:"download",num_files:c.length,webserver:Constants.WEBSERVER});if(c.length===1&&!c[0].dir){b=c.first();d=[Constants.protocol,Constants.block,Util.urlquote(b.fq_path),b.hash],g=d[0],h=d[1],e=d[2],f=d[3];a=""+g+"://"+h+"/get"+e+"?w="+f+"&dl=1";return window.location=a}else{return FileOps.do_bulk_download(c)}}},view:{href:function(){var f,a,d,c,e,b;a=this.get_files().first();b=[Constants.protocol,Constants.block,Util.urlquote(a.fq_path),a.hash],e=b[0],f=b[1],c=b[2],d=b[3];return""+e+"://"+f+"/get"+c+"?w="+d},icon:"page_white_magnify",text:_("View file")},a_photo:{href:function(){return"/photoshow"+Util.urlquote(this.get_files().first().fq_path.substring(7))},icon:"pictures",text:_("Gallery view")},ignore:{click_handler:function(){return Sharing.ignore(this.get_files().first().fq_path)},icon:"folder_user_delete",text:_("Permanently remove")},show_del:{click_handler:function(a){return Browse.toggle_deleted()},icon:"show-deleted",text:_("Show deleted files")},hide_del:{click_handler:function(a){return Browse.toggle_deleted()},icon:"hide-deleted",text:_("Hide deleted files")},copy:{icon:"copy",text:_("Copy"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_copy(a.fq_path,a.dir)}else{if(b.length>1){return FileOps.show_copy_bulk(b)}}}},move:{icon:"move_16",text:_("Move"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_move(a.fq_path,a.dir)}else{if(b.length>1){return FileOps.show_move_bulk(b)}}}},rename:{icon:"rename",text:_("Rename"),click_handler:function(){return this.get_files().first().edit()}},"delete":{icon:"delete_16",text:_("Delete"),click_handler:function(c){var a,b;b=this.get_files();if(b.length>1){return FileOps.show_bulk_delete(b)}else{if(b.length===1){a=b.first();return FileOps.show_delete(a.fq_path,a.dir)}}}},global_purge:{icon:"permdelete",text:_("Permanently delete folder"),click_handler:function(){return FileOps.show_purge(Browse.containing_fq_path(),true)}},purge:{icon:"permdelete",text:_("Permanently delete"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_purge(a.fq_path,a.dir)}else{return FileOps.show_bulk_purge(b)}}},upload:{icon:"upload_16",text:_("Upload"),click_handler:function(a){return FileOps.show_upload()}},app_info:{icon:"application_double",text:_("Application info"),click_handler:function(a){return window.location.href="/account/applications"}},more_actions:{icon:"big-dropdown",text:function(){return _("More")},click_handler:Prototype.emptyFunction},preview_folder:{icon:"magnifier2",text:function(){return _("Preview folder")},click_handler:function(){return BrowseUtil.filepreview_from_selected("fileclick",this)}},more_global_actions:{icon:"arrow_down_grey_small",text:_("More actions"),click_handler:function(){GlobalActionsBasic.show_secondary();return document.body.observe("click",GlobalActionsBasic.hide_secondary)}},open_with:{icon:"move_16",text:_("Open with..."),click_handler:function(){return FileOps.show_open_with(this.get_files())}}}});BrowseActionsContext=Class.create(BrowseActions,{initialize:function($super,a){$super(a);return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(d,b){var c,a;c=b.readAttribute("data-value");a=BrowseActions.option_dict[c];d.stop();ContextMenu.hide();return a.click_handler.call(this)}});BrowseActionsBasic=Class.create(BrowseActions,{initialize:function($super){var a;a=BrowseSelection.get_selected_files();$super(a);this._render();return this._listen()},_listen:function(){var a;this.bound_update=this._update.bind(this);this.bound_disable=this._disable.bind(this);this.bound_enable=this._enable.bind(this);this.bound_click=this._click.bind(this);document.observe(BrowseSelection.UPDATED_EVT,this.bound_update);document.observe(ContextMenu.SHOW_EVT,this.bound_disable);document.observe(ContextMenu.HIDE_EVT,this.bound_enable);a=$("browse-root-actions");a.stopObserving("click");return a.on("click",".action button",this.bound_click)},unlisten:function(){document.stopObserving(BrowseSelection.UPDATED_EVT,this.bound_update);document.stopObserving(ContextMenu.SHOW_EVT,this.bound_disable);document.stopObserving(ContextMenu.HIDE_EVT,this.bound_enable);return $("browse-root-actions").stopObserving("click",this.bound_click)},_update:function(){this._set_files(BrowseSelection.get_selected_files());return this._render()},_disable:function(){$("browse-root-actions").stopObserving("click");if($("browse-root-actions").down(".secondary")){$("browse-root-actions").down(".secondary").addClassName("disabled")}return $$("#browse-root-actions .action *").invoke("setStyle",{cursor:"default"})},_enable:function(){$("browse-root-actions").stopObserving("click");$("browse-root-actions").on("click",".action button",this._click.bind(this));if($("browse-root-actions").down(".secondary")){$("browse-root-actions").down(".secondary").removeClassName("disabled")}return $$("#browse-root-actions .action *").invoke("setStyle",{cursor:"pointer"})},_render:function(){var u,p,h,s,v,w,o,q,k,e,f,g,r,d,m,b,j,l,n,c,a,t;e=this.get_files();h=this.get_actions();u=14;q="";f="";if(e.length===1){q=e[0].filename.em_snippet(u);if(!e[0].dir&&e[0].bytes>=0){f=e[0].size}}else{if(1<e.length){b=BrowseUtil.profile_files(e);r=[];if(b.files){d=ungettext("%d file","%d files",b.files).format(b.files);r.push(d)}if(b.folders){d=ungettext("%d folder","%d folders",b.folders).format(b.folders);r.push(d)}q=Util.nice_list(r)}}v=$("browse-root-actions");s=v.getLayout().get("width");g=v.getStyle("font-size");assert(g.endsWith("px"),"Invalid font size "+g);g=parseInt(g,10);k=new Emstring(q).length*g;l=new Emstring(f).length*g;s-=k+l;n=[];j=[];s-=10;for(a=0,t=h.length;a<t;a++){p=h[a];c=new Emstring(this.get_text(p)).length*g;w=c+16+8+10+9;if(s>w){n.push(p)}else{if(j.length===0){m=n.pop();j.push(m)}j.push(p)}s-=w}o=HTML.tmpl("actions_bar_tmpl",{context:this,description:q,filesize:f,has_actions:!!h.length,standard_actions:n,secondary_actions:j});return $("browse-root-actions").__date(o)},_click:function(d,b){var c,a;c=b.readAttribute("data-value");assert(c);a=BrowseActions.option_dict[c];assert(a,"Action info is missing for "+c);d.preventDefault();return a.click_handler.call(this)}});Object.extend(BrowseActionsBasic,{STANDARD_ACTIONS:["share","sharing_options","app_info","token_share","copy_url","download","delete","rename","restore","purge"]});GlobalActions=Class.create(BrowseActions,{initialize:function($super){return $super()},get_actions:function(){var a;if(!Browse.inside_dir){return[]}a=[];if(!Browse.inside_deleted_dir){a=a.concat(["upload","new_folder"]);if(!Browse.inside_sandbox){a.push("global_share")}if(Browse.containing_fq_path()&&FileOps.is_shmodelable(Browse.containing_fq_path())){a.push("global_token_share")}if(!Constants.can_see_trash){a.push((Browse.deleted_shown?"hide_del":"show_del"))}}else{a=a.concat(["global_restore"])}return a}});GlobalActionsBasic=Class.create(GlobalActions,{initialize:function($super){$super();this._listen();return this._render()},_listen:function(){$("global-actions").stopObserving("click");$("global-actions").on("click","a",this._click.bind(this));document.observe(ContextMenu.SHOW_EVT,this._disable.bind(this));return document.observe(ContextMenu.HIDE_EVT,this._enable.bind(this))},_render:function(){var d,b,c,a;d=this.get_actions();a=d.intersect(GlobalActionsBasic.STANDARD_ACTIONS);c=d.without.apply(d,GlobalActionsBasic.STANDARD_ACTIONS);if(c.length===1){a=d;c=[]}if(c.length){a.push("more_global_actions")}b=HTML.tmpl("global_actions_tmpl",{context:this,standard_actions:a,secondary_actions:c});return $("global-actions").__date(b)},_disable:function(){$("global-actions").stopObserving("click");$$("#global-actions .action a").invoke("removeClassName","title_bubble");return $$("#global-actions .action a").invoke("addClassName","disabled")},_enable:function(){$("global-actions").stopObserving("click");$("global-actions").on("click","a",this._click.bind(this));$$("#global-actions .action a").invoke("removeClassName","disabled");return $$("#global-actions .action a").invoke("addClassName","title_bubble")},_click:function(d,b){var c,a;c=b.readAttribute("data-value");assert(c);a=BrowseActions.option_dict[c];assert(a,"Action info is missing for "+c);d.stop();GlobalActionsBasic.hide_secondary();BrowseSelection.deselect_all();return a.click_handler.call(this)}});Object.extend(GlobalActionsBasic,{STANDARD_ACTIONS:["upload","new_folder","global_share","global_token_share","global_restore","global_purge"],show_secondary:function(){var a,b;b=$("secondary-actions");a=$("more_global_actions_button");b.show();return a.addClassName("down")},hide_secondary:function(){var a,b;b=$("secondary-actions");if(!b){return}a=$("more_global_actions_button");b.hide();return a.removeClassName("down")}});GlobalActionsContext=Class.create(GlobalActions,{initialize:function($super,a){$super(a);return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(d,b){var c,a;c=b.readAttribute("data-value");a=BrowseActions.option_dict[c];d.stop();BrowseSelection.deselect_all();ContextMenu.hide();return a.click_handler.call(this)}});var BrowseClipboard;BrowseClipboard=(function(){var j,f,c,g,e,l,n,h,b,a,k,d,m;j=0;f=1;e=[];c=null;m=function(){var q,s,p,t,r,o;if(Util.focus_in_input()){return}p=BrowseSelection.get_selected_files();if(p&&p.length){for(r=0,o=p.length;r<o;r++){s=p[r];if(s.bytes<0){Notify.server_error(_("Deleted files cannot be added to the clipboard"));return false}else{if(s.target_ns){t=_("'%(filename)s' cannot be added to the clipboard");t=t.format({filename:s.filename});Notify.server_error(t);return false}}}e=p;q=p.length;t=ungettext("Added %d item to clipboard","Added %d items to clipboard",q).format(q);Notify.server_success(t);return true}};l=function(){if(m()){c=j;return false}};n=function(){if(m()){c=f;return false}};h=function(o){var p;assert(typeof o!=="undefined","BrowseClipboard _paste got an undefined path");if(e.length){p=c===j?FileOps.do_bulk_copy:FileOps.do_bulk_move;p(e,o);return true}};d=function(o){var p;if(Util.focus_in_input()||Browse.in_search_mode()||Browse.inside_deleted_dir){return}p=h(Browse.containing_fq_path());if(p){return false}};g=function(){return e=[]};a=function(v){var u,q,s,t,r,p,o;s=v.memo.files;for(t=0,p=s.length;t<p;t++){q=s[t];for(r=0,o=e.length;r<o;r++){u=e[r];if(u.fq_path===q.fq_path||u.fq_path.startsWith(q.fq_path+"/")){g();return}}}};b=function(o){assert((o.memo.file!=null)&&!(o.memo.files!=null));o.memo.files=[o.memo.file];return a(o)};k=function(){var s,o,r,p,q;document.observe(FileEvents.RENAME,b);q=[FileEvents.DELETE,FileEvents.MOVE];for(r=0,p=q.length;r<p;r++){s=q[r];document.observe(s,a)}o=key.main_modifier();key(""+o+"+c",Browse.KEY_SCOPE,l);key(""+o+"+x",Browse.KEY_SCOPE,n);return key(""+o+"+v",Browse.KEY_SCOPE,d)};return{init:function(){return k()}}})();var BrowseSelection;BrowseSelection=(function(){var z,E,C,y,g,f,v,A,n,e,D,s,r,a,b,o,t,F,m,k,p,j,x,d,h,w,u,c,B,l,q;h=[];y=null;e=null;A=null;f=[];B=function(){$$("#browse-files li.browse-file.file-select").invoke("removeClassName","file-select");return BrowseSelection.get_selected_files().invoke("get_div").findAll(function(G){return G}).invoke("addClassName","file-select")};l=function(){if(A){return}$$("#browse-files li.browse-file[draggable]").invoke("writeAttribute","draggable",false);return BrowseSelection.get_selected_files().filter(function(G){return !G.editing}).invoke("get_div").findAll(function(G){return G}).invoke("writeAttribute","draggable","true")};q=function(G){G.apply(null,$A(arguments).slice(1));return document.fire(BrowseSelection.UPDATED_EVT)};w=function(I,H){var J,G;G=h.length;h=(I instanceof BrowseFile?[I]:$A(I));if(h.length!==G){T("Selected",h.length,"files")}J=H||h.last();assert(!J||J instanceof BrowseFile,"Invalid anchor type"+J);return y=J};w=w.wrap(q);z=function(H,G){if(H){h.push(H)}return y=G||H};z=z.wrap(q);k=function(G){var H;H=h.indexOf(G);if(H===-1){return}return h.splice(H,1)};k=k.wrap(q);p=function(){return h=[]};p=p.wrap(q);u=function(G){f=G;$$("#browse-files li.browse-file.context-select").invoke("removeClassName","context-select");return G.invoke("get_div").findAll(function(H){return H}).invoke("addClassName","context-select")};a=function(P){var M,K,J,L,S,I,R,U,G,O,Q,N,H;N=$(P.target);U=N.match("li.browse-file")?N:N.up("li.browse-file");M=N.match("a")?N:N.up("a");J=BrowseFile.from_elem(U);if(P.isRightClick()||!U||M){return}Browse.keyboard_nav=false;if(f.length){return}I=Util.is_mac();if((I&&P.metaKey)||(!I&&P.ctrlKey)){if(h.indexOf(J)===-1){return z(J)}else{return k(J)}}else{if(P.shiftKey){K=Browse.files.indexOf(y);H=Browse.files.indexOf(J);R=Browse.files.indexOf(h.last());O=h.slice(0);S=R<K?-1:1;L=K;while(L!==R){L+=S;Q=O.indexOf(Browse.files[L]);if(Q!==-1){O.splice(Q,1)}}S=H<K?-1:1;L=K;while(L!==H){L+=S;G=O.indexOf(Browse.files[L]);if(G!==-1){O.splice(G,1)}O.push(Browse.files[L])}return w(O,y)}else{return w(J)}}};b=function(L){var P,I,O,M,H,G,K,J,N;if(L.isRightClick()||f.length||Util.in_scrollbar(L.pointerX())){return}M=$(L.target);if(Element.match(M,"object")){M=M.parentNode}K=["browse-box","context-menu-container","modal","modal-overlay"];H=false;for(J=0,N=K.length;J<N;J++){G=K[J];if(M.descendantOf(G)||M.match("#"+G)){H=true;break}}if(!H){w();return}O=M.match("li.browse-file")?M:M.up("li.browse-file");I=BrowseFile.from_elem(O);P=M.match("[draggable]")||M.up("[draggable]");if(I&&!P){e=y;if(!L.shiftKey){if(I){e=I}else{if(M.match("#browse-files")){e=Browse.files.last()}}}A=[];if(L.metaKey||L.ctrlKey){return A=BrowseSelection.get_selected_files()}}};c=function(J){var H,G,I;I=$(J.target);G=I.match("li.browse-file")?I:I.up("li.browse-file");H=BrowseFile.from_elem(G);J.preventDefault();if(H){return Sharing.shmodel(H.fq_path)}};g=function(J){var H,G,I;I=$(J.target);G=I.match("li.browse-file")?I:I.up("li.browse-file");H=BrowseFile.from_elem(G);if(H){return a(J)}};r=null;D=function(){var G;clearInterval(r);G=function(){Browse.keyboard_nav=false;return $("browse-files").addClassName("mouse-active")};return r=setTimeout(G,100)};v=function(){if(!Browse.keyboard_nav){Browse.keyboard_nav=true;return $("browse-files").removeClassName("mouse-active")}};o=function(M){var J,I,H,L,O,G,K,N;D();if(!BrowseSelection.is_selecting()){return}J=Browse.files.indexOf(e);G=Browse.files.indexOf(BrowseFile.from_elem(M.target));assert(J<Browse.files.length&&J>=0,"anchor_index: "+J+" "+e);assert(G<Browse.files.length&&G>=0,"target_index: "+G);I=Browse.files.slice(Math.min(J,G),Math.max(J,G)+1);H=A.slice(0);for(K=0,N=I.length;K<N;K++){O=I[K];L=H.indexOf(O);if(L===-1){H.push(O)}else{H.splice(L,1)}}return w(H)};n=function(G){e=null;return A=null};m=function(I){var G,H;if(typeof BrowseJump!=="undefined"&&BrowseJump!==null){BrowseJump.reset()}v();if(I){Event.extend(I).preventDefault()}H=h.length?h.last()===Browse.files.first()?Browse.files.first():(G=Browse.files.indexOf(h.last())-1,Browse.files[G]):Browse.files.last();w(H);if(H){return Browse.scrollTo(H.get_div())}};t=function(I){var G,H;if(typeof BrowseJump!=="undefined"&&BrowseJump!==null){BrowseJump.reset()}v();if(I){Event.extend(I).preventDefault()}H=h.length?h.last()===Browse.files.last()?Browse.files.last():(G=Browse.files.indexOf(h.last())+1,Browse.files[G]):Browse.files.first();w(H);if(H){return Browse.scrollTo(H.get_div())}};C=function(O){var G,H,M,N,J,K,L,I;if(typeof BrowseJump!=="undefined"&&BrowseJump!==null){BrowseJump.reset()}v();if(O){Event.extend(O).preventDefault()}if(h.length>0){N=Browse.files.indexOf(h.last());G=Browse.files.indexOf(y);if(y===h.last()||G>N){if(N>0){I=[];for(M=K=L=N-1;L<=0?K<=0:K>=0;M=L<=0?++K:--K){H=Browse.files[M];J=h.indexOf(H);z(H,y);if(J!==-1){I.push(h.splice(J,1))}else{Browse.scrollTo(H.get_div());break}}return I}}else{k(h.last());return Browse.scrollTo(h.last().get_div())}}else{return m()}};E=function(P){var G,H,N,O,K,L,M,J,I;if(typeof BrowseJump!=="undefined"&&BrowseJump!==null){BrowseJump.reset()}v();if(P){Event.extend(P).preventDefault()}if(h.length>0){O=Browse.files.indexOf(h.last());G=Browse.files.indexOf(y);if(y===h.last()||G<O){I=[];for(N=L=M=O+1,J=Browse.files.length;M<=J?L<J:L>J;N=M<=J?++L:--L){H=Browse.files[N];K=h.indexOf(H);z(H,y);if(K!==-1){I.push(h.splice(K,1))}else{Browse.scrollTo(H.get_div());break}}return I}else{k(h.last());return Browse.scrollTo(h.last().get_div())}}else{return t()}};j=function(){if(typeof BrowseJump!=="undefined"&&BrowseJump!==null){BrowseJump.reset()}w(Browse.files);return false};d=function(){if(typeof BrowseJump!=="undefined"&&BrowseJump!==null){BrowseJump.reset()}return w(null,null,null)};x=function(G){return w(Browse.find_file(G.memo.fq_path))};s=function(){$$(".file-select").invoke("removeClassName","file-select");return setTimeout(B,100)};F=function(G){return G.memo.files.each(function(H){var I;I=h.indexOf(H[0]);if(I!==-1){h.splice(I,1);return z(H[1])}})};document.observe(UpdateEvents.REMOVE,function(G){return G.memo.files.each(k)});document.observe(UpdateEvents.MOVE,F);return{UPDATED_EVT:"db:select:updated",init:function(){var G;document.observe("click",g);document.observe("mousedown",b);document.observe("mouseup",n);document.observe("dragend",n);document.observe("mouseup",l);$("browse-files").on("mouseover","li.browse-file",o);$("browse-files").on("click",".shmodel-file",c);document.observe(BrowseSelection.UPDATED_EVT,B);document.observe(BrowseSelection.UPDATED_EVT,l);document.observe(Browse.RENDER_EVT,B);document.observe(Browse.RENDER_EVT,l);document.observe(Browse.UPDATE_EVT,w.bind(null,null,null));document.observe(Lightbox.EXIT_SELECT_EVT,x);G=key.main_modifier();key("up",Browse.KEY_SCOPE,m);key("down",Browse.KEY_SCOPE,t);key(G+"+a",Browse.KEY_SCOPE,j);key("escape",Browse.KEY_SCOPE,d);key("shift+up",Browse.KEY_SCOPE,C);return key("shift+down",Browse.KEY_SCOPE,E)},set_selected_files:function(G){return w(G)},get_selected_files:function(){return h.slice(0)},get_selected_fq_paths:function(){return h.map(function(G){return G.fq_path})},is_selected:function(G){return h.indexOf(G)!==-1},is_selecting:function(){return !!e},deselect_all:p,set_context_selected:function(G){return u(G)},flicker_selected:s}})();var BrowseDrag,BrowseDragScroll;BrowseDrag={_BODY_DRAG_CLASS:"external_drag",_STATUS_CLASS:"dragging",_STATUS_OFFSET:10,_SELECTION_CONST:"SELECTION",_current_item_key:null,_drag_from_window:false,init:function(){if(!Modernizr.draganddrop){return}return this.listen()},listen:function(){var a;a=$(document.body);document.observe(Browse.UPDATE_EVT,this._update_body_data.bind(this));a.on("dragleave","[dropzone]",this._dropzone_dragleave.bind(this));a.on("dragend",this._body_dragend.bind(this));a.on("dragover","[dropzone]",this._dropzone_dragover.bind(this));if(Prototype.Browser.IE){a.on("dragenter","[dropzone]",this._dropzone_dragover.bind(this));a.on("mousedown",this._ie_start_drags.bind(this));a.on("mouseover","a.filename-link",this._ie_mouseover.bind(this))}a.observe("dragover",this._body_dragover.bind(this));a.observe("dragleave",this._body_dragleave.bind(this));a.observe("dragstart",this._body_dragstart.bind(this));a.observe("mousemove",this._body_mousemove.bind(this));a.on("dragstart","li.browse-file",this._file_dragstart.bind(this));document.observe(BrowseSelection.UPDATED_EVT,this._build_selected_drag_icon.bind(this));document.observe(Browse.RENDER_EVT,this._build_selected_drag_icon.bind(this));a.on("mousedown","li.browse-file",this._build_file_drag_icon.bind(this));return a.on("drop","[dropzone]",this._drop.bind(this))},_file_mousemove:function(b){var a;if(!window.event||window.event.button!==1){return}a=b.findElement("[draggable]");if(a&&a!==document&&a.dragDrop){a.dragDrop();return BrowseDrag._ie_end_drags()}},_ie_start_drags:function(a,b){if(b.tagName!=="OBJECT"&&$(b).match("[draggable]")){return $("browse-files").observe("mousemove",this._file_mousemove)}},_ie_end_drags:function(){return $("browse-files").stopObserving("mousemove")},_update_body_data:function(){var b,a;b=Browse.inside_dir?"copy move":false;a=Browse.inside_dir?Browse.containing_fq_path():false;$(document.documentElement).writeAttribute("dropzone",b);return $(document.documentElement).writeAttribute("data-fq_path",a)},_body_dragover:function(d){var b,c,a;b=this._get_event_browse_files();if(b.length){return this._update_status_position(d,b)}else{if(!this._drag_from_window&&((c=d.dataTransfer)!=null?(a=c.types)!=null?a.contains("Files"):void 0:void 0)){return CrossDomainUploader.show_drop_indicators(d)}}},_body_dragleave:function(c){var b,a,d;a=c.x||c.clientX;d=c.y||c.clientY;b=Util.viewport_dimensions();if(!((0<a&&a<b.width)&&(0<d&&d<b.height))){return CrossDomainUploader.hide_drop_indicators()}},_body_dragstart:function(){return this._drag_from_window=true},_body_dragend:function(){if($("breadcrumb-dropdown")){$("breadcrumbs-box").removeClassName("down");$("breadcrumb-dropdown").hide()}this._clear_event_browse_files();this._remove_drop_indicators();CrossDomainUploader.hide_drop_indicators();BrowseDragScroll.end();return this._drag_from_window=false},_body_mousemove:function(){return CrossDomainUploader.hide_drop_indicators()},_ie_mouseover:function(b,a){return a.focus()},_dropzone_dragover:function(f,a){var b,c,d;c=this._get_event_browse_files();d=this._target_fq_path(a);if(!c.pluck("fq_path").indexOf(d===-1)){return}if(!this._can_drop(f,a)){a.addClassName("drag_nodrop");return}if(Util.is_mac()){f.dataTransfer.dropEffect="copyMove"}else{f.dataTransfer.dropEffect="move"}f.preventDefault();b=$$(".dragover");b.removeItem(a);b.invoke("removeClassName","dragover");a.addClassName("dragover");return CrossDomainUploader.folder_dragover(d)},_dropzone_dragleave:function(b,a){return this._clear_hover_state(a)},_file_dragstart:function(h,l){var m,b,n,g,d,f,j,c;Util.clear_selected();if(BrowseSelection.is_selecting()){return h.preventDefault()}h.dataTransfer.effectAllowed="copyMove";h.dataTransfer.setData("URL","about:blank");g=BrowseFile.from_elem(l);this._set_event_browse_files(g);d=this._get_event_browse_files();if(d.length<=1&&!g.dir){c=g.href;f=(g.filename||_("file")).replace(/:/g,"-");j="application/octet-stream";try{h.dataTransfer.setData("DownloadURL",[j,f,c].join(":"))}catch(k){}}n=new Element("img",{src:"/static/images/icons/icon_spacer.gif",width:1,height:1});m=true;try{h.dataTransfer.setDragImage(n,150,150)}catch(a){m=Util.ie8}this._add_drop_indicators(h);BrowseDragScroll.start();if(m){this._update_status_position(h,d);b=$("drag-status");b.removeClassName("rotatein").removeClassName("fadein").removeClassName("selection");if(d.length>1){b.addClassName("rotatein")}if(this._is_dragging_selection()){b.addClassName("selection")}return b.addClassName("fadein")}},_add_drop_indicators:function(f){var g,d,b,c,a;$(document.body).addClassName(this._STATUS_CLASS);c=$$('[dropzone="copy move"]');a=[];for(d=0,b=c.length;d<b;d++){g=c[d];if(this._can_drop(f,g)){a.push(g.addClassName("can_drop"))}else{a.push(void 0)}}return a},_remove_drop_indicators:function(){this._clear_hover_state();$(document.body).removeClassName(this._STATUS_CLASS);return $$(".can_drop").invoke("removeClassName","can_drop")},_build_selected_drag_icon:function(){var a,d,j,c,g,k,h,b,e,l,f;b=BrowseSelection.get_selected_files();j=new Element("div",{id:"drag-selection-status"});f=b.slice(0,4);for(g=e=0,l=f.length;e<l;g=++e){d=f[g];a=d.get_div();if(!a){continue}h=a.down(".icon");h.stopObserving("load");h.observe.bind(h).defer("load",BrowseDrag._build_selected_drag_icon);k=h.cloneNode(false);Element.addClassName(k,"icon icon"+g);j.__sert(k)}c=new Element("span",{className:"badge"});c.__date(b.length);j.appendChild(c);return $("drag-selection-status").replace(j)},_build_file_drag_icon:function(f,a){var b,g,d,c;b=BrowseFile.from_elem(a);c=b.get_div().down(".icon").cloneNode(false);Element.addClassName(c,"icon icon0");d=new Element("span",{className:"badge"});d.__date("1");g=new Element("div",{id:"drag-file-status"});g.__date(c).__sert(d);return $("drag-file-status").replace(g)},_drop:function(j,d){var a,c,f,g,b,h;j.preventDefault();c=this._get_event_browse_files();b=j.dataTransfer.files;h=j.dataTransfer.items;f=null;g=BrowseFile.from_elem(d);a=d.readAttribute("data-fq_path");if(g){f=g.fq_path}else{if(a||a===""){f=a}}if(b&&b.length){if(!CrossDomainUploader.supported()){Notify.server_error(_("Drag and drop not supported. Please try the simple uploader."))}else{if(!CrossDomainUploader.browse_indicators_enabled()&&!CrossDomainUploader.modal_indicators_enabled()){Notify.server_error(_("You can't drag and drop upload right now."))}else{CrossDomainUploader.upload(f,b,h)}}}else{if(c.length){if((j.dataTransfer.dropEffect==="copy")||(j.dataTransfer.effectAllowed==="copy")){if(Constants.can_undo){FileOps.do_bulk_copy(c,f)}else{FileOps.show_dragdrop_confirm(c,f,false)}}else{if(!Browse.inside_dir||Browse.containing_fq_path()!==f){if(Constants.can_undo){FileOps.do_bulk_move(c,f)}else{FileOps.show_dragdrop_confirm(c,f,true)}}}}}this._remove_drop_indicators();return CrossDomainUploader.hide_drop_indicators()},_set_event_browse_files:function(a){var b;b=BrowseSelection.is_selected(a);return this._current_item_key=b?this._SELECTION_CONST:a.to_key()},_clear_event_browse_files:function(){return this._current_item_key=null},_get_event_browse_files:function(){var c,b;try{b=this._current_item_key;if(this._is_dragging_selection()){return BrowseSelection.get_selected_files()}else{if(b){c=BrowseFile.from_key(b);return(c?[c]:[])}}}catch(a){console.log(a)}return[]},_is_dragging_selection:function(){return this._current_item_key&&this._current_item_key===this._SELECTION_CONST},_can_drop:function(d,b){var a,c;a=this._target_fq_path(b);c=this._get_event_browse_files();if(c.length){return !FileOps.bulk_move_error(c,a)}else{if($A(d.dataTransfer.types).indexOf("Files")!==-1){return CrossDomainUploader.supported()}else{return false}}},_target_fq_path:function(a){var b;b=BrowseFile.from_elem(a);if(b){return b.fq_path}else{return a.readAttribute("data-fq_path")}},_clear_hover_state:function(b){var e,d,a,c;c=$$("#browse .dragover");for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){e.removeClassName("dragover")}}return $$("#browse .drag_nodrop").invoke("removeClassName","drag_nodrop")},_update_status_position:function(a){a=Event.extend(a);return Util.scry("drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+this._STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+this._STATUS_OFFSET)+"px"})}};BrowseDragScroll=(function(){var h,g,f,c,a,d,b,e;b=null;f=0;a=40;d=50;c=function(l){var k,j;j=$(l.target);if(j.descendantOf("browse-location")||j.match("#browse-location")){return f=0}else{k=l.pointerY();return f=k-Util.scroll_offsets().top}};g=function(){d=$("browse-header").getHeight();document.observe("mousemove",c);return document.observe("dragover",c)};e=function(){document.stopObserving("mousemove",c);return document.stopObserving("dragover",c)};h=function(){var j;j=0;if(f<d){j=-1*a}else{if(f>Util.viewport_dimensions().height-d){j=a}}if(j){return Util.scroll_to(Util.scroll_offsets().left,Util.scroll_offsets().top+j)}};return{start:function(){g();return b=setInterval(h,100)},end:function(){e();return clearInterval(b)}}})();var BrowseJump;BrowseJump={_active:"",_listening:false,_RESET_WAIT:1000,_RESET_TIMER_ID:null,_CODEPOINTS:null,_BLACKLIST:["/","\\",":","?","*","<",">","|"].map(function(a){return a.charCodeAt(0)}),update:function(){var c,f,b,e,a,d;if(!BrowseJump._listening){BrowseJump.listen();BrowseJump._listening=true}c=[];d=Browse.files;for(e=0,a=d.length;e<a;e++){b=d[e];f=BrowseJump.to_codepoint_list(b.filename);c.push([f,b])}c.sort(function(h,g){return BrowseJump.cmp_codepoints(h[0],g[0])});return BrowseJump._CODEPOINTS=c},reset:function(){return BrowseJump._active=""},is_active:function(){return BrowseJump._active},jump:function(a){if(a){BrowseSelection.set_selected_files([a]);return Browse.scrollTo(a.get_div())}},listen:function(){var e,d,b,c,a;document.observe("keypress",function(g){var f;if(key.getScope()!==Browse.KEY_SCOPE){return}if(Util.focus_in_input()||g.metaKey||g.altKey||g.altGraphKey||g.ctrlKey){return}f=g.charCode||g.keyCode;if(f<32){return}if((33<=f&&f<=40)){return}if(f===32){if(BrowseJump._active){g.preventDefault()}else{return}}if(BrowseJump._BLACKLIST.indexOf(f)!==-1){return}clearTimeout(BrowseJump._RESET_TIMER_ID);BrowseJump._active+=String.fromCharCode(f).toLowerCase();BrowseJump.jump(BrowseJump.nearest_file(BrowseJump._active));return BrowseJump._RESET_TIMER_ID=setTimeout(BrowseJump.reset,BrowseJump._RESET_WAIT)});c=[FileEvents.DELETE,FileEvents.COPY,FileEvents.MOVE,FileEvents.RENAME,FileEvents.PURGE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE,UpdateEvents.ADD,UpdateEvents.REMOVE,UpdateEvents.MOVE];a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(document.observe(e,function(f){return BrowseJump.update()}))}return a},nearest_file:function(j){var f,b,a,e,h,g,d,c;if((g=BrowseJump._CODEPOINTS)!=null?g.length:void 0){f=BrowseJump.to_codepoint_list(j);d=BrowseJump._CODEPOINTS;for(e=0,h=d.length;e<h;e++){c=d[e],a=c[0],b=c[1];if(BrowseJump.cmp_codepoints(f,a)<1){return b}}BrowseJump._CODEPOINTS.last()[1]}return null},cmp_codepoints:function(e,d){var a,c,b;assert(e.length>0&&d.length>0,"bad input to cmp_codepoints");for(a=c=0,b=e.length;0<=b?c<b:c>b;a=0<=b?++c:--c){if(!(d[a]!=null)){return 1}if(e[a]!==d[a]){return(e[a]<d[a]?-1:1)}}if(d.length>e.length){return -1}else{return 0}},to_codepoint_list:function(b){var c,a,e,d;b=b.toLowerCase();a=[];for(c=e=0,d=b.length;0<=d?e<d:e>d;c=0<=d?++e:--e){a.push(b.charCodeAt(c))}return a}};var ContextMenu;ContextMenu={KEY_SCOPE:"context",SHOW_EVT:"db:contextmenu:show",HIDE_EVT:"db:contextmenu:hide",_prev_key_scope:null,listen:function(){var a=this;document.observe("click",this.hide_on_click);document.observe(Browse.UPDATE_EVT,this.hide_on_click);return key("esc",this.KEY_SCOPE,function(b){return ContextMenu.hide()})},unlisten:function(){return document.stopObserving("click",this.hide_on_click)},hide_on_click:function(a){if(!a.isRightClick()){return ContextMenu.hide()}},show_for_file:function(c,b){var d,a;Browse.keyboard_nav=false;this.hide();d=BrowseFile.from_elem(b);a=BrowseSelection.is_selected(d)?BrowseSelection.get_selected_files():[d];BrowseSelection.set_context_selected(a);return this._show(c,new BrowseActionsContext(a))},show_global:function(a){this.hide();return this._show(a,new GlobalActionsContext())},show_shmodel:function(f){var d,a,b,c;d=["get_original"];this.hide();b=f.findElement("img");c={get_original:{icon:"download",text:_("Download Original"),href:b.readAttribute("data-original-href")}};a=Class.create({get_actions:function(){return d},get_icon:function(e){return c[e].icon},get_text:function(e){return c[e].text},get_href:function(e){return c[e].href}});return this._show(f,new a())},show_photos:function(o,u){var v,r,t,q,s,c,m,n,k,l,j,h,g,f,d,b,a;this.hide();q={divider:{type:"divider"},add_to_album:{type:"subheader",text:_("ADD TO ALBUM")},new_album:{icon:"album_new_32_padded",text:_("New album"),click_handler:function(p){PhotosCollections.create(p,$("new_album_button").down("span"),u);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_NEW_ALBUM,PhotosTriggers.PCM,{num_photos:u.length})}},recent_album_1:{text:(l=PhotosCollections.get_all()[0])!=null?l.name.em_snippet(PhotosCollections.CONTEXT_MENU_COLLECTION_SNIPPET_LENGTH,1):void 0,click_handler:function(){PhotosCollections.add_photos(PhotosCollections.get_all()[0],u);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.PCM,{num_photos:u.length})}},recent_album_2:{text:(j=PhotosCollections.get_all()[1])!=null?j.name.em_snippet(PhotosCollections.CONTEXT_MENU_COLLECTION_SNIPPET_LENGTH,1):void 0,click_handler:function(){PhotosCollections.add_photos(PhotosCollections.get_all()[1],u);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.PCM,{num_photos:u.length})}},choose_album:{icon:"add_to_album_32_padded",text:_("Add %(num_photos)s to album...").format({num_photos:u.length}),click_handler:function(p){PhotosCollections.show_add_to_album_modal(p,u);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.PCM,{num_photos:u.length})}},all_albums:{icon:"album_32_padded",text:_("Another album..."),click_handler:function(p){PhotosCollections.show_add_to_album_modal(p,u);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.PCM,{num_photos:u.length})}},remove:{icon:"remove_from_album_32_padded",text:_("Remove %(num_photos)s from album").format({num_photos:u.length}),click_handler:function(){PhotosCollections.show_remove_photos_modal(Photos.get_current_collection(),u);return PhotosLogger.log_interaction(PhotosEvents.REMOVE,PhotosTriggers.PCM,{num_photos:u.length})}},set_cover:{icon:"album_32_padded",text:_("Set as cover"),click_handler:function(){PhotosCollections.set_as_cover(Photos.get_current_collection(),u[0]);return PhotosLogger.log_interaction(PhotosEvents.SET_AS_COVER,PhotosTriggers.PCM,{num_photos:1})}},edit_timestamp:{icon:"edit_timestamp_padded_32",text:"Edit timestamp",click_handler:function(){return Photos.show_timestamps_modal(u)}}};if(((h=PhotosCollections.get_all()[0])!=null?h.thumbnail_url_32:void 0)!=null){q.recent_album_1.icon_href=(g=PhotosCollections.get_all()[0])!=null?g.thumbnail_url_32:void 0}else{q.recent_album_1.icon="empty_album"}if(((f=PhotosCollections.get_all()[1])!=null?f.thumbnail_url_32:void 0)!=null){q.recent_album_2.icon_href=(d=PhotosCollections.get_all()[1])!=null?d.thumbnail_url_32:void 0}else{q.recent_album_2.icon="empty_album"}if(Photos.in_single_collection_view()){v=["share","choose_album","remove","divider"];if(u.length===1){v.unshift("divider");v.unshift("set_cover")}}else{v=["share","divider","add_to_album","new_album"];if(PhotosCollections.get_all().length){v.push("recent_album_1");if(PhotosCollections.get_all().length>1){v.push("recent_album_2");if(PhotosCollections.get_all().length>2){v.push("all_albums")}}}v.push("divider");v.push("delete");if(Photos.can_edit_timestamps){s=(function(){var w,p,e;e=[];for(w=0,p=u.length;w<p;w++){n=u[w];if(!(n.time_taken!=null)){e.push(n)}}return e})();if(s.length===0){v.push("edit_timestamp")}else{if(s.length===u.length){q.edit_timestamp.text="Set timestamp";v.push("edit_timestamp")}}}}if(u.length===1){b=PhotosUtil.categorize_files(u),c=b[0],m=b[1];if(c){k=_("Share photo")}else{k=_("Share video")}Object.extend(q,{share:{icon:"link_32_padded",text:k,click_handler:function(p){Foshmodal.show(u,false);return PhotosLogger.log_interaction(PhotosEvents.SHARE,PhotosTriggers.PCM,{num_photos:1})}},"delete":{text:_("Delete"),click_handler:function(){Photos.show_delete_photos_modal(u);return PhotosLogger.log_interaction(PhotosEvents.DELETE,PhotosTriggers.PCM,{num_photos:1})}},show_in_folder:{text:_("Show in folder"),click_handler:function(){Photos.show_in_folder(u[0]);return PhotosLogger.log_interaction(PhotosEvents.SHOW_IN_FOLDER,PhotosTriggers.PCM,{num_photos:1})}}});v.push("show_in_folder")}else{a=PhotosUtil.categorize_files(u),c=a[0],m=a[1];if(c&&m){k=ungettext("Share %(file_count)s item","Share %(file_count)s items",u.length);t=ungettext("Delete %(file_count)s item","Delete %(file_count)s items",u.length)}else{if(c){k=ungettext("Share %(file_count)s photo","Share %(file_count)s photos",u.length);t=ungettext("Delete %(file_count)s photo","Delete %(file_count)s photos",u.length)}else{k=ungettext("Share %(file_count)s video","Share %(file_count)s videos",u.length);t=ungettext("Delete %(file_count)s video","Delete %(file_count)s videos",u.length)}}k=k.format({file_count:u.length});t=t.format({file_count:u.length});Object.extend(q,{share:{icon:"link_32_padded",text:k,click_handler:function(p){Photos._share_selected();return PhotosLogger.log_interaction(PhotosEvents.SHARE,PhotosTriggers.PCM,{num_photos:u.length})}},"delete":{text:t,click_handler:function(p){Photos.show_delete_photos_modal(u);return PhotosLogger.log_interaction(PhotosEvents.DELETE,PhotosTriggers.PCM,{num_photos:u.length})}}})}r=Class.create({initialize:function(){return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(z,x){var y,p,w;y=x.readAttribute("data-value");p=q[y];z.stop();if(z.clientX===0&&z.clientY===0){return}if(y!=="new_album"){ContextMenu.hide()}return(w=p.click_handler)!=null?w.call(this,z):void 0},get_actions:function(){return v},get_type:function(e){return q[e].type},get_icon:function(e){return q[e].icon},get_icon_href:function(e){return q[e].icon_href},get_text:function(e){return q[e].text},get_href:function(e){return q[e].href}});return this._show(o,new r(),true)},show_photo_collection:function(d,f,g){var c,a,b;this.hide();if(f.is_anonymous){c=["go_to_link","unshare"]}else{c=["share","rename"];if(f.share_tkey!=null){c.push("unshare")}c.push("delete")}b={share:{icon:"link",text:_("Share album"),click_handler:function(h){if(f.num_photos===0){Notify.server_error(_("This album is empty. Add some photos before you share it!"));return}Foshmodal.show(f,true);return PhotosLogger.log_interaction(PhotosEvents.SHARE_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},unshare:{icon:"lock",text:f.is_anonymous?_("Unshare"):_("Unshare album"),click_handler:function(h){PhotosCollections.show_unshare_modal(f);return PhotosLogger.log_interaction(PhotosEvents.UNSHARE_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},rename:{icon:"album_rename_16",text:_("Rename album"),click_handler:function(h){PhotosCollections.rename(f,g.down(".collection-name"));return PhotosLogger.log_interaction(PhotosEvents.RENAME_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},"delete":{icon:"album_delete_16",text:_("Delete album"),click_handler:function(h){PhotosCollections.show_delete_modal(f);return PhotosLogger.log_interaction(PhotosEvents.DELETE_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},go_to_link:{icon:"link",text:_("Go to link"),click_handler:function(h){PhotosCollections.go_to_link(f);return PhotosLogger.log_interaction(PhotosEvents.GO_TO_ALBUM_LINK,PhotosTriggers.CCM,{num_photos:f.num_photos})}}};a=Class.create({initialize:function(){return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(m,j){var l,h,k;l=j.readAttribute("data-value");h=b[l];m.stop();ContextMenu.hide();return(k=h.click_handler)!=null?k.call(this):void 0},get_actions:function(){return c},get_icon:function(e){return b[e].icon},get_text:function(e){return b[e].text},get_href:function(e){return b[e].href}});return this._show(d,new a())},_show:function(q,j,p){var o,d,n,k,g,m,t,s,l,a,b,r,h,f,c;if(p==null){p=false}l=((q!=null?(h=q.target)!=null?h.tagName.toUpperCase():void 0:void 0)==="INPUT")&&((q!=null?(f=q.target)!=null?f.type.toUpperCase():void 0:void 0)==="TEXT")||((q!=null?(c=q.target)!=null?c.tagName.toUpperCase():void 0:void 0)==="TEXTAREA");n=["page-footer","account-header","browse-global-actions-bar","modal","modal-overlay","file-preview-modal","file-viewer"];s=$(q.target);for(b=0,r=n.length;b<r;b++){d=n[b];if($(d)&&(s.descendantOf(d)||s.match("#"+d))){return}}if(s.match("#context-menu")){return}if((q!=null?q.shiftKey:void 0)||l){return}else{Event.stop(q)}if(this._context_menu_tmpl==null){this._context_menu_tmpl=HTML.tmpl("context_menu_tmpl")}o=Event.pointer(q);if(!j.get_actions().length){return}FreshDropdown.hide_all();$("context-menu-container").__date(this._context_menu_tmpl({context:j,actions:j.get_actions(),big:p}));a=Util.viewport_dimensions();t=Util.scroll_offsets();g=parseInt($("context-menu").getStyle("width"),10);k=parseInt($("context-menu").getStyle("height"),10);m=15;if(o.x+g>a.width+t.left-m){$("context-menu").setStyle({left:(o.x-t.left-g)+"px"})}else{$("context-menu").setStyle({left:(o.x-t.left)+"px"})}if(o.y+k>a.height+t.top-m){$("context-menu").setStyle({top:(a.height-k-m)+"px"})}else{$("context-menu").setStyle({top:(o.y-t.top)+"px"})}$("context-menu-container").show();this.listen();this._prev_key_scope=key.getScope();key.setScope(this.KEY_SCOPE);return document.fire(this.SHOW_EVT)},hide:function(){if(!$("context-menu-container").empty()){this.unlisten();BrowseSelection.set_context_selected([]);$("context-menu-container").__date();if(key.getScope()===this.KEY_SCOPE){key.setScope(this._prev_key_scope)}return document.fire(this.HIDE_EVT)}}};var CountSubscriber,Subscriber;Subscriber={INITIAL_BACKOFF:15,MAX_BACKOFF:4*60,NS_MAP_CHILLOUT:5,_failure_backoff:this.INITIAL_BACKOFF,_ns_map:false,_get_list_info:false,_latest_nid:0,_do_list:function(){var g,c,e,a,b,d,f=this;d=this._get_list_info(),g=d[0],b=d[1],e=d[2];if(e==null){e={}}e=Object.extend(e,{ns_map:((function(){var h,j;h=this._ns_map;j=[];for(c in h){a=h[c];j.push(""+c+"_"+a)}return j}).call(this)).join(",")});return new Ajax.DBRequest(b,{no_watch:true,noAutonotify:true,parameters:e,onSuccess:function(h){var k;k=Util.from_json(h.responseText);f._failure_backoff=f.INITIAL_BACKOFF;f._ns_map=k.ns_map;try{g(k)}catch(j){}return f._long_poll()},onFailure:function(){f._do_list.bind(f).delay(f._failure_backoff);return f._failure_backoff=Math.min(f._failure_backoff*2,f.MAX_BACKOFF)}})},_long_poll:function(){var a,b=this;if(!this._ns_map){this._long_poll.bind(this).delay(this.NS_MAP_CHILLOUT);return}a={onList:this._do_list.bind(this),cursorForList:function(){return b._ns_map}};a.onUser=function(){return Subscriber._do_unread_notification_count()};a.cursorForUser=Subscriber._latest_nid;return Notserver.subscribe(Constants.SUBSCRIBE_URL,a)},subscribe:function(a){this._get_list_info=a;return Subscriber._do_unread_notification_count()},set_ns_map:function(a){return this._ns_map=a},_do_unread_notification_count:function(){var a=this;return new Ajax.DBRequest("/web/notifications/user/unread_notifications",{onSuccess:function(b){var d,c;c=Util.from_json(b.responseText);d=parseInt(c.notifications.length,10);Subscriber.update_jewel_with_unread_count(d);return Subscriber._latest_nid=c.latest_nid},onComplete:function(){return Subscriber._long_poll()}})},update_jewel_with_unread_count:function(a){if(a>0){$j("#notification-count").addClass("show")}else{$j("#notification-count").removeClass("show")}return $j("#notification-count").text(a)}};CountSubscriber={init:function(){return this._refresh_jewel()},_latest_nid:0,_long_poll:function(){var a;a={onUser:this._refresh_jewel.bind(this),cursorForUser:this._latest_nid};return Notserver.subscribe(Constants.SUBSCRIBE_URL,a)},_refresh_jewel:function(){var a=this;return new Ajax.DBRequest("/web/notifications/user/unread_notifications",{onSuccess:function(b){var d,c;c=Util.from_json(b.responseText);d=parseInt(c.notifications.length,10);a._set_jewel_count(d);return a._latest_nid=c.latest_nid},onComplete:function(){return a._long_poll()}})},_set_jewel_count:function(a){if(a>0){$j("#notification-count").addClass("show")}else{$j("#notification-count").removeClass("show")}return $j("#notification-count").text(a)}};var BROWSE_SNIPPET_LEN,Browse,BrowseUpdate,FILE_PPREVIEW_MODAL_FOR_DOCS,LAST_MODIFIED_FNAME_SNIPPET,SEARCH_SNIPPET_LEN;BROWSE_SNIPPET_LEN=25;SEARCH_SNIPPET_LEN=20;LAST_MODIFIED_FNAME_SNIPPET=4;FILE_PPREVIEW_MODAL_FOR_DOCS=false;Browse={KEY_SCOPE:"browse",RENDER_EVT:"db:browse:render",UPDATE_EVT:"db:browse:update",SCROLL_DURATION:0.5,msg:false,files:[],reloading:false,creating_folder:false,first_load:true,last_sort:[Sort.FILES_BY_NAME,true],folder_loading_notification:null,keyboard_nav:false,init:function(a){this.unselectable();this.listen();Util.viewport_dimensions();if($j.browser.chrome){return this.previews_enabled=a&&Util.pdf_plugins().length}else{return this.previews_enabled=a}},setup:function(a){var b;this.ns_id_to_mount_point=a.ns_id_to_mount_point;this.old_path_to_ns_id=a.old_path_to_ns_id;this.compiled_tmpl=HTML.tmpl("list_item_tmpl");this.render_timeout=null;this.inside_dir=a.inside_dir;this.inside_deleted_dir=a.inside_deleted_dir;this.inside_shared_folder=a.inside_shared_folder;this.inside_sandbox=a.inside_sandbox;this.public_app_token=a.public_app_token;this.public_folder_enabled=a.public_folder_enabled;this.inside_deleted_sandbox=a.inside_deleted_sandbox;this.inside_deleted_shared_folder=a.inside_deleted_shared_folder;this.ns_map=a.ns_map;this.contents_cache_key=a.contents_cache_key;b="inside_deleted_dir";if(this.inside_deleted_dir){$("browse").addClassName(b)}else{$("browse").removeClassName(b)}this.block_hash=a.block_hash;this.block_hash_param=a.block_hash_param;if(this.inside_dir){$("advanced-search-box").hide();$("advanced-search-link").removeClassName("selected");this._containing_ns_id=a.containing_ns_id;this._containing_ns_path=a.containing_ns_path;this._containing_fq_path=a.containing_fq_path;this._containing_mount_point=a.containing_mount_point;BrowseURL.set_path_url(this._containing_ns_id,this._containing_ns_path);this.breadcrumb();if(this.browse_actions_basic){this.browse_actions_basic.unlisten();delete this.browse_actions_basic}this.browse_actions_basic=new BrowseActionsBasic();new GlobalActionsBasic();if(!a.file_info){this.show_message(_('<h3>This folder is empty</h3> Add files using the <a href="/install">desktop application</a> or the upload button above.'))}}this._push_files(a.file_info);return Subscriber.set_ns_map(a.ns_map)},_push_files:function(b){var c,d,a;for(d=0,a=b.length;d<a;d++){c=b[d];BrowseUtil.make_browsefile(c)}return BrowseJump.update()},_get_helper:function(a){assert(this.inside_dir,"accessed "+a+", but not inside a directory");return Browse[a]},containing_ns_id:function(){return this._get_helper("_containing_ns_id")},containing_ns_path:function(){return this._get_helper("_containing_ns_path")},containing_fq_path:function(){return this._get_helper("_containing_fq_path")},containing_mount_point:function(){return this._get_helper("_containing_mount_point")},listen:function(){var b,f,o,j,h,e,m,c,a,n,k,g,d,l=this;$("browse-files").on("click","li.browse-file",this.click.bind(this));$("browse-files").on("dblclick","li.browse-file",this.dblclick.bind(this));$("browse-files").on("contextmenu","li.browse-file",ContextMenu.show_for_file.bind(ContextMenu));this.enable_sorting();f="#browse-sort a.sortable-column-header";Util.add_sort_arrow_mouseover($("name-sorter"),true,f,false);Event.observe(window,"scroll",this.window_scroll.bind(this));Event.observe(window,"resize",this.updateOffset.bind(this));$(document.body).on("click","a.crumb",this.crumb_click.bind(this));$("browse-files").on("click","a.parent-dir",this.parent_click.bind(this));document.observe("contextmenu",ContextMenu.show_global.bind(ContextMenu));document.observe(BrowseSelection.UPDATED_EVT,this.selection_handler.bind(this));document.observe(Lightbox.PHOTO_DELETE_EVT,function(p){return FileOps.do_delete(p.memo.fq_path)});document.observe(FileEvents.COPY,function(p){if(l.inside_dir&&p.memo.to_fq_path===l.containing_fq_path()){return l.force_reload()}});k=[FileEvents.MOVE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE];for(j=0,m=k.length;j<m;j++){b=k[j];document.observe(b,function(p){if(l.inside_dir){return l.force_reload()}})}g=[FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE];for(h=0,c=g.length;h<c;h++){b=g[h];document.observe(b,function(p){if(l.inside_dir){if(p.memo.target_ns_id===l.containing_ns_id()){if(p.memo.folder_deleted){return l.reload_fqpath("")}else{return l.reload_fqpath(l.containing_fq_path())}}else{return l.force_reload()}}})}d=[FileEvents.DELETE,FileEvents.PURGE];for(e=0,a=d.length;e<a;e++){b=d[e];document.observe(b,function(x){var u,w,q,v,p,s,t,r;if(l.inside_dir){if(x.eventName===FileEvents.PURGE||(x.eventName===FileEvents.DELETE&&!BrowseURL.get_del())){for(w=v=t=l.files.length-1;t<=0?v<=0:v>=0;w=t<=0?++v:--v){if(x.memo.files.indexOf(l.files[w])===-1){q=l.files[w]}else{break}}BrowseSelection.deselect_all();r=x.memo.files;for(s=0,p=r.length;s<p;s++){u=r[s];u.get_div().remove();l.files.removeItem(u)}if(l.files.length){if(q!=null){return BrowseSelection.set_selected_files(q)}else{return BrowseSelection.set_selected_files(l.files.last())}}else{return l.show_empty()}}else{if(l.keyboard_nav){l.select_fq_paths=[l.containing_fq_path()+"/"+x.memo.files.last().filename]}if(Lightbox.shown){return Lightbox.reload=true}else{return l.force_reload()}}}})}document.observe(ContextMenu.SHOW_EVT,this.disable_sorting.bind(this));document.observe(ContextMenu.HIDE_EVT,this.enable_sorting.bind(this));n=function(){var q,p;q=$("browse-header");p=q.cumulativeOffset().top+q.getHeight();return Util.viewport_dimensions().height-p};key("pagedown",this.KEY_SCOPE,function(p){Event.extend(p).preventDefault();return window.scrollBy(0,n())});key("pageup",this.KEY_SCOPE,function(p){Event.extend(p).preventDefault();return window.scrollBy(0,-1*n())});o=function(){var p;p=Browse.in_search_mode()?FileSearch:Browse;if(Browse.files.length===0){return p.show_empty()}else{return p.hide_empty()}};document.observe(UpdateEvents.ADD,function(r){var q,p,t,s;s=r.memo.files;for(p=0,t=s.length;p<t;p++){q=s[p];l.insert_file(q,true)}return o()});document.observe(UpdateEvents.REMOVE,function(r){var q,p,t,s;s=r.memo.files;for(p=0,t=s.length;p<t;p++){q=s[p];l.remove_file(q)}return o()});return document.observe(UpdateEvents.MOVE,function(s){var w,v,q,u,t,r,p;t=s.memo.files;p=[];for(q=0,u=t.length;q<u;q++){r=t[q],w=r[0],v=r[1];l.remove_file(w);p.push(l.insert_file(v))}return p})},disable_sorting:function(){$("browse-sort").stopObserving("click");return $$("#browse-sort *").invoke("setStyle",{cursor:"default"})},enable_sorting:function(){$("browse-sort").stopObserving("click");$("browse-sort").on("click","#browse-sort a.sortable-column-header",this.sort_handler.bind(this));return $$("#browse-sort *").invoke("setStyle",{cursor:"pointer"})},click:function(b,c){var a;a=$(b.target);if(a.match("a.filename-link")||a.match("img.icon")){return this._click(b,c)}},dblclick:function(a,b){if($(a.target).match("a")){return}return this._click(a,b)},dropbox_open_file:function(c,a){var b,d;b={mode:"get",file_ext:FileOps.file_extension_for_logging(c.filename),file_bytes:c.bytes};if(c.dir){if(a){return this.open_folder_in_new_window(c)}else{return this.open_folder(c)}}else{if(!a&&!((c.preview_type==="video")&&Constants.DISABLE_VIDEOS_IN_LIGHTBOX)){if(this.previews_enabled||((d=c.preview_type)==="photo"||d==="video")){return BrowseUtil.filepreview_from_selected("fileclick",c)}else{UserActivityLogger.log("web","file_view",Object.toJSON(b));return window.open(c.href,"_blank")}}else{UserActivityLogger.log("web","file_view",Object.toJSON(b));return window.open(c.href,"_blank")}}},open_file:function(b,a){if(!b.dir&&Browse.can_open_with&&b.get_extension() in Browse.app_prefs){return window.open(FileOps.open_with_url(Browse.app_prefs[b.get_extension()],[b]),"_blank")}else{return this.dropbox_open_file(b,a)}},open_preview:function(a){var b,c=this;b=function(){var e,d,g,f;e=c.find_file(a);g=e.preview_type==="video"&&Constants.DISABLE_VIDEOS_IN_LIGHTBOX;d=c.previews_enabled||((f=e.preview_type)==="photo"||f==="video");if(!g&&d){BrowseUtil.filepreview_from_selected("fileclick",e)}return document.stopObserving(c.UPDATE_EVT,b)};return document.observe(this.UPDATE_EVT,b)},_click:function(c,d){var b,a;this.keyboard_nav=false;b=BrowseFile.from_elem(d);if(b.editing){return}a=(c.which===2)||(Util.is_mac()&&c.metaKey);Browse.open_file(b,a);c.preventDefault()},crumb_click:function(d,a){var c,b;this.keyboard_nav=false;d.preventDefault();b=a.readAttribute("data-fq_path");c=this.details_from_fq_path(b);return BrowseURL.set_path_url(c.ns_id,c.ns_path)},parent_click:function(d,c){var a,b;this.keyboard_nav=false;d.preventDefault();b=c.readAttribute("data-parent_ns_path");a=parseInt(c.readAttribute("data-parent_ns_id"),10);return BrowseURL.set_path_url(a,b)},selection_handler:function(){if(BrowseSelection.get_selected_files().length){return $("browse-box").addClassName("selected")}else{return $("browse-box").removeClassName("selected")}},POST_SCROLL_WAIT:100,_last_scroll_timeout:null,window_scroll:function(){clearTimeout(this._last_scroll_timeout);return this._last_scroll_timeout=setTimeout(BrowseUtil.load_visible_thumbs.bind(BrowseUtil),this.POST_SCROLL_WAIT)},updateOffset:function(){if(!this.div_parent){return}this._cumulativeOffset=this.div_parent.cumulativeOffset();return this.viewportOffset()},reset_sort:function(){var b,a;this.last_sort=[Sort.FILES_BY_NAME,true];a="#browse-sort a.sortable-column-header";b=$$(a)[0];Util.add_sort_arrow_mouseover(b,true,a,false);$("kind-sorter-label").__date(FlexColumn.DISPLAY.FILES_BY_KIND);return Sprite.src(b.down("img"),"web","sort-uptick-off")},sort_handler:function(h,j,d){var f,a,g,b,k,c;j=$(j);j.blur();f=j.readAttribute("data-sort");if(!(d!=null)){d=this.last_sort[0]===Sort[f]?j.readAttribute("data-ascending")==="false":true}if(FlexColumn.LABELS.indexOf(f)!==-1){k=FlexColumn.SORT_FUNCTIONS.indexOf(this.last_sort[0])!==-1;if(k){g=(FlexColumn.LABELS.indexOf(f)+1)%FlexColumn.LABELS.length;f=FlexColumn.LABELS[g];a=FlexColumn.DISPLAY[f];$("kind-sorter-label").__date(a)}j.writeAttribute("data-sort",f);d=FlexColumn.IS_ASC[f]}else{j.writeAttribute("data-ascending",(d?"true":"false"))}c="#browse-sort a.sortable-column-header";Util.add_sort_arrow_mouseover(j,d,c,true);b=Sort[f];this.sort(b,d);if(h){return h.stop()}},toggle_deleted:function(){var a;a=!BrowseURL.get_del();return BrowseURL.set_del_url(a)},new_folder:function(){var f,s,h,b,g,p,l,d,k,o,c,q,m,j,a,r,e,n=this;if(this.reloading||this.creating_folder){return}this.hide_empty();this.selectable();s=_("New folder");g=[];e=this.files;for(a=0,r=e.length;a<r;a++){p=e[a];if(p.dir&&p.filename.indexOf(s)!==-1){g.push(p.filename)}}d=s;f=1;while(true){if(g.indexOf(d)===-1){break}d=s+" ("+f+")";f++}j=HTML.tmpl("new_folder_tmpl",{name:d});l=-1;if(this.files.length){m=Util.scroll_offsets();if(m.top>0){q=this.files[0].get_div().getLayout().get("margin-box-height");l=Math.floor(m.top/q)}}if(l>0){this.files[l].get_div().__sert({after:j})}else{$("browse-files").__sert({top:j})}k=$$("#browse-files .browse-new-folder .name").first();assert(k!=null,"expected new_folder_name to be defined");h=this.containing_fq_path();c=function(v){var u,t,w;w=v.responseText.evalJSON(true);assert(w.new_browse_files.length===1,"No new file data returned.");u=FileOps.filename(w.new_browse_files.first().fq_path);t=_("Created folder '%(folder_name)s'");t=t.format({folder_name:u.snippet()});Notify.server_success(t);n.select_fq_paths=[w.new_browse_files.first().fq_path];return n.force_reload()};o=function(u){var t;t=$$("#browse-files li.browse-new-folder").first();if(t){t.remove()}return n.creating_folder=false};b=new Ajax.InPlaceEditor(k,"/cmd/new"+(Util.urlquote(h)),{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:true,onFailure:function(){},onComplete:o,savingText:_("Creating folder..."),onLeaveEditMode:this.unselectable,ajaxOptions:{method:"POST",onSuccess:c},callback:function(t,u){n.creating_folder=true;return{to_path:u||"",folder:"yes"}}});return b.enterEditMode()},open_folder:function(c){var b,a,d,e=this;assert(c.dir,"Only open directories, not files");if(!(BrowseSelection.get_selected_files().length===1&&BrowseSelection.get_selected_files().indexOf(c)===0)){BrowseSelection.deselect_all();c.get_div().addClassName("file-select")}clearTimeout(this.folder_loading_notification);b=function(){var f;f=_("Loading %(filename)s...");f=f.format({filename:c.filename.em_snippet(50)});return Notify.server_success(f,60,true)};this.folder_loading_notification=setTimeout(b,1000);if(c.target_ns){a=c.target_ns;d=""}else{a=c.ns_id;d=c.ns_path}if(c.is_deleted){return BrowseURL.set_path_url(a,d,true)}else{return BrowseURL.set_path_url(a,d)}},open_folder_in_new_window:function(a){return window.open(BrowseURL._make_url(a.ns_id,a.ns_path),"_blank")},show_message:function(c){var b,a;if((typeof c)!==(typeof"string")){a=$("browse-files").down(".browse-message");if(a){a.show()}return}this.msg=c;b=new Element("div",{"class":"browse-message"});b.__date(c);return $("browse-files").__sert(b)},sort:function(a,d,c){var b;if(!c&&a===this.last_sort[0]&&d===this.last_sort[1]){return}this.last_sort=[a,d];b=a(d);this.files.sort(b);this.smartfill();return BrowseUtil.load_visible_thumbs()},resort:function(){var c,a,b;a=this.last_sort;b=a[0];c=a[1];return this.sort(b,c,true)},in_search_mode:function(){return $("browse").hasClassName("search")},flex_column:function(){return $("kind-sorter").readAttribute("data-sort")},smartfill:function(){var b,e,c,f,d,h,a,g;b=$("browse-files");d=[];f=this.in_search_mode();c=this.flex_column();g=this.files;for(h=0,a=g.length;h<a;h++){e=g[h];d.push(this.compiled_tmpl({file:e,in_search_mode:f,flex_column:c}))}b.__date(d);return document.fire(this.RENDER_EVT)},add_file:function(a){this.files.push(a);if(a.target_ns){Browse.ns_id_to_mount_point[a.target_ns]=a.fq_path}if(a.bytes<0){return this.deleted_shown=true}},insert_file:function(c,b){var a;if(!c){return}b=b||0;a=this.find_file(c.fq_path);if(a&&a!==c){this.remove_file(a);BrowseFile._file_index[c.to_key()]=c}this.update_file_pos(c);if(b){c.get_div().setStyle({display:"none"})}return document.fire(this.RENDER_EVT)},add_files:function(a){return Browse._push_files(a.file_info)},get_file_pos:function(a){var b;b=this.files.indexOf(a);assert(b!==-1,"file not present in @files");assert(a.to_key() in BrowseFile._file_index,"file not present in BrowseFile._file_index");return b},remove_file:function(a){var b;if(!a){return}b=this.files.indexOf(a);if(b!==-1){this.files.splice(b,1);delete BrowseFile._file_index[a.to_key()];return a.get_div().remove()}},update_file_pos:function(f){var a,j,d,e,g,c,b,h;h=this.files.indexOf(f);if(h!==-1){this.files.splice(h,1)}delete f.sort_rank;c=this.last_sort[0];g=this.last_sort[1];e=Util.bsearch(this.files,f,c(g),true);this.files.splice(e,0,f);d=f.get_div();a=$("browse-files");if(d){d.remove()}b=this.compiled_tmpl({file:f,in_search_mode:this.in_search_mode(),flex_column:this.flex_column()});j=a.childElements();if(e<j.length){return a.childElements()[e].__sert({before:b})}else{return a.__sert(b)}},find_file:function(a){return this.files.find(function(b){return b.fq_path.toLowerCase()===a.toLowerCase()})},reset_state:function(){this.msg=false;this.dragging=false;this.files=[];this.selected_files=[];this.selection=[];BrowseFile._file_index={};return BrowseDrag._body_dragend()},clear:function(){$("browse-files").__date();return this.hide_empty()},show_empty:function(){$("browse-empty").show();return $(document.documentElement).removeClassName("earthrise")},hide_empty:function(){$("browse-empty").hide();return $(document.documentElement).addClassName("earthrise")},update:function(a){$("browse-box").show();$("browse-files").__date();if(typeof a==="string"){this.setup(Util.from_json(a))}else{this.setup(a)}this.resort();return document.fire(this.UPDATE_EVT)},reload_fqpath:function(b,a){return this.reload(null,Util.urlquote(b),a)},force_reload:function(){return this.reload(this.containing_ns_id(),Util.urlquote(this.containing_ns_path()),true)},set_title:function(){var a;a=this.containing_fq_path();return document.title=a?FileOps.filename(a)+" - Dropbox":_("Home")+" - Dropbox"},set_selection_from_fq_paths_or_index:function(j){var c,b,g,f,a,d,e,h;a=j.select_fq_paths;d=j.select_index;if(a||d>-1){b=[];if(a){for(e=0,h=a.length;e<h;e++){g=a[e];f=this.find_file(g);if(f){b.push(f)}}}if(!b.length&&d>-1){c=this.files[d];if(c){b.push(c)}}if(b.length){BrowseSelection.set_selected_files(b);this.scrollToWithPadding(b.first().get_div(),100)}j.select_fq_paths=false;return j.select_index=-1}else{return window.scrollTo(0,0)}},reload:function(d,o,b){var r,f,l,e,j,p,q,c,k,g,n,a,h=this;c="Browse.reload ns_path contains an invalid character: # ; ? : @ & = + $ (ns_path = "+o+")";assert(o.search(DBHistory.URL_ESCAPE_REGEX)===-1,c);if(d==null){d=Constants.root_ns}o=Util.normalize(o);if(BrowseUtil.get_mode()!==BrowseUtil.BROWSE_MODE){this.clear();BrowseUtil.set_browse_mode()}if(FileSearch._clear_on_reload){FileSearch.clear_searchbox()}if(!FileQueue.uploading){InlineUploadStatus.hide()}if(this.reloading){return}if(this.inside_dir&&o===this.containing_ns_path()&&d===this.containing_ns_id()&&!b){return}n=this.first_load?Constants.referrer:"";p=this.deleted_shown?"?show_deleted=yes":"";g={ns_id:d,referrer:n};g=Object.extend(g,this.extra_reload_args);T("Browse.reload:",o);this.reloading=true;a="/browse"+o+p;r=2;f=["browse",d,o,p,Constants.uid,r];k=function(s){h.reset_state();h.update(s);(h.files.length?h.hide_empty.bind(h):h.show_empty.bind(h))();clearTimeout(h.folder_loading_notification);if(Notify.cancel_on_reload){Notify.clear_all();Notify.cancel_on_reload=false}Util.force_delete_cached_scroll_offsets();h.set_selection_from_fq_paths_or_index(Browse);h.set_title();if(Tutorial.should_handle_event(Tutorial.events.browse_reload)){return Tutorial.handle_event(Tutorial.events.browse_reload)}};l=false;if(this.use_local_cache){e=DBLocalStorage.getItem(f);try{q=Util.from_json(e)}catch(m){q={}}g.contents_cache_key=q.contents_cache_key;if(e){j=function(){try{k(q);h.reloading=false;return l=true}catch(s){return DBLocalStorage.removeItem(f)}};j.defer()}}new Ajax.DBRequest(a,{allow_retries:true,parameters:g,log_timing:true,on304:function(s){},onSuccess:function(w){var z,t,y,u,v,x,s;if(h.in_search_mode()){return}q=Util.from_json(w.responseText);u=null;y=null;if(h.use_local_cache){v=function(){return DBLocalStorage.setItem(f,w.responseText)};v.defer();if(e&&l){if(!(h.containing_fq_path()===q.containing_fq_path)){return}u=BrowseSelection.get_selected_files();y=Util.scroll_offsets()}}k(q);if(u){t=[];for(x=0,s=u.length;x<s;x++){z=u[x];t.push(Browse.find_file(z.fq_path))}BrowseSelection.set_selected_files(t);return window.scrollTo(y[0],y[1])}},onFailure:function(){if(h.first_load){h.reload.bind(h).defer(Constants.root_ns,"")}return clearTimeout(h.folder_loading_notification)},cleanUp:function(){h.first_load=false;return h.reloading=false},no_feed_reload:true,evalJSON:false});return true},unload:function(){var a;this.reset_state();a=$("dropdown");if(a){return Util.yank(a)}},can_get_details_from_fq_path:function(c){var b,a;b=this.containing_fq_path();a=this.containing_mount_point();return(a&&c.startsWith(a))||b.startsWith(c)},details_from_fq_path:function(d){var e,b,a,c;assert(this.can_get_details_from_fq_path(d));b=this.containing_mount_point();if(b&&d.startsWith(b)){a=this.containing_ns_id();c=d.slice(b.length);e=FileOps.filename(d)}else{a=Constants.root_ns;c=d;e=FileOps.filename(d)}return{ns_id:a,ns_path:c,fq_path:d,folder_name:e||"Dropbox",url:"/home"+d,icon:(d.length?"folder_32":"dropbox_32")}},_make_breadcrumbs_data:function(){var f,g,b,e,a,d,c;g=this.containing_fq_path();f=[];a=g.split("/");for(b=d=0,c=a.length;0<=c?d<c:d>c;b=0<=c?++d:--d){e=Util.normalize(a.slice(0,b+1).join("/"));f.push(this.details_from_fq_path(e))}return f},_MAX_BREADCRUMB_WIDTH:16.5,_CONNECT_WIDTH:1.64,breadcrumb:function(){var k,b,d,l,g,j,a,h,c,e,f;b=this._make_breadcrumbs_data();c=b.collect(function(m){return new Emstring(m.fq_path?m.folder_name:"").length});h=0;d=0;assert(b.length>0,"expected at least one breadcrumb");for(g=e=f=b.length-1;f<=0?e<=0:e>=0;g=f<=0?++e:--e){h+=c[g];if(h>this._MAX_BREADCRUMB_WIDTH){break}d+=1;h+=this._CONNECT_WIDTH}l=b.slice(0,b.length-Math.max(1,d));b=b.slice(l.length,b.length);if(!l.length&&b.length>1){b.shift()}j=b.pop();k=HTML.tmpl("breadcrumb_tmpl",{breadcrumbs:b,dropdown:l,containing_fq_path:this.containing_fq_path()});a=j.folder_name.em_snippet(this._MAX_BREADCRUMB_WIDTH);$("browse-location").__date(k);$("browse-location").__sert(" "+a);if(l.length>1){return this._render_breadcrumbs_dropdown(l)}},_render_breadcrumbs_dropdown:function(f){var a,c,b,e,d=this;a=$("breadcrumbs-box");f.reverse();b=HTML.tmpl("breadcrumb_li_tmpl",{breadcrumbs:f});$("browse-location").__sert(b);c=$("breadcrumb-dropdown");e=function(h){var g;h.stopPropagation();c.show();g=$j(a);return $j(c).clonePosition(g,{setWidth:0,setHeight:0,offsetTop:g[0].offsetHeight,offsetLeft:parseInt(g.css("padding-left"),10)})};a.observe("click",e);a.observe("dragover",e);return document.observe("click",function(){a.removeClassName("down");return c.hide()})},viewportOffset:function(){var a,c,b;if(!this.files.length){return}if(!this.div_parent){c=this.files[0].get_div().offsetParent;if(!c){return}this._viewportOffset={};this.div_parent=$(c);this._cumulativeOffset=this.div_parent.cumulativeOffset()}a=Util.scrollLeft(this.div_parent);b=Util.scrollTop(this.div_parent);if(!this.scrollTop||!this.scrollLeft||this.scrollTop!==b||this.scrollLeft!==a){this._viewportOffset.top=this._cumulativeOffset.top-b;this._viewportOffset.left=this._cumulativeOffset.left-a;this.scrollLeft=a;this.scrollTop=b}return this._viewportOffset},selectable:function(){return Util.enableSelection($("browse-files"))},unselectable:function(){return Util.disableSelection($("browse-files"))},_header_offset:(function(){var a;a=$("browse-header");return a.getHeight()+a.cumulativeOffset().top}).cached(1000),scrollTo:function(a){return this.scrollToWithPadding(a,3)},scrollToWithPadding:function(d,f){var c,g,b,e,a;if(!d){return}e=Util.viewport_dimensions();a=Util.scroll_offsets();g=d.cumulativeOffset().top-a.top;c=d.getHeight();b=this._header_offset();if(g<b){Util.scroll_to(0,a.top+g-b-f)}else{if(g+c>e.height){Util.scroll_to(0,a.top+g+c-e.height+f)}}if($("modal-overlay").visible()&&$("modal").getStyle("position")==="absolute"){return Modal.fix_position()}}};BrowseUpdate=(function(){var a,h,g,d,f,e,c,b;c=function(k){var l,m,j;if(!Browse.inside_dir){return}m=k.parent_changes;if(m.change_to_fq_path!=null){if(m.change_type==="moved"){if(m.is_changing_view){l=_("The folder '%s' has been moved. <a href=\"/home%s\">View</a>");l=l.format(m.old_fq_path.escapeHTML(),Util.urlquote(m.new_fq_path))}else{l=_("This folder has been moved")}}else{if(m.change_type==="renamed"){if(m.is_changing_view){l=_("The folder '%s' has been renamed. <a href=\"/home%s\">View</a>");l=l.format(m.old_fq_path.escapeHTML(),Util.urlquote(m.new_fq_path))}else{l=_("This folder has been renamed to '%s'.");j=m.change_to_fq_path.split("/");l=l.format(j[j.length-1].escapeHTML())}}else{l=_("The folder '%s' has been deleted.");l=l.format(m.old_fq_path.escapeHTML())}}if(m.is_changing_view){Notify.server_error(new HTML(l))}else{if(m.old_fq_path===Browse.containing_fq_path()){Notify.server_success(new HTML(l))}}Browse.reload_fqpath(m.change_to_fq_path);return}return e(k)};b=function(o){var k,r,q,j,t,p,m,s,n,l;r=[];p=[];if(!Browse.in_search_mode()){return}FileSearch.clear_cache();for(j in Browse.ns_id_to_mount_point){if(!(j in o.mount_points)){o.mount_points[j]=null}}n=o.mount_points;for(j in n){q=n[j];j=parseInt(j,10);t=Browse.ns_id_to_mount_point[j];if(q===t){continue}if(q){Browse.ns_id_to_mount_point[j]=q}else{delete Browse.ns_id_to_mount_point[j]}l=Browse.files;for(m=0,s=l.length;m<s;m++){k=l[m];if(k.fq_path.indexOf(t)===0&&k.target_ns!==j){if(q){k.fq_path=q+k.fq_path.slice(t.length);k.href="/home"+q+k.href.slice(5+t.length);r.push([k,k])}else{p.push(k)}}}}return e(o,[],p,r)};e=function(F,s,y,r){var A,q,z,v,x,o,w,C,t,m,k,j,B,E,D,u,p,n,l;if(s==null){s=[]}if(y==null){y=[]}if(r==null){r=[]}u=F.added;for(m=0,B=u.length;m<B;m++){A=u[m];z=BrowseUtil.unpack_file_info(A);q=Util.normalize(Util.parentDir(z.ns_path));if(z.ns_id===Browse.containing_ns_id()&&q===Browse.containing_ns_path()){s.push(BrowseUtil.make_browsefile(A))}}p=F.removed;for(k=0,E=p.length;k<E;k++){v=p[k];y.push(Browse.find_file(v))}n=F.moved;for(j=0,D=n.length;j<D;j++){l=n[j],x=l[0],o=l[1];t=BrowseUtil.unpack_file_info(o);C=Util.normalize(Util.parentDir(t.ns_path));w=null;if(t.ns_id===Browse.containing_ns_id()&&C===Browse.containing_ns_path()){w=BrowseUtil.make_browsefile(o)}r.push([Browse.find_file(x),w])}document.fire(UpdateEvents.ADD,{files:s});document.fire(UpdateEvents.MOVE,{files:r});BrowseUtil.load_visible_thumbs();if(Tutorial.should_handle_event(Tutorial.events.browse_folder_update_start)){Tutorial.handle_event(Tutorial.events.browse_folder_update_start,{added:s,moved:r,removed:y})}return f(s,y,r)};a=function(m,k,l,j){m.css("background","");document.fire(UpdateEvents.REMOVE,{files:l});if(Tutorial.should_handle_event(Tutorial.events.browse_folder_update_done)){return Tutorial.handle_event(Tutorial.events.browse_folder_update_done,{added:k,moved:j,removed:l})}};f=function(t,s,u){var l,w,q,x,p,o,m,v,k,j,r,n;q=!IE7_OR_LESS&&(t.length+s.length)<=10;for(p=0,v=t.length;p<v;p++){l=t[p];if(!(l&&l.get_div())){continue}h(l,q,t,s,u)}for(o=0,k=s.length;o<k;o++){l=s[o];if(!(l&&l.get_div())){continue}d(l,q,t,s,u)}n=[];for(m=0,j=u.length;m<j;m++){r=u[m],w=r[0],x=r[1];if(w){d(w,q,t,s,u)}if(x){n.push(h(x,q,t,s,u))}else{n.push(void 0)}}return n};g=function(j){var k;k=BrowseSelection.is_selected(j)?"#83B8DC":"#CCEAFF";return $j(j.get_div()).css("background-color",k)};d=function(j,m,l,n,k){var o;g(j);o=$j(j.get_div());if(m){return o.show().slideUp("normal",function(){return a(o,l,n,k)})}else{o.hide();return a(o,l,n,k)}};h=function(j,m,l,n,k){var o;g(j);o=$j(j.get_div());if(m){return o.hide().slideDown("normal",function(){return a(o,l,n,k)})}else{o.show();return a(o,l,n,k)}};return{init:function(){var j;j=function(){var o,n,l,m,k;l=Browse.in_search_mode();o=l?b:c;k=l?"/update/list_search":"/update/list_dir";if(l){m=FileSearch.get_state();if(m.is_advanced){n=m}else{n={all_terms:m.query}}}else{n={fq_dir:Browse.containing_fq_path(),show_deleted:Browse.deleted_shown}}return[o,k,n]};return Subscriber.subscribe(j)}}})();var FileEvents,FileOps,Job,ModalProgress,NOTIFICATION_SNIPPET_LEN,ProgressBar,ProgressWatcher;FileEvents={DELETE:"db:bulk_delete",COPY:"db:bulk_copy",MOVE:"db:bulk_move",RENAME:"db:bulk_rename",PURGE:"db:bulk_purge",RESTORE:"db:bulk_restore",UPLOAD:"db:upload",SF_NEW:"db:sf_new",SF_LEAVE:"db:sf_leave",SF_UNSHARE:"db:sf_unshare",SF_REJOIN:"db:sf_rejoin",SF_IGNORE:"db:sf_ignore",LINKS_REMOVE:"db:link_remove"};NOTIFICATION_SNIPPET_LEN=40;FileOps={OPEN_WITH_ITEM_SELECTED:"#open-with-app-list .selected",is_shmodelable:function(a){var b;if(Browse.public_app_token){return false}if(Browse.public_folder_enabled){b=a.toLowerCase();if(b.startsWith("/public/")){return false}}return true},filename_to_icon:function(a){var b,c;c=FileOps.file_extension(a).toLowerCase();b={exe:"page_white_gear",dll:"page_white_gear",xls:"page_white_excel",xlsx:"page_white_excel",ods:"page_white_tux",c:"page_white_c",h:"page_white_c",php:"page_white_php",mp3:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aiff:"page_white_sound",au:"page_white_sound",ogg:"page_white_sound",doc:"page_white_word",docx:"page_white_word",odt:"page_white_tux",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",pps:"page_white_powerpoint",ppsx:"page_white_powerpoint",odp:"page_white_tux",txt:"page_white_text",rtf:"page_white_text",sln:"page_white_visualstudio",vcproj:"page_white_visualstudio",html:"page_white_code",htm:"page_white_code",psd:"page_white_paint",pdf:"page_white_acrobat",fla:"page_white_actionscript",swf:"page_white_flash",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture",py:"page_white_code",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",iso:"page_white_dvd",dmg:"page_white_dvd",css:"page_white_code",xml:"page_white_code",tgz:"page_white_compressed",bz2:"page_white_compressed",rb:"page_white_ruby",cpp:"page_white_cplusplus",java:"page_white_cup",cs:"page_white_csharp",ai:"page_white_vector"};return b[c]||"page_white"},open_with_select:function(a){$$(FileOps.OPEN_WITH_ITEM_SELECTED).invoke("removeClassName","selected");this.addClassName("selected");return $("open-button").addClassName("freshbutton-blue")},open_with_url:function(b,a){var c;c={edit_flow_blob:a};return Util.add_qstring(b,c)},do_open_with:function(b,a){return window.open(FileOps.open_with_url(b.landing,a),"_blank")},_find_app_by_id:function(b){var e,d,a,c;c=Modal.vars.apps;for(d=0,a=c.length;d<a;d++){e=c[d];if(e.app_id!==b){continue}return e}return null},close_open_with:function(g,e){var f,a,h,b,d,c;$("open-button").removeClassName("freshbutton-blue");if(!g){return Modal.hide(e)}d=$$(FileOps.OPEN_WITH_ITEM_SELECTED);if(d.length!==1){return false}d=d[0];a=parseInt(d.readAttribute("name",10));if(a!==-1){f=FileOps._find_app_by_id(a);if(f==null){return Modal.hide(e)}}else{a=null;f=null}h=Modal.vars.extensions[0];c=$("make-default").checked;if(c){if(f!=null){Browse.app_prefs[h]=f.landing}else{delete Browse.app_prefs[h]}new Ajax.DBRequest("/set_open_with_pref",{parameters:{app_id:a,ext:h},onSuccess:function(j){},onFailure:function(j){}})}if(f!=null){new Ajax.DBRequest("/edit_flow_add_files",{parameters:{app_id:a,fq_paths:Util.to_json((function(){var m,k,l,j;l=Modal.vars.files;j=[];for(m=0,k=l.length;m<k;m++){b=l[m];j.push(b.fq_path)}return j})())},onSuccess:function(j){return FileOps.do_open_with(f,j.responseText)},onFailure:function(j){var k;k=ungettext("Error opening file","Error opening files",Modal.vars.files.length);return Notify.server_error(k)}})}else{assert(Modal.vars.files.length===1,"App should not be null if there are more than one file, Dropbox handler can only handle one");Browse.dropbox_open_file(Modal.vars.files[0],true)}return Modal.hide(e)},render_open_with_dialog:function(d,b,m){var g,a,o,f,p,j,h,n,c,k;try{a=Util.from_json(d).apps}catch(l){a=[]}if(b.length===1){o={app_id:-1,name:"Dropbox",description:"",landing:"",icon_url:"/static/images/favicon.ico"};a.unshift(o)}if(!a.length){f=ungettext("No apps available for this file!","No apps available for these files",b.length);Notify.server_error(f);return}$("open-with-app-list").__date();for(j=0,n=a.length;j<n;j++){g=a[j];$("open-with-app-list").__sert(HTML.tmpl("open_with_app_tmpl",{app:g}))}k=$$(".open-with-app-list-li");for(h=0,c=k.length;h<c;h++){p=k[h];p.observe("click",FileOps.open_with_select)}return Modal.icon_show("page_white_go_32",_("Open With..."),$("open-with"),{apps:a,action:FileOps.close_open_with,files:b,extensions:m})},file_extension:function(a){return a.split(".").last()},file_extension_for_logging:function(a){if(a.indexOf(".")===-1){return""}else{return FileOps.file_extension(a).toLowerCase()}},filename:function(c,b){var a;if(b==null){b=_("Dropbox")}c=Util.normalize(c);c=c.split("/");a=c.pop();if(a===""){return b}else{return a}},dir_handler:function(d,c){var b,a;if(typeof c==="string"){c=$(c)}b=$$(".treeview .highlight")[0];if(b){b.removeClassName("highlight")}a=c.up("div");a.addClassName("highlight");Modal.selected_div=a;if(Modal.shown()){c.blur()}document.fire("db:dir_click",{path:d});return Modal.vars.selected_path=d},show_folder_pick:function(h,f,e,g,a){var b,d,c;DomUtil.fillVal(FileOps.filename(f).escapeHTML(),"folder-pick-file");TreeView.move("copy-move-treeview","folder-pick-treeview");TreeView.enable_shared("copy-move-treeview");c=(a?"page_white_go_32":"page_white_copy_32");b=(a?_("Move"):_("Copy"));DomUtil.fillVal(b,"folder-pick-action-text");Modal.icon_show(c,h,$("folder-pick"),{fq_path:f,action:e,folder:g});d=$("first-treeview-link");return d.onclick()},show_bulk_folder_pick:function(h,e,a,f){var b,j,c,g,d;d=BrowseUtil.profile_files(a);j=BrowseUtil.profile_summary(d);DomUtil.fillVal(j,"bulk-folder-pick-file");TreeView.move("copy-move-treeview","bulk-folder-pick-treeview");TreeView.enable_shared("copy-move-treeview");g=(e==="move"?"page_white_go_32":"page_white_copy_32");if(e==="move"){b=_("Move")}else{if(e==="copy"){b=_("Copy")}else{b=_("Restore")}}DomUtil.fillVal(b,"bulk-folder-pick-action-text");Modal.icon_show(g,h,$("bulk-folder-pick"),{files:a,action:f});c=$("first-treeview-link");return c.onclick()},show_copy:function(a,b){var c;c=(b?_("Copy folder to..."):_("Copy file to..."));return FileOps.show_folder_pick(c,a,FileOps.do_copy,b,false)},show_dragdrop_confirm:function(a,k,b){var c,h,e,g,d,j;h=FileOps.filename(k)||"Dropbox";j=void 0;d=void 0;c=void 0;g=void 0;e=void 0;if(b){j=ungettext("Move %(item_count)s item","Move %(item_count)s items",a.length).format({item_count:a.length});c="Move";d=ungettext("Are you sure you want to move %(item_count)s item to '%(destination)s'?","Are you sure you want to move %(item_count)s items to '%(destination)s'?",a.length).format({item_count:a.length,destination:h});g="page_white_go_32";e=FileOps.do_bulk_move}else{j=ungettext("Copy %(item_count)s item","Copy %(item_count)s items",a.length).format({item_count:a.length});c="Copy";d=ungettext("Are you sure you want to copy %(item_count)s item to %(destination)s?","Are you sure you want to copy %(item_count)s items to %(destination)s?",a.length).format({item_count:a.length,destination:h});g="page_white_copy_32";e=FileOps.do_bulk_copy}DomUtil.fillVal(c,"dragdrop-folder-pick-action-text");Modal.icon_show(g,j,$("dragdrop-confirm-modal"),{files:a,to:k,action:e});return $("dropdown-confirm-text").__date(d)},show_copy_bulk:function(a){var b;b=ungettext("Copy %(item_count)s item to...","Copy %(item_count)s items to...",a.length).format({item_count:a.length});return FileOps.show_bulk_folder_pick(b,"copy",a,FileOps.do_bulk_copy)},show_move_bulk:function(a){var b;b=ungettext("Move %(item_count)s item to...","Move %(item_count)s items to...",a.length).format({item_count:a.length});return FileOps.show_bulk_folder_pick(b,"move",a,FileOps.do_bulk_move)},show_move:function(a,b){var c;c=(b?_("Move folder to..."):_("Move file to..."));return FileOps.show_folder_pick(c,a,FileOps.do_move,b,true)},show_delete:function(b,c,a){var d,e;DomUtil.fillVal("'"+FileOps.filename(b).escapeHTML()+"'","delete_filename");d=void 0;if(a){d=function(){return FileOps.do_nonbrowse_delete([b])}}else{d=FileOps.do_delete}e=(c?_("Delete folder?"):_("Delete file?"));return Modal.icon_show("delete_32",e,DomUtil.fromElm("delete-file"),{fq_path:b,action:d,folder:c,wit_group:"delete-confirm"})},show_bulk_delete:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"delete_filename");a=ungettext("Delete %(item_count)s item?","Delete %(item_count)s items?",b.length).format({item_count:b.length});return Modal.icon_show("delete_32",a,DomUtil.fromElm("delete-file"),{files:b,action:FileOps.do_bulk_delete,wit_group:"delete-bulk-confirm"})},show_purge:function(a,b){var c;DomUtil.fillVal("'"+FileOps.filename(a).escapeHTML()+"'","purge-filename");c=(b?_("Permanently delete folder?"):_("Permanently delete file?"));return Modal.icon_show("alert_32",c,DomUtil.fromElm("purge-file"),{fq_path:a,action:FileOps.do_purge,folder:b,wit_group:"purge-file-confirm"})},show_bulk_purge:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"purge-filename");a=ungettext("Permanently delete %d item?","Permanently delete %d items?",b.length).format(b.length);return Modal.icon_show("alert_32",a,DomUtil.fromElm("purge-file"),{files:b,action:FileOps.do_bulk_purge,wit_group:"purge-bulk-confirm"})},show_bulk_restore:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"restore-filename");a=ungettext("Restore %d item...","Restore %d items...",b.length).format(b.length);return Modal.icon_show("alert_32",a,DomUtil.fromElm("restore-file"),{files:b,action:FileOps.do_bulk_restore,wit_group:"restore-bulk-confirm"})},show_upload:function(b,f){var h,c,g,e,a,d;b=b||Browse.containing_fq_path();if(!FlashDetect.versionAtLeast(9)){FileOps.show_basic_upload(b);$("enhanced-upload-toggle").hide();return}h=FileOps.filename(b);DomUtil.fillVal("'"+h.escapeHTML()+"'","upload-foldername");DomUtil.fillVal("'"+h.em_snippet(14).escapeHTML()+"'","dnd-upload-foldername");if($("upload-desc").visible()&&CrossDomainUploader.supported()){$("upload-desc").hide();$("dnd-upload-desc").show()}g=_("Upload to '%(folder_name)s'").format({folder_name:h.em_snippet(20)});Modal.icon_show("upload_32",g,DomUtil.fromElm("advanced-upload-modal"),{wit_group:"advanced-uploader"},false,false,FileQueue.num_files()&&!f);d=[$("modal").down(".basic-link-start"),$("modal").down(".basic-link-running")];for(e=0,a=d.length;e<a;e++){c=d[e];c.observe("click",function(){FileOps.show_basic_upload(Browse.containing_fq_path());return false})}if(!FileQueue.num_files()||f){Upload.init(Util.normalize(b),true)}else{Upload.set_dest(Util.normalize(b))}return InlineUploadStatus.hide()},show_basic_upload:function(a){var c,b;c=FileOps.filename(a);DomUtil.fillVal("'"+c.escapeHTML()+"'","basic-upload-foldername");b=_("Upload to '%(folder_name)s'").format({folder_name:c.em_snippet(20)});Modal.icon_show("upload_32",b,$("basic-upload-modal"),{},false);$("modal").down(".enhanced-link").observe("click",function(){FileOps.show_upload(Browse.containing_fq_path(),1);return false});Upload.set_dest(Util.normalize(a));return Upload.init_basic()},show_undelete:function(a){var b,c,d;DomUtil.fillVal(a.filename.escapeHTML(),"undelete_filename");b=Sprite.make("web",a.icon,{});b.addClassName("link-img");b.style.backgroundColor="transparent";c="/revisions"+Util.urlquote(a.real_path)+"?undelete=1";$$(".undelete-icon").invoke("update",b);$$(".undelete-other-versions")[0].href=c;$$(".undelete-link")[0].href=c;$("undelete-form").action="/revisions"+Util.urlquote(a.real_path);d=_("Restore file?");return Modal.icon_show("alert_32",d,$("undelete-modal"),{file:a})},show_open_with:function(a){var b,f,h,k,c,g,e,d,j;h={};g=false;for(d=0,j=a.length;d<j;d++){c=a[d];if(c.dir){b="/";g=true}else{b=c.get_extension()}h[b]=(h[b]||0)+1}k=[];e=[];for(b in h){k.push(b);e.push(_(b))}f='"'+e.join('", "')+'"';DomUtil.fillVal(f,"open_with_ext");if(k.length!==1||g){$("open-with-prefs").setStyle("display: none")}else{$("open-with-prefs").setStyle("display: inline");$("make-default").checked=false}return new Ajax.DBRequest("/openwithlist",{parameters:{extensions:Util.to_json(k)},onSuccess:function(l){return FileOps.render_open_with_dialog(l.responseText,a,k)}})},do_undelete:function(f){var c,b,d,a;b=Modal.vars.file;d=$("undelete-form");a=_("Restored '%(file_name)s'").format({file_name:b.filename});c=_("Error, unable to restore '%(file_name)s'").format({file_name:b.filename});Forms.ajax_submit(d,false,(function(){Modal.hide();Notify.server_success(a);return document.fire(FileEvents.RESTORE,{files:[b]})}),(function(){return Notify.server_error(c)}),f.target);return false},do_copy:function(c,b){var a;c=c||Modal.vars.fq_path;b=b||Modal.vars.selected_path;a=Browse.find_file(c);assert(a,"Trying to copy a file we couldn't find.");return FileOps.do_bulk_copy([a],b)},do_bulk_copy:function(f,b){var d,e,c,g,a;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();f=f||Modal.vars.files;assert(f.length>0,"Tried to copy 0 files");if(typeof b==="undefined"){if(typeof Modal.vars.selected_path==="undefined"){Notify.server_error(_("You need to select a destination for the file."));return}else{b=Modal.vars.selected_path}}b=Util.normalize(b);c=0;for(g=0,a=f.length;g<a;g++){d=f[g];if(d.dir){if((b+"/").indexOf(d.fq_path+"/")===0){Notify.server_error(_("You cannot copy a folder into itself."));return}}}e=f.pluck("fq_path");Notify.clear_all();return new Ajax.DBRequest("/cmd/copy",{parameters:{files:e,to_path:b},job:true,html_in_error_msg:true,progress_text:_("Copying..."),onSuccess:function(p){var l,o,h,q,k,m,j,n;l=p.responseText.evalJSON().changesets;o=e.length;q=FileOps.filename(b).em_snippet(NOTIFICATION_SNIPPET_LEN).escapeHTML();k=ungettext("Copied %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Copied %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",o);k=k.format({count:o,location:q});Notify.server_success(new HTML(k),null,null,l,FileOps.do_rollback);h=[];n=p.responseText.evalJSON().new_browse_files;for(m=0,j=n.length;m<j;m++){d=n[m];h.push(d.fq_path)}Browse.select_fq_paths=h;$("reload-link").observe("click",function(){return Browse.reload_fqpath(b)});TreeView.schedule_reset();return document.fire(FileEvents.COPY,{files:f,to_fq_path:b})}})},bulk_move_error:function(a,j){var g,d,k,e,l,f,b,c,h;k=Browse.find_file(j);e=BrowseUtil.profile_files(a);c=void 0;f=void 0;h=void 0;if(k){f=k.dir;c=k.fq_path;h=k.target_ns||k.ns_id}else{if(Browse.inside_dir&&Browse.can_get_details_from_fq_path(j)){d=Browse.details_from_fq_path(j);f=true;c=d.fq_path;h=d.ns_id}else{f=true;c=j;h=void 0}}l=a.pluck("fq_path").collect(Util.normalize);if(-1!==l.indexOf(Util.normalize(c))){return _("You cannot copy a folder into itself.")}g=b=function(m){var n;n=Util.parentDir(m.fq_path);return n===(c||"/")};if(a.all(g)){return ungettext("That file already exists in that folder.","Those files already exist in that folder.",a.length)}if(!f){return _("You cannot put files inside one another.")}if(e.target_namespaces>0&&h&&h!==Constants.root_ns){if(e.sandboxes>0){return _("You're not allowed to put an application folder inside a special folder.")}else{if(e.shared_folders>0){return _("You're not allowed to put a shared folder inside a special folder.")}else{return _("You're not allowed to nest special folders.")}}}if(Browse.public_folder_enabled){if(c==="/Public"&&e.target_namespaces>0){return _("You're not allowed to move shared folders to your Public folder.")}}if(e.public_folder>0){return _("You're not allowed to move your Public folder.")}if(e.photos_folder>0){return _("You're not allowed to move your Photos folder.")}if(e.deleted>0){return _("Moving deleted folders or files is not allowed.")}},do_move:function(c,b){var a;c=c||Modal.vars.fq_path;b=b||Modal.vars.selected_path;a=Browse.find_file(c);assert(a,"Trying to move a file we couldn't find.");return FileOps.do_bulk_move([a],b)},do_bulk_move:function(e,f){var c,d,a,b;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();e=e||Modal.vars.files;if(!e){return}assert(e.length>0,"Tried to move 0 files");a=f||Modal.vars.selected_path||"";a=Util.normalize(a);c=FileOps.bulk_move_error(e,a);if(c){Notify.server_error(c);return}d=e.pluck("fq_path");Notify.clear_all();b="/cmd/move";return new Ajax.DBRequest(b,{parameters:{files:d,to_path:a},job:true,html_in_error_msg:true,progress_text:_("Moving..."),onSuccess:function(k){var j,h,g,l;j=k.responseText.evalJSON().changesets;h=d.length;g=FileOps.filename(a).em_snippet(NOTIFICATION_SNIPPET_LEN).escapeHTML();l=ungettext("Moved %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Moved %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",h);l=l.format({count:h,location:g});Notify.server_success(new HTML(l),null,null,j,FileOps.do_rollback);$("reload-link").observe("click",function(){return Browse.reload_fqpath(a)});TreeView.schedule_reset();return document.fire(FileEvents.MOVE,{files:e,to_fq_path:a})}})},do_rollback:function(a){return new Ajax.DBRequest("/cmd/rollback",{parameters:{ns_to_cs:Util.to_json(a)},job:true,html_in_error_msg:true,progress_text:_("Undoing..."),onSuccess:function(b){var c;c=_("Undo complete.");Notify.server_success(c);assert(Browse.pre_action_selection instanceof Array,"Expected a selection from before the action to be undone");if(Browse.in_search_mode()){FileSearch.select_fq_paths=Browse.pre_action_selection;FileSearch.force_reload()}else{if(Lightbox.shown){Browse.select_fq_paths=Browse.pre_action_selection}else{Browse.select_fq_paths=Browse.pre_action_selection;Browse.force_reload()}}return Browse.pre_action_selection=false}})},do_bulk_delete:function(c){var a,b;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();c=c||Modal.vars.files;assert(c.length>0,"Tried to delete 0 files");b=(function(){var f,e,d;d=[];for(f=0,e=c.length;f<e;f++){a=c[f];d.push(a.fq_path)}return d})();Notify.clear_all();return new Ajax.DBRequest("/cmd/delete",{parameters:{files:b},job:true,html_in_error_msg:true,progress_text:_("Deleting..."),onSuccess:function(d){var f,e;e=d.responseText.evalJSON();f=ungettext("Deleted %d item.","Deleted %d items.",b.length).format(b.length);Notify.server_success(f,null,null,e.changesets,FileOps.do_rollback);TreeView.schedule_reset();Subscriber.set_ns_map(e.ns_map);return document.fire(FileEvents.DELETE,{files:c})}})},do_delete:function(b){var a;a=Browse.find_file(b||Modal.vars.fq_path);assert(a,"Trying to delete a file we couldn't find.");return FileOps.do_bulk_delete([a])},do_nonbrowse_delete:function(a){return new Ajax.DBRequest("/cmd/delete",{parameters:{files:a},html_in_error_msg:true,onSuccess:function(b){var c;c=ungettext("Deleted %(file_count)s item","Deleted %(file_count)s items",a.length);c=c.format({file_count:a.length});Notify.server_success(c);return document.fire(FileEvents.DELETE,{fq_paths:a})}})},do_purge:function(){var a;a=Browse.find_file(Modal.vars.fq_path);assert(a,"Trying to purge a file we couldn't find.");return FileOps.do_bulk_purge([a])},do_bulk_purge:function(b){var a,c;b=b||Modal.vars.files;assert(b.length>0,"Tried to purge 0 files");a=b.collect(function(d){return d.fq_path});c=ungettext("Permanently deleted %d item","Permanently deleted %d items",a.length).format(a.length);return new Ajax.DBRequest("/cmd/purge",{parameters:{files:a},job:true,html_in_error_msg:true,progress_text:_("Deleting..."),onSuccess:function(d){Notify.server_success(c);TreeView.schedule_reset();return document.fire(FileEvents.PURGE,{files:b})}})},do_bulk_restore:function(b){var a,c;b=b||Modal.vars.files;assert(b.length>0,"Tried to restore 0 files");a=b.collect(function(d){return d.fq_path});c=ungettext("Restored %d item","Restored %d items",a.length).format(a.length);return new Ajax.DBRequest("/cmd/restore",{parameters:{files:a},job:true,html_in_error_msg:true,progress_text:_("Restoring..."),onSuccess:function(d){Notify.server_success(c);TreeView.schedule_reset();return document.fire(FileEvents.RESTORE,{files:b})}})},do_folder_restore:function(a){var b;b=function(c){var e,d;e=_("Restoring '%(folder_name)s'").format({folder_name:FileOps.filename(a)});d=c.responseText;if(d.startsWith("err:")){d=d.substring(4);$j("#async-result").html(d);Notify.server_error(new HTML(d),60)}else{e=_("Restored '%(folder_name)s'").format({folder_name:FileOps.filename(a)});$j("#status-of-files").text(_("Restored files"));Notify.server_success(e,60)}$j("#restore-done-heading").text(e);$j(".pre-restore").hide();return $j(".post-restore").show()};return new Ajax.DBRequest("/cmd/restore",{parameters:{files:[a]},job:true,html_in_error_msg:true,progress_text:_("Restoring..."),onSuccess:b,onFailure:b})},do_bulk_download:function(c){var e,b,d,a;e=new Element("form",{action:"https://"+Constants.BLOCK_CLUSTER+"/zip_batch",method:"post"});for(d=0,a=c.length;d<a;d++){b=c[d];Forms.add_vars(e,{files:b.fq_path})}Forms.add_vars(e,{parent_path:Browse.block_hash_param||"/",w:Browse.block_hash});$(document.body).__sert(e);return e.submit()}};ProgressBar={MAGIC:42,make:function(a,b,c){var k,h,j,e,g,d,f;if(b==null){b=300}f=b.toString()+"px";c=(typeof c!=="undefined"?c:"0%");j=new Element("div",{"class":"outer-progress-bar",style:"width: "+f});k=new Element("div",{"class":"inner-progress-bar",id:"pb_"+a,style:"width: "+f});g=new Element("div",{"class":"under-pb progress-bar",style:"width: "+f});e=new Element("div",{style:"display: none","class":"over-pb progress-bar",id:"pb_"+a+"_over"});d=new Element("div",{"class":"pb-percentage",id:"pb_"+a+"_upct",style:"width: "+f});d.update(c);h=new Element("div",{"class":"pb-percentage",id:"pb_"+a+"_opct",style:"width: "+f});h.update(c);g.__sert(d);e.__sert(h);k.__sert(g);k.__sert(e);j.__sert(k);e.progress_width=b;return j},reset:function(a){return ProgressBar.set(a,0)},set:function(e,a,d){var c,b;a=Math.min(a,1);d=(typeof d!=="undefined"&&d!==false?d:Math.floor(a*100).toString()+"%");c=$("pb_"+e+"_over");if(!c){return}b=c.progress_width*a;c.show();c.makeClipping().setStyle({width:b.toString()+"px",backgroundColor:"#348DD3"});$("pb_"+e+"_upct").innerHTML=d;return $("pb_"+e+"_opct").innerHTML=d}};ModalProgress={show:function(c,a){var b;if(!c){return}a=$(a)||$("browse-box")||$("gallery-view-media");b=$("modal-progress-overlay");if(!(a!=null)){b.setStyle({position:"fixed",width:"100%",height:"100%"})}else{$j(b).clonePosition($j(a))}if(!b.getWidth()){return}$("modal-progress-text").__date(c);$("modal-progress-bar").setOpacity(1);$("modal-progress-bar").__date(ProgressBar.make("modal-progress",150,""));$j(b).fadeTo(250,0.7);return $j("#modal-progress-content").fadeIn(250)},update:function(a){var b;if(a.indexOf("/")>0){b=a.split("/");a=Number(b[0])/Number(b[1])}if(a){return ProgressBar.set("modal-progress",a,"")}},hide:function(){$j("#modal-progress-overlay").fadeOut(250);return $j("#modal-progress-content").fadeOut(250)}};Job={complete:{},handled:function(a){var b;if(!a){return false}b=!!Job.complete[a];Job.complete[a]=true;return b},peek:function(a){if(!a){return false}return !!Job.complete[a]}};ProgressWatcher={job_info:{},INIT_POLL_INT:1000,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1000,watch:function(a){var c,b;if(a.async_task_id){if(!a.async_task_id.match(/^[A-Za-z0-9_\-=]*$/)){return}b=a.async_task_id}else{b=a.job_id}ProgressWatcher.job_info[b]={};c=ProgressWatcher.job_info[b];c.req=a;c.is_async_task=!!a.async_task_id;c.poll_int=ProgressWatcher.INIT_POLL_INT;c.poll_count=0;c.int_id=setInterval(ProgressWatcher.update_for(b),c.poll_int);c.failures=0;return c.start_time=Util.time()},update_for:function(a){return function(){return ProgressWatcher.update(a)}},backoff:function(b){var a;a=ProgressWatcher.job_info[b];clearInterval(a.int_id);a.poll_int=Math.min(Math.floor(a.poll_int*1.5),30000);return a.int_id=setInterval(ProgressWatcher.update_for(b),a.poll_int)},update:function(c){var a,b;b=ProgressWatcher.job_info[c];if(Job.peek(c)){return ProgressWatcher.done(c)}b.poll_count++;if(b.poll_count%10===0){ProgressWatcher.backoff(c)}if(!b.modaled&&Util.time()-b.start_time>ProgressWatcher.MODAL_WAIT_MS){a=b.req.options;ModalProgress.show(a.progress_text,a.cover_this);a.onProgress=ModalProgress.update;if(a.on_modal_shown!=null){a.on_modal_shown()}b.modaled=true}if(b.is_async_task){return ProgressWatcher.get_async_task_status(c)}else{return ProgressWatcher.get_job_status(c)}},get_job_status:function(a){return new Ajax.Request("/job_status/"+a,{method:"post",parameters:{t:Constants.TOKEN},onSuccess:function(c){var d,b;d=ProgressWatcher.job_info[a];b=c.responseText;if(b.indexOf("err")===0){ProgressWatcher.done(a);if(d.req.options.onFailure&&!Job.handled(a)){d.req.options.onFailure(c)}return}if(b.indexOf("done")===0){d.req.options.job=false;if(!Job.peek(a)){new Ajax.Request("/job_results/"+a,{method:"post",parameters:{t:Constants.TOKEN},onSuccess:function(f){if(Job.handled(a)){return}Notify.clear_if(RequestWatcher.working_msg);if(d.req.options.onSuccess){return d.req.options.onSuccess(f)}},onFailure:function(f){if(Job.handled(a)){return}Notify.clear_if(RequestWatcher.working_msg);if(d.req.options.onFailure){return d.req.options.onFailure(f)}}})}return ProgressWatcher.done(a)}else{try{if(d.req.options.onProgress){return d.req.options.onProgress(c.responseText)}}catch(e){}}},onFailure:function(b){var c;c=ProgressWatcher.job_info[a];c.failures++;if(c.failures>=ProgressWatcher.FAILS_MEAN_FAIL){if(c.req.options.onFailure){c.req.options.onFailure(b,true)}RequestWatcher.remove(c.req);return ProgressWatcher.done(a)}}})},get_async_task_status:function(a){return new Ajax.Request("/async_task_status/"+a,{method:"post",parameters:{t:Constants.TOKEN},onSuccess:function(c){var d,b;d=ProgressWatcher.job_info[a];b=c.responseText;if(!(b.indexOf("done:")&&b.indexOf("err:"))){Job.handled(a);Notify.clear_if(RequestWatcher.working_msg);if(b.indexOf("done:")===0){c.responseText=b.substr(5)}if(d.req.options.onSuccess){d.req.options.onSuccess(c)}return ProgressWatcher.done(a)}else{try{if(d.req.options.onProgress){return d.req.options.onProgress(c.responseText)}}catch(e){}}},onFailure:function(b){var c;c=ProgressWatcher.job_info[a];c.failures++;if(c.failures>=ProgressWatcher.FAILS_MEAN_FAIL){if(c.req.options.onFailure){c.req.options.onFailure(b,true)}RequestWatcher.remove(c.req);return ProgressWatcher.done(a)}}})},done:function(b){var a;a=ProgressWatcher.job_info[b];clearInterval(a.int_id);delete ProgressWatcher.job_info[b];if(!(a.req.async_task_id&&a.req.async_task_id!==b)){return ModalProgress.hide(b)}}};var Forms,__hasProp={}.hasOwnProperty;Forms={submitOnlyOnce:function(){var a;a=Forms.submitted!==true;Forms.submitted=true;return a},disable:function(a){if(a){return setTimeout((function(){return a.disabled=true}),0)}},enable:function(a){if(a){return setTimeout((function(){return a.disabled=false}),0)}},add_vars:function(c,d){var e,b,a;c=$(c);a=[];for(b in d){if(!__hasProp.call(d,b)){continue}e=new Element("input",{type:"hidden",name:b});e.setValue(d[b]);e.addClassName("added-vars");a.push(c.__sert(e))}return a},clear_added_vars:function(a){return $$("#"+a+" .added-vars").each(Element.remove)},mirror:function(c,b){var a;c=$(c);b=$(b);a=function(e,d){d.setValue($F(e));return d.fire("db:value_change")};if(c&&b){c.observe("keyup",function(){return a(c,b)});c.observe("db:autocompleted",function(){return a(c,b)});b.observe("keyup",function(){return a(b,c)});return b.observe("db:autocompleted",function(){return a(b,c)})}},collect_form_vars:function(d){var g,c,b,f,e,a;d=d||$(document.body);c=d.select("input").concat(d.select("textarea")).concat(d.select("select"));b={};for(e=0,a=c.length;e<a;e++){g=c[e];if(g.name&&g.name!=="t"){f=g.getValue();if(f){if(typeof f!=="string"){f=f.join(",")}if(b[g.name]!=null){if(typeof b[g.name]==="string"){b[g.name]=[b[g.name],f]}else{b[g.name].push(f)}}else{b[g.name]=f}}}}return b},add_loading:function(c,a){var b;if(c){c=$(c);b=new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"});b.addClassName("text-img ajax_submit_loading");if(a==="after"){return c.__sert({after:b})}else{return c.__sert({before:b})}}},remove_loading:function(a){return $$(".ajax_submit_loading").each(function(b){return Util.yank(b)})},ui_form_submit:function(b,a){var c;c=Forms.collect_form_vars(b);a=a||b.action;return new UIRequest(b,a,c)},ajax_submit:function(d,b,n,c,l,h,m,e,a,q,f){var o,g,j,p,k;if(a==null){a=false}if(d.ajax_submitted){return false}d.ajax_submitted=true;k=d.select(".suggestion-input");for(j=0,p=k.length;j<p;j++){o=k[j];SuggestionInput.blank(o.identify())()}if(l){Forms.add_loading(l,m)}g=Forms.collect_form_vars(d);if(h){Object.extend(g,h)}new Ajax.DBRequest(b||d.action,{noAutonotify:true,parameters:g,job:e,progress_text:f,evalJSON:false,onSuccess:function(r){if(n&&typeof n==="function"){n(r)}return Forms.remove_loading()},onFailure:function(t){var r,s;if(t){if(t.responseText.indexOf("err:")===0){r=t.responseText.substr(4);if(r.indexOf("{")===0){s=r.evalJSON(true);Forms.fill_errors(d,s)}else{if(a){r=new HTML(r)}Notify.server_error(r)}}else{Notify.server_error()}if(c&&typeof c==="function"){c(t)}return Forms.remove_loading()}},onComplete:function(u){var t,s,r;r=d.select(".suggestion-input");for(t=0,s=r.length;t<s;t++){o=r[t];SuggestionInput.blur_elm(o)}d.ajax_submitted=false;if(q&&typeof q==="function"){return q(u)}}});return false},clear_errors:function(a){a=a||$(document.body);SickInput.hide_errors(a);return a.select(".error-removable").invoke("remove")},fill_errors:function(e,d){var b,g,a,c,f;d=d||{};e=e||$(document.body);Forms.clear_errors(e);for(f in d){if(!__hasProp.call(d,f)){continue}g=e.down("[data-error-field-name='"+f+"']")||e.down("[name='"+f+"']");if(g){b=new Element("br",{"class":"error-removable"});a=new Element("span",{"class":"error-message error-removable"});c=d[f];assert(c.message_html||c.message_text,"Error message must have a message_html or message_text property");if(c.message_html){a.update(c.message_html)}else{a.__date(c.message_text)}g.__sert({before:a});g.__sert({before:b})}}return SickInput.show_errors(e)},value:function(d){var c,b,f,e,a;b=$$('input[name="'+d+'"]');f=null;for(e=0,a=b.length;e<a;e++){c=b[e];f=$(c).getValue()||f}return f},postRequest:function(c,d,a){var b;if(d==null){d={}}if(a==null){a={}}assert(c!=null,"postRequest missing action");d.t=Constants.TOKEN;b=new Element("form",{action:c,method:"POST"});if(a.target){b.target=a.target}document.body.appendChild(b);Forms.add_vars(b,d);return b.submit()}};var Invitations,Referral;Referral={get_selected_emails:function(){var a;a=[];$$("#contact-list input").each(function(b){if(b.className==="email"){if(b.checked){return a.push(b.value)}}});return a.join(", ")},get_selected_fb_contacts:function(){var a;a=[];$$("#contact-list input").each(function(b){if(b.className==="fb"){if(b.checked){return a.push(b.value)}}});return a.join(", ")},send_invites:function(a){var b;b=Referral.get_selected_emails();Invitations.do_send(b,"",false,a,true);return Modal.hide()},show_select_contacts:function(p){var b,m,q,f,g,o,h,l,r,n,a,k,d,j,e,c;$j("#contact-list").html(p);h=$j("#contact-list-rec .contact-row").length;l=ungettext("%d contact","%d contacts",h).format(h);$j("#contact-header-rec .contact-header-count").html(l);h=$j("#contact-list-all .contact-row").length;l=ungettext("%d contact","%d contacts",h).format(h);$j("#contact-header-all .contact-header-count").html(l);if(ReferralsPage.contacts_variant){$j("#contact-rec-check").click(function(){var s;s=$j("#contact-rec-check").is(":checked");$j("#contact-rec-check").prop("checked",s);$j("#contact-list-rec input").prop("checked",s);return Referral.update_invite_count()});b=ReferralsPage.max_referral_bonus;a=function(s,u){var t;t=$j(u.handle);return t.css("margin-left",-t.outerWidth()*u.value/b+"px")};if(!ReferralsPage.is_team){$j("#free-space-slider").show()}$j("#free-space-slider-track").slider({min:0,max:b,step:ReferralsPage.bonus_per_referral,range:"min",value:0,slide:a,change:a,disabled:true});$j("#free-space-slider-track ui-slider-handle").removeAttr("href")}m=$$(".contact-row").length;g=true;if(m){SuggestionInput.reset("contact-filter");q=$$("#contact-list img").length;if(q===0){if((e=$("dropbox-users-text"))!=null){e.style.visibility="hidden"}}$j("#contact-import-msg").empty();if(ReferralsPage.contacts_variant){$j("#contact-import-msg").append($j("#social-message").html());$j("#contact-import-msg").append(" ");if(!ReferralsPage.is_team){if(ReferralsPage.is_paid){$j("#contact-import-msg").append(_("You'll receive 1GB of free space for each new contact who installs Dropbox."))}else{$j("#contact-import-msg").append(_("You'll receive 500MB of free space for each new contact who installs Dropbox."))}}$j("#social-message").remove()}else{$j("#contact-import-msg").append(ungettext("Good news! We've found %d contact. Select the contact if you'd like to invite them.","Good news! We've found %d contacts. Select the contacts you'd like to invite.",m).format(m))}Referral.contact_rows=$$("#contact-list .contact-row");n=0;c=Referral.contact_rows;for(d=0,j=c.length;d<j;d++){r=c[d];r.search_text=r.down(".contact-name").innerHTML+r.down(".contact-email").innerHTML;if(ReferralsPage.contacts_variant){$j(r).find("label").change(function(s){var t;Referral.update_invite_count();if((t=Referral.last_search)!=null?t.length:void 0){return WebMiscActivityLogger.log("contact_list_search",{search_string:Referral.last_search,clicked:1})}})}else{$j(r).find("label").click(function(s){return Referral.update_invite_count()});if(n%2===0){r.style.background="#ffffff"}else{r.style.background="#f4faff"}n+=1}}Referral.update_invite_count();g=false}o=(m?"select-contacts-modal":"no-contacts-modal");k="";if(ReferralsPage.contacts_variant){k=(m?_("Invite friends and family to Dropbox!"):_("Oops! No contacts here."))}else{k=(m?_("Choose contacts"):_("Oops! No contacts here."))}if(ReferralsPage.contacts_variant){f=$j("<div><img src='/static/images/contact_import_envelope.png' />"+k+"</div>")[0];Modal.show(f,$j("#"+o)[0],{action:Referral.action},false,700,false,"contact-list-modal-new",g)}else{Modal.icon_show("email_32",k,$j("#"+o)[0],{action:Referral.action},false,false,false,"contact-list-modal-old",g)}return Referral.filter_observer=new Form.Element.Observer("contact-filter",0.5,function(s,t){if(!SuggestionInput.defaulted(s)){return Referral.filter(t)}})},update_invite_count:function(){var d,h,c,b,g,f,a,e;if(Referral.contact_rows){d=0;e=Referral.contact_rows;for(f=0,a=e.length;f<a;f++){g=e[f];if(g.down("input").checked){$j(g).addClass("selected");d+=1}else{$j(g).removeClass("selected")}}}if(ReferralsPage.contacts_variant){c=Math.min(d,ReferralsPage.max_referral_bonus);b=c*ReferralsPage.bonus_per_referral;$j("#free-space-slider-track").slider("value",b);$j("#free-space-slider-track .ui-slider-handle").text(_("%fGB").format(b))}if(!d){h=_("Invite friends")}else{h=ungettext("Invite %d friend","Invite %d friends",d).format(d)}return $("select-contacts-submit-button").__date(h)},filter:function(j){var c,b,k,h,a,e,g,f,d;if(j===Referral.last_search||(!(Referral.last_search!=null)&&j==="")){return}Referral.last_search=j;if(ReferralsPage.contacts_variant&&ReferralsPage.contacts_variant.indexOf("RECOMMENDED")!==-1){if((f=Referral.last_search)!=null?f.length:void 0){$j("#contact-list .contact-header").hide()}else{$j("#contact-list .contact-header").show()}}h=0;b=new RegExp(RegExp.escape(j.strip()).split(/[;,\s]+/).join(".*"),"i");d=Referral.contact_rows;for(e=0,g=d.length;e<g;e++){k=d[e];a=k.style;if(b.test(k.search_text)){if(!ReferralsPage.contacts_variant){if(h%2===0){a.background="#ffffff"}else{a.background="#f4faff"}}h+=1;a.display=""}else{a.display="none"}}c=function(){if(Referral.last_search===j){return WebMiscActivityLogger.log("contact_list_search",{search_string:j,rows_shown:h})}};setTimeout(c,500);return Referral.update_invite_count()},do_submit:function(a){assert(Referral.action&&typeof Referral.action==="function","Finished with contact list importer but have no callback");return Referral.action(a)},hide:function(b,a){b=$(b);assert(b,"Referral elm doesn't exist");assert(Util.isNumber(a),"Referral id is not a number");Modal.hide();return new Ajax.DBRequest("/account/hide_referral",{parameters:{referral_id:a},onSuccess:function(c){var d;d=b.up("tr");return $j(d).fadeOut()}})}};Invitations={submit:function(a){a=a||window.event;if(a.keyCode===Event.KEY_RETURN){return Invitations.send()}},send:function(b,a){if(a==null){a=false}return Invitations.do_send(ReferralsPage.autocompleter.getEmails(),"",null,b,a)},do_send:function(h,g,e,b,a){var f,c,d;f=h.strip().split(/[;,\s]+/).length;c=g.strip().split(/[;,\s]+/).length;if((!f||h.strip()==="")&&(!g||g.strip()==="")){Notify.server_error(_("Please choose at least one contact."));return}d={emails:h,referral_src:b};if((g!=null)&&g&&(ReferralsPage.fb_url!=null)){d.fb_ids=g;d.fb_link=ReferralsPage.fb_url}if(Referral.source){d.source=Referral.source}new Ajax.DBRequest("/send_invite",{parameters:d,onSuccess:function(j){if(Invitations.custom_on_success){Invitations.custom_on_success(j.responseText,a)}else{Notify.server_success(j.responseText.substr(5))}if(Referral.on_success){Referral.on_success(j.responseText)}if(e){e.setValue("")}return ReferralsPage.autocompleter.clearTokens()},onFailure:function(j){if(j.responseText.startsWith("err:")){return Notify.server_error(j.responseText.substr(4))}else{return Notify.server_error()}},noAutonotify:true});return false},addCustomMessage:function(b){var c,a;Event.stop(b);c=(b.target.tagName==="A"?$(b.target):$(b.target).up("a"));c.addHTML=c.innerHTML;c.update(Sprite.make("web","email_delete",{"class":"link-img"}));c.appendChild(document.createTextNode(_("Remove custom message")));c.stopObserving("click");c.observe("click",Invitations.hideCustomMessage);a=new Element("textarea",{title:_("Enter a custom message here"),name:"custom_message","class":"custom-message suggestion-input act_as_block textinput",rows:3,cols:25,style:"margin-top: 0.75em;"});a.setValue(Invitations.custom_message||a.title);SuggestionInput.register(a);c.up().previous("div").__sert({bottom:a});SuggestionInput.register(a);ActAsBlock.resize(a);return false},hideCustomMessage:function(b){var a,c;Event.stop(b);c=(b.target.tagName==="A"?$(b.target):$(b.target).up("a"));c.stopObserving("click");c.observe("click",Invitations.addCustomMessage);c.update(c.addHTML);a=c.up().up().select(".custom-message")[0];Invitations.custom_message=$F(a);a.parentNode.removeChild(a);return false}};var EventBubble,Feed;EventBubble={make:function(b){var a;a='<table class="ebubble">\n  <tr>\n    <td class="tl"></td>\n    <td class="t"></td>\n    <td class="tr"></td>\n  </tr>\n  <tr>\n    <td class="l"></td>\n    <td class="c">\n      <%= content %>\n    </td>\n    <td class="r"></td>\n  </tr>\n  <tr>\n    <td class="bl"></td>\n    <td class="b">\n      <img src="/static/images/events_bubble_tail.gif" alt="" class="events_bubble_tail" />\n    </td>\n    <td class="br"></td>\n  </tr>\n</table>';return HTML.tmpl(a,{content:b})}};Feed={firstTime:true,page_num:0,ns_id:null,_fetching_feed:false,changeDate:function(a,b){Feed.date=a;Feed.nice_date=Util.niceDate(a);if(!b){return Feed.getPage(0)}},getPage:function(a){var b,c;if(Feed._fetching_feed){return}Feed._fetching_feed=true;a=a||0;Feed.page_num=parseInt(a,10);b=a===0?"140px":"20px";$j("#more-loading").css("marginTop",b).show();c=Feed.ns_id!=null?"&ns_id="+(Feed.ns_id.toString()):"";new Ajax.DBRequest("/next_events?cur_page="+a+c,{parameters:{date:Feed.nice_date?Feed.nice_date:""},log_timing:true,onSuccess:function(d){if(a===0){$j("#old-event-table").empty()}return $j(d.responseText).appendTo($j("#old-event-table"))},onComplete:function(){$j("#more-loading").hide();Feed._fetching_feed=false;EventsFull.load_more_if_needed();return EventsFull.update_rss_button_title()}});return false},url_check:function(b,c,a){var d;c=c||0;b=b||null;d=(Feed.ns_id!==b)||(Feed.page_num!==c)||(Feed.nice_date!==a);Feed.ns_id=b||Feed.ns_id;Feed.page_num=parseInt((c!=null?c:Feed.page_num),10);if(a){Feed.changeDate(new Date(a.gsub("-","/")),true)}if(d){ULSelectMenu.set_selected_by_value($("namespace-list"),Feed.ns_id);if(a){EventDatePicker.change_date(Feed.date)}return Feed.getPage(Feed.page_num)}},set_url:function(c){var b,a,d,e;a=(c.ns_id!=null?c.ns_id:Feed.ns_id);d=(c.page_num!=null?c.page_num:Feed.page_num);b=(c.date!=null?c.date:Feed.nice_date);e={n:d,d:b};if(a){e.ns=a}return DBHistory.push_state("/events",e)},get_key:function(a){return""+Feed.ns_id+"_"+Feed.date+"_"+a+"_"+Feed.nice_date},show_rss_modal:function(){var a,b;a=Feed.ns_id||Constants.root_ns;b=Feed.rss_url;Modal.icon_show("feed_32",_("Subscribe to this RSS feed"),$("rss-modal"));$("rss_url").setValue(b);BrowseActions.addCopyUrlFlash(b);$("copy_success").__date();$("reset-rss-link").writeAttribute("href","/reset_rss/"+a);return $("rss_url").select()}};var DBCalendar,DatePickerInput,EventDatePicker,TextInputDatePicker,Timezone;Date.fromSecondsSinceEpochUTC=function(a){var b;b=new Date(1970,0,1);b.setSeconds(a);return b};Date.utcnow=function(){var a;a=new Date();return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())};Date.prototype.applyTimezoneOffset=function(c){var a,b;a=parseInt(c,10);b=60*(c-a);this.setHours(this.getHours()+a);return this.setMinutes(this.getMinutes()+b)};Date.prototype.contextualFormat=function(){var d,f,b,c,a,e;a=Date.utcnow();c=(a.getTime()-this.getTime())/1000;d=0;if(c<8*3600){return this.ago()}a.applyTimezoneOffset(Constants.TIMEZONE_OFFSET);b=a;this.applyTimezoneOffset(Constants.TIMEZONE_OFFSET);e=Date.utcnow();e.applyTimezoneOffset(Constants.TIMEZONE_OFFSET);e.setDate(e.getDate()-1);if(this.getYear()===b.getYear()&&this.getMonth()===b.getMonth()&&this.getDate()===b.getDate()){f=_("Today %(time)s");return f.format({time:this.format(Constants.time_format)})}else{if(this.getYear()===e.getYear()&&this.getMonth()===e.getMonth()&&this.getDate()===e.getDate()){f=_("Yesterday %(time)s");return f.format({time:this.format(Constants.time_format)})}else{return this.format(Constants.datetime_format)}}};Date.prototype.toUTCDate=function(){return new Date(this.getUTCFullYear(),this.getUTCMonth(),this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds(),this.getUTCMilliseconds())};Date.prototype.differenceStr=function(c){var h,b,g,a,e,f,d;e=(this.getTime()-c.getTime())/1000;if(e<60){return ungettext("%d sec","%d secs",e).format(e)}else{if(e<3600){g=parseInt(e/60,10);return ungettext("%d min","%d mins",g).format(g)}else{if(e<86400){b=parseInt(e/3600,10);return ungettext("%d hour","%d hours",b).format(b)}else{if(e<2592000){h=parseInt(e/(60*60*24),10);return ungettext("%d day","%d days",h).format(h)}else{if(e<4838400){f=parseInt(e/(60*60*24*7),10);return ungettext("%d week","%d weeks",f).format(f)}else{if(e<31536000){a=parseInt(e/(60*60*24*30),10);return ungettext("%d month","%d months",a).format(a)}else{d=parseInt(e/(60*60*24*365),10);return ungettext("%d year","%d years",d).format(d)}}}}}}};Date.prototype.ago=function(){var h,c,g,a,e,b,f,d;b=Date.utcnow();e=(b.getTime()-this.getTime())/1000;if(e<60){return ungettext("%d sec ago","%d secs ago",e).format(e)}else{if(e<3600){g=parseInt(e/60,10);return ungettext("%d min ago","%d mins ago",g).format(g)}else{if(e<86400){c=parseInt(e/3600,10);return ungettext("%d hour ago","%d hours ago",c).format(c)}else{if(e<2592000){h=parseInt(e/(60*60*24),10);return ungettext("%d day ago","%d days ago",h).format(h)}else{if(e<4838400){f=parseInt(e/(60*60*24*7),10);return ungettext("%d week ago","%d weeks ago",f).format(f)}else{if(e<31536000){a=parseInt(e/(60*60*24*30),10);return ungettext("%d month ago","%d months ago",a).format(a)}else{d=parseInt(e/(60*60*24*365),10);return ungettext("%d year ago","%d years ago",d).format(d)}}}}}}};Timezone={check_timezone:function(){var a;if(!Constants.uid){return}a=Timezone.get_current_timezone();if(!(Constants.auto_timezone_offset!=null)||Constants.auto_timezone_offset!==a){return Timezone.update(a)}},get_current_timezone:function(){var d,c,a,b;c=new Date();c.setSeconds(0);c.setMilliseconds(0);b=c.toGMTString();d=new Date(b.substring(0,b.lastIndexOf(" ")));a=(c-d)/(1000*60*60);return a},update:function(a){assert(typeof a==="number","Timezone offset was not a number: "+a);return new Ajax.DBRequest("/set_timezone",{parameters:{offset:a},noAutonotify:true})},on_change:function(){var a,b;a=[];b=[$("timezone_area"),$("timezone_location"),$("timezone_city")];b.each(function(c){if(c){return a.push($F(c))}});return Timezone.update_form(a)},update_form:function(m){var h,a,n,c,e,j,d,l,b,g,f,k;m=m||["America"];assert(Timezone.tree,"Timezone tree missing...");$("tz").__date();a=["timezone_area","timezone_location","timezone_city"];e=Timezone.tree;b=Math.max(m.length+1,2);for(h=g=0;0<=b?g<b:g>b;h=0<=b?++g:--g){d=m[h];n=Object.keys(e);if(!n.length){break}l=new Element("select",{id:a[h],name:a[h]});l.observe("change",Timezone.on_change);for(f=0,k=n.length;f<k;f++){c=n[f];j=new Element("option");j.value=c;j.update(c);if(c===d){j.selected=true}l.appendChild(j)}$("tz").appendChild(l);e=e[d]}return Util.syncHeight()},auto:function(){var a;a=$F("timezone_auto");if(a){return $("tz").__date()}else{return Timezone.update_form()}},build_tree:function(b){var a;a={};b.each(function(e){var d,c;c=e.split("/");d=a;return c.each(function(f){if(!d[f]){d[f]={}}return d=d[f]})});return Timezone.tree=a}};if(!Constants.is_test){Util.smartLoad(Timezone.check_timezone)}DBCalendar=Class.create({initialize:function(b,a){this.options=a||{};this.container=$(b);assert(this.container,"Couldn't find the element");this.today=new Date();if(this.options.disable_future){this.options.last_day=Util.start_of_day(this.options.last_day||this.today)}if(this.options.disable_past){this.options.first_day=Util.start_of_day(this.options.first_day||this.today)}this.view_date=Util.start_of_day(this.options.selected_date||this.today);this.selected_date=Util.start_of_day(this.options.selected_date||this.today);return this.render()},_change_month:function(b,a){Event.stop(b);this.view_date.setMonth(a);return this.render()},is_valid_date:function(d,f,e,c,a){var b;d=parseInt(d,10);f=parseInt(f,10);e=parseInt(e,10);c=parseInt(c,10);a=parseInt(a,10);c=c||1970;a=a||(new Date()).getFullYear()+1;f+=1;if(e<c){return false}if(e>a){return false}if(f<1||f>12){return false}if(d<=0){return false}if(f===2){b=((e%4)===0)&&(((e%100)!==0)||((e%400)===0));if(b){return d<=29}else{return d<=28}}else{if(f===4||f===6||f===9||f===11){return d<=30}else{return d<=31}}},change_date:function(a,d,b){var c;if(!this.is_valid_date(a,d,b)){return}c=b!==this.view_date.getFullYear()||d!==this.view_date.getMonth();this.selected_date.setDate(a);this.selected_date.setMonth(d);this.selected_date.setFullYear(b);if(c){this.view_date.setMonth(d);this.view_date.setFullYear(b);this.render()}else{$j(this.container).find(".selected").removeClass("selected");$j(this.container).find("a#day"+a+"-"+d).addClass("selected")}if(this.options.onDateChange){return this.options.onDateChange(this.selected_date)}},render:function(){var d,k,h,f,e,b,g,c,j,a;k=this.render_days();f=$j(".current-month",k);g=f.first().data("date");b=f.last().data("date");a=g<=this.options.first_day;j=b>=this.options.last_day;d=new Element("div");d.addClassName("calendar clearfix");if(!j){this._next_month=(function(l){return this._change_month(l,this.view_date.getMonth()+1)}).bind(this);e=new Element("a");e.addClassName("changemonth next");e.update(Sprite.make("web","arrowright",{}));Event.observe(e,"click",this._next_month);d.__sert(e)}if(!a){this._prev_month=(function(l){return this._change_month(l,this.view_date.getMonth()-1)}).bind(this);c=new Element("a");c.addClassName("changemonth prev");c.update(Sprite.make("web","arrowleft",{}));Event.observe(c,"click",this._prev_month);d.__sert(c)}h=new Element("h5");h.update(_("%(month)s %(year)s").format({month:Util.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()}));d.__sert(h);d.__sert(k);return this.container.__date(d)},render_days:function(){var h,g,a,f,b,e,d,c;g=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);d=g.getDay();h=new Element("div");h.addClassName("days");for(a=c=d;d<=0?c<0:c>0;a=d<=0?++c:--c){e=new Date(g.getFullYear(),g.getMonth(),g.getDate());e.setDate(e.getDate()-a);h.__sert(this.render_day(e,true))}f=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);while(f.getMonth()===this.view_date.getMonth()){h.__sert(this.render_day(f));f=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),f.getDate()+1)}b=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);while(b.getDay()!==6){b=new Date(b.getFullYear(),b.getMonth(),b.getDate()+1);h.__sert(this.render_day(b,true))}return h},render_day:function(c,e){var b,d;d=!e;if(this.options.last_day){e=e||c>this.options.last_day}if(this.options.first_day){e=e||c<this.options.first_day}b=new Element(e?"span":"a");$j(b).data("date",c);if(d){b.addClassName("current-month")}b.update(c.getDate());b.addClassName("date");b.writeAttribute("id","day"+c.getDate()+"-"+c.getMonth());if(this.selected_date.getDate()===c.getDate()&&this.selected_date.getMonth()===c.getMonth()&&this.selected_date.getFullYear()===c.getFullYear()){b.addClassName("selected")}if(e){b.addClassName("inactive")}else{this._handler=(function(f){var a;a=f.target.identify().substr(3).split("-");return this.change_date(a[0],this.view_date.getMonth(),this.view_date.getFullYear())}).bind(this);Event.observe(b,"click",this._handler)}return b}});EventDatePicker={show_calendar:function(c){var a,b,d;Event.extend(c).preventDefault();if(EventDatePicker.shown){$("cal_container").hide();EventDatePicker.shown=false;return}if(!EventDatePicker.calendar){d=new Element("div",{id:"cal_container"});d.observe("click",function(f){return f.preventDefault()});$(document.body).__sert(d);EventDatePicker.calendar=new DBCalendar("cal_container",{onDateChange:function(e){return EventDatePicker.change_date(e,0)},disable_future:true,first_day:EventDatePicker.first_event});d.absolutize();b=$j("#cal_date");a=$j("#cal_container");a.clonePosition(b,{setWidth:false,setHeight:false,offsetTop:b.height(),offsetLeft:b.width()-a.children().first()[0].offsetWidth})}$("cal_container").show();$(document.body).observe("click",EventDatePicker.hide_calendar);return EventDatePicker.shown=true},hide_calendar:function(a){if($(a.target).up("#cal_date")){return}Event.stop(a);$("cal_container").hide();$(document.body).stopObserving("click",EventDatePicker.hide_calendar);return EventDatePicker.shown=false},change_date:function(a,b){var c;if(b!=null){Feed.page_num=0}c=$("cur_date_text");c.update(a.localize());return Feed.set_url({date:Util.niceDate(a)})}};TextInputDatePicker=Class.create({initialize:function(d,c){var f,e,b,a;this.options={include_seconds:true,choose_eod:false};Object.extend(this.options,c||{});this.input=$(d);assert(this.input,"Couldn't find the element "+d.toString());b=new Date();a=(this.input.value?Util.from_mysql_date(this.input.value):false);e=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate());this.cal_icon=Sprite.make("web","calendar_view_month",{align:"absmiddle"});this.cal_container=new Element("div",{id:"cal_container_"+d,style:"display: none; position: absolute; z-index: 1"});this.calendar=new DBCalendar(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:e,selected_date:a});this.input.__sert({after:this.cal_icon});this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this));f=$j(this.input);$j(this.cal_container).clonePosition(f,{setWidth:false,setHeight:false,offsetTop:f[0].offsetHeight});return this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(a){if(a){Event.stop(a)}return this.cal_container.toggle()},hide_cal:function(a){if(a){Event.stop(a)}return this.cal_container.hide()},onDateChange:function(a){if(this.options.choose_eod){a.setTime(Util.start_of_day(a).getTime()+86399999)}this.input.value=Util.to_mysql_date(a,true);return this.hide_cal()}});DatePickerInput=Class.create({initialize:function(a,c){var d,b;this.container=a;this.options={};Object.extend(this.options,c||{});this.input=this.container.down(".input-date");this.display=this.container.down(".visible-date");b=(this.input.value?Util.from_mysql_date(this.input.value):new Date());if(this.container.hasAttribute("data-first")){d=Util.from_mysql_date(this.container.getAttribute("data-first"))}this.cal_container=this.container.down(".cal-container");this.calendar=new DBCalendar(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:d,disable_future:true,selected_date:b});this.container.observe("click",this.show_cal.bindAsEventListener(this));$(document.body).observe("click",this.hide_cal.bind(this));return this.onDateChange(b)},show_cal:function(b){var a;if(b){Event.stop(b)}a=$(b.target);if(a.match(".cal-container")||a.up(".cal-container")){return}$j(".cal-container").hide();return this.cal_container.show()},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(a){this.input.value=Util.to_mysql_date(a,false);this.display.update(a.localize());return this.hide_cal()}});var AppDirectory,AppReview,Apps;Apps={confirm_disable:function(d,c,b){var e,a;e=(b?_("Are you sure you want to disable '%(app_name)s'?"):_("Are you sure you want to delete '%(app_name)s'?"));DomUtil.fillVal(e.format({app_name:d.escapeHTML()}),"app-disable-text");Modal.icon_show("application_delete_32",(b?_("Confirm disable"):_("Confirm delete")),$("app-disable-modal"));a="/developers/disable_app/"+c;$("app-disable-modal").down("form").action=a;return $("disable-app-button").setValue((b?_("Disable"):_("Delete")))},enable_app:function(b){var a;a="/developers/enable_app/"+b;return window.location.href=a},show_create:function(){if(EmailVerification.verified()){Modal.icon_show("application_add_32",_("Create a new app"),$("create-app"),{});return ActAsBlock.register(false,$("modal-content"))}},do_create:function(b){var a;if(b){Event.stop(b)}a=$("create-app-form");assert(a,"Missing form for Apps.do_create");return Forms.ajax_submit(a,false,Apps.on_create,false,b&&b.target)},on_create:function(a){if(a&&a.responseText&&a.responseText!=="ok"){return window.location.href=a.responseText}else{return window.location.reload()}},do_edit:function(b){var a;if(b){Event.stop(b)}a=$("update-app-form");assert(a,"Missing form for Apps.do_edit");return Forms.ajax_submit(a,false,(function(){return window.location.reload()}),false,b&&b.target)},show_about:function(g,f,d,a,c,b){if(g){Event.stop(g)}$$(".app-name")[0].__date(f);$$(".app-description")[0].__date(d);Modal.show(f,$("about-app"),{"force-icon":c});return $("application-link").href=b},show_uninstall:function(f,d,c,a,b){var g;if(f){Event.stop(f)}Modal.vars={token_id:c,delete_row_type:"inst-app",action:"uninstall_app"};g=$("delete-"+a+"-app-confirm");if(a==="sandbox"){if(!b){return Apps.do_action()}g.select(".app_folder")[0].__date(b)}g.select(".app_name")[0].__date(d);Modal.icon_show("application_delete_32",_("Remove %(app_name)s?").format({app_name:d.em_snippet(22)}),g,Modal.vars);return null},do_uninstall:function(){new Ajax.DBRequest("/api/uninstall_app",{parameters:{id:Modal.vars.token_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(a){Notify.server_success(a.responseText);$("inst-app-"+Modal.vars.token_id+"-row").hide().removeClassName("active_app");if($$(".active_app").length===0){$("applications-table-container").__date(_("You're not using any Dropbox API apps."));return $("applications-explanation").remove()}}});return Modal.hide()},do_action:function(){return new Ajax.DBRequest("/api/"+Modal.vars.action,{parameters:{id:Modal.vars.token_id},onSuccess:function(a){Notify.server_success(a.responseText);if(Modal.vars.delete_row_type){return $(Modal.vars.delete_row_type+"-"+Modal.vars.token_id.toString()+"-row").hide()}else{return window.location.reload()}}})},enable_users_in_dev:function(a,b){new Ajax.DBRequest("/developers/enable_users_in_dev/"+a,{onSuccess:function(c){Modal.icon_show("alert_32",_("Limit raised to %d users").format(b),$("increased-dev-user-limit-modal"));$j("#users-in-dev-none, #users-in-dev-some").hide();return $j("#users-in-dev-max").show()}});return false},unlink_all_users_in_dev:function(a){Modal.icon_show("alert_32",_("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+a,{onSuccess:function(b){$j("#current-app-users-1, #current-app-users-2").text("0");return Modal.hide()}})}});return false},remove_user:function(c,b,a){$j.post("/developers/remove_user/"+c+"/"+b,function(e){var d;d=$j(a).parentsUntil("table");$j(a).parent("div").remove();if(!$j(".additional-user").length){$j("#none-linked").show();return $j("#apply-for-more").hide()}});return false},show_add_key_confirm:function(c,b,a){if(c){Event.stop(c)}$$(".app-name")[0].__date(b);Modal.show(_("Confirm key creation"),$("add-key-confirm"),{app_id:a});return 0},do_add_key:function(a){return new Ajax.DBRequest("/api/create_app_token",{parameters:{id:Modal.vars.app_id},onSuccess:function(b){var c,d;Notify.server_success(_("Key created successfully."));d="<tr id=\"token-#{id}-row\"><td>#{key}</td><td>#{secret}</td><td><a href=\"#\" onclick=\"Apps.show_del_key_confirm(event, '#{key}', '#{secret}', '#{id}');\">"+Sprite.html("web","x")+"</a></td></tr>";c=b.responseText.evalJSON(true);c.id=Number(c.id);c.key=c.key.replace("'","");c.secret=c.secret.replace("'","");d=d.interpolate(c);return $("api-key-last-row").insert({before:d})}})},show_del_key_confirm:function(d,b,a,c){if(d){Event.stop(d)}$$(".token-key")[0].__date(b);$$(".token-secret")[0].__date(a);Modal.show(_("Confirm key removal"),$("del-key-confirm"),{token_id:c});return 0},do_del_key:function(a){return new Ajax.DBRequest("/api/delete_app_token",{parameters:{id:Modal.vars.token_id},onSuccess:function(c){var b;Notify.server_success(_("Key removed successfully."));b=c.responseText.evalJSON(true);return $("token-"+b.id+"-row").hide()}})},restore_sandbox:function(b,a){var d,c;d=$("restore-sandbox");Modal.icon_show("folder_app_32",_("Restore app folder '%(filename)s'").format({filename:FileOps.filename(b).em_snippet(17)}),d);c=$("restore-sandbox-form");return Forms.add_vars(c,{ns_id:a})},submit_restore_sandbox:function(b){var a;Event.stop(b);a=$("restore-sandbox-form");Forms.ajax_submit(a,false,(function(c){Modal.hide();Notify.server_success(_("Restored app folder"));if(c.responseText.length){return Browse.reload_fqpath(c.responseText)}else{return Browse.reload("","",true)}}),false,b.target);return false},developer_support:function(){var a;a=$("dev-support-modal");return Modal.icon_show("alert_32",_("Dropbox developer support"),a)},submit_developer_support:function(b){var a;a=$("dev-support-form");assert(a,"Form is missing in submit_developer_support");return Forms.ajax_submit(a,false,(function(){Modal.hide();return Notify.server_success(_("Thanks for your help request.  We'll get back to you soon."))}),false,b&&b.target)},submit_app_create:function(b){var a;if(b){Event.stop(b)}if(EmailVerification.verified()){a=$j("#create-app-form");assert(a,"Missing form for Apps.do_create");a=a[0];Forms.ajax_submit(a,false,Apps.on_create,Apps.set_label_offset,b&&b.target)}return false},show_app_secret:function(){$j("#app-secret").show();$j("#app-secret-show").hide();return false},set_label_offset:function(){return $j(".error-message").parent().filter(".sick-input").find("label").css("top","29px")},submit_app_info:function(c,a){var b;try{b=$("update-app-form");return Forms.ajax_submit(b,"/developers/app_info/%s".format(a),(function(d){return b.submit()}),false,c&&c.target)}finally{return false}},delete_screenshot:function(a,b,c){return new Ajax.DBRequest("/developers/delete_screenshot/%s".format(b),{parameters:{screenshot_id:c},onSuccess:function(d){return $j(a).fadeOut()}})},add_screenshot_form:function(){var a;a=new Element("input",{type:"file",name:"screenshots"});return $("screenshots-container").appendChild(a)},select_api_radio:function(b){var c,e,d,a;if(b){$j("#"+b).attr("checked","true")}e=document.getElementsByName("api");for(d=0,a=e.length;d<a;d++){c=e[d];if(c.checked){$j(c.parentElement.parentElement).addClass("selected",true);$j("#api-perms").hide();$j("#api-domain").hide();$j("#api-perm-sandbox").removeAttr("disabled");switch(c.value){case"chooser":$j("#api-domain").show();break;case"core":$j("#api-perm-db-container").show();$j("#api-perm-sandbox").show();$j("#api-perms").show();break;case"sync":$j("#api-perm-db-container").hide();$j("#api-perm-sandbox").attr("disabled","true").attr("checked","true");$j("#api-perms").show()}}else{$j(c.parentElement.parentElement).removeClass("selected")}}return true},show_need_users_modal:function(a){Event.stop(a);Modal.icon_show("alert_32",_("Please test this app"),$("app-need-users-modal"));return false},show_name_branding_modal:function(a){Event.stop(a);Modal.icon_show("alert_32",_("Please rename this app"),$("app-name-branding-modal"));return false}};AppDirectory={click:function(a){a=Object.toQueryString(a);AppDirectory.get_page(a);return HashRouter._set_hash(a)},get_page:function(a){Spinner.showLoading(true,"list-content");return new Ajax.Request("/apps/list?"+a,{onSuccess:function(b){return $("list-content").update(b.responseText)},onComplete:function(){return Spinner.hideLoading()}})},hash_change:function(b){var a;a=b.memo.hash;return AppDirectory.get_page(a)},platform_change:function(){var b,a;b=Object.clone(AppDirectory.filter_state);a=[];$$(".platform input").each(function(c){if(c.checked){return a.push(c.value)}});b.page=0;b.platform=a.join(",");return AppDirectory.click(b)},set_order:function(a){var b;b=Object.clone(AppDirectory.filter_state);b.order_by=a;b.page=0;return AppDirectory.click(b)},set_page:function(a){var b;b=Object.clone(AppDirectory.filter_state);b.page=a;return AppDirectory.click(b)}};AppReview={page:0,get_page:function(a,b){Spinner.showLoading(true,$("reviews").down("div"));return new Ajax.Request("/apps/reviews",{parameters:{page:b,app_id:a},onSuccess:function(c){AppReview.update(c.responseText);AppReview.page=parseInt(b,10);HashRouter.set_hash("review",a,b.toString());return $("reviews").scrollTo()},onComplete:function(){return Spinner.hideLoading()}})},update:function(a){return $("reviews").update(a)},check_hash:function(a,b){b=b||0;b=parseInt(b,10);if(b!==AppReview.page){return AppReview.get_page(a,b)}},add_review:function(c,a){var b;Event.stop(c);b=$("app-review-form");return Forms.ajax_submit(b,false,(function(d){AppReview.get_page(a,0);return b.down("textarea").setValue("")}),false,c.target)}};var FacebookOAuth,Twitter;window.twitter_auth_complete=function(){if(Twitter.onLoginSuccessCallback){Twitter.onLoginSuccessCallback()}else{window.location.reload()}return false};Twitter={get_progress_container:function(){var a;assert(Twitter.progress_container,"Twitter is missing progress_container");a=$(Twitter.progress_container);assert(a,"Missing progress_container elm");return a},follow_dropbox:function(a){var b;if(a.showWorking){a.showWorking()}b=function(){if(a.onFailure){return a.onFailure()}else{return window.location.reload()}};return new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(c){if(!c.responseText.startsWith("ok")){return b()}else{if(a.onSuccess){return a.onSuccess()}}},onFailure:function(){return b()}})},do_auth:function(a){window.open("/twitter/request_token","twitter_auth","width=800,height=400");if(a){return Twitter.onLoginSuccessCallback=a}},show_auth:function(a){if(a){Twitter.onLoginSuccessCallback=a}return DomUtil.updateFromElm(Twitter.get_progress_container(),"inline-twitter-auth")},show_posting:function(){if(Twitter.should_hide_modal()){Modal.hide()}return Twitter.get_progress_container().update(DomUtil.fromElm("sharing-progress"))},show_complete:function(b){var a;a=Twitter.get_progress_container();a.update(DomUtil.fromElm("sharing-posted"));return Twitter.show_complete_into(b,a)},show_complete_into:function(g,a){var d,e,c,f,b;d="twitter";f=_("View tweet");b=void 0;if(g.startsWith("ok")){b="http://www.twitter.com/"}else{b=g}e=a.down("#view-post");e.href=b;e.update(f);c=Sprite.make("web",d);return e.__sert({top:c})},post:function(c,e,b){var d,a;assert(c,"Twitter message is empty");d={message:c,from_referrals:Twitter.from_referrals,from_getspace:Twitter.from_getspace};new Ajax.DBRequest("/twitter_post",{parameters:d,onSuccess:function(f){var g,h;if(f.responseText==="login"){Twitter.onLoginSuccessCallback=function(){return Twitter.post(c)};g=Twitter.custom_show_auth||Twitter.show_auth;return g()}else{if(Twitter.should_hide_modal()){Modal.hide()}h=Twitter.onPostSuccessCallback||Twitter.show_complete;return h(f.responseText)}}});a=Twitter.custom_show_posting||Twitter.show_posting;return a()},custom_post:function(a,b){if(b){Twitter.onPostSuccessCallback=b}if(!a){return}assert(a,"Twitter message doesn't exist");if(!Constants.uid){return window.open("http://www.twitter.com/home?status="+encodeURI(a))}else{return Twitter.post(a)}},get_user_info:function(a){return new Ajax.DBRequest("/twitter/user_info",{parameters:{},onSuccess:function(b){return a(Util.from_json(b.responseText))}})},should_hide_modal:function(){if(typeof Twitter.hide_modal==="undefined"){return true}else{return Twitter.hide_modal}}};FacebookOAuth={get_progress_container:function(){var a;assert(FacebookOAuth.progress_container,"Facebook is missing progress_container");a=$(FacebookOAuth.progress_container);assert(a,"Missing progress_container elm");return a},do_auth:function(a){window.open("/fb/access_token","fb_auth","width=600,height=450");if(a){return FacebookOAuth.onLoginSuccessCallback=a}},show_posting:function(){Modal.hide();return FacebookOAuth.get_progress_container().update(DomUtil.fromElm("sharing-progress"))},show_auth:function(a){if(a){FacebookOAuth.onLoginSuccessCallback=a}return DomUtil.updateFromElm(FacebookOAuth.get_progress_container(),"inline-facebook-auth")},show_complete:function(){var a,d,e,c,f,b;a=FacebookOAuth.get_progress_container();a.update(DomUtil.fromElm("sharing-posted"));d="facebook";f="View Post";b="http://www.facebook.com/profile.php?v=wall";e=a.down("#view-post");e.href=b;e.update(f);c=Sprite.make("web",d);return e.__sert({top:c})},post:function(e,d,c,b,f){var a;if(!Constants.uid){window.open("http://www.facebook.com/sharer.php?u="+encodeURI(d)+"&t="+encodeURI(c));return}a=FacebookOAuth.custom_show_posting||FacebookOAuth.show_posting;a();return new Ajax.DBRequest("/fb/post",{parameters:{message:e,link:d,link_name:c,description:b,from_referrals:FacebookOAuth.from_referrals,from_getspace:FacebookOAuth.from_getspace,picture:(f?f:"")},onSuccess:function(g){var h;if(g.responseText.startsWith("ok")){h=FacebookOAuth.custom_show_complete||FacebookOAuth.show_complete;return h()}else{if(g.responseText.startsWith("auth")){return do_auth(function(){return FacebookOAuth.post(e,d,c,b)})}}}})}};var Scroll;Scroll={SCROLL_OFFSET:100,_get_cursor:null,_getting_more:false,_more_endpoint:null,_get_more_params:null,_render_more:null,_paused:true,_more:true,_scroller:null,init:function(b,c,d,f,e,a){this.SCROLL_OFFSET=b;this._more_endpoint=c;this._get_more_params=d;this._render_more=f;this._get_cursor=e;this._paused=false;this._more=true;return this._scroller=a},listen:function(){var a;return Event.observe((a=this._scroller)!=null?a:window,"scroll",this._window_scroll)},pause:function(){return this._paused=true},_window_scroll:function(){var c,b,a;if(Scroll._more){a=Util.scroll_offsets().top;b=Util.viewport_dimensions().height;c=document.body.getHeight();if(Scroll._scroller){if(Scroll._scroller.scrollTop+Scroll._scroller.offsetHeight+Scroll.SCROLL_OFFSET>=Scroll._scroller.scrollHeight){return Scroll._get_more()}}else{if(a+b+Scroll.SCROLL_OFFSET>=c){return Scroll._get_more()}}}},_get_more:function(){var a,b;if(Scroll._getting_more||Scroll._paused){return}Scroll._getting_more=true;if((b=$("more-loading"))!=null){b.show()}a={cursor:Scroll._get_cursor()};Object.extend(a,Scroll._get_more_params);return new Ajax.DBRequest(Scroll._more_endpoint,{method:"POST",parameters:a,onSuccess:function(d){var e,c;if((c=$("more-loading"))!=null){c.hide()}e=Util.from_json(d.responseText);Scroll._more=e.more;Scroll._render_more(e);return Scroll._getting_more=false}})}};var AllPhotosPhotoPreview,AllPhotosVideoPreview,LightboxPreviewBase,PhotoPreview,SingleCollectionPhotoPreview,SingleCollectionVideoPreview,VideoPreview,get_timeline_preview_classes,_ref,_ref1,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d},__bind=function(a,b){return function(){return a.apply(b,arguments)}};LightboxPreviewBase=(function(){function a(c,g,e,d,h,b,f){this.filename=c;this.fq_path=g;this.thumbnail_url_tmpl=e;this.dl_url=d;this.ns_id=b;this.ns_path=f;this.display_time=h||null;this.more_actions_item_tmpl=HTML.tmpl("lightbox_more_actions_item_tmpl")}a.prototype.preload=function(){};a.prototype.render=function(){};a.prototype.image_size=function(){var b;b=document.viewport.getDimensions();return Util.dimensions_to_imagesize(b.width,b.height)};a.prototype.get_more_actions_above_divider=function(c){var d,b;b=[];d=this.more_actions_item_tmpl({_id:"lightbox_download_link",_href:this.dl_url,sprite_name:"lightbox_download",item_text:_("Download"),more_classes:"more-actions-item"});b.push(d);return b};a.prototype.get_more_actions_below_divider=function(b){return[]};a.prototype.is_a_timeline_preview=function(){return this instanceof SingleCollectionPhotoPreview||this instanceof AllPhotosPhotoPreview||this instanceof SingleCollectionVideoPreview||this instanceof AllPhotosVideoPreview};a.prototype.is_an_album_preview=function(){return this instanceof SingleCollectionPhotoPreview||this instanceof SingleCollectionVideoPreview};a.prototype.is_a_photo_preview=function(){return this instanceof PhotoPreview};a.prototype.is_a_video_preview=function(){return this instanceof VideoPreview};a.prototype.get_actions=function(f){var c,e,d,b,g=this;e=[];if(!this.is_a_timeline_preview()){d=$j("<a />",{id:"lightbox_shmodel_link","class":"title_bubble black"});if(this.is_a_photo_preview()){d.attr("title",_("Share link to photo"))}else{if(this.is_a_video_preview()){d.attr("title",_("Share link to video"))}else{assert(false,"preview needs to be a photo or video")}}d.html(Sprite.make("web","link_white"));if(this.shmodel_link){d.attr("href",this.shmodel_link+"?m");d.attr("target","_blank")}else{d.attr("href","#");b=(function(h){h.preventDefault();return Forms.postRequest("/sm/create"+Util.urlquote(g.fq_path),{},{target:"_blank"})});d.on("click",b)}e.push(d[0])}if(f.include_delete){c=$j("<a />",{id:"lightbox-delete-button",href:"#","class":"title_bubble black",title:Photos.in_single_collection_view()?_("Remove"):_("Delete")});c.html(Sprite.make("web","lightbox_delete_16"));c.on("click",(function(h){h.preventDefault();return Lightbox.toggle_delete()}));e.push(c[0])}assert(Lightbox.more_actions_button!=null,"Lightbox should have a more_actions_button added on init");e.push(Lightbox.more_actions_button);return e};a.prototype.delete_pressed=function(){var b;b=_("Deleting...");if(this.is_a_timeline_preview()){if(Photos.in_single_collection_view()){b=_("Removing...");PhotosCollections.remove_photos(Photos.get_current_collection(),[this.photo])}else{Photos._delete_photos([this.photo])}}else{document.fire(Lightbox.PHOTO_DELETE_EVT,this)}return Notify.server_success(b)};a.prototype.set_more_actions_event_handlers=function(b){};return a})();PhotoPreview=(function(b){__extends(a,b);function a(d,h,l,g,f,c,j,e,k){this.original_url=f;this.shmodel_link=j;a.__super__.constructor.call(this,d,h,l,g,c,e,k);this.fail_image_src="/static/images/preview_fail.png";if(this.is_gif()){this.thumbnail_url_tmpl=f}this.loaded=false}a.prototype.show_fail=function(d){var c;c=new Element("div").__sert(_("Unable to preview this item."));return d.__sert(c)};a.prototype.fallback=function(d){var c,f;c=$(d.target);c.writeAttribute({src:this.fail_image_src,width:128,height:128});f=c.up("div.content-item");if(f){return this.show_fail(f)}};a.prototype.is_gif=function(){return"gif"===FileOps.file_extension(this.filename).toLowerCase()};a.prototype.preload=function(e){var d,f,c,g=this;c=Util.add_qstring(this.thumbnail_url_tmpl,{size:this.image_size()});if(this.is_gif()){c=this.thumbnail_url_tmpl}f=function(){if(typeof e==="function"){e()}return g.loaded=true};Util.preload_image(c,this.fallback.bind(this),f);d=$(Util.preloaded_images[c]);d.writeAttribute("class","thumbnail");return d};a.prototype.render=function(e){var d,f,c,g;if(this.loaded){e()}d=this.preload(e);g=new Element("div").__sert(d);f=d.getAttribute("src").length;c=d.getAttribute("src").substring(f-this.fail_image_src.length,f);if(c===this.fail_image_src){this.show_fail(g)}return g};a.prototype.advance_on_click=true;a.prototype.get_more_actions_above_divider=function(e){var d,c;c=a.__super__.get_more_actions_above_divider.call(this,e);d=this.more_actions_item_tmpl({_id:"view_original",_href:this.original_url,_target:"_blank",sprite_name:"lightbox_view_original",item_text:_("View original"),more_classes:"more-actions-item"});c.push(d);return c};return a})(LightboxPreviewBase);VideoPreview=(function(a){__extends(b,a);function b(d,g,k,l,f,c,h,e,j){this.preview_url=l;this.shmodel_link=h;this._player_error=__bind(this._player_error,this);this._player_ready=__bind(this._player_ready,this);b.__super__.constructor.call(this,d,g,k,f,c,e,j);this.thumbnail_div=null}b.prototype.render_error=function(){var d,c,e;d=new Element("div");c=new Element("img",{src:"/static/images/preview_fail.png","class":"video-preview-fail"});e=new Element("div",{"class":"video-preview-fail"});e.__sert(_("Unable to preview this item."));d.__sert(c);d.__sert(e);return d};b.prototype._player_ready=function(){var c;c=function(){return $j(".vjs-big-play-button").focus()};return c.defer()};b.prototype._player_error=function(c){this.div=this.render_error();if(this.rendered){return $$("#file-preview-modal .content-item")[0].__date(this.div)}};b.prototype.preload=function(){};b.prototype.render=function(){this.div=this.render_video();return this.div};b.prototype.render_video=function(e){var g,d,c,h,f;if(!FlashDetect.installed){return this.render_error()}f=new Element("div",{"class":"video-player"});h=this.image_size().split("x")[0]*0.8;c=parseInt(h*0.55,10);g=false;d=Util.add_qstring(this.thumbnail_url_tmpl,{size:this.image_size()});VideoUtil.embed(f,{src:this.preview_url,type:"video/flv",width:h,height:c,controls:true,preload:"auto",poster:d,onError:this._player_error,onReady:this._player_ready});f.down(".video-js").setStyle({margin:"0 auto"});return f};return b})(LightboxPreviewBase);get_timeline_preview_classes=function(c){var a,b;a=(function(e){__extends(d,e);function d(f,k,h,m,j,l,n,g){this.shmodel_link=n;this.photo=g;d.__super__.constructor.call(this,f,k,h,m,j,l,this.shmodel_link,this.photo.ns_id,this.photo.ns_path);TitleBubble.set_vertical_space(3);if(Photos.in_single_collection_view()){$j("#lightbox-delete-photo").val(_("Remove"))}else{$j("#lightbox-delete-photo").val(_("Delete"))}}d.prototype.get_more_actions_above_divider=function(h){var g,f;f=d.__super__.get_more_actions_above_divider.call(this,h);g=this.more_actions_item_tmpl({_id:"lightbox_add_to_album",sprite_name:"lightbox_add_to_album",item_text:_("Add to album"),more_classes:"more-actions-item"});f.push(g);return f};d.prototype.toggle_select_button_off=function(f){if(this.is_a_photo_preview()){f.attr("title",_("Select photo"))}else{if(this.is_a_video_preview()){f.attr("title",_("Select video"))}}f.html(Sprite.make("web","lightbox_unselected"));f.removeClass("selected");f.addClass("elbboggiw");return setTimeout((function(){return f.removeClass("elbboggiw")}),540)};d.prototype.toggle_select_button_on=function(f){if(this.is_a_photo_preview()){f.attr("title",_("Un-select photo"))}else{if(this.is_a_video_preview()){f.attr("title",_("Un-select video"))}}f.html(Sprite.make("web","lightbox_selected"));f.addClass("selected");f.addClass("wiggobble");return setTimeout((function(){return f.removeClass("wiggobble")}),540)};d.prototype.toggle_select=function(g){var f;g.preventDefault();f=$j("#lightbox-select-button");TitleBubble.hide_all();if(PhotosSelection.contains(this.photo)){PhotosSelection._remove(this.photo);return this.toggle_select_button_off(f)}else{PhotosSelection._add(this.photo);return this.toggle_select_button_on(f)}};d.prototype.get_actions=function(h){var g,f,k,j=this;g=[];k=$j("<a />",{id:"lightbox_share",href:"#","class":"lightbox-button lightbox-not-important"});Lightbox.update_share_button_text(null,$j(k));k.on("click",(function(m){var l;m.preventDefault();l=PhotosSelection.get();if(l.length===0){return Foshmodal.show([j.photo],false)}else{return Foshmodal.show(PhotosSelection.get(),false)}}));f=$j("<a />",{id:"lightbox-select-button",href:"#","class":"title_bubble black",title:_("Select this photo")});if(PhotosSelection.contains(this.photo)){f.html(Sprite.make("web","lightbox_selected"))}else{f.html(Sprite.make("web","lightbox_unselected"))}f.on("click",this.toggle_select.bind(this));g.push(k[0]);g.push(f[0]);return g.concat(d.__super__.get_actions.call(this,h))};d.prototype.set_more_actions_event_handlers=function(f){var g=this;$("lightbox_add_to_album").observe("click",(function(h){h.preventDefault();return PhotosCollections.show_add_to_album_modal(h,[g.photo])}));$("lightbox_show_in_folder").observe("click",(function(h){h.preventDefault();return Photos.show_in_folder(g.photo)}));return d.__super__.set_more_actions_event_handlers.call(this,f)};d.prototype.get_more_actions_below_divider=function(h){var g,f;g=[];f=this.more_actions_item_tmpl({_id:"lightbox_show_in_folder",sprite_name:"lightbox_show_in_folder",item_text:_("Show in folder"),more_classes:"more-actions-item"});g.push(f);g=g.concat(d.__super__.get_more_actions_below_divider.call(this,h));return g};return d})(c);b=(function(e){__extends(d,e);function d(){return d.__super__.constructor.apply(this,arguments)}d.prototype.get_more_actions_below_divider=function(h){var f,g;g=[];f=this.more_actions_item_tmpl({_id:"lightbox_remove_from_album",sprite_name:"lightbox_remove_from_album",item_text:_("Remove from album"),more_classes:"more-actions-item"});g.push(f);g=g.concat(d.__super__.get_more_actions_below_divider.call(this,h));return g};d.prototype.set_more_actions_event_handlers=function(f){var g=this;$("lightbox_remove_from_album").observe("click",(function(h){h.preventDefault();return PhotosCollections.show_remove_photos_modal(Photos.get_current_collection(),[g.photo])}));return d.__super__.set_more_actions_event_handlers.call(this,f)};return d})(a);return[a,b]};_ref=get_timeline_preview_classes(PhotoPreview),AllPhotosPhotoPreview=_ref[0],SingleCollectionPhotoPreview=_ref[1];_ref1=get_timeline_preview_classes(VideoPreview),AllPhotosVideoPreview=_ref1[0],SingleCollectionVideoPreview=_ref1[1];var Lightbox;Lightbox=(function(){var r,p,U,S,I,g,f,a,w,E,Y,R,D,M,n,L,B,X,m,O,N,e,u,Q,C,h,x,y,G,c,q,F,P,W,K,o,t,d,s,H,b,j,J,z,A,l,v,k,V;S=[];r=0;I=false;U=true;z=void 0;f="lightbox";a=/^\d+\-\d+\-\d+\s+\d+\.\d+\.\d+/;g=false;Q=void 0;M=void 0;H=-1;b=null;m=function(Z){return Z.complete!==false};d=function(){var Z;if($$("#file-preview-modal .loading-image").length){return}Z=new Element("img",{"class":"loading-image",src:"/static/images/icons/ajax-loader-black.gif"});return $$("#file-preview-modal .preview-content").first().__sert(Z)};B=function(){return $$("#file-preview-modal .loading-image").invoke("remove")};y=function(){var ae,ad,ab,Z,ac,aa;ad=$$("#file-preview-modal .content-item").first().down("img.thumbnail");if(!ad||!m(ad)){return}Z=$$("#file-preview-modal .preview").first().getDimensions();ae=void 0;if(!ad.naturalHeight){ae=ad.getDimensions();ad.naturalHeight=ae.height;ad.naturalWidth=ae.width}else{ae={width:ad.naturalWidth,height:ad.naturalHeight}}ab=ae.width/Z.width;aa=ae.height/Z.height;ac=Math.max(ab,aa);ad.style.visibility="";if(ac<1){ad.style.width="";return ad.style.height=""}else{ad.style.width=Math.floor(ae.width/ac)+"px";return ad.style.height=Math.floor(ae.height/ac)+"px"}};D=void 0;N=function(){var ag,ab,af,ae,ad,aa,ac,Z;ab=$("file-preview-modal");ae=ab.down(".menu");af=ab.down(".header");ac=$$(".lightbox-not-important");Z=[];for(ad=0,aa=ac.length;ad<aa;ad++){ag=ac[ad];Z.push(ag.addClassName("opacity-zero"))}return Z};s=function(){var ad,ac,aa,ab,Z;if(D){clearTimeout(D)}ab=$$(".lightbox-not-important");Z=[];for(ac=0,aa=ab.length;ac<aa;ac++){ad=ab[ac];Z.push(ad.removeClassName("opacity-zero"))}return Z};G=function(aa){var Z;s();Z=aa&&$(aa.target).descendantOf("file-preview-menu");if(D!=null){clearTimeout(D)}if(U){if(!g&&!Z){return D=setTimeout(N,3112)}}};J=function(){if(D!=null){clearTimeout(D)}return U=false};j=function(){U=true;return G()};X=function(aa){var Z;Z=S.length;return(Z+(r+aa)%Z)%Z};C=function(aa){var Z,ab;if(Q.no_preload){return}Z=o.bind(null,aa);return typeof(ab=S[aa]).preload==="function"?ab.preload(Z):void 0};h=function(){var ab,ad,aa,ac,Z;ac=[1,2,3,4,5,6,-1,-2];Z=[];for(ad=0,aa=ac.length;ad<aa;ad++){ab=ac[ad];if(Math.abs(ab)<S.length){Z.push(C(X(ab)))}else{Z.push(void 0)}}return Z};q=function(Z){if(!Q.filename_in_url){return}if(Z!=null){return HashRouter.replace_hash("f",Z)}else{return HashRouter.replace_hash("")}};F=function(ab,ap){var ag,ah,ai,ad,Z,al,ao,an,ak,af,aa,ae,aj,am,ac,aq;H=Util.time();Lightbox.vid_player=null;assert(r<S.length,"Invalid index "+r);aj=S[r];if(typeof aj!=="object"){if(b){clearTimeout(b)}b=setTimeout((function(){if((Lightbox.shown!=null)&&Lightbox.shown){return F(ab,ap)}}),100);return}$j("#file-preview-modal").trigger("lightbox-preview",{preview:aj});al={mode:"lightbox"};UserActivityLogger.log("web","file_view",Object.toJSON(al));ae=ab?K:o;ad=aj.render(ae);ad.addClassName("content-item");an=$("file-preview-modal");am=an.down(".preview-content");am.__date(ad);q(aj.filename);aa=Q.num_previews||S.length;an.down(".lightbox-index-text-container").__date(_("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:r+1,num_total_files:aa}));if(aj.display_time){if(aj.filename.match(a)){an.down(".filename").__date(aj.display_time)}else{an.down(".filename").__date(aj.filename.snippet(20)+" - "+aj.display_time)}}else{an.down(".filename").__date(aj.filename.snippet(40))}an.down(".filename").writeAttribute("title",aj.filename);if(S.length===1){an.down(".prev").addClassName("opacity-zero");an.down(".next").addClassName("opacity-zero")}else{if(r===0&&Q.no_wrap){an.down(".prev").addClassName("opacity-zero");an.down(".next").removeClassName("opacity-zero")}else{if(r===S.length-1&&Q.no_wrap){an.down(".prev").removeClassName("opacity-zero");an.down(".next").addClassName("opacity-zero")}else{an.down(".prev").removeClassName("opacity-zero");an.down(".next").removeClassName("opacity-zero")}}}af=HTML.tmpl("lightbox_more_actions_item_tmpl");ak=aj.get_more_actions_above_divider(Q);ai=aj.get_more_actions_below_divider(Q);if(ai.length){ak.push(af({divider:true}));ak=ak.concat(ai)}$("lightbox-more-actions-list").__date(ak);aj.set_more_actions_event_handlers(Q);ah=aj.get_actions(Q);Z=document.createDocumentFragment();for(ac=0,aq=ah.length;ac<aq;ac++){ag=ah[ac];Z.appendChild(ag)}an.down(".actions").__date();an.down(".actions").appendChild(Z);document.fire(Lightbox.ACTIONS_ADDED);if(Photos.in_single_collection_view()){an.down(".album-name").show().__date(Photos.get_current_collection().name.em_snippet(15,1));an.down(".filename").addClassName("faded")}else{an.down(".album-name").hide();an.down(".filename").removeClassName("faded")}ad=ad.down("img.thumbnail");if(ad){if(!m(ad)){ad.hide();d();ad.observe("load",function(){B();ad.style.visibility="hidden";ad.show();return y()})}else{ad.show();y()}}ao={preview_obj:aj,direction:ap};return document.fire(Lightbox.PHOTO_CHANGE_EVT,ao)};W=function(ab){var Z,aa;if(H===-1){return}aa=Util.time()-H;if(typeof PhotosLogger!=="undefined"&&PhotosLogger!==null){Z=PhotosLogger.get_current_view()}else{if(typeof SharingModel!=="undefined"&&SharingModel!==null?SharingModel.is_album:void 0){Z="album_shmodel"}else{Z="not_photos"}}WebTimingLogger.log_ajax_transition(aa,ab,{current_view:Z});H=-1;return h()};K=function(){return W("file-preview-lightbox-load-initial")};o=function(Z){var aa;if(typeof Z==="number"){if((aa=S[Z])!=null){aa.loaded=true}if(Z===r){return W("file-preview-lightbox-load")}}else{return W("file-preview-lightbox-load")}};P=function(Z){var aa;aa=$j("#lightbox-click-catcher");if(!aa.length){aa=$j("<div />",{id:"lightbox-click-catcher",style:"position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 2;"});aa.appendTo("#file-preview-modal .modal-preview-content");if(($j.browser.msie!=null)&&$j.browser.msie){aa.css("background","black");aa.fadeTo(0,0)}}aa.off("click");aa.on("click",(function(ab){ab.preventDefault();return Z()}));return aa.show()};n=function(){return $j("#lightbox-click-catcher").hide()};Y=function(){var Z;Z=$("lightbox_more_actions_button");if(Z.hasClassName("toggled")){n();Z.removeClassName("toggled");$("lightbox-more-actions-menu").hide();j();return true}return false};u=function(){var Z;Z=$j("#lightbox_more_actions_button");if(!Z.hasClass("toggled")){Z.addClass("toggled");TitleBubble.hide_all();$j("#lightbox-more-actions-menu").show();J();return P(Lightbox.close_more_actions_menu)}};l=function(){if($j("#lightbox_more_actions_button").hasClass("toggled")){return Y()}else{return u()}};e=function(Z){Y();if(Z){Z.preventDefault()}if(r===S.length-1&&Q.no_wrap){return}r=X(1);if(r===0){G()}return F(null,Lightbox.NEXT)};x=function(Z){Y();if(Z){Z.preventDefault()}if(r===0&&Q.no_wrap){return}r=X(-1);return F(null,Lightbox.PREV)};E=function(Z){if(Z){Z.preventDefault()}if(S[r].advance_on_click){if(Z.clientX<document.width/10){return x()}else{return e()}}};R=function(af){var ac,ab,ae,ag,ad,aa,Z;ac=S.dict_by("fq_path");ag=void 0;if(af.memo.files){ag=af.memo.files.collect(function(ah){return ah.fq_path})}else{ag=af.memo.fq_paths}Z=[];for(ad=0,aa=ag.length;ad<aa;ad++){ae=ag[ad];if(ac[ae]){ab=S.indexOf(ac[ae]);S.splice(ab,1);if(Q.num_previews){Q.num_previews--}if(!Q.num_previews&&!S.length){Z.push(M())}else{if(ab===S.length){Z.push(x())}else{Z.push(F())}}}else{Z.push(void 0)}}return Z};c=function(Z){if(S[r].is_a_timeline_preview()){return S[r].toggle_select(Z)}};v=function(){Event.stopObserving(document,"mousemove",G);Event.stopObserving(document,"click",G);document.stopObserving(FileEvents.DELETE,R);document.stopObserving(PhotosSelection.CHANGE_EVT,k);return clearInterval(z)};M=function(ac){var aa,ab,Z;if(ac){ac.preventDefault()}if(!Lightbox.shown){return}aa=$("file-preview-modal");aa.hide();if(Lightbox.vid_player&&Lightbox.vid_player.sendEvent){Lightbox.vid_player.sendEvent("stop")}aa.down(".preview-content").__date();document.body.removeClassName("full_no_overflow");$j(document.documentElement).removeClass("full_no_overflow");v();q();Lightbox.shown=0;aa.stopObserving("click",Lightbox.back);if((ab=$$(".preview-content"))!=null){if((Z=ab.first())!=null){Z.stopObserving("click")}}if(Lightbox.reload){Browse.force_reload()}if(Tutorial.should_handle_event(Tutorial.events.browse_hide_lightbox)){return Tutorial.handle_event(Tutorial.events.browse_hide_lightbox)}};p="db:filepreview:exitselect";w=function(Z){if(Q.keep_url){M()}else{window.history.go(-1)}if(Z!=null){if(Z.originalEvent){Z=Z.originalEvent}Event.extend(Z).stop()}return document.fire(p,S[r])};O=function(){var Z;if(!I){Z=$j("#file-preview-modal");Z.on("click",".close",w);key("esc",f,(function(aa){if($j("#lightbox_more_actions_button").hasClass("toggled")){return Y()}else{if(g){return L()}else{return w(aa)}}}));Z.on("click",".next",e);Z.on("click",".prev",x);Z.on("click",".preview-container",E);key("left, k",f,function(aa){return x()});key("right, j",f,function(aa){e();return false});key("up, down",f,function(aa){return false});key("x, s, space",f,function(aa){c(aa);return false});if(Q.include_delete){key("delete, command+backspace, backspace",f,function(aa){Event.extend(aa).preventDefault();return Lightbox.toggle_delete()});$j("#lightbox-delete-photo").on("click",(function(aa){A();return S[r].delete_pressed()}));$j("#lightbox-delete-cancel").on("click",L)}DBHistory.add_exit_callback("/lightbox",function(){return M()});Util.disableSelection(Z.find(".preview-container")[0]);Util.disableSelection(Z.find(".header")[0]);I=true}Event.observe(document,"mousemove",G);Event.observe(document,"click",G);document.observe(FileEvents.DELETE,R);document.observe(PhotosSelection.CHANGE_EVT,k);key.setScope(f);return z=setInterval(y,500)};V=function(){return on_script_loaded(function(){return HashRouter.watch("f",function(Z){var ac,ad,af,ae,ab,aa;ac=decodeURIComponent(Z);aa=[];for(ad=ae=0,ab=S.length;ae<ab;ad=++ae){af=S[ad];if(af.filename.toLowerCase()===ac.toLowerCase()){r=ad;if(!Lightbox.shown){aa.push(Lightbox.show())}else{aa.push(F())}}else{aa.push(void 0)}}return aa})})};k=function(ad,af){var ab,ae,aa,ac,Z;if(af==null){af=$j("#lightbox_share")}aa=PhotosSelection.get();ac=PhotosUtil.categorize_files(aa),ab=ac[0],ae=ac[1];if(aa.length===0){af.text(_("Share"));return(Z=S[r])!=null?Z.toggle_select_button_off($j("#lightbox-select-button")):void 0}else{if(aa.length===1){if(ab){return af.text(_("Share 1 photo"))}else{return af.text(_("Share 1 video"))}}else{if(ab&&ae){return af.text(_("Share %(num_files)s items").format({num_files:aa.length}))}else{if(ab){return af.text(_("Share %(num_photos)s photos").format({num_photos:aa.length}))}else{return af.text(_("Share %(num_videos)s videos").format({num_videos:aa.length}))}}}}};t=function(){TitleBubble.hide_all();$j("#file-preview-modal .delete-file-prompt").show();s();g=true;P(Lightbox.toggle_delete);return $j("#lightbox-delete-photo").focus()};L=function(){var aa,Z;if(g){aa=$j("#file-preview-modal .delete-file-prompt");aa.hide();if((Z=aa.find(":focus")[0])!=null){Z.blur()}G();g=false;return n()}};A=function(){if(g){return L()}else{return t()}};return{init:function(Z,ab){var aa=this;if(Lightbox.shown){return}Lightbox.more_actions_button=new Element("a",{id:"lightbox_more_actions_button",href:"#","class":"lightbox_more_actions_button title_bubble black",title:_("More actions")});Lightbox.more_actions_button.observe("click",(function(ac){ac.preventDefault();return Lightbox.toggle_more_actions_menu()}));Lightbox.more_actions_button.__date(Sprite.make("web","lightbox_gear"));ab=ab||{};Q={include_delete:ab.include_delete||false,keep_url:ab.keep_url||false,num_previews:ab.num_previews||null,filename_in_url:ab.filename_in_url||false,no_wrap:(ab.no_wrap||false)||true,no_preload:ab.no_preload||false};assert(!Q.filename_in_url||Q.keep_url,"filename_in_url cannot be used with keep_url off");S=Z;if(ab.start_index!=null){Lightbox.show(ab.start_index)}if(Q.filename_in_url){V()}return $(document.body).on("click",".more-actions-item",function(ac,ad){if(ad.down("a").getAttribute("href").length<2){ac.preventDefault()}return Lightbox.close_more_actions_menu()})},update_previews:function(Z){return S=Z},show:function(Z){var aa;if(Lightbox.shown){return}assert(S&&S.length,"Lightbox.show() requires file preview objects to show");O();if(Z!=null){r=Z}$j("#file-preview-modal").trigger("lightbox-init-show",{preview:S[r]});assert(!Lightbox.shown,"Trying to reshow file preview modal");$("file-preview-modal").show();$(document.body).addClassName("full_no_overflow");$j(document.documentElement).addClass("full_no_overflow");F(true);Lightbox.shown=1;if(!Q.keep_url){aa=DBHistory.deconstruct_url(DBHistory.get_url());if(aa.path.indexOf("/lightbox/")!==0){DBHistory.push_state("/lightbox"+aa.path,aa.qargs)}}return G()},jump_to:function(Z){assert(Lightbox.shown,"Lightbox should be showing");r=Z;F();return G()},set_no_wrap:function(Z){return Q.no_wrap=Z},num_previews:function(){return Q.num_previews||S.length},close_more_actions_menu:Y,toggle_more_actions_menu:l,update_share_button_text:k,toggle_delete:A,back:w,PHOTO_CHANGE_EVT:"db:lightbox:photo_change",PHOTO_DELETE_EVT:"db:lightbox:photo_delete",PHOTO_REMOVE_FROM_ALBUM_EVT:"db:lightbox:photo_remove_from_album",ACTIONS_ADDED:"db:lightbox:actions_added",EXIT_SELECT_EVT:p,reload:false,NEXT:1,PREV:-1,vid_player:null,vid_player_loading:null,vid_player_error:null,vid_thumbnail_hidden:null}})();var Tour;Tour=(function(){var d,c,f,g,l,j,k,h,e,m,b,a;c=6;d=0;b=function(n){var w,v,u,p,o,q,s,t,r;$$(".page-end").each(Element.remove);o=n;s=c-n-1;w=document.createDocumentFragment();for(v=t=0;0<=o?t<o:t>o;v=0<=o?++t:--t){p=new Element("img",{src:"/static/images/page-left.png","class":"page-end-left page-end"});p.style.left=(28-v*5)+"px";p.style.zIndex=c-v;w.appendChild(p)}for(u=r=0;0<=s?r<s:r>s;u=0<=s?++r:--r){q=new Element("img",{src:"/static/images/page-right.png","class":"page-end-right page-end"});q.style.right=(31-u*5)+"px";q.style.zIndex=c-u;w.appendChild(q)}return $("book").appendChild(w)};a=function(n){(n>0?Element.show:Element.hide)("tour-page-back");return(n+1<c?Element.show:Element.hide)("tour-page-forward")};e=function(n){$$(".pages").invoke("hide");return $("page-"+n).show()};f=function(n){a(n);b(n);e(n);return d=n};h=function(o){var n;Event.extend(o).preventDefault();n=d-1;if(n<0){return}f(n);return DBHistory.push_state("/tour/"+n)};j=function(o){var n;Event.extend(o).preventDefault();n=d+1;if(n>=c){return}f(n);return DBHistory.push_state("/tour/"+n)};m=function(o,p){var n;o.preventDefault();n=parseInt(p.href.split("/").last(),10);f(n);return DBHistory.push_state("/tour/"+n)};l=function(){$("tour-page-back").observe("click",h);$("tour-page-forward").observe("click",j);key("right",j);key("left",h);return $("toc").on("click","a",m)};g=function(o,p){var n;n=parseInt(o,10)||0;return f(n)};k=function(){var r,q,o,p,n;p=$$(".page-right img");n=[];for(q=0,o=p.length;q<o;q++){r=p[q];n.push(Util.preload_image(r.src))}return n};return{setup:function(){return Util.smartLoad(function(){DBHistory.add_callback("/tour",g);l();return k()})}}})();var CameraUploads;CameraUploads={THUMBS_PER_ROW:5,SCROLL_OFFSET:2000,LIGHTBOX_OFFSET:30,POST_SCROLL_WAIT:100,POST_SCROLL_MAX_WAIT:300,DUPLICATES_SNIPPET_LENGTH:30,PHOTO_FILTER:"photos",VIDEO_FILTER:"videos",LOADING_SPINNER:new HTML('<div class="cu-loading"><img src="/static/images/icons/ajax-loading-small.gif" /></div>'),THUMBS_BATCH_SIZE:15,_photos:[],_key_to_photos:{},_preview_objs:[],_num_total:null,_selected_index:-1,_cursor:null,_current_filter:null,_last_scroll_timeout:null,_start_scroll_time:-1,_prev_date:null,_getting_more:false,_tmpl:null,_cu_duplicate_tmpl:null,_flow:false,_more_endpoint:"",_count_endpoint:"",_uniqueness_key_to_index_of_photo_in_event:{},_photo_grid:{},init:function(f,b,e,c,a,d){if(d){CameraUploads._more_endpoint="/more_pm";CameraUploads._count_endpoint="/pm_count"}else{CameraUploads._more_endpoint="/more_cu";CameraUploads._count_endpoint="/cu_count"}CameraUploads._flow=a;return on_script_loaded(function(){CameraUploads._tmpl=HTML.tmpl("cu_list_item_tmpl");CameraUploads._cu_duplicate_tmpl=HTML.tmpl("cu_duplicate_list_item_tmpl");if(b){CameraUploads._cursor=e}else{CameraUploads._cursor=null}if(c===CameraUploads.PHOTO_FILTER||c===CameraUploads.VIDEO_FILTER){CameraUploads._set_filter(c)}if(!HTML5_HISTORY&&!Util.url_hash()){DBHistory.push_state("/camera",{})}CameraUploads._render(f);CameraUploads._listen();return CameraUploads._get_num_total()})},_listen:function(){$(document.body).on("click",".cu-thumb",CameraUploads._thumb_click);document.observe(Lightbox.PHOTO_CHANGE_EVT,CameraUploads._lightbox_event);document.observe(Lightbox.PHOTO_DELETE_EVT,CameraUploads._lightbox_delete);document.observe(Lightbox.EXIT_SELECT_EVT,CameraUploads._lightbox_exit);document.observe(FileEvents.DELETE,CameraUploads._remove);Event.observe(window,"scroll",CameraUploads._window_scroll);DBHistory.add_callback("/camera",CameraUploads._history_change_handler);return document.on("click",".filter-option",function(c,b){var a;c.preventDefault();a=b.readAttribute("data-filter");return CameraUploads._filter(a)})},_render:function(f){var d,b,a,e,c;if(!f.length){a=void 0;if(CameraUploads._current_filter===CameraUploads.PHOTO_FILTER){a=_("photos")}else{if(CameraUploads._current_filter===CameraUploads.VIDEO_FILTER){a=_("videos")}else{a=_("photos or videos")}}DomUtil.fillVal(a,"file-types");$("cu-empty").show();return}b=[];c=void 0;d=void 0;e=void 0;CameraUploads._update_key_to_photos(f);if(CameraUploads._prev_date){c=CameraUploads._prev_date}else{c=new Date(f[0].time_taken);b.push(CameraUploads._generate_month_header(c))}f.each(function(g){e=CameraUploads._get_newest(g.uniqueness_key);if(CameraUploads._photos.indexOf(e)===-1){d=new Date(e.time_taken);if(d.getMonth()!==c.getMonth()||d.getFullYear()!==c.getFullYear()){b.push(CameraUploads._generate_month_header(d))}b.push(CameraUploads._tmpl({photo:e,display_date:Util.niceDateWithMonthName(d,d.getFullYear()<new Date().getFullYear()),shareable:false}));CameraUploads._photos.push(e);CameraUploads._preview_objs.push(CameraUploads._get_preview_obj(e));return c=d}});CameraUploads._prev_date=c;if(CameraUploads._cursor){b.push(CameraUploads.LOADING_SPINNER)}$("photos-list").__sert(b);CameraUploads._update_grid();if(CameraUploads._num_total){CameraUploads._set_lightbox_wrap()}CameraUploads._load_visible_thumbs();if(CameraUploads._flow){return $$(".cu-thumb").each(function(g){return g.setStyle({width:"auto"})})}},_update_grid:function(){var b,n,a,r,j,f,m,o,q,l,k,g,e,p,h,d,c;a=$("photos-list").childElements();q=$$(".cu-thumb");l=q.first().getLayout().get("margin-box-height");o=$$(".cu-month-header").first().getLayout().get("margin-box-height");r=q.first().cumulativeOffset();k=r.top;m=r.left;b=0;j=void 0;CameraUploads._photo_grid.thumb_height=l;CameraUploads._photo_grid.height_to_photo={};CameraUploads._photo_grid.photo_heights=[];CameraUploads._photo_grid.left_offsets=[];for(j=g=0,h=CameraUploads.THUMBS_PER_ROW;0<=h?g<=h:g>=h;j=0<=h?++g:--g){CameraUploads._photo_grid.left_offsets.push(m+l*j)}CameraUploads._photo_grid.height_to_photo[k]=null;CameraUploads._photo_grid.photo_heights.push(k);f=-1;d=a.slice(1);c=[];for(e=0,p=d.length;e<p;e++){n=d[e];if(n.hasClassName("cu-month-header")){b=0;k+=o;CameraUploads._photo_grid.height_to_photo[k]=null;CameraUploads._photo_grid.photo_heights.push(k);f=-1}else{if(n.hasClassName("cu-thumb")){f++;this._uniqueness_key_to_index_of_photo_in_event[n.id]=f;if(b===0){k+=l;b++;CameraUploads._photo_grid.height_to_photo[k]={uniqueness_key:n.id,num_photos:1};CameraUploads._photo_grid.photo_heights.push(k)}else{b++;CameraUploads._photo_grid.height_to_photo[k].num_photos++;if(b>=CameraUploads.THUMBS_PER_ROW){b=0}}}}c.push(j++)}return c},_reset:function(){CameraUploads._photos=[];CameraUploads._key_to_photos={};CameraUploads._preview_objs=[];CameraUploads._num_total=null;CameraUploads._cursor=null;CameraUploads._set_filter(null);CameraUploads._last_scroll_timeout=null;CameraUploads._start_scroll_time=-1;CameraUploads._prev_date=null;CameraUploads._getting_more=false;$("photos-list").__date();return $("cu-empty").hide()},_get_thumb_elm_for_photo:function(a){return $(a.uniqueness_key)},_get_photo_for_thumb_elm:function(a){if(!a.hasClassName("cu-thumb")){a=a.up(".cu-thumb")}if(a){return CameraUploads._get_newest(a.identify())}else{return null}},_update_key_to_photos:function(a){return a.each(function(b){if(CameraUploads._key_to_photos[b.uniqueness_key]){return CameraUploads._key_to_photos[b.uniqueness_key].push(b)}else{return CameraUploads._key_to_photos[b.uniqueness_key]=[b]}})},_get_newest:function(c){var f,g,b,e,a,d;g=CameraUploads._key_to_photos[c];if(g.length===0){}else{if(g.length===1){return g[0]}else{b=g[0];d=g.slice(1);for(e=0,a=d.length;e<a;e++){f=d[e];if(f.mtime>b.mtime){b=f}}return b}}},_thumb_click:function(c){var b,a;a=CameraUploads._get_photo_for_thumb_elm($(c.target));CameraUploads._preview(CameraUploads._photos.indexOf(a));b={timeline_photo_index:CameraUploads._photos.indexOf(a),event_photo_index:CameraUploads._uniqueness_key_to_index_of_photo_in_event[a.uniqueness_key]};return PhotosLogger.log_interaction(PhotosEvents.OPEN_LIGHTBOX,"camera_uploads_page_click",b)},_preview:function(a){if(CameraUploads._num_total){return Lightbox.show(a)}else{return setTimeout((function(){return CameraUploads._preview(a)}),100)}},_get_num_total:function(){return new Ajax.DBRequest(CameraUploads._count_endpoint,{parameters:{filter:CameraUploads._current_filter},onSuccess:function(a){CameraUploads._num_total=a.responseText;Lightbox.init(CameraUploads._preview_objs,{include_delete:true,num_previews:CameraUploads._num_total});return CameraUploads._set_lightbox_wrap()}})},_set_lightbox_wrap:function(){if(CameraUploads._cursor){return Lightbox.set_no_wrap(true)}else{return Lightbox.set_no_wrap(false)}},_window_scroll:function(){var d,a,c,b;a=new Date().getTime();if(CameraUploads._start_scroll_time===-1||a-CameraUploads._start_scroll_time<CameraUploads.POST_SCROLL_MAX_WAIT){clearTimeout(CameraUploads._last_scroll_timeout)}if(CameraUploads._start_scroll_time===-1){CameraUploads._start_scroll_time=a}CameraUploads._last_scroll_timeout=setTimeout(CameraUploads._load_visible_thumbs,CameraUploads.POST_SCROLL_WAIT);if(CameraUploads._cursor){b=Util.scroll_offsets().top;c=Util.viewport_dimensions().height;d=document.body.getHeight();if(b+c+CameraUploads.SCROLL_OFFSET>=d){return CameraUploads._get_more()}}},_load_visible_thumbs:function(p){var b,o,n,k,m,l,j,c,q,f,g,a,t,s,d,r,h;CameraUploads._start_scroll_time=-1;if(!CameraUploads._photos.length){return}g=$$(".cu-thumb");s=Util.scroll_offsets().top;t=Util.viewport_dimensions().height;k=void 0;c=void 0;m=void 0;q=void 0;n=void 0;j=void 0;h=CameraUploads._photo_grid.photo_heights;for(d=0,r=h.length;d<r;d++){l=h[d];o=CameraUploads._photo_grid.height_to_photo[l];if(o!==null){a=g.indexOf($(o.uniqueness_key));if(l>s-t&&l<s){if(!(k!=null)){k=a}c=a+o.num_photos-1}else{if(l>s&&l<s+t){if(!(m!=null)){m=a}q=a+o.num_photos-1}else{if(l>s+t&&l<s+3*t){if(!(n!=null)){n=a}j=a+o.num_photos-1}}}}}b=[];[[m,q],[n,j],[k,c]].each(function(x){var v,w,e,y,u;u=[];for(v=w=e=x[0],y=x[1];e<=y?w<=y:w>=y;v=e<=y?++w:--w){u.push(b.push(g[v].down("img")))}return u});f=function(e){return e.up(".cu-thumb").addClassName("thumb-loaded")};return BatchThumbLoader.batch_load_thumbs(b,this.THUMBS_BATCH_SIZE,f)},_lightbox_event:function(a){CameraUploads._selected_index=CameraUploads._preview_objs.indexOf(a.memo.preview_obj);if(CameraUploads._cursor&&CameraUploads._selected_index>CameraUploads._preview_objs.length-CameraUploads.LIGHTBOX_OFFSET){return CameraUploads._get_more()}},_lightbox_delete:function(a){var d,c,b;d=CameraUploads._preview_objs.indexOf(a.memo);c=CameraUploads._photos[d];b=CameraUploads._key_to_photos[c.uniqueness_key];assert(b.length,"No key_to_photos entry for cu photo");if(b.length===1){return FileOps.do_nonbrowse_delete([c.path])}else{return CameraUploads._show_duplicates_delete_modal(b)}},_lightbox_exit:function(a){return key.setScope("all")},_history_change_handler:function(b,c){var a;a=c.filter;if(a===CameraUploads.PHOTO_FILTER||a===CameraUploads.VIDEO_FILTER){if(a!==CameraUploads._current_filter){CameraUploads._reset();CameraUploads._set_filter(a);CameraUploads._get_more()}}else{if(CameraUploads._current_filter){CameraUploads._reset();CameraUploads._set_filter(null);CameraUploads._get_more()}}if(CameraUploads._selected_index>-1){CameraUploads._scroll_to_thumb(CameraUploads._selected_index);return CameraUploads._selected_index=-1}},_show_duplicates_delete_modal:function(d){var c,b,a;d.sort(function(f,e){return e.mtime-f.mtime});b=$("cu-duplicate-files");a=[];c=void 0;d.each(function(e){c="Dropbox"+Util.normalize(Util.parentDir(e.path));return a.push(CameraUploads._cu_duplicate_tmpl({thumbnail_url:e.thumbnail_url,filename_snippet:e.filename.em_snippet(CameraUploads.DUPLICATES_SNIPPET_LENGTH),path_snippet:c.em_snippet(CameraUploads.DUPLICATES_SNIPPET_LENGTH,0),path_href:Photos._get_browse_link(e)}))});b.__date(a);if(d.length>=5){b.addClassName("scroll")}else{b.removeClassName("scroll")}return Modal.icon_show("delete_32",_("Delete all copies of this file?"),$("cu-delete-modal"),{photos:d})},delete_all_duplicates:function(){var a;a=Modal.vars.photos.collect(function(b){return b.path});return FileOps.do_nonbrowse_delete(a)},_remove:function(b){var d,a,c;c=b.memo.fq_paths;if(c.length===1){a=c[0];d=false;if(Modal.vars.photos){Modal.vars.photos.each(function(e){if(e.path===a){CameraUploads._remove_photo_with_duplicates(e);return d=true}})}if(!d){return CameraUploads._remove_photo(a)}}else{return c.each(function(e){return CameraUploads._remove_photo(e)})}},_remove_photo:function(f){var c,b,e,a,d;d=CameraUploads._photos;for(c=e=0,a=d.length;e<a;c=++e){b=d[c];if(b.path===f){CameraUploads._photos.splice(c,1);$$(".cu-thumb")[c].remove();return}}},_remove_photo_with_duplicates:function(a){var e,c,d,b;e=CameraUploads._key_to_photos[a.uniqueness_key];e.removeItem(a);assert(e.length,"Photo has no duplicates");c=CameraUploads._photos.indexOf(a);if(c!==-1){d=CameraUploads._get_newest(a.uniqueness_key);b=new HTML('<img src="'+d.thumbnail_url+'" class="cu-thumb" />');CameraUploads._photos[c]=d;$$(".cu-thumb")[c].__sert({after:b});$$(".cu-thumb")[c].remove();CameraUploads._preview_objs.splice(c,0,CameraUploads._get_preview_obj(d));if(CameraUploads._preview_objs.length===CameraUploads._photos.length){return Lightbox.jump_to(c)}else{return Lightbox.jump_to(c+1)}}},_set_filter:function(b){var a;CameraUploads._current_filter=b;a=void 0;if(b===CameraUploads.PHOTO_FILTER){a=_("Photos only")}else{if(b===CameraUploads.VIDEO_FILTER){a=_("Videos only")}else{a=_("Photos and videos")}}return $$(".current-filter")[0].__date(a)},_filter:function(b){var a;a=DBHistory.deconstruct_url();if(b===CameraUploads.PHOTO_FILTER||b===CameraUploads.VIDEO_FILTER){a.qargs.filter=b}else{delete a.qargs.filter}return DBHistory.push_state(a.path,a.qargs)},_get_more:function(){if(CameraUploads._getting_more){return}CameraUploads._getting_more=true;return new Ajax.DBRequest(CameraUploads._more_endpoint,{parameters:{cursor:CameraUploads._cursor,filter:CameraUploads._current_filter},onSuccess:function(a){var b;if($$(".cu-loading")){$$(".cu-loading").invoke("remove")}b=Util.from_json(a.responseText);if(b.more){CameraUploads._cursor=b.cursor}else{CameraUploads._cursor=null}CameraUploads._render(b.photos);CameraUploads._getting_more=false;if(!CameraUploads._num_total){return CameraUploads._get_num_total()}}})},_get_preview_obj:function(a){if(a.preview_type==="photo"&&a.large_thumbnail_url){return new PhotoPreview(a.filename,a.path,a.large_thumbnail_url,a.href+"&dl=1",a.href,a.display_time_taken,null,a.ns_id,a.ns_path)}else{if(a.preview_type==="video"&&a.large_thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){return new VideoPreview(a.filename,a.path,a.large_thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+a.block_hash+(Util.urlquote(a.path)),a.href+"&dl=1",a.display_time_taken,a.ns_id,a.ns_path)}}return null},_generate_month_header:function(a){return new HTML('<h1 class="cu-month-header">'+_("%(month)s %(year)s").format({month:Util.month_name(a.getMonth()),year:a.getFullYear()})+"</h1>")},_scroll_to_thumb:function(b){var a;a=$$(".cu-thumb")[b];if(!a){return}Util.scroll_to_thumb(a);return CameraUploads._load_visible_thumbs()},reflow:function(){var g,c,n,p,q,d,m,b,a,f,l,k,o,e,h;n=800;g=10;c=150;f=$$(".cu-thumb");p=[];d=0;q=void 0;h=[];for(l=0,o=f.length;l<o;l++){q=f[l];if(d+q.width+g>n){if(d-n<q.width/2){p.push(q);d+=q.width+g;b=c*(n-g*p.length)/(d-g*p.length)-1;m=0;for(k=0,e=p.length;k<e;k++){a=p[k];a.setStyle({height:b+"px"})}p=[];h.push(d=0)}else{CameraUploads._adjust_row_height(p,d);p=[q];h.push(d=q.width+g)}}else{p.push(q);h.push(d+=q.width+g)}}return h}};var Photos,PhotosTour,PhotosUtil,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};Photos={LIGHTBOX_OFFSET:25,DUPLICATES_SNIPPET_LENGTH:30,KEY_SCOPE:"photos",PHOTO_TYPE:"photos",VIDEO_TYPE:"videos",NUM_PHOTOS_LONG_RUNNING_DELETES:100,NUM_PHOTOS_LONG_RUNNING_EDIT_TIMESTAMP:200,_all_photos_timeline:null,_single_collection_timeline:null,_last_lightbox_index:-1,_current_filters:{},_current_collection_gid:null,_in_all_collections_view:false,_tmpl:null,_cu_duplicate_tmpl:null,_creating_filetags:false,_creating_filetags_cb:null,_is_all_photos:false,event_metadata_cache:{},scroll_count:0,initialized:false,init:function(b,p,q,l,f,h,m,a,e,n,o,t,r,d,s){var j,c,g,k;this.local_storage_enabled=n;this.event_metadata_cache=o;this.can_edit_timestamps=r;this.undo_enabled=d;this.include_shared_folders=s;this.initialized=true;this.disable_selection();Util.disable_ie_image_dragging();this._tmpl=HTML.tmpl("cu_list_item_tmpl");this._cu_duplicate_tmpl=HTML.tmpl("cu_duplicate_list_item_tmpl");this._set_filters(f);this._current_collection_gid=h!=null?h.gid:void 0;this._is_all_photos=a;key.setScope(this.KEY_SCOPE);c=DBHistory.deconstruct_url();if("share" in c.qargs){for(g in l){if(l.hasOwnProperty(g)){PhotosSelection.inc_num_loading_events_before_share()}}}this._init_timeline(b,p,q,l);this._init_lightbox();j=h!=null?[h]:[];PhotosCollections.init(j,m);PhotosSelection.drag_select_enabled=e;if("m" in c.qargs||t){PhotosTour.next()}delete c.qargs.selr;delete c.qargs.share;delete c.qargs.m;if("uuid" in c.qargs){delete c.qargs.uuid;delete c.qargs.id}if(HTML5_HISTORY){DBHistory.replace_state(c.path,c.qargs)}else{if(!Util.url_hash()){k=this._is_all_photos?"/photos":"/camera";DBHistory.push_state(k,c.qargs)}}return this._listen()},_listen:function(){var a=this;$(document.body).on("click",".cu-thumb",this._thumb_click.bind(this));$(document.body).on("dblclick",".cu-thumb",this._thumb_double_click.bind(this));$(document.body).on("contextmenu",".cu-thumb",this._thumb_context_menu.bind(this));document.observe(Lightbox.PHOTO_CHANGE_EVT,this._lightbox_photo_change.bind(this));document.observe(Lightbox.PHOTO_DELETE_EVT,this._lightbox_delete.bind(this));document.observe(Lightbox.PHOTO_REMOVE_FROM_ALBUM_EVT,this._lightbox_remove.bind(this));document.observe(Lightbox.EXIT_SELECT_EVT,this._lightbox_exit.bind(this));document.observe(ContextMenu.HIDE_EVT,this._context_menu_hide.bind(this));Event.observe(window,"resize",this._window_resize.bind(this));DBHistory.add_callback((this._is_all_photos?"/photos":"/camera"),this._history_change_handler.bind(this));document.on("click",".filter-option",function(d,c){var b;d.preventDefault();b=c.readAttribute("data-filter");return a._filter_type(b)});$j("#photos-nav-item").on("click",this._clear_filters.bind(this));$j("#back-to-photos").on("click",this._back_to_photos.bind(this));$j("#back-to-albums").on("click",this._back_to_albums.bind(this));$j("#share-selected").on("click",this._share_selected.bind(this));$j("#clear-selected").on("click",this._clear_selected.bind(this));$j("#share-collection").on("click",this._share_collection.bind(this));if(this.include_shared_folders){$j("#do-include-shared-folders").attr("checked","checked")}else{$j("#dont-include-shared-folders").attr("checked","checked")}$j("input[name=shared-folder-pref]").on("change",this._change_memory_lane_settings.bind(this));PhotosCollections.listen();PhotosSelection.listen();$(document.body).on("click",".event-select",this._select_event.bind(this));$(document.body).on("click",".event-share",this._share_event.bind(this));return $(document.body).on("click",".event-add-to-album",this._add_event_to_album.bind(this))},_select_event:function(j){var d,h,c,g,b,f,a;h=$(j.target).up(".cu-month-header").identify().slice(2);d=this.get_timeline().events.valueFromKey(h);f=d.photos;a=[];for(g=0,b=f.length;g<b;g++){c=f[g];a.push(PhotosSelection._add(c))}return a},_share_event:function(h){var c,g,b,f,a,d;g=$(h.target).up(".cu-month-header").identify().slice(2);c=this.get_timeline().events.valueFromKey(g);d=c.photos;for(f=0,a=d.length;f<a;f++){b=d[f];PhotosSelection._add(b)}return this._share_selected()},_add_event_to_album:function(h){var c,g,b,f,a,d;g=$(h.target).up(".cu-month-header").identify().slice(2);c=this.get_timeline().events.valueFromKey(g);d=c.photos;for(f=0,a=d.length;f<a;f++){b=d[f];PhotosSelection._add(b)}return PhotosCollections.show_add_to_album_modal(h,PhotosSelection.get())},_init_timeline:function(f,b,c,j){var a,g,k,h,e,d;if(!f.length){this.set_empty_state();return}a=this.in_single_collection_view()?$("single-collection-list"):$("photos-list");h=$("cu-view").cumulativeOffset().top+a.getLayout().get("margin-top")+a.getLayout().get("padding-top");g=$("cu-view").cumulativeOffset().left+a.getLayout().get("margin-left")+a.getLayout().get("padding-left");k=new PhotoTimeline(a,h,g,f,b,c,j,this._current_filters,this._tmpl);if(this.in_single_collection_view()){if((e=this._single_collection_timeline)!=null){e.unlisten()}this._single_collection_timeline=k}else{if((d=this._all_photos_timeline)!=null){d.unlisten()}this._all_photos_timeline=k}return this.get_timeline().render()},_init_lightbox:function(){if(this.get_timeline()==null){return}if(Lightbox.shown){return Lightbox.update_previews(this.get_timeline().preview_objs)}else{return Lightbox.init(this.get_timeline().preview_objs,{include_delete:true,no_wrap:true})}},_refresh_view:function(b){var a;if((a=this.get_timeline())!=null){a.unlisten()}PhotosSelection.clear();$("cu-empty").hide();$("single-album-empty").hide();if(this.in_single_collection_view()){$("single-collection-list").__date()}this._refresh_photo_events(b);return window.scrollTo(0,0)},_refresh_photo_events:function(b){var a=this;this.event_metadata_cache=null;return new Ajax.DBRequest("/photos_events",{parameters:{filters:Util.to_json(this._current_filters),collection_gid:this._current_collection_gid,is_all_photos:this._is_all_photos,include_shared_folders:this.include_shared_folders},onSuccess:function(c){var d;d=Util.from_json(c.responseText);if(d==="deleted_collection"){a._current_collection_gid=null;PhotosCollections.reload();a.show_all_collections();Notify.server_error(_("This album has been deleted!"));return}a._init_timeline(d.header_ids,d.header_id_to_name,d.header_id_to_num_photos,{});a._init_lightbox();return typeof b==="function"?b():void 0}})},set_empty_state:function(){var a;if(this._current_filters.file_type===this.PHOTO_TYPE){a=_("photos")}else{if(this._current_filters.file_type===this.VIDEO_TYPE){a=_("videos")}else{a=_("photos or videos")}}DomUtil.fillVal(a,"file-types");return $("cu-empty").show()},hide_empty_state:function(){return $("cu-empty").hide()},get_timeline:function(){if(this.in_single_collection_view()){return this._single_collection_timeline}else{return this._all_photos_timeline}},show_in_folder:function(a){var b;if(a.uniqueness_key in this.get_timeline().key_to_duplicates){b=this.get_timeline().key_to_duplicates[a.uniqueness_key];return this._show_duplicates_modal(a,b,false)}else{return window.open(this._get_browse_link(a),"_blank")}},_get_browse_link:function(a){return"/home"+(Util.urlquote(Util.normalize(Util.parentDir(a.path))))+"?select="+(Util.urlquote(a.filename))},in_single_collection_view:function(){return this._current_collection_gid!=null},in_all_collections_view:function(){return this._in_all_collections_view},get_current_collection:function(){if(this._current_collection_gid!=null){return PhotosCollections.get(this._current_collection_gid)}else{return null}},enable_selection:function(){return Util.enableSelection($(document.body))},disable_selection:function(){return Util.disableSelection($(document.body))},_set_filters:function(b){var a;this._current_filters=b;if(b.file_type===this.PHOTO_TYPE){a=_("Photos only")}else{if(b.file_type===this.VIDEO_TYPE){a=_("Videos only")}else{a=_("Photos and videos")}}return $$(".current-filter")[0].__date(a)},_filter_type:function(a){var b;b=DBHistory.deconstruct_url();if(a===this.PHOTO_TYPE||a===this.VIDEO_TYPE){b.qargs.file_type=a}else{delete b.qargs.file_type}return DBHistory.push_state(b.path,b.qargs)},show_collection:function(c){var b,a;PhotosLogger.log_transition_to(PhotosViews.SINGLE_COLLECTION_VIEW);a=DBHistory.deconstruct_url();b="/lightbox";if(a.path.indexOf(b)===0){a.path=a.path.slice(b.length);key.setScope(this.KEY_SCOPE);this._last_lightbox_index=-1}if(a.qargs.album==null){if(a.qargs.all_albums!=null){$("back-to-photos").hide();$("back-to-albums").show()}else{$("back-to-albums").hide();$("back-to-photos").show()}}delete a.qargs.all_albums;if(c!=null){a.qargs.album=c}else{delete a.qargs.album}return DBHistory.push_state(a.path,a.qargs)},show_all_collections:function(){var a;PhotosLogger.log_transition_to(PhotosViews.ALBUMS_VIEW);a=DBHistory.deconstruct_url();delete a.qargs.album;a.qargs.all_albums="";return DBHistory.push_state(a.path,a.qargs)},_clear_filters:function(c){var b,a;c.preventDefault();PhotosLogger.log_transition_to(PhotosViews.PHOTOS_VIEW);a=DBHistory.deconstruct_url();if(((function(){var d;d=[];for(b in a.qargs){d.push(b)}return d})()).length){PhotosSelection.clear();return DBHistory.push_state(a.path)}else{return this._refresh_view()}},_back_to_photos:function(a){PhotosSelection.clear();return this._clear_filters(a)},_back_to_albums:function(a){PhotosSelection.clear();return this.show_all_collections()},get_thumb_click_event_data:function(c,a){var b;b=this.get_timeline().get_event_for_photo(c,a);return{timeline_photo_index:a,event_photo_index:b.photos.indexOf(c),num_photos_in_event:b.num_photos,event_index:this.get_timeline().events.list.indexOf(b.unique_id),num_events:this.get_timeline().events.list.length}},_thumb_click:function(b){var a;a=this.get_timeline().get_photo_for_thumb_elm($(b.target));if(PhotosSelection._drag_drop.ignore_next_click){return PhotosSelection._drag_drop.ignore_next_click=false}else{return PhotosSelection.photo_click(b,a)}},_thumb_double_click:function(d){var c,b,a;b=this.get_timeline().get_photo_for_thumb_elm($(d.target));a=this.get_timeline().photos.indexOf(b);this._preview(a);c=this.get_thumb_click_event_data(b,a);return PhotosLogger.log_interaction(PhotosEvents.OPEN_LIGHTBOX,PhotosTriggers.DBL_CLICK,c)},_thumb_context_menu:function(f){var b,g,d,a,c;b=this.get_timeline().get_photo_for_thumb_elm($(f.target));if(f.shiftKey){PhotosSelection.photo_click(f,b);return}if(PhotosSelection.contains(b)){g=PhotosSelection.get()}else{g=[b]}ContextMenu.show_photos(f,g);for(d=0,a=g.length;d<a;d++){b=g[d];if((c=this.get_timeline().get_thumb_elm_for_photo(b))!=null){c.addClassName("context-selected")}}if(g.length<=PhotosCollections.NUM_PHOTOS_LONG_RUNNING_ADDS&&!Photos._is_all_photos){return this._async_create_filetags(g)}},_context_menu_hide:function(a){$$(".cu-thumb.context-selected").invoke("removeClassName","context-selected");return $$(".photo-collection.context-selected").invoke("removeClassName","context-selected")},_share_selected:function(b){var a;a=PhotosSelection.get();if(a.length<=PhotosCollections.NUM_PHOTOS_LONG_RUNNING_ADDS&&!Photos._is_all_photos){this._async_create_filetags(a)}if(!a.length){return}Foshmodal.show(a,false);return PhotosLogger.log_interaction(PhotosEvents.SHARE,PhotosTriggers.SAH,{num_photos:a.length})},_clear_selected:function(b){var a;a=PhotosSelection.get().length;PhotosSelection.clear();return PhotosLogger.log_interaction(PhotosEvents.CLEAR_SELECTED,PhotosTriggers.SAH,{num_photos:a})},_share_collection:function(b){var a;assert(this.in_single_collection_view(),"_share_collection can only happen in single collection view");a=this.get_current_collection();if(a.num_photos===0){Notify.server_error(_("This album is empty. Add some photos before you share it!"));return}Foshmodal.show(this.get_current_collection(),true);return PhotosLogger.log_interaction(PhotosEvents.SHARE_ALBUM,PhotosTriggers.SCA)},toggle_mem_lane_settings:function(a){var c,b;if(a){Event.extend(a).preventDefault()}if(!$j("#memory-lane-settings-menu").visible()){b=$j("#memory-lane-settings-menu");if(($j.browser.msie!=null)&&$j.browser.msie){if(!b.parent().is("body")){$j(document.body).append(b.remove())}}FreshDropdown.show($("memory-lane-settings-menu"),$("memory-lane-settings-button"));c=function(d){return d.stopPropagation()};b.off("mousedown");b.off("click");b.on("mousedown",c);return b.on("click",c)}},_change_memory_lane_settings:function(){var a=this;FreshDropdown.hide_all();this.include_shared_folders=$j("#do-include-shared-folders").is(":checked");return new Ajax.DBRequest("/toggle_shared_folder_pref",{parameters:{value:this.include_shared_folders},onSuccess:function(e){var d,h,j,c,g,b,f;if(a.include_shared_folders){Notify.server_success(_("All photos and videos in your Dropbox are now shown."))}else{Notify.server_success(_("Photos and videos from shared folders you joined are no                                    longer shown."))}h=null;c=Util.get_viewport();j=c.top+a.get_timeline().top_offset;f=a.get_timeline().events.getValues();for(g=0,b=f.length;g<b;g++){d=f[g];h=d.unique_id;if((d.top_offset>=j)||(d.top_offset+d.height>=c.bottom)){break}}return a._refresh_photo_events(function(){var m,n,l,k;if(__indexOf.call(a.get_timeline().events.list,h)<0){m=h;k=a.get_timeline().events.list;for(n=0,l=k.length;n<l;n++){h=k[n];if(h<m){break}}}d=a.get_timeline().events.valueFromKey(h);return Util.scroll_to(0,d.top_offset-a.get_timeline().top_offset)})}})},show_delete_photos_modal:function(j){var k,f,c,g,a,b,d,h,e;if(j.length===1){b=j[0];if(b.uniqueness_key in this.get_timeline().key_to_duplicates){f=this.get_timeline().key_to_duplicates[b.uniqueness_key];this._show_duplicates_modal(b,f,true);return}}else{k=[];for(d=0,h=j.length;d<h;d++){b=j[d];if(b.uniqueness_key in this.get_timeline().key_to_duplicates){f=this.get_timeline().key_to_duplicates[b.uniqueness_key].slice(0);f.push(b);f.sort(function(m,l){return l.mtime-m.mtime});k=k.concat(f)}}if(k.length){this._show_delete_multiple_duplicates_modal(j,k);return}}e=PhotosUtil.categorize_files(j),g=e[0],a=e[1];if(g&&a){c=ungettext("Delete %(file_count)s file?","Delete %(file_count)s files?",j.length)}else{if(g){c=ungettext("Delete %(file_count)s photo?","Delete %(file_count)s photos?",j.length)}else{c=ungettext("Delete %(file_count)s video?","Delete %(file_count)s videos?",j.length)}}c=c.format({file_count:j.length});DomUtil.fillVal(PhotosUtil.file_desc(j),"delete_filename");return Modal.icon_show("delete_32",c,DomUtil.fromElm("delete-file"),{action:this._delete_photos.curry(j),wit_group:"delete-confirm"})},_delete_photos:function(r){var n,k,d,g,o,a,b,q,j,f,e,p,c,h,l,m=this;r=r.slice(0);q=[];for(f=0,p=r.length;f<p;f++){b=r[f];q.push(b.path);if(b.uniqueness_key in Photos.get_timeline().key_to_duplicates){g=Photos.get_timeline().key_to_duplicates[b.uniqueness_key];for(e=0,c=g.length;e<c;e++){d=g[e];q.push(d.path)}}}h=PhotosUtil.categorize_files(r),o=h[0],a=h[1];if(o&&a){k=ungettext("Deleting file","Deleting files",q.length);n=ungettext("Deleted file.","Deleted files.",q.length)}else{if(o){k=ungettext("Deleting photo","Deleting photos",q.length);n=ungettext("Deleted photo.","Deleted photos.",q.length)}else{k=ungettext("Deleting video","Deleting videos",q.length);n=ungettext("Deleted video.","Deleted videos.",q.length)}}l=function(s){return new Ajax.DBRequest("/cmd/rollback",{parameters:{ns_to_cs:Util.to_json(s)},html_in_error_msg:true,progress_text:_("Undoing..."),onSuccess:function(t){var u;u=_("Undo complete");Notify.server_success(u);return Photos._all_photos_timeline.restore_removed_photos()}})};j=function(s){return new Ajax.DBRequest("/cmd/delete",{parameters:{files:q},job:q.length>Photos.NUM_PHOTOS_LONG_RUNNING_DELETES,progress_text:k,onSuccess:function(v){var t,w,u;w=v.responseText.evalJSON();u=Photos.undo_enabled&&(Photos._all_photos_timeline!=null);t=u?w.changesets:null;Notify.server_success(n,null,null,t,l);Photos.get_timeline().remove_photos(r);if(s.length>0){return PhotosCollections.refresh_album_views(s)}}})};return new Ajax.DBRequest("/collections_from_paths",{parameters:{fq_paths:Util.to_json(q)},onSuccess:function(u){var t,s,v,w;s=Util.from_json(u.responseText);v=[];for(w in s){t=s[w];v=v.concat(t)}return j(v)}})},_preview:function(a){return Lightbox.show(a)},_lightbox_delete:function(a){var c,b;c=this.get_timeline().preview_objs.indexOf(a.memo);b=this.get_timeline().photos[c];PhotosLogger.log_interaction(PhotosEvents.DELETE,PhotosTriggers.LIGHTBOX);return this.show_delete_photos_modal([b])},_lightbox_remove:function(c){var b,a;b=this.get_timeline().preview_objs.indexOf(c.memo);a=this.get_timeline().photos[b];PhotosCollections.remove_photos(this.get_current_collection(),[a]);return PhotosLogger.log_interaction(PhotosEvents.REMOVE,PhotosTriggers.LIGHTBOX)},_show_duplicates_modal:function(b,k,r){var j,q,g,l,d,n,c,h,m,a,p,e,o,f;k=k.slice(0);k.push(b);k.sort(function(t,s){return s.mtime-t.mtime});l=$("cu-duplicate-files");d=[];for(e=0,o=k.length;e<o;e++){g=k[e];q="Dropbox"+Util.normalize(Util.parentDir(g.path));d.push(this._cu_duplicate_tmpl({thumbnail_url:g.thumbnail_url,filename_snippet:g.filename.em_snippet(this.DUPLICATES_SNIPPET_LENGTH),path_snippet:q.em_snippet(this.DUPLICATES_SNIPPET_LENGTH,0),path_href:this._get_browse_link(g)}))}l.__date(d);if(k.length>=5){l.addClassName("scroll")}else{l.removeClassName("scroll")}f=PhotosUtil.categorize_files([b]),m=f[0],a=f[1];if(m){c=_("There are multiple copies of this photo.");h=_("Delete all copies of this photo?")}else{c=_("There are multiple copies of this video.");h=_("Delete all copies of this video?")}if(r){n="delete_32";p=h;j=c+" "+_("Would you like to delete them all?");$("cu-delete-all-duplicates").show()}else{n="folder_32";p=_("Show in folder");j=c+" "+_("Which folder would you like to view?");$("cu-delete-all-duplicates").hide()}DomUtil.fillVal(j,"cu-duplicates-desc");return Modal.icon_show(n,p,$("cu-duplicates-modal"),{action:this._delete_photos.curry([b])})},_show_delete_multiple_duplicates_modal:function(o,j){var n,g,k,c,b,h,f,l,a,d,m,e;k=$("cu-multiple-duplicate-files");c=[];for(d=0,m=j.length;d<m;d++){g=j[d];n="Dropbox"+Util.normalize(Util.parentDir(g.path));c.push(this._cu_duplicate_tmpl({thumbnail_url:g.thumbnail_url,filename_snippet:g.filename.em_snippet(this.DUPLICATES_SNIPPET_LENGTH),path_snippet:n.em_snippet(this.DUPLICATES_SNIPPET_LENGTH,0),path_href:this._get_browse_link(g)}))}k.__date(c);if(j.length>=5){k.addClassName("scroll")}else{k.removeClassName("scroll")}e=PhotosUtil.categorize_files(o),l=e[0],a=e[1];if(l&&a){b=_("Delete %(num_files)s files and all copies?").format({num_files:o.length});h=_("There are multiple copies of these files in your Dropbox.");f=_("Show files with multiple copies")}else{if(l){b=_("Delete %(num_photos)s photos and all copies?").format({num_photos:o.length});h=_("There are multiple copies of these photos in your Dropbox.");f=_("Show photos with multiple copies")}else{b=_("Delete %(num_videos)s videos and all copies?").format({num_videos:o.length});h=_("There are multiple copies of these videos in your Dropbox.");f=_("Show videos with multiple copies")}}DomUtil.fillVal(h,"cu-multiple-duplicates-desc");DomUtil.fillVal(f,"cu-multiple-duplicates-show");$("cu-multiple-duplicates-modal").removeClassName("show-duplicates");return Modal.icon_show("delete_32",b,$("cu-multiple-duplicates-modal"),{action:this._delete_photos.curry(o)})},show_timestamps_modal:function(f){var b,c,d,a,e;f.sort_by_key((function(g){return g.time_taken}),true);a=(function(){var j,h,g;g=[];for(j=0,h=f.length;j<h;j++){d=f[j];g.push(d.time_taken)}return g})();b=(function(){var j,h,g;g=[];for(j=0,h=f.length;j<h;j++){d=f[j];g.push(d.item_counter)}return g})();c=(function(){var j,h,g;g=[];for(j=0,h=a.length;j<h;j++){e=a[j];if(!(e!=null)){g.push(e)}}return g})();if(c.length===a.length){return this._show_add_timestamps_modal(f,a,b)}else{if(c.length===0){return this._show_edit_timestamps_modal(f,a,b)}else{return assert(false,"Timestamp modal should only open when all selected photos either have or don't        have timestamp information.")}}},_scroll_to_photo_after_timestamp_edit:function(a,b){var c=this;return this._refresh_photo_events(function(){var d,e;e=("m_"+(b.getFullYear()))+(""+(b.getMonth()+1)).lpad(2);d=c.get_timeline().events.valueFromKey(e);assert(d!=null,"Event is missing after a timestamp edit!");ModalProgress.update("2/3");d.on_load_all_metadata=function(){c.get_timeline().scroll_to_photo_with_key(a.uniqueness_key);ModalProgress.hide();return Notify.server_success("New timestamps have been saved!")};if(d.has_loaded_metadata()){d.on_load_all_metadata();return d.on_load_all_metadata=null}else{return d.load_metadata()}})},_show_add_timestamps_modal:function(f,b,a){var d,c,e=this;c=$j("#add-timestamp-modal");d=new DBCalendar("date_picker",{disable_future:true});return Modal.show("Set Timestamps",c[0],{action:function(){var k,o,m,n,h,j,l,g;m=Util.to_iso8601_date(d.selected_date,false,true);n=(function(){var r,q,p;p=[];for(j=r=0,q=f.length;0<=q?r<q:r>q;j=0<=q?++r:--r){p.push(m)}return p})();h={};for(k=l=0,g=a.length;l<g;k=++l){o=a[k];h[o]=n[k]}ModalProgress.show("Making the changes");return new Ajax.DBRequest("/modify_photo_timestamp",{parameters:{timestamp_by_item_counter:Util.to_json(h)},onSuccess:function(p){ModalProgress.update("1/3");return e._scroll_to_photo_after_timestamp_edit(f[0],d.selected_date)}})}})},_show_edit_timestamps_modal:function(k,j,e){var a,h,c,f,g,b,d=this;h=$j("#edit-timestamp-modal");a=(function(){var n,m,l;l=[];for(n=0,m=j.length;n<m;n++){f=j[n];l.push(new Date(f).toUTCDate())}return l})();c={year:0,month:0,day:0,hour:0};g=function(l){return _("%(date)s at %(time)s").format({date:l.format("H:mm a"),time:l.localize()})};b=function(l,p,q,o){var n,m;if(l==null){l=0}if(p==null){p=0}if(q==null){q=0}if(o==null){o=0}c.year+=l;c.month+=p;c.day+=q;c.hour+=o;m=Util.incrementDate(new Date(a[0]),c.year,c.month,c.day,c.hour,0);n=Util.incrementDate(new Date(a[a.length-1]),c.year,c.month,c.day,c.hour,0);if(k.length===1){return h.find("#timestamp-new").text(g(m))}else{h.find("#timestamp-new-start").text(g(m));return h.find("#timestamp-new-end").text(g(n))}};if(k.length===1){h.find("#edit-timestamp-single").show();h.find("#edit-timestamp-multi").hide();h.find("#timestamp-current").text(g(a[0]))}else{h.find("#edit-timestamp-single").hide();h.find("#edit-timestamp-multi").show();h.find("#timestamp-current-start").text(g(a[0]));h.find("#timestamp-current-end").text(g(a[a.length-1]))}b();$j("#timestamp-year-plus").on("click",b.curry(1,0,0,0));$j("#timestamp-year-minus").on("click",b.curry(-1,0,0,0));$j("#timestamp-month-plus").on("click",b.curry(0,1,0,0));$j("#timestamp-month-minus").on("click",b.curry(0,-1,0,0));$j("#timestamp-day-plus").on("click",b.curry(0,0,1,0));$j("#timestamp-day-minus").on("click",b.curry(0,0,-1,0));$j("#timestamp-hour-plus").on("click",b.curry(0,0,0,1));$j("#timestamp-hour-minus").on("click",b.curry(0,0,0,-1));Modal.onHide=function(){var l,o,m,n;n=["year","month","day","hour"];for(o=0,m=n.length;o<m;o++){l=n[o];$j("#timestamp-"+l+"-plus").off("click");$j("#timestamp-"+l+"-minus").off("click")}Modal.onHide=null;return Modal.hide()};return Modal.show("Edit Timestamps",h[0],{action:function(){var v,r,l,m,s,x,u,p,w,q,o,n;if((((c.year===(n=c.month)&&n===(o=c.day))&&o===(q=c.hour))&&q===0)){return}PhotosLogger.log_interaction(PhotosEvents.EDIT_TIMESTAMP,PhotosTriggers.PCM,{num_photos:k.length});m=(function(){var z,y,t;t=[];for(z=0,y=a.length;z<y;z++){v=a[z];t.push(Util.incrementDate(v,c.year,c.month,c.day,c.hour,0))}return t})();s=(function(){var z,y,t;t=[];for(z=0,y=m.length;z<y;z++){x=m[z];t.push(Util.to_iso8601_date(x,false,true))}return t})();u={};for(r=p=0,w=e.length;p<w;r=++p){l=e[r];u[l]=s[r]}ModalProgress.show("Making the changes");return new Ajax.DBRequest("/modify_photo_timestamp",{parameters:{timestamp_by_item_counter:Util.to_json(u)},job:k.length>d.NUM_PHOTOS_LONG_RUNNING_EDIT_TIMESTAMP,onSuccess:function(t){ModalProgress.update("1/3");return d._scroll_to_photo_after_timestamp_edit(k[0],m[0])}})}})},_preload_file_previews:function(c){var g,b,k,h,f,e,j,a,d;if(c[0]<c[c.length-1]){h=null;for(f=0,j=c.length;f<j;f++){g=c[f];if(typeof(this.get_timeline().preview_objs[g])==="object"){continue}k=this.get_timeline().events.valueFromKey(this.get_timeline().preview_objs[g]);if(!(h!=null)){h=k}if(k===h){continue}if(!h.has_loaded_metadata()){b=Math.ceil((g-h.photo_index_offset)/this.get_timeline().THUMBS_PER_ROW);assert(!isNaN(b),"Last row to load is NaN");h.load_metadata(b)}h=k}if((h!=null)&&!h.has_loaded_metadata()){b=Math.ceil((g-h.photo_index_offset)/this.get_timeline().THUMBS_PER_ROW);assert(!isNaN(b),"Last row to load is NaN");return h.load_metadata(b)}}else{d=[];for(e=0,a=c.length;e<a;e++){g=c[e];if(typeof this.get_timeline().preview_objs[g]==="object"){continue}k=this.get_timeline().events.valueFromKey(this.get_timeline().preview_objs[g]);b=Math.ceil((g-k.photo_index_offset)/this.get_timeline().THUMBS_PER_ROW);assert(!isNaN(b),"Last row to load is NaN");d.push(k.load_metadata(b))}return d}},_lightbox_photo_change:function(h){var k,j,f,b,g,d,c,a;this._last_lightbox_index=this.get_timeline().preview_objs.indexOf(h.memo.preview_obj);if(this._last_lightbox_index===this.get_timeline().preview_objs.length-1){return}if(h.memo.direction===Lightbox.NEXT||!(h.memo.direction!=null)){k=this._last_lightbox_index+1;if(this._last_lightbox_index+this.LIGHTBOX_OFFSET*this.get_timeline().THUMBS_PER_ROW<this.get_timeline().preview_objs.length){k=this._last_lightbox_index+this.LIGHTBOX_OFFSET*this.get_timeline().THUMBS_PER_ROW}this._preload_file_previews((function(){c=[];for(var e=g=this._last_lightbox_index+1;g<=k?e<=k:e>=k;g<=k?e++:e--){c.push(e)}return c}).apply(this))}if(h.memo.direction===Lightbox.PREV||!(h.memo.direction!=null)){j=this._last_lightbox_index-1;if(this._last_lightbox_index-this.LIGHTBOX_OFFSET*this.get_timeline().THUMBS_PER_ROW<this.get_timeline().preview_objs.length){j=this._last_lightbox_index-this.LIGHTBOX_OFFSET*this.get_timeline().THUMBS_PER_ROW}return this._preload_file_previews((function(){a=[];for(var l=j,e=this._last_lightbox_index-1;j<=e?l<=e:l>=e;j<=e?l++:l--){a.push(l)}return a}).apply(this))}},_lightbox_exit:function(a){return key.setScope(this.KEY_SCOPE)},_window_resize:function(){var c,b,d,a;b=$("cu-view").cumulativeOffset().top+$("photos-list").getLayout().get("margin-top")+$("photos-list").getLayout().get("padding-top");c=$("cu-view").cumulativeOffset().left+$("photos-list").getLayout().get("margin-left")+$("photos-list").getLayout().get("padding-left");if((d=this._all_photos_timeline)!=null){d.update_offsets(b,c)}return(a=this._single_collection_timeline)!=null?a.update_offsets(b,c):void 0},_history_change_handler:function(n,m){var j,k,e,a,g,c,f,l,h,d,b;$("photos-nav-item").removeClassName("selected");$$(".sidebar-album.selected").invoke("removeClassName","selected");if((h=this.get_timeline())!=null){h.unlisten()}if(m.all_albums!=null){this._in_all_collections_view=true;$("cu-view").removeClassName("single-collection");$("cu-view").addClassName("all-collections");$("all-albums-sidebar").addClassName("selected");PhotosSelection.clear();document.title=_("Albums")+" - Dropbox";PhotosCollections.restore_all_albums_scroll_position();this._current_collection_gid=null;return}else{this._in_all_collections_view=false;$("cu-view").removeClassName("all-collections")}if(m.album!=null){a=m.album;d=$$(".sidebar-album");for(f=0,l=d.length;f<l;f++){k=d[f];if(k.readAttribute("data-gid")===a){k.addClassName("selected");break}}j=PhotosCollections.get(a);$("single-collection-title").__date(j.name.em_snippet(PhotosCollections.HEADER_COLLECTION_SNIPPET_LENGTH,1));if(j.shmodel_url!=null){$("single-collection-share-status").writeAttribute("href",j.shmodel_url);$("single-collection-share-status").__date(_("Shared"))}else{$("single-collection-share-status").__date()}$("cu-view").addClassName("single-collection");document.title=""+j.name+" - Dropbox";AlbumsLogger.log_event("show_collection",j.gid,j.num_photos,j.is_anonymous)}else{a=null;$("cu-view").removeClassName("single-collection");$("photos-nav-item").addClassName("selected");document.title=(this._is_all_photos?_("Photos"):_("Camera"))+" - Dropbox"}g={};if(m.file_type!=null){g.file_type=m.file_type}e=false;if(Util.to_json(g)!==Util.to_json(this._current_filters)){e=true}if(a!=null){if(a!==this._current_collection_gid){e=true}}else{if(!(this._all_photos_timeline!=null)){e=true}}this._set_filters(g);this._current_collection_gid=a;if(e){this._refresh_view()}else{this._init_lightbox();this.get_timeline().init_timeline_nav();this.get_timeline().restore_scroll_position();this.get_timeline().listen()}if(this._last_lightbox_index>-1&&this.get_timeline().photos.length){c=this.get_timeline().photos[this._last_lightbox_index].uniqueness_key;this.get_timeline().scroll_to_photo_with_key(c);if((b=$(c))!=null){b.addClassName("wiggobble")}setTimeout((function(){return $(c).removeClassName("wiggobble")}),1000);return this._last_lightbox_index=-1}},_async_create_filetags:function(d){var b,a,c=this;b=(function(){var g,f,e;e=[];for(g=0,f=d.length;g<f;g++){a=d[g];e.push(a.path)}return e})();this._creating_filetags=true;return new Ajax.DBRequest("/prepare_collection_items",{parameters:{fq_paths:Util.to_json(b)},job:false,no_watch:true,noAutonotify:true,onSuccess:function(e){c._creating_filetags=false;if(c._creating_filetags_cb!=null){c._creating_filetags_cb();return c._creating_filetags_cb=null}},onFailure:function(e){return c._creating_filetags=false}})}};PhotosUtil={categorize_files:function(b){var c,a;c=b.filter(function(d){return d.preview_type==="photo"});a=b.filter(function(d){return d.preview_type==="video"});return[c.length,a.length]},file_desc:function(f,c,a){var b,e,d;if(c==null){c=false}if(a==null){a=false}d=this.categorize_files(f),b=d[0],e=d[1];return this._photo_video_desc(b,e,c,a)},album_desc:function(c,b,a){if(b==null){b=false}if(a==null){a=false}return this._photo_video_desc(c.num_photos,c.num_videos,b,a)},_photo_video_desc:function(b,g,c,a){var d,f,e;f=ungettext("%d photo","%d photos",b).format(b);e=ungettext("%d video","%d videos",g).format(g);if(b&&g){if(c){d=b+g;return ungettext("%d item","%d items",d).format(d)}else{if(a){return new HTML(""+f+"<br/>"+e)}else{return _("%(num_photos)s and %(num_videos)s").format({num_photos:f,num_videos:e})}}}else{if(b){return f}else{if(g){return e}else{return""}}}}};PhotosTour={frame:0,next:function(){var a,b=this;Modal.show("",$j("#photos-tour-"+(this.frame+1))[0],null,null,700,null,null,false);a=this.frame;PhotosLogger.log_interaction(PhotosTourEvents.SHOW_MODAL,"",{frame:a});$j("#modal-x").off("click");$j("#modal-x").on("click",(function(){return PhotosLogger.log_interaction(PhotosTourEvents.EXIT_MODAL,"",{frame:a})}));return this.frame=(this.frame+1)%4}};var PhotosSelection,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};PhotosSelection={CHANGE_EVT:"db:photos_selection:change",SHIFT_KEY_CODE:16,DRAG_STATUS_OFFSET:16,DRAG_START_THRESHOLD:10,SCROLL_BAR_WIDTH:10,_selected:[],_context_selected:null,_highlighted:[],_dehighlighted:[],_last_selected:null,_last_mouseover:null,_drag_select:{},_marquee:{},_drag_drop:{},_num_events_highlighting:0,_last_highlight_from_photo:null,_last_highlight_to_photo:null,_select_highlighted_waiting:0,_show_share_after_loading_selected:false,_num_pending_selected_events:0,_max_num_pending_selected_events:0,listen:function(){var a=this;$(document.body).on("keydown",function(b){if(b.keyCode===a.SHIFT_KEY_CODE&&a._last_mouseover&&!Util.focus_in_input()){return a._highlight_range(a._last_selected,a._last_mouseover)}});$(document.body).on("keyup",function(b){if(b.keyCode===a.SHIFT_KEY_CODE&&!a._marquee.active){return a.clear_highlighted()}});key("delete, command+backspace, backspace",Photos.KEY_SCOPE,function(b){b.preventDefault();if(Photos.in_single_collection_view()){if(a._selected.length){return PhotosCollections.show_remove_photos_modal(Photos.get_current_collection(),a._selected)}}else{if(a._selected.length){return Photos.show_delete_photos_modal(a._selected)}}});key("esc",Photos.KEY_SCOPE,function(b){if(typeof b.preventDefault==="function"){b.preventDefault()}if(a._drag_drop.active){a._drag_drop.active=false;$("albums-sidebar-list").removeClassName("drag-drop");return $("photos-drag-status").removeClassName("active")}else{a.clear();return PhotosLogger.log_interaction(PhotosEvents.CLEAR_SELECTED,PhotosTriggers.ESC)}});$(document.body).on("mouseover",".cu-thumb",this._photo_mouseover.bind(this));$(document.body).on("mouseout",".cu-thumb",this._photo_mouseout.bind(this));$(document.body).on("mousedown",this._body_mousedown.bind(this));$(document.body).on("mousemove",this._body_mousemove.bind(this));$(document.body).on("mouseup",this._body_mouseup.bind(this));return $(document.body).on("dblclick",this._body_double_click.bind(this))},is_selection_active:function(){return this._highlighted.length||this._selected.length||this._marquee.active||this._drag_drop.active||this._drag_select.active},get:function(){return this._selected},contains:function(b){var a,d,c;d=(function(){var h,f,g,e;g=this._selected;e=[];for(h=0,f=g.length;h<f;h++){a=g[h];e.push(a.uniqueness_key)}return e}).call(this);return c=b.uniqueness_key,__indexOf.call(d,c)>=0},clear:function(){this._selected=[];this._last_selected=null;$$(".cu-thumb.selected").invoke("removeClassName","selected");$("cu-view").removeClassName("photos-selected");$("page-sidebar").removeClassName("photos-selected");FreshDropdown.hide_all();return document.fire(PhotosSelection.CHANGE_EVT)},clear_highlighted:function(){this._highlighted=[];this._dehighlighted=[];if(!this._select_highlighted_waiting){$$(".cu-thumb.highlighted").invoke("removeClassName","highlighted");$$(".cu-thumb.dehighlighted").invoke("removeClassName","dehighlighted");this._last_highlight_from_photo=null;return this._last_highlight_to_photo=null}},photo_click:function(b,a){if(b.isRightClick()&&!b.shiftKey){return}if(b.shiftKey){return this._select_highlighted()}else{if(this.contains(a)){return this._remove(a)}else{return this._add(a)}}},num_selected:function(){return this._selected.length},refresh:function(d){var f,g,c,h,e,b,a;h=(function(){var m,k,l,j;l=this._selected;j=[];for(m=0,k=l.length;m<k;m++){c=l[m];j.push(c.uniqueness_key)}return j}).call(this);a=[];for(e=0,b=d.length;e<b;e++){g=d[e];f=h.indexOf(g.uniqueness_key);if(f>=0){a.push(this._selected[f]=g)}else{a.push(void 0)}}return a},inc_num_loading_events_before_share:function(){if(!this._show_share_after_loading_selected){ModalProgress.show(_("Selecting photos..."))}this._show_share_after_loading_selected=true;this._num_pending_selected_events++;if(this._num_pending_selected_events>this._max_num_pending_selected_events){return this._max_num_pending_selected_events=this._num_pending_selected_events}},dec_num_loading_events_before_share:function(){if(this._show_share_after_loading_selected){this._num_pending_selected_events--;ModalProgress.update(""+(this._max_num_pending_selected_events-this._num_pending_selected_events)+"/"+this._max_num_pending_selected_events);if(this._num_pending_selected_events===0){ModalProgress.hide();this._show_share_after_loading_selected=false;if(this.num_selected()>0){return Photos._share_selected()}}}},_photo_mouseover:function(a){this._last_mouseover=Photos.get_timeline().get_photo_for_thumb_elm($(a.target));if(a.shiftKey){return this._highlight_range(this._last_selected,this._last_mouseover)}else{if(this._drag_select.active){return this._highlight_range(this._drag_select.anchor,this._last_mouseover,true)}}},_photo_mouseout:function(a){if(!this._marquee.active){this.clear_highlighted();return this._last_mouseover=null}},_body_mousedown:function(c){var a,d,b;if(Photos.in_all_collections_view()||c.isRightClick()||this._invalid_mouse_target($(c.target))){return}ContextMenu.hide();FreshDropdown.hide_all();a=Photos.get_timeline().get_photo_for_thumb_elm($(c.target));if(a!=null){if(this.contains(a)||!PhotosSelection.drag_select_enabled){b=Util.scroll_offsets();this._drag_drop.active=true;this._drag_drop.start_x=c.clientX+b.left;this._drag_drop.start_y=c.clientY+b.top;this._drag_drop.anchor=$(c.target);this._drag_drop.single_photo=this.contains(a)?null:a;this._build_drag_status(a);this._update_drag_status_position(c);d=this.get();if(d.length<=PhotosCollections.NUM_PHOTOS_LONG_RUNNING_ADDS){return Photos._async_create_filetags(d)}}else{this._drag_select.active=true;return this._drag_select.anchor=a}}else{b=Util.scroll_offsets();if((c.clientX+b.left)>=($(document.body).getWidth()-this.SCROLL_BAR_WIDTH)){return}this._marquee.active=true;this._marquee.start_x=c.clientX+b.left;this._marquee.start_y=c.clientY+b.top;this._marquee.x_max_boundary=-1;return this._marquee.y_max_boundary=-1}},_body_mousemove:function(c){var b,a,d;b=Util.scroll_offsets();a=c.clientX+b.left;d=c.clientY+b.top;if(this._marquee.active){if(!$("marquee").visible()){if(Math.abs(a-this._marquee.start_x)<this.DRAG_START_THRESHOLD&&Math.abs(d-this._marquee.start_y)<this.DRAG_START_THRESHOLD){return}}this._marquee.end_x=a;this._marquee.end_y=d;return this._draw_marquee()}else{if(this._drag_drop.active){if(!$("photos-drag-status").hasClassName("active")){if(Math.abs(a-this._drag_drop.start_x)<this.DRAG_START_THRESHOLD&&Math.abs(d-this._drag_drop.start_y)<this.DRAG_START_THRESHOLD){return}}this._update_drag_status_position(c);$$(".sidebar-album").invoke("removeClassName","album-flash");$("albums-sidebar-list").addClassName("drag-drop");return $("photos-drag-status").addClassName("active")}}},_body_mouseup:function(b){var a;if(this._drag_select.active){this._drag_select.active=false;this._select_highlighted()}if(this._marquee.active){this._marquee.active=false;$("marquee").hide();a=this._highlighted.length;this._select_highlighted();if(a){PhotosLogger.log_interaction(PhotosEvents.MARQUEE_SELECT,PhotosTriggers.DRAG,{num_selected:a})}}if(this._drag_drop.active){if($(b.target)===this._drag_drop.anchor&&$("photos-drag-status").hasClassName("active")){this._drag_drop.ignore_next_click=true}this._drag_drop.active=false;this._drag_drop.anchor=null;this._drag_drop.single_photo=null;$("albums-sidebar-list").removeClassName("drag-drop");return $("photos-drag-status").removeClassName("active")}},_body_double_click:function(a){if(Photos.get_timeline().get_photo_for_thumb_elm($(a.target))||this._invalid_mouse_target($(a.target))){return}this.clear();return PhotosLogger.log_interaction(PhotosEvents.CLEAR_SELECTED,PhotosTriggers.DBL_CLICK)},_draw_marquee:function(){var a,e,d,c,b;b=Math.abs(this._marquee.start_x-this._marquee.end_x);a=Math.abs(this._marquee.start_y-this._marquee.end_y);d=Math.min(this._marquee.start_y,this._marquee.end_y);e=Math.min(this._marquee.start_x,this._marquee.end_x);$("marquee").setStyle({width:b+"px",height:a+"px",top:d+"px",left:e+"px"});$("marquee").show();c=false;if(this._marquee.end_x>=this._marquee.x_max_boundary||this._marquee.end_x<=this._marquee.x_min_boundary){this._update_marquee_x_bounds(this._marquee.end_x);c=true}if(this._marquee.end_y>=this._marquee.y_max_boundary||this._marquee.end_y<=this._marquee.y_min_boundary){this._update_marquee_y_bounds(this._marquee.end_y);c=true}if(c){return this._update_marquee_highlight(d,e,b,a)}},_update_marquee_highlight:function(m,c,a,o){var k,l,h,b,g,f,n,j,e,d;this.clear_highlighted();b=[];l=Photos.get_timeline().grid.photo_col_offsets.length;j=Photos.get_timeline().grid.photo_col_offsets.slice(0,l-1);for(k=g=0,n=j.length;g<n;k=++g){h=j[k];if(h<=c+a&&Photos.get_timeline().grid.photo_col_offsets[k+1]>=c){b.push(k)}}d=[];for(k=f=0,e=Photos.get_timeline().events.length();0<=e?f<e:f>e;k=0<=e?++f:--f){d.push(Photos.get_timeline().events.valueAtIndex(k).marquee_highlight(m,m+o,b))}return d},_update_marquee_x_bounds:function(a){var d,g,h,f,c,e,b;g=$(document.body).getWidth();if(a<Photos.get_timeline().grid.photo_col_offsets.first()){this._marquee.x_min_boundary=-1;return this._marquee.x_max_boundary=Photos.get_timeline().grid.photo_col_offsets.first()}else{if(a>Photos.get_timeline().grid.photo_col_offsets.last()){this._marquee.x_min_boundary=Photos.get_timeline().grid.photo_col_offsets.last();return this._marquee.x_max_boundary=g}else{e=Photos.get_timeline().grid.photo_col_offsets;b=[];for(d=f=0,c=e.length;f<c;d=++f){h=e[d];if(h>a){this._marquee.x_min_boundary=Photos.get_timeline().grid.photo_col_offsets[d-1];this._marquee.x_max_boundary=h;break}else{b.push(void 0)}}return b}}},_update_marquee_y_bounds:function(h){var a,e,d,g,c,f,b;d=$(document.body).getHeight();if(h<Photos.get_timeline().grid.photo_row_offsets.first()){this._marquee.y_min_boundary=-1;return this._marquee.y_max_boundary=Photos.get_timeline().grid.photo_row_offsets.first()}else{if(h>Photos.get_timeline().grid.photo_row_offsets.last()){this._marquee.y_min_boundary=Photos.get_timeline().grid.photo_row_offsets.last();return this._marquee.y_max_boundary=d}else{f=Photos.get_timeline().grid.photo_row_offsets;b=[];for(e=g=0,c=f.length;g<c;e=++g){a=f[e];if(a>h){this._marquee.y_min_boundary=Photos.get_timeline().grid.photo_row_offsets[e-1];this._marquee.y_max_boundary=a;break}else{b.push(void 0)}}return b}}},_build_drag_status:function(d){var c,a,b;a=Photos.get_timeline().get_thumb_elm_for_photo(d);b=a.down("img.thumb-content").cloneNode(false);$("photos-drag-status").down(".thumb").__date(b);c=this._drag_drop.single_photo?[this._drag_drop.single_photo]:this._selected;return $("photos-drag-status").down(".count").__date(PhotosUtil.file_desc(c,false,true))},_update_drag_status_position:function(a){return $("photos-drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+this.DRAG_STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+this.DRAG_STATUS_OFFSET)+"px"})},_highlight_range:function(m,l,c){var k,a,d,g,j,h,b,f,e;if(c==null){c=false}this.clear_highlighted();this._last_highlight_from_photo=m;this._last_highlight_to_photo=l;d=Photos.get_timeline().photos.indexOf(m);b=Photos.get_timeline().photos.indexOf(l);k=!c&&this.contains(l)&&!this.contains(m);e=[];for(g=f=d;d<=b?f<=b:f>=b;g=d<=b?++f:--f){h=Photos.get_timeline().photos[g];if(typeof h!=="object"){if(h!==j){a=Photos.get_timeline().events.valueFromKey(h);if(!a.has_loaded_metadata()){a.on_load_all_metadata=this._highlight_range_incremental.bind(this);a.load_metadata();this._num_events_highlighting++;e.push(j=h)}else{e.push(void 0)}}else{e.push(void 0)}}else{if(this.contains(h)){if(k){e.push(this._dehighlight(h))}else{e.push(void 0)}}else{if(!k){e.push(this._highlight(h))}else{e.push(void 0)}}}}return e},_highlight_range_incremental:function(){var f,e,d,c,b,a,g;e=this._last_highlight_from_photo;a=this._last_highlight_to_photo;f=Photos.get_timeline().photos.indexOf(e);b=Photos.get_timeline().photos.indexOf(a);for(d=g=f;f<=b?g<=b:g>=b;d=f<=b?++g:--g){c=Photos.get_timeline().photos[d];if(typeof c==="object"&&!this.contains(c)&&this._highlighted.indexOf(c)===-1){this._highlight(c)}}this._num_events_highlighting--;if(this._select_highlighted_waiting){ModalProgress.update(""+(this._select_highlighted_waiting-this._num_events_highlighting)+"/"+this._select_highlighted_waiting);if(this._num_events_highlighting===0){return this._select_highlighted()}}},_highlight_list:function(d){var c,e,b,a;this.clear_highlighted();a=[];for(e=0,b=d.length;e<b;e++){c=d[e];if(!this.contains(c)){a.push(this._highlight(c))}else{a.push(void 0)}}return a},_select_highlighted:function(){var d,g,e,c,b,f,a;if(this._num_events_highlighting>0){ModalProgress.show(_("Selecting photos..."));this._select_highlighted_waiting=this._num_events_highlighting;return}f=this._highlighted;for(g=0,c=f.length;g<c;g++){d=f[g];this._add(d)}a=this._dehighlighted;for(e=0,b=a.length;e<b;e++){d=a[e];this._remove(d)}if(this._select_highlighted_waiting){ModalProgress.hide();this._select_highlighted_waiting=0}return this.clear_highlighted()},_highlight:function(b){var a;this._highlighted.push(b);a=Photos.get_timeline().get_thumb_elm_for_photo(b);return a!=null?a.addClassName("highlighted"):void 0},_dehighlight:function(b){var a;this._dehighlighted.push(b);a=Photos.get_timeline().get_thumb_elm_for_photo(b);return a!=null?a.addClassName("dehighlighted"):void 0},_add:function(b){var a;a=Photos.get_timeline().get_thumb_elm_for_photo(b);if(a!=null){a.addClassName("selected")}this._selected.push(b);this._last_selected=b;DomUtil.fillVal(PhotosUtil.file_desc(this._selected,true),"selected-desc");DomUtil.fillVal(this._selected.length,"num-selected");$("cu-view").addClassName("photos-selected");this._check_for_single_selection();$("page-sidebar").addClassName("photos-selected");return document.fire(PhotosSelection.CHANGE_EVT)},_remove:function(c){var b,a;a=Photos.get_timeline().get_thumb_elm_for_photo(c);if(a!=null){a.removeClassName("selected")}b=this._selected.indexOf(c);if(b!==-1){this._selected.splice(b,1);this._last_selected=c;if(this._selected.length){DomUtil.fillVal(PhotosUtil.file_desc(this._selected,true),"selected-desc");DomUtil.fillVal(this._selected.length,"num-selected")}else{$("cu-view").removeClassName("photos-selected");$("page-sidebar").removeClassName("photos-selected")}}this._check_for_single_selection();return document.fire(PhotosSelection.CHANGE_EVT)},_invalid_mouse_target:function(c){var a,b;a=c.classNames().toArray().concat(c.up().classNames().toArray());return(__indexOf.call(a,"freshbutton")>=0)||(__indexOf.call(a,"freshbutton-blue")>=0)||(__indexOf.call(a,"freshbutton-lightblue")>=0)||(__indexOf.call(a,"freshbutton-blue-on-gray")>=0)||(__indexOf.call(a,"timeline-elm")>=0)||(c.up(".no-marquee")!=null)||(c.up("#context-menu")!=null)||(c.up(".freshdropdown-menu")!=null)||c.nodeName==="A"||((b=c.tagName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT")||Modal.shown()||$("modal-progress-content").visible()||Lightbox.shown},_check_for_single_selection:function(){if(this._selected.length===1){return $("cu-view").addClassName("single-selection")}else{return $("cu-view").removeClassName("single-selection")}}};var PhotosCollections,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};PhotosCollections={SIDEBAR_COLLECTION_SNIPPET_LENGTH:10,HEADER_COLLECTION_SNIPPET_LENGTH:25,CONTEXT_MENU_COLLECTION_SNIPPET_LENGTH:11,NUM_PHOTOS_LONG_RUNNING_ADDS:100,NUM_PHOTOS_LONG_RUNNING_REMOVES:250,LOADING_SPINNER:new HTML('<br/><div class="cu-loading"><img src="/static/images/icons/ajax-loading-small.gif" /></div>'),_collections:[],_anonymous_collections:[],_gid_to_collection:{},_collection_list_item_tmpl:null,_albums_sidebar_tmpl:null,_add_to_album_menu_tmpl:null,_all_collections_loaded:false,_removed_pre_load:[],_all_albums_scroll_position:0,init:function(b,a){this._collections=b;this._gid_to_collection=b.dict_by("gid");this._collection_list_item_tmpl=HTML.tmpl("collection_list_item_tmpl");this._albums_sidebar_tmpl=HTML.tmpl("albums_sidebar_tmpl");this._add_to_album_menu_tmpl=HTML.tmpl("add_to_album_menu_tmpl");this._all_collections_loaded=false;this.refresh_album_views();this._init_collections();return this._init_anonymous_collections()},_init_collections:function(){var a=this;if(!this._all_collections_loaded){return new Ajax.DBRequest("/collections",{allow_retries:true,onSuccess:function(d){var g,f,c,e,b;e=Util.from_json(d.responseText);for(f=0,c=e.length;f<c;f++){g=e[f];if(!(g.gid in a._gid_to_collection)&&!(b=g.gid,__indexOf.call(a._removed_pre_load,b)>=0)){a._collections.push(g);a._gid_to_collection[g.gid]=g}}a._all_collections_loaded=true;return a.refresh_album_views()}})}},_init_anonymous_collections:function(){var a=this;return new Ajax.DBRequest("/collections",{allow_retries:true,parameters:{anonymous:true},onSuccess:function(c){var f,e,b,d;d=Util.from_json(c.responseText);for(e=0,b=d.length;e<b;e++){f=d[e];a._anonymous_collections.push(f);a._gid_to_collection[f.gid]=f}return a.render_all_albums_view()}})},reload:function(){this._collections=[];this._anonymous_collections=[];this._gid_to_collection={};this._all_collections_loaded=false;this.refresh_album_views();this._init_collections();return this._init_anonymous_collections()},listen:function(){var a=this;$("single-collection-title").observe("click",function(b){a.header_rename();return PhotosLogger.log_interaction(PhotosEvents.RENAME_ALBUM,PhotosTriggers.CLICK_TITLE)});$("show-anonymous-albums-button").observe("click",(function(){return $("anonymous-albums-container").toggleClassName("show-albums")}));$(document.body).on("contextmenu",".albums-list-item",this._albums_list_item_contextmenu.bind(this));$(document.body).on("click",".show-collection-target",this._show_collection_click.bind(this));$(document.body).on("click",".collection-shmodel-target",this._collection_shmodel_click.bind(this));$(document.body).on("click",".add-to-album-target",this._add_to_album_click.bind(this));$(document.body).on("mouseover",".add-to-album-drop-target",this._drop_target_mouseover.bind(this));$(document.body).on("mouseup",".add-to-album-drop-target",this._drop_target_mouseup.bind(this));$(document.body).on("mouseout",".add-to-album-drop-target",this._drop_target_mouseout.bind(this));$(document.body).on("click",".create-album-target",this._create_album_click.bind(this));document.observe(ContextMenu.HIDE_EVT,(function(){return $$(".albums-list-item.context-selected").invoke("removeClassName","context-selected")}));return Event.observe(window,"scroll",this._window_scroll.bind(this))},render_all_albums_view:function(){var d,h,b,f,e,j,a,g,c;if(this._collections.length||this._anonymous_collections.length||!this._all_collections_loaded){$("albums-empty").hide()}else{$("albums-empty").show()}b=[];g=this._collections;for(f=0,j=g.length;f<j;f++){h=g[f];b.push(this._collection_list_item_tmpl({collection:h,additional_class:"albums-list-item show-collection-target big",show_stack:true}))}$("albums-list").__date(b);$("albums-list").__sert(new Element("div",{"class":"clearfix"}));$("albums-container").removeClassName("show-anonymous");if(!this._all_collections_loaded){return $("albums-list").__sert(this.LOADING_SPINNER)}else{if(this._anonymous_collections.length>0){d=[];c=this._anonymous_collections;for(e=0,a=c.length;e<a;e++){h=c[e];d.push(this._collection_list_item_tmpl({collection:h,additional_class:"albums-list-item collection-shmodel-target",show_stack:false}))}$("anonymous-albums-list").__date(d);return $("albums-container").addClassName("show-anonymous")}}},render_add_to_album_modal:function(){var f,b,c,e,a,d;b=[];c={name:_("Create new album"),num_photos:0,thumbnail_url_256:"/static/images/new_album_big.png"};b.push(this._collection_list_item_tmpl({collection:c,additional_class:"create-album-target big",show_stack:false}));d=this._collections;for(e=0,a=d.length;e<a;e++){f=d[e];b.push(this._collection_list_item_tmpl({collection:f,additional_class:"add-to-album-target big",show_stack:true}))}$("add-to-album-modal-list").__date(b);if(!this._all_collections_loaded&&this._collections.length>0){return $("add-to-album-modal-list").__sert(this.LOADING_SPINNER)}},render_albums_sidebar:function(){var h,k,e,j,f,d,b,a,c,g=this;k=this._albums_sidebar_tmpl({collections:this._collections.slice(0,5)});if((f=$("albums-sidebar"))!=null){f.__date(k)}if((d=$("all-albums-sidebar"))!=null){d.observe("click",Photos.show_all_collections)}if((b=$("all-albums-sidebar"))!=null){b.observe("mouseup",function(l){var m;if(!PhotosSelection._drag_drop.active){return}if(PhotosSelection._drag_drop.single_photo!=null){m=[PhotosSelection._drag_drop.single_photo]}else{m=PhotosSelection.get()}g.show_add_to_album_modal(l,m);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})})}if(Photos.in_all_collections_view()){return $("all-albums-sidebar").addClassName("selected")}else{if(Photos.in_single_collection_view()){a=$$(".sidebar-album");c=[];for(e=0,j=a.length;e<j;e++){h=a[e];if(h.readAttribute("data-gid")===Photos.get_current_collection().gid){h.addClassName("selected");break}else{c.push(void 0)}}return c}}},render_add_to_album_menu:function(){var c,b,a,d=this;c=this._add_to_album_menu_tmpl({collections:this._collections.slice(0,3),all_link:this._collections.length>3});if((b=$("add-to-album-menu"))!=null){b.__date(c)}return(a=$("show-add-to-album-modal"))!=null?a.observe("click",function(f){d.show_add_to_album_modal(f);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.SAH,{num_photos:PhotosSelection.get().length})}):void 0},refresh_album_views:function(b){var a,c=this;if(b==null){b=null}a=function(){c.render_all_albums_view();c.render_albums_sidebar();c.render_add_to_album_menu();return c.render_add_to_album_modal()};if(b!=null?b.length:void 0){return new Ajax.DBRequest("/collections",{allow_retries:true,parameters:{collection_gids:Util.to_json(b.unique())},onSuccess:function(e){var h,g,d,f;f=Util.from_json(e.responseText);for(g=0,d=f.length;g<d;g++){h=f[g];c.refresh_collection(h)}return a()}})}else{return a()}},get_all:function(){return this._collections},get:function(a){return this._gid_to_collection[a]},go_to_link:function(a){return window.open(a.shmodel_url,"_blank")},show_unshare_modal:function(b){var a;DomUtil.fillVal(b.name.escapeHTML(),"collection-unshare-name");a=b.is_anonymous?_("Unshare?"):_("Unshare album?");return Modal.icon_show("alert_32",a,DomUtil.fromElm("collection-unshare-modal"),{action:this.unshare.curry(b).bind(this)})},unshare:function(a){var b=this;assert(a.share_tkey!=null,"Can't unshare collection "+a.gid+" without a tkey");return new Ajax.DBRequest("/sm/disable/"+a.share_tkey,{onSuccess:function(){a.share_tkey=null;$("single-collection-share-status").__date();if(a.is_anonymous){b._anonymous_collections.removeItem(a);delete b._gid_to_collection[a.gid];b.render_all_albums_view()}return Notify.server_success(_("Unshared '%(collection_name)s'").format({collection_name:a.name}))}})},add_photos:function(f,k,d){var c,e,a,h,j,b,g=this;if(d==null){d=true}a=(function(){var n,m,l;l=[];for(n=0,m=k.length;n<m;n++){b=k[n];l.push(b.path)}return l})();h=(function(){var n,m,l;l=[];for(n=0,m=k.length;n<m;n++){b=k[n];l.push(b.item_counter)}return l})();assert(a.length||h.length,"Have to add at least one photo");e={collection_gid:f.gid,is_all_photos:Photos._is_all_photos};if(e.is_all_photos){e.item_counters=Util.to_json(h);if(Photos.in_single_collection_view()){e.source_collection_gid=Photos.get_current_collection().gid}}else{e.fq_paths=Util.to_json(a)}j=k.length>this.NUM_PHOTOS_LONG_RUNNING_ADDS;Notify.server_success(_("Adding to album..."));c={parameters:e,job:j,progress_text:_("Adding to album..."),onSuccess:function(u){var p,o,s,t,m,l,n,q,r;q=Util.from_json(u.responseText);if(f.num_items===0){assert(!(f.thumbnail_url_32!=null)&&!(f.thumbnail_url_256!=null),"Empty album shouldn't have a thumbnail url");f.thumbnail_url_32=q.thumbnail_url_32;f.thumbnail_url_256=q.thumbnail_url_256}m=q.new_num_photos-f.num_photos;n=q.new_num_videos-f.num_videos;s=q.new_num_items-f.num_items;f.num_photos=q.new_num_photos;f.num_videos=q.new_num_videos;f.num_items=q.new_num_items;if(d&&s>0){g._collection_updated(f)}else{g.refresh_album_views([f.gid])}if(k===PhotosSelection.get()){PhotosSelection.clear()}if(s<1){r=PhotosUtil.categorize_files(k),t=r[0],l=r[1];if(t&&l){o=ungettext("That item is already in '%(collection_name)s'","Those items are already in '%(collection_name)s'",a.length)}else{if(t){o=ungettext("That photo is already in '%(collection_name)s'","Those photos are already in '%(collection_name)s'",a.length)}else{o=ungettext("That video is already in '%(collection_name)s'","Those videos are already in '%(collection_name)s'",a.length)}}}else{if(m&&n){o=ungettext("Added item to '%(collection_name)s'","Added items to '%(collection_name)s'",a.length)}else{if(m){o=ungettext("Added photo to '%(collection_name)s'","Added photos to '%(collection_name)s'",a.length)}else{o=ungettext("Added video to '%(collection_name)s'","Added videos to '%(collection_name)s'",a.length)}}}p=f.name.escapeHTML();o=o.format({collection_name:"<a data-gid='"+f.gid+"' class='show-collection-target'>"+p+"</a>"});return Notify.server_success(new HTML(o))}};if(Photos._creating_filetags){return Photos._creating_filetags_cb=function(){return new Ajax.DBRequest("/collection_add",c)}}else{return new Ajax.DBRequest("/collection_add",c)}},show_remove_photos_modal:function(d,f){var c,a,e,b;b=PhotosUtil.categorize_files(f),a=b[0],e=b[1];if(a&&e){c=ungettext("Remove %(file_count)s item?","Remove %(file_count)s items?",f.length)}else{if(a){c=ungettext("Remove %(file_count)s photo?","Remove %(file_count)s photos?",f.length)}else{c=ungettext("Remove %(file_count)s video?","Remove %(file_count)s videos?",f.length)}}c=c.format({file_count:f.length});DomUtil.fillVal(PhotosUtil.file_desc(f),"collection-remove-files");DomUtil.fillVal(d.name.escapeHTML(),"collection-remove-name");return Modal.icon_show("delete_32",c,DomUtil.fromElm("collection-remove-modal"),{action:this.remove_photos.curry(d,f).bind(this)})},remove_photos:function(m,s){var n,h,a,g,l,k,p,q,e,b,f,j,c,r,d,o=this;s=s.slice(0);p=(function(){var v,u,t;t=[];for(v=0,u=s.length;v<u;v++){e=s[v];t.push(e.item_counter)}return t})();n=PhotosUtil.file_desc(s);q=s.length>this.NUM_PHOTOS_LONG_RUNNING_REMOVES;f=(function(){var w,u,v,t;v=PhotosSelection.get();t=[];for(w=0,u=v.length;w<u;w++){e=v[w];t.push(e.uniqueness_key)}return t})();j=Photos.get_timeline();l=j.photos.length;k=null;for(c=0,r=s.length;c<r;c++){e=s[c];b=j.photos.indexOf(e);if(b<l){l=b;k=e}}g=k.uniqueness_key;h=j.get_event_for_photo(k);assert(h!=null);a=h.unique_id;d=function(t){ModalProgress.show(_("Undoing..."));return new Ajax.DBRequest("/photos_undo_remove",{parameters:{collection_gid:m.gid,changeset:t},html_in_error_msg:true,progress_text:_("Undoing..."),onSuccess:function(u){var v=this;ModalProgress.update("1/3");return Photos._refresh_view(function(){var w;ModalProgress.update("2/3");w=Photos.get_timeline().events.valueFromKey(a);assert(w!=null,"cannot find event after restoration of photos");w.on_load_all_metadata=function(){var A,y,z,x;PhotosCollections.refresh_album_views([m.gid]);if(Lightbox.shown){Lightbox.jump_to(l)}else{Photos.get_timeline().scroll_to_photo_with_key(g);for(z=0,x=f.length;z<x;z++){y=f[z];PhotosSelection._add(Photos.get_timeline().key_to_photo[y])}}A=_("Undo complete");return Notify.server_success(A)};if(w.has_loaded_metadata()){w.on_load_all_metadata();w.on_load_all_metadata=null}else{w.load_metadata(null)}return ModalProgress.hide()})}})};return new Ajax.DBRequest("/collection_remove",{parameters:{collection_gid:m.gid,item_counters:Util.to_json(p),num_items:m.num_items,is_shared:m.share_tkey!=null},job:q,progress_text:_("Removing from album..."),onSuccess:function(x){var v,y,u,w,t;y=Util.from_json(x.responseText);m.thumbnail_url_32=y.thumbnail_url_32;m.thumbnail_url_256=y.thumbnail_url_256;m.num_photos=y.new_num_photos;m.num_videos=y.new_num_videos;m.num_items=y.new_num_items;PhotosCollections._collection_updated(m);u=Photos.undo_enabled?y.undo_changeset:null;Notify.server_success(_("Removed %(files_desc)s from '%(collection_name)s.'").format({files_desc:n,collection_name:m.name}),null,null,u,d);PhotosSelection.clear();for(v=w=0,t=s.length;w<t;v=++w){e=s[v];Photos.get_timeline().remove_photos([e])}return o.refresh_album_views()}})},set_as_cover:function(b,a){var c=this;return new Ajax.DBRequest("/collection_set_cover",{parameters:{collection_gid:b.gid,item_counter:a.item_counter},onSuccess:function(d){var f,e;e=Util.from_json(d.responseText);b.thumbnail_url_32=e.thumbnail_url_32;b.thumbnail_url_256=e.thumbnail_url_256;c.refresh_album_views();f=_("Changed cover photo for '%(collection_name)s'");f=f.format({collection_name:b.name.escapeHTML()});return Notify.server_success(f)}})},_add_to_album_new:function(a){document.stopObserving("click",FreshDropdown.hide_all);return this.create(a,$("add-to-album-new").down(".new-album-text"))},_add_to_album_sidebar_new:function(b,a){var c;if(a&&!PhotosSelection._drag_drop.active){return}if(PhotosSelection._drag_drop.single_photo!=null){c=[PhotosSelection._drag_drop.single_photo]}else{c=PhotosSelection.get()}$("add-to-album-sidebar-new").addClassName("editing");return this.create(b,$("add-to-album-sidebar-new").down(".collection-name"),c,true)},show_delete_modal:function(b){var a;DomUtil.fillVal(b.name.escapeHTML(),"collection-delete-name");a=_("Delete album?");return Modal.icon_show("delete_32",a,DomUtil.fromElm("collection-delete-modal"),{action:this["delete"].curry(b)})},"delete":function(a){var b=this;if(a.num_items>50){Notify.server_success(_("Deleting '%(collection_name)s'...").format({collection_name:a.name}),100)}if(a.share_tkey!=null){new Ajax.DBRequest("/sm/disable/"+a.share_tkey)}return new Ajax.DBRequest("/collection_delete",{parameters:{collection_gid:a.gid,num_items:a.num_items,is_shared:a.share_tkey!=null},onSuccess:function(c){var d;PhotosCollections._collections.removeItem(a);PhotosCollections._anonymous_collections.removeItem(a);if(!PhotosCollections._all_collections_loaded){PhotosCollections._removed_pre_load.push(a.gid)}PhotosCollections.refresh_album_views();if(((d=Photos.get_current_collection())!=null?d.gid:void 0)===a.gid){Photos.show_all_collections()}delete PhotosCollections._gid_to_collection[a.gid];return Notify.server_success(_("Deleted '%(collection_name)s'").format({collection_name:a.name}))},onFailure:function(){return Notify.server_error()}})},rename:function(d,c){var a,b,e=this;Photos.enable_selection();b=function(h){var m,l,k,g,j,f;l=h.responseText;if(((j=Photos.get_current_collection())!=null?j.gid:void 0)===d.gid){$("single-collection-title").__date(l.em_snippet(e.HEADER_COLLECTION_SNIPPET_LENGTH,1));document.title=""+l+" - Dropbox"}f=e._collections;for(k=0,g=f.length;k<g;k++){m=f[k];if(m.gid===d.gid){m.name=l;e._collection_updated(m);break}}e._gid_to_collection[d.gid].name=l;e.refresh_album_views();return Notify.server_success(_("Renamed '%(collection_name)s'").format({collection_name:l}))};a=new Ajax.InPlaceEditor(c,"/collection_rename",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:11,ajaxClass:Ajax.DBRequest,submitOnBlur:true,initialText:d.name,cancelIfSame:true,clickToEdit:false,onComplete:function(){return $("single-collection-title-container").removeClassName("editing")},onFailure:function(){},savingText:_("Saving..."),onLeaveEditMode:Photos.disable_selection,onLeaveHover:function(){},ajaxOptions:{method:"POST",onSuccess:b},callback:function(f,g){return{collection_gid:d.gid,new_collection_name:g,is_shared:d.share_tkey!=null}}});return a.enterEditMode()},create:function(n,m,r,c){var d,g,k,a,f,j,p,q,o,b,l,h=this;if(c==null){c=false}if(n){Event.extend(n).preventDefault();l=$(n.target);if(l.hasClassName("inplaceeditor-form")||(l.up(".inplaceeditor-form")!=null)){return}if(l.up("#context-menu")){g=true}else{if(l.up(".freshdropdown-menu")){f=true}}}Photos.enable_selection();if(!r){r=PhotosSelection.get()}a=(function(){var t,s,e;e=[];for(t=0,s=r.length;t<s;t++){b=r[t];e.push(b.path)}return e})();j=(function(){var t,s,e;e=[];for(t=0,s=r.length;t<s;t++){b=r[t];e.push(b.item_counter)}return e})();r.sort_by_key(function(e){return e.time_taken});p=r.length>this.NUM_PHOTOS_LONG_RUNNING_ADDS;d=Class.create({initialize:function(s,e){if(e==null){e={}}if(Photos._creating_filetags){return Photos._creating_filetags_cb=function(){return new Ajax.DBRequest(s,e)}}else{return new Ajax.DBRequest(s,e)}}});o=function(s){var t,e,u;t=Util.from_json(s.responseText);t.is_anonymous=false;PhotosSelection.clear();h._gid_to_collection[t.gid]=t;h._collections.unshift(t);FreshDropdown.hide_all();ContextMenu.hide();Modal.hide();$("add-to-album-sidebar-new").removeClassName("editing");h.refresh_album_views();Photos.disable_selection();$("add-to-album-new").down(".new-album-text").__date(_("New album"));u=_("Created '%(collection_name)s'");e=t.name.escapeHTML();u=u.format({collection_name:"<a data-gid='"+t.gid+"' class='show-collection-target'>"+e+"</a>"});Notify.server_success(new HTML(u));return h.flash_sidebar_album(t.gid)};q=function(){if(!f){FreshDropdown.hide_all()}if(!g){ContextMenu.hide()}$("add-to-album-sidebar-new").removeClassName("editing");PhotosCollections.render_add_to_album_menu();PhotosCollections.render_albums_sidebar();return Photos.disable_selection()};k=new Ajax.InPlaceEditor(m,"/collection_create",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:11,ajaxClass:d,submitOnBlur:c,initialText:"",cancelIfSame:true,clickToEdit:false,onCancel:q,onFailure:function(){},savingText:_("Creating..."),onLeaveEditMode:Photos.disable_selection(),onLeaveHover:function(){},ajaxOptions:{method:"POST",onSuccess:o,job:p,progress_text:_("Creating album...")},callback:function(e,t){var s;Notify.server_success(_("Creating album..."));s={collection_name:t,is_all_photos:Photos._is_all_photos};if(s.is_all_photos){s.item_counters=Util.to_json(j);if(Photos.in_single_collection_view()){s.source_collection_gid=Photos.get_current_collection().gid}}else{s.fq_paths=Util.to_json(a)}return s}});k.enterEditMode();if(!c){return k._controls.editor.observe("blur",q)}},header_rename:function(){if($("single-collection-title-container").hasClassName("editing")){return}$("single-collection-title-container").addClassName("editing");return this.rename(Photos.get_current_collection(),$("single-collection-title"))},toggle_add_to_album:function(a){var b;if(a){Event.extend(a).preventDefault()}if(!$("add-to-album-menu").visible()){FreshDropdown.show($("add-to-album-menu"),$("add-to-album-button"))}b=PhotosSelection.get();if(b.length<=this.NUM_PHOTOS_LONG_RUNNING_ADDS){return Photos._async_create_filetags(b)}},toggle_share_add_to_album:function(a){if(a){Event.extend(a).preventDefault()}if(!$("share-add-to-album-menu").visible()){return FreshDropdown.show($("share-add-to-album-menu"),$("share-add-to-album-button"))}},toggle_more_actions:function(a){var b;if(a){Event.extend(a).preventDefault()}if(!$("more-collection-actions-menu").visible()){if(Photos.get_current_collection().share_tkey!=null){$("unshare-album").show()}else{$("unshare-album").hide()}if(($j.browser.msie!=null)&&$j.browser.msie){b=$j("#more-collection-actions-menu");if(!b.parent().is("body")){$j(document.body).append(b.remove())}}return FreshDropdown.show($("more-collection-actions-menu"),$("more-collection-actions-button"))}},show_add_to_album_modal:function(a,b){if(b!==PhotosSelection.get()&&!(PhotosSelection._drag_drop.single_photo!=null)){PhotosSelection._context_selected=b}Modal.onHide=function(){PhotosSelection._context_selected=null;delete Modal.onHide;return Modal.hide()};return Modal.show(_("Choose an album"),$("add-to-album-modal"),false,false,893)},_collection_updated:function(a){this._collections.removeItem(a);this._collections.unshift(a);return this.refresh_album_views()},_albums_list_item_contextmenu:function(b,a){ContextMenu.show_photo_collection(b,this.get(a.readAttribute("data-gid")),a);a.removeClassName("album-flash");return a.addClassName("context-selected")},_show_collection_click:function(c,a){var b;b=$(c.target);if(b.hasClassName("inplaceeditor-form")||(b.up(".inplaceeditor-form")!=null)){return}return Photos.show_collection(a.readAttribute("data-gid"))},_collection_shmodel_click:function(b,a){return this.go_to_link(this.get(a.readAttribute("data-gid")))},_add_to_album_click:function(b,a){if(PhotosSelection._context_selected){this.add_photos(this.get(a.readAttribute("data-gid")),PhotosSelection._context_selected);PhotosSelection._context_selected=null}else{this.add_photos(this.get(a.readAttribute("data-gid")),PhotosSelection.get())}delete Modal.onHide;Modal.hide();return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.SAH,{num_photos:PhotosSelection.get().length})},_drop_target_mouseover:function(b,a){if(PhotosSelection._drag_drop.active){a.addClassName("hovered");return $("photos-drag-status").addClassName("hovering")}},_drop_target_mouseout:function(b,a){if(PhotosSelection._drag_drop.active){a.removeClassName("hovered");return $("photos-drag-status").removeClassName("hovering")}},_drop_target_mouseup:function(b,a){var c;if(a.hasClassName("hovered")){a.removeClassName("hovered");$("photos-drag-status").removeClassName("hovering");if(PhotosSelection._drag_drop.single_photo!=null){c=[PhotosSelection._drag_drop.single_photo]}else{c=PhotosSelection.get()}if(a.readAttribute("data-gid")!=null){this.add_photos(this.get(a.readAttribute("data-gid")),c,false)}if(a.identify()==="add-to-album-sidebar-new"){return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_NEW_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})}else{if(a.identify()==="all-albums-sidebar"){return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})}else{return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})}}}},_create_album_click:function(a,b){if(PhotosSelection._context_selected){this.create(a,b.down(".collection-name"),PhotosSelection._context_selected,true);return PhotosSelection._context_selected=null}else{return this.create(a,b.down(".collection-name"),PhotosSelection.get(),true)}},_window_scroll:function(){if(Photos.in_all_collections_view()){return this._all_albums_scroll_position=Util.scroll_offsets().top}},restore_all_albums_scroll_position:function(){if(this._all_albums_scroll_position!=null){return window.scrollTo(0,this._all_albums_scroll_position)}else{return window.scrollTo(0,0)}},two_line_snippet:function(c,b){var a,e,d;a=c.em_snippet(b,1);e=a.lastIndexOf(" ");if(e===-1){return a}else{a=a.slice(0,e+1||9000000000);d=c.slice(e+1).em_snippet(b,1);return a+d}},get_default_album_name:function(){var a;a=_("Untitled album");return this.increment_collection_name_until_valid(a)},collection_name_in_use:function(b){var e,d,a,c;c=this.get_all();for(d=0,a=c.length;d<a;d++){e=c[d];if(e.name===b.trim()){return true}}return false},increment_collection_name_until_valid:function(b){var c,a;c=this.collection_name_in_use(b);a=0;while(c){a++;c=this.collection_name_in_use(b+(" ("+a+")"))}return(a===0?b:b+(" ("+a+")"))},refresh_collection:function(e){var b,d,c,a;this._gid_to_collection[e.gid]=e;a=[];for(b=d=0,c=this._collections.length;0<=c?d<c:d>c;b=0<=c?++d:--d){if(this._collections[b].gid===e.gid){this._collections[b]=e;break}else{a.push(void 0)}}return a},flash_sidebar_album:function(e){var f,d,b,c,a;c=$$(".sidebar-album");a=[];for(d=0,b=c.length;d<b;d++){f=c[d];if(f.readAttribute("data-gid")===e){f.removeClassName("album-flash");f.addClassName("album-flash");break}else{a.push(void 0)}}return a}};var PhotoTimeline;PhotoTimeline=(function(){a.prototype.THUMB_SIZE=158;a.prototype.HEADER_HEIGHT=51;a.prototype.THUMBS_PER_ROW=5;a.prototype.RENDER_SCROLL_WAIT=100;a.prototype.RENDER_SCROLL_MAX_WAIT=750;a.prototype.HIDE_TIMELINE_NAV_DELAY=1500;a.prototype.THUMBS_BATCH_SIZE=15;a.prototype.VIEWPORT_SCALE_SCROLL_DIRECTION=4;a.prototype.VIEWPORT_SCALE_OTHER_DIRECTION=1;a.prototype.TIMELINE_NAV_MOUSE_THRESHOLD=100;a.prototype.TIMELINE_NAV_ELM_HEIGHT=20;a.prototype.TIMELINE_DOT_HTML=Sprite.html("web","timeline_dot");a.container;a.events;a.current_event;a.photos;a.key_to_photo;a.key_to_duplicates;a.preview_objs;a.filters;a.tmpl;a.last_render_scroll_timeout;a.start_render_scroll_time;a.last_scroll_position;a.hide_timeline_nav_timeout;a.grid;a._skip_scroll_update;a.header_id_to_sel_items;a.events_to_removed_photos;a.removed_events;a.events_to_remove;function a(b,g,h,f,c,e,j,d,k){this.container=b;this.photos=[];this.key_to_photo={};this.key_to_duplicates={};this.preview_objs=[];this.filters=d;this.tmpl=k;this.start_render_scroll_time=-1;this.grid={};this._skip_scroll_update=false;this.header_id_to_sel_items=j;this.events_to_removed_photos={};this.removed_events=[];this.events_to_remove=[];if(Photos._is_all_photos){this.THUMB_SIZE=198;this.THUMBS_PER_ROW=4;this.THUMBS_BATCH_SIZE=12}this._init_events(f,c,e);if(this.events.valueAtIndex(0).is_collection()){this.HEADER_HEIGHT=4}this.update_offsets(g,h);this.listen();Velocity.start_capture()}a.prototype._init_events=function(m,d,g){var c,j,p,f,h,e,l,n,b,k,o;if(m.length<1){this.events=new SuperDictionary([],{});return}j=[];h={};e=0;l=0;p=false;for(k=0,o=m.length;k<o;k++){f=m[k];f=String(f);b=f in this.header_id_to_sel_items?this.header_id_to_sel_items[f]:[];n=false;if(b.length&&!p){p=true;n=true}c=new PhotoEvent(this,f,d[f],g[f],b,n,e,l);j.push(f);h[f]=c;e+=g[f];l+=Math.ceil(g[f]/this.THUMBS_PER_ROW)+1}return this.events=new SuperDictionary(j,h)};a.prototype.listen=function(){this._bound_window_scroll=this._window_scroll.bind(this);this._bound_window_resize=this._window_resize.bind(this);this._body_mousemove_handler=$(document.body).on("mousemove",this._body_mousemove.bind(this));this._timeline_elm_click_handler=$(document.body).on("click",".timeline-elm",this._timeline_elm_click.bind(this));Event.observe(window,"scroll",this._bound_window_scroll);return Event.observe(window,"resize",this._bound_window_resize)};a.prototype.unlisten=function(){var c,b;if((c=this._body_mousemove_handler)!=null){c.stop()}if((b=this._timeline_elm_click_handler)!=null){b.stop()}Event.stopObserving(window,"scroll",this._bound_window_scroll);return Event.stopObserving(window,"resize",this._bound_window_resize)};a.prototype.render=function(){this._render_empty_grid();this.init_timeline_nav();this._load_metadata_for_sel_events();return this._render_viewport()};a.prototype.update_offsets=function(j,k){var b,h,f,e,l,g,d,c;this.top_offset=j;this.grid.photo_row_offsets=[];g=this.events.getValues();for(f=0,l=g.length;f<l;f++){b=g[f];b.top_offset=j;b.create_global_row_heights();j+=b.height}this.left_offset=k;this.grid.photo_col_offsets=[];c=[];for(h=e=0,d=this.THUMBS_PER_ROW;0<=d?e<=d:e>=d;h=0<=d?++e:--e){c.push(this.grid.photo_col_offsets.push(this.left_offset+this.THUMB_SIZE*h))}return c};a.prototype._render_empty_grid=function(){var d,f,c,e,b;this.container.__date();e=this.events.getValues();b=[];for(f=0,c=e.length;f<c;f++){d=e[f];b.push(d.add_html_elements_to(this.container))}return b};a.prototype._render_viewport=function(e){var m,c,n,p,q,k,j,g,o,d,b,l,h,f;if(e==null){e=false}this.start_render_scroll_time=-1;q=Util.get_viewport();n=[];l=this.events.getValues();for(k=0,o=l.length;k<o;k++){c=l[k];if(!c.has_loaded_metadata()&&!c.loading_metadata){if(c.in_current_viewport(q,false)){n.unshift(c)}else{if(c.in_current_viewport(q,true)){n.push(c)}}}}for(j=0,d=n.length;j<d;j++){c=n[j];h=c.get_row_range_to_render(q,true),p=h[0],m=h[1];if(m!=null){assert(!isNaN(m),"Bottom row to render should not be NaN");c.load_metadata(m)}}if(e){q=Util.get_viewport();f=this.events.getValues();for(g=0,b=f.length;g<b;g++){c=f[g];if(c.in_current_viewport(q,false)){c.timing_stopped_scrolling_on_event=Util.time()-this.RENDER_SCROLL_WAIT}}}return this._load_visible_photos()};a.prototype._load_metadata_for_sel_events=function(){var d,f,b,e,c;e=this.header_id_to_sel_items;c=[];for(f in e){b=e[f];d=this.events.valueFromKey(f);if(d!=null){d.load_metadata()}c.push(assert(d!=null,"Missing "+f+" in list of events with selected photos"))}return c};a.prototype._load_visible_photos=function(){var d,f,c,e,b;e=this.events.getValues();b=[];for(f=0,c=e.length;f<c;f++){d=e[f];b.push(d.update_photo_divs())}return b};a.prototype._body_mousemove=function(b){if((b.clientX+Util.scroll_offsets().left)>=($(document.body).getWidth()-this.TIMELINE_NAV_MOUSE_THRESHOLD)){return $("timeline-nav").addClassName("mouse-active")}else{return $("timeline-nav").removeClassName("mouse-active")}};a.prototype._timeline_elm_click=function(g,f){var c,d,b;d=f.readAttribute("data-event-id");if(d){c=this.events.valueFromKey(d)}this._update_timeline_position(c);if(c.is_missing_timestamp_bucket()){PhotosLogger.log_interaction(PhotosViews.MISSING_TIMESTAMPS_VIEW)}b=c.top_offset-this.top_offset;if(c&&(Util.scroll_offsets().top!==b)){this._skip_scroll_update=true;return window.scrollTo(Util.scroll_offsets().left,b)}};a.prototype._window_scroll=function(){var e,d,h,g,c,f,b,j=this;d=Util.time();BatchThumbLoader.batch_load_thumbs_queue=[];if(this.start_render_scroll_time===-1||d-this.start_render_scroll_time<this.RENDER_SCROLL_MAX_WAIT){clearTimeout(this.last_render_scroll_timeout)}if(this.start_render_scroll_time===-1){this.start_render_scroll_time=d}h=this.visible_thumbs_loaded()?0:this.RENDER_SCROLL_WAIT;this.last_render_scroll_timeout=setTimeout(this._render_viewport.curry(true).bind(this),h);this._update_timeline_position();$("timeline-nav").addClassName("scroll-active");clearTimeout(this.hide_timeline_nav_timeout);this.hide_timeline_nav_timeout=setTimeout((function(){return $("timeline-nav").removeClassName("scroll-active")}),this.HIDE_TIMELINE_NAV_DELAY);this.last_scroll_position=Util.scroll_offsets().top;Photos.scroll_count++;f=this.events.getValues();b=[];for(g=0,c=f.length;g<c;g++){e=f[g];b.push(e.logged_thumbs_arrived=false)}return b};a.prototype._window_resize=function(){this._resize_timeline_nav();return this._show_hide_timeline_elms()};a.prototype.init_timeline_nav=function(){var c,e,b,d;this.grid.side_nav={};this.current_event=null;$("timeline-nav").__date();this._resize_timeline_nav();d=this.events.getValues().reverse();for(e=0,b=d.length;e<b;e++){c=d[e];c.add_to_timeline_nav(c===this.events.getValues()[0])}this._update_timeline_position();return this._show_hide_timeline_elms()};a.prototype._resize_timeline_nav=function(){var b;b=Util.viewport_dimensions().height-this.TIMELINE_NAV_ELM_HEIGHT;return $("timeline-nav").setStyle({height:b+"px"})};a.prototype._update_timeline_position=function(h){var l,j,b,f,e,k,c,g,d;if(this._skip_scroll_update){this._skip_scroll_update=false;return}if(!(h!=null)){l=document.viewport.getScrollOffsets().top+Util.viewport_dimensions().height/2;g=this.events.getValues();for(f=0,k=g.length;f<k;f++){b=g[f];if(b.top_offset>l){break}h=b}}if(!(h!=null)||h===this.current_event){return}$$(".timeline-elm.current").invoke("removeClassName","current");d=$$(".timeline-elm");for(e=0,c=d.length;e<c;e++){j=d[e];if(j.readAttribute("data-event-id")===h.unique_id){j.addClassName("current");break}}return this.current_event=h};a.prototype._show_hide_timeline_elms=function(){var j,f,d,e,h,c,g,b;d=$("cu-header").cumulativeOffset().left+$("cu-header").getWidth();f=$("cu-header").cumulativeOffset().top+$("cu-header").getHeight();g=$$(".timeline-elm");b=[];for(h=0,c=g.length;h<c;h++){j=g[h];j.show();e=j.cumulativeOffset();if(e.top<f&&e.left<d){b.push(j.hide())}else{b.push(void 0)}}return b};a.prototype.get_thumb_elm_for_photo=function(b){return $(b.uniqueness_key)};a.prototype.get_photo_for_thumb_elm=function(b){if(!b.hasClassName("cu-thumb")){b=b.up(".cu-thumb")}if(b){return this.key_to_photo[b.identify()]}else{return null}};a.prototype.get_preview_obj=function(b){if(b.preview_type==="photo"&&b.large_thumbnail_url){if(Photos.in_single_collection_view()){return new SingleCollectionPhotoPreview(b.filename,b.path,b.large_thumbnail_url,b.href+"&dl=1",b.href,b.display_time_taken,null,b)}else{return new AllPhotosPhotoPreview(b.filename,b.path,b.large_thumbnail_url,b.href+"&dl=1",b.href,b.display_time_taken,null,b)}}else{if(b.preview_type==="video"&&b.large_thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){if(Photos.in_single_collection_view()){return new SingleCollectionVideoPreview(b.filename,b.path,b.large_thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+b.block_hash+(Util.urlquote(b.path)),b.href+"&dl=1",b.display_time_taken,null,b)}else{return new AllPhotosVideoPreview(b.filename,b.path,b.large_thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+b.block_hash+(Util.urlquote(b.path)),b.href+"&dl=1",b.display_time_taken,null,b)}}}return null};a.prototype.scroll_to_photo_with_key=function(c){var g,d,b,f,e;g=$(c);if(g!=null?g.visible():void 0){Util.scroll_to_thumb(g)}else{b=this.key_to_photo[c];d=this.get_event_for_photo(b);if(d!=null){f=Math.floor(d.photos.indexOf(b)/this.THUMBS_PER_ROW);e=Util.viewport_dimensions().height;Util.scroll_to(0,d.top_offset+this.HEADER_HEIGHT+f*this.THUMB_SIZE-e/2)}}return this._load_visible_photos()};a.prototype.restore_scroll_position=function(){if(this.last_scroll_position!=null){window.scrollTo(0,this.last_scroll_position)}else{window.scrollTo(0,0)}if(Prototype.Browser.IE&&Prototype.Browser.IEV<9){return this._load_visible_photos()}};a.prototype.get_event_for_photo=function(d,c){var j,f,h,b,g;if(c==null){c=this.photos.indexOf(d)}g=this.events.getValues();for(h=0,b=g.length;h<b;h++){j=g[h];if(j.photo_index_offset>c){break}f=j}return f};a.prototype._remove_photo=function(b,c){var e,d,f;if(c==null){c=false}e=this.get_event_for_photo(b);d={photo:b,duplicates:(f=this.key_to_duplicates[b.uniqueness_key])!=null?f:[],photo_local_index:e.photos.indexOf(b)};if(this.events_to_removed_photos[e.unique_id]!=null){this.events_to_removed_photos[e.unique_id].push(d)}else{this.events_to_removed_photos[e.unique_id]=[d]}return e.remove_photo(b,true)};a.prototype.remove_photos=function(o){var b,n,l,c,e,j,h,m,d,k,g,f;o=o.slice(0);this.events_to_removed_photos={};this.removed_events=[];this.events_to_remove=[];for(l=j=0,m=o.length;j<m;l=++j){c=o[l];this._remove_photo(c,true)}k=this.events_to_remove;for(h=0,d=k.length;h<d;h++){b=k[h];this.remove_event(b)}this.events_to_remove=[];if(this.events.length()===0){Photos.set_empty_state()}g=this.events_to_removed_photos;f=[];for(n in g){e=g[n];b=this.events.valueFromKey(n);f.push(b!=null?b.update_photo_divs():void 0)}return f};a.prototype._num_photos_removed=function(){var b,d,e,c;b=0;c=this.events_to_removed_photos;for(d in c){e=c[d];b+=e.length}return b};a.prototype.restore_removed_photos=function(){var b,p,j,q,l,k,o,c,d,n,m,g,h,f,e;l=this._num_photos_removed();k=this.photos.length;while(this.removed_events.length>0){o=this.removed_events.pop();this.events.insertAtIndex(o.index,o.event.unique_id,o.event);o.event.restore()}PhotosSelection.clear();h=this.events_to_removed_photos;for(p in h){d=h[p];b=this.events.valueFromKey(p);for(j=g=f=d.length-1;g>=0;j=g+=-1){c=d[j];b.add_photo(c.photo,c.photo_local_index,true);PhotosSelection._add(c.photo)}b.update_photo_divs();b._check_row_display_states()}n=null;e=this.events_to_removed_photos;for(p in e){d=e[p];b=this.events.valueFromKey(p);if(!(n!=null)||n.photo_index_offset>b.photo_index_offset){n=b}}m=this.events_to_removed_photos[n.unique_id][0];this.removed_events=[];this.events_to_removed_photos={};Photos.hide_empty_state();this.init_timeline_nav();this.scroll_to_photo_with_key(m.photo.uniqueness_key);assert(this.photos.length===k+l);q=this.events.valueAtIndex(this.events.length()-1);assert(q.photo_index_offset===this.photos.length-q.num_photos);return assert(PhotosSelection.get().length===l)};a.prototype.queue_remove_event=function(b){return this.events_to_remove.push(b)};a.prototype.remove_event=function(c){var d,b;d=this.events.indexOfKey(c.unique_id);b={event:c,index:d};this.removed_events.push(b);this.events.remove(c.unique_id);return this.init_timeline_nav()};a.prototype.visible_thumbs_loaded=function(){var c,e,b,d;d=this.events.getValues();for(e=0,b=d.length;e<b;e++){c=d[e];if(!c.visible_thumbs_loaded()){return false}}return true};a.prototype.has_missing_timestamp_bucket=function(){var b;b=this.events.getValues();return b[b.length-1].is_missing_timestamp_bucket()};return a})();var PhotoEvent;PhotoEvent=(function(){a.prototype.MONTH_PREFIX="m_";a.prototype.COLLECTION_PREFIX="c_";a.prototype.EVENT_PREFIX="e_";a.prototype.MISSING_TIMESTAMP_PREFIX="a_";a.prototype.NUM_LIGHTBOX_PHOTOS_TO_PRELOAD=5;a.prototype.METADATA_CACHE_VERSION=1;a.prototype.EVENT_METADATA_CACHE_LOAD="e";a.prototype.BROWSER_CACHE_LOAD="b";a.prototype.MAX_PHOTOS_PER_METADATA_REQUEST=500;a.timeline;a.unique_id;a.name;a.num_photos;a.num_rows;a.photos;a.key_to_duplicates;a.header_html;a.placeholder_html;a.photos_html;a.height;a.top_offset;a.photo_index_offset;a.photo_row_offset;a.displaying_row;a.rendered_row;a.loading_metadata;a.cursor;a.num_rows_loaded_metadata;a.num_rows_to_load_metadata;a.on_load_all_metadata;a.metadata_cache_key;a.init_sel_items;a.scroll_to_first_sel;a.num_to_select;a.logged_thumbs_arrived;a.timing_metadata_received;a.timing_stopped_scrolling_on_event;a.scroll_count;function a(o,k,c,l,b,j,n,d){var h,p,f,e,m,g;this.timeline=o;this.unique_id=k;this.name=c;this.num_photos=l;this.init_sel_items={};for(f=0,m=b.length;f<m;f++){p=b[f];this.init_sel_items[p]=true}this.num_to_select=b.length;this.scroll_to_first_sel=j;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);this.photos=[];this.key_to_duplicates={};this.photos_html=[];this.displaying_row=[];this.rendered_row=[];for(h=e=0,g=this.num_rows;0<=g?e<g:e>g;h=0<=g?++e:--e){this.displaying_row[h]=false;this.rendered_row[h]=false}this.photo_index_offset=n;this.photo_row_offset=d;this._generate_container_html();this._create_global_array_placeholders();this.timing_metadata_received=-1;this.timing_stopped_scrolling_on_event=-1;this.num_rows_loaded_metadata=0;this.num_rows_to_load_metadata=0;this.loading_metadata=false;this.metadata_cache_key=["photo_event",this.unique_id,Constants.uid,this.METADATA_CACHE_VERSION];if(l===0){$("single-album-empty").show()}}a.prototype.is_month=function(){return this.unique_id.slice(0,2)===this.MONTH_PREFIX};a.prototype.is_missing_timestamp_bucket=function(){return this.unique_id.slice(0,2)===this.MISSING_TIMESTAMP_PREFIX};a.prototype.get_month=function(){var b;assert(this.is_month(),"this must be a month event");b=parseInt(this.unique_id.slice(6,8),10);assert(!isNaN(b),"Month was not parsed out of the event id "+this.unique_id+" correctly.");return b};a.prototype.get_year=function(){var b;assert(this.is_month(),"this must be a month event");b=parseInt(this.unique_id.slice(2,6),10);assert(!isNaN(b),"Year was not parsed out of the event id "+this.unique_id+" correctly.");return b};a.prototype.is_collection=function(){return this.unique_id.slice(0,2)===this.COLLECTION_PREFIX};a.prototype.get_collection_gid=function(){assert(this.is_collection(),"this must be a collection event");return this.unique_id.slice(2)};a.prototype.is_event=function(){return this.unique_id.slice(0,2)===this.EVENT_PREFIX};a.prototype._generate_container_html=function(){var e,c,f,h,d,b,g;h=this.name;if(this.is_event()){this.header_html=new Element("h1",{id:"h-"+this.unique_id,"class":"cu-month-header"});this.header_html.__sert(h);e=new Element("div",{"class":"event-button event-add-to-album title_bubble","data-title":"Add to album"});e.__date(Sprite.html("web","event_add_to_album"));this.header_html.__sert(e);g=new Element("div",{"class":"event-button event-share title_bubble","data-title":"Share"});g.__date(Sprite.html("web","event_share"));this.header_html.__sert(g);b=new Element("div",{"class":"event-button event-select title_bubble","data-title":"Select all"});b.__date(Sprite.html("web","event_select"));this.header_html.__sert(b)}else{this.header_html=new HTML("<h1 class='cu-month-header' id='h-"+this.unique_id+"'>"+h+"</h1>")}c=this.num_rows*this.timeline.THUMB_SIZE;d=this.num_photos%this.timeline.THUMBS_PER_ROW;f=d===0?0:(this.timeline.THUMBS_PER_ROW-d)*this.timeline.THUMB_SIZE;this.placeholder_html=new HTML('<div style="height: '+c+'px;" id="p-'+this.unique_id+'" class="content-placeholder-container">\n  <div style="height: '+c+'px;" id="p-top-'+this.unique_id+'" class="content-placeholder"></div>\n  <div style="height: 0px;" id="p-bottom-'+this.unique_id+'" class="content-placeholder"></div>\n  <div style="width: '+f+'px" id="p-cover-'+this.unique_id+'" class="thumb-cover"></div>\n</div>');return this.height=this.timeline.HEADER_HEIGHT+c};a.prototype.add_to_timeline_nav=function(k){var b,h,l,c,m,f,g,e,j,d;if(k==null){k=false}if(!(this.is_month()||this.is_event()||this.is_missing_timestamp_bucket())){return}d=Util.get_viewport().height;m=this.timeline.TIMELINE_NAV_ELM_HEIGHT;g=$(document.body).getHeight();f=100;if(this.timeline.has_missing_timestamp_bucket()&&Photos._is_all_photos){f=100-m/d*100;g-=this.timeline.events.valueAtIndex(this.timeline.events.length()-1).height}e=this.top_offset/g*f;if(this.is_event()){c=this.name}else{if(this.is_missing_timestamp_bucket()&&Photos._is_all_photos){c=_("Missing dates");e=f}else{c=Util.monthAbrWithYear(this.get_month()-1,this.get_year())}}l=false;for(j in this.timeline.grid.side_nav){b=Math.abs(this.timeline.events.valueFromKey(j).top_offset-this.top_offset);if(b/g*d<m){l=true;if(k){$("timeline-nav-"+j).remove()}}}if(!l||k){h=new Element("div",{"class":"timeline-elm",style:"top: "+e+"%",id:"timeline-nav-"+this.unique_id,"data-event-id":this.unique_id});h.__date(new HTML(c));$("timeline-nav").__sert(h);return this.timeline.grid.side_nav[this.unique_id]=e}};a.prototype._create_global_array_placeholders=function(){var c,e,d,b;b=[];for(c=e=0,d=this.num_photos;0<=d?e<d:e>d;c=0<=d?++e:--e){this.timeline.preview_objs[this.photo_index_offset+c]=this.unique_id;b.push(this.timeline.photos[this.photo_index_offset+c]=this.unique_id)}return b};a.prototype.create_global_row_heights=function(){var f,c,e,d,b;f=this.top_offset;this.timeline.grid.photo_row_offsets[this.photo_row_offset]=this.top_offset;f+=this.timeline.HEADER_HEIGHT;b=[];for(c=e=0,d=this.num_rows;0<=d?e<d:e>d;c=0<=d?++e:--e){b.push(this.timeline.grid.photo_row_offsets[this.photo_row_offset+c+1]=f+c*this.timeline.THUMB_SIZE)}return b};a.prototype._num_photos_changed=function(){var d,c,b;d=this.num_rows*this.timeline.THUMB_SIZE;this.height=this.timeline.HEADER_HEIGHT+d;$("p-"+this.unique_id).setStyle({height:d+"px"});b=this.num_photos%this.timeline.THUMBS_PER_ROW;c=b!==0?(this.timeline.THUMBS_PER_ROW-b)*this.timeline.THUMB_SIZE:0;return $("p-cover-"+this.unique_id).setStyle({width:c+"px"})};a.prototype.add_metadata_to_global_arrays=function(p,o,g){var m,h,b,l,c,f,e,n,k,d;if(!p){p=this.photos;o=this.key_to_duplicates;g=0}l=[];for(m=f=0,n=p.length;f<n;m=++f){b=p[m];c=this.timeline.get_preview_obj(b);this.timeline.preview_objs[this.photo_index_offset+m+g]=c;if(m+g<this.NUM_LIGHTBOX_PHOTOS_TO_PRELOAD){l.push(c)}this.timeline.photos[this.photo_index_offset+m+g]=b;this.timeline.key_to_photo[b.uniqueness_key]=b}if(m+g<this.num_photos){for(h=e=k=m+g,d=this.num_photos;k<=d?e<d:e>d;h=k<=d?++e:--e){this.timeline.preview_objs[this.photo_index_offset+h]=this.unique_id;this.timeline.photos[this.photo_index_offset+h]=this.unique_id}}Object.extend(this.timeline.key_to_duplicates,o);return window.setTimeout((function(){var r,q,j;j=[];for(r=0,q=l.length;r<q;r++){c=l[r];j.push(c.preload())}return j}),500)};a.prototype.load_metadata=function(b){var k,d,j,f,h,c,g,e=this;if((!(b!=null))||(b>this.num_rows-1)||this.num_to_select>0){b=this.num_rows-1}if(this.has_loaded_metadata()||(this.num_rows_loaded_metadata-1>=b)){return}if(this.loading_metadata){this.num_rows_to_load_metadata=Math.max(this.num_rows_to_load_metadata,b+1);return}k=this.load_cached_metadata();if(k===this.EVENT_METADATA_CACHE_LOAD){return}this.loading_metadata=true;h={is_all_photos:Photos._is_all_photos,include_shared_folders:Photos.include_shared_folders};if(this.cursor!=null){h.cursor=this.cursor}if(k!==this.BROWSER_CACHE_LOAD){if(this.is_collection()||Photos._is_all_photos){h.limit=(b+1)*this.timeline.THUMBS_PER_ROW-this.photos.length;if(h.limit>this.MAX_PHOTOS_PER_METADATA_REQUEST){this.num_rows_to_load_metadata=b;h.limit=this.MAX_PHOTOS_PER_METADATA_REQUEST}}}if(this.is_event()){c=this.unique_id.split("_");d=c[2];j=c[1];h.filters=Util.to_json({date_begin:d,date_end:j,file_type:this.timeline.filters.file_type})}else{if(this.is_missing_timestamp_bucket()){h.filters=Util.to_json({other:true,file_type:this.timeline.filters.file_type})}else{if(this.is_month()){g=this.get_year();f=this.get_month();d=Util.to_iso8601_date(new Date(g,f-1,1,0,0,0,0),false,true);j=Util.to_iso8601_date(new Date(g,f,1,0,0,0),false,true);h.filters=Util.to_json({date_begin:d,date_end:j,file_type:this.timeline.filters.file_type})}else{if(this.is_collection()){h.filters=Util.to_json({collection_gid:this.get_collection_gid()})}else{assert(false,"invalid photo event id: "+this.unique_id)}}}}return new Ajax.DBRequest("/photos_event_metadata",{parameters:h,allow_retries:true,onSuccess:function(l){var m;m=Util.from_json(l.responseText);e.timing_metadata_received=Util.time();e.cursor=m.cursor;if(k===e.BROWSER_CACHE_LOAD){if(e.cached_metadata_matches(m.photos,m.key_to_duplicates)){return}else{e.reset_cached_load()}}return e._load_metadata_callback(m.photos,m.key_to_duplicates,(m.more!=null)&&m.more,b)}})};a.prototype.has_loaded_metadata=function(){return this.num_rows_loaded_metadata===this.num_rows};a.prototype.load_cached_metadata=function(){var e,c,d,b,f;if(this.loading_metadata||this.num_rows_loaded_metadata>0){return false}if(((f=Photos.event_metadata_cache)!=null?f[this.unique_id]:void 0)!=null){e=Photos.event_metadata_cache[this.unique_id];this.cursor=e.cursor;d=e.more;if(d){c=Math.floor(e.photos.length/this.timeline.THUMBS_PER_ROW)}else{c=Math.ceil(e.photos.length/this.timeline.THUMBS_PER_ROW)}b=this.EVENT_METADATA_CACHE_LOAD}else{if(!Photos.local_storage_enabled){return false}e=DBLocalStorage.getItem(this.metadata_cache_key);if(e==null){return false}if(this.num_photos!==e.photos.length){return false}d=false;c=this.num_rows-1;b=this.BROWSER_CACHE_LOAD}this._load_metadata_callback(e.photos,e.key_to_duplicates,d,c);return b};a.prototype.write_metadata_to_cache=function(){if(!Photos.local_storage_enabled){return}assert(this.has_loaded_metadata(),"Shouldn't be writing to the cache with partial metadata");return DBLocalStorage.setItem(this.metadata_cache_key,{photos:this.photos,key_to_duplicates:this.key_to_duplicates})};a.prototype.cached_metadata_matches=function(d,b){var c;if(d.length!==this.photos.length||((function(){var e;e=[];for(c in b){e.push(c)}return e})()).length!==((function(){var e;e=[];for(c in this.key_to_duplicates){e.push(c)}return e}).call(this)).length){return false}if(Util.to_json(d)!==Util.to_json(this.photos)){return false}for(c in b){if(!(c in this.key_to_duplicates)){return false}if(b[c].length!==this.key_to_duplicates[c].length){return false}if(Util.to_json(b[c])!==Util.to_json(this.key_to_duplicates[c])){return false}}return true};a.prototype.reset_cached_load=function(){var f,e,j,g,d,h,b,c;h=this.photos;for(j=0,d=h.length;j<d;j++){e=h[j];if(PhotosSelection.contains(e)){PhotosSelection._remove(e)}}this.photos=[];this.key_to_duplicates={};this.photos_html=[];$$("#p-"+this.unique_id+" .cu-thumb").invoke("remove");$("p-top-"+this.unique_id).setStyle({height:this.num_rows*this.timeline.THUMB_SIZE+"px"});$("p-bottom-"+this.unique_id).setStyle({height:"0px"});c=[];for(f=g=0,b=this.num_rows;0<=b?g<b:g>b;f=0<=b?++g:--g){this.displaying_row[f]=false;c.push(this.rendered_row[f]=false)}return c};a.prototype._display_date=function(b){var c;if(b.time_taken!=null){c=new Date(b.time_taken);return Util.niceDateWithMonthName(c,c.getUTCFullYear()<new Date().getFullYear(),true)}else{return""}};a.prototype._load_metadata_callback=function(m,k,g,j){var f,l,b,n,e,d,h,c;this.photos=this.photos.concat(m);Object.extend(this.key_to_duplicates,k);for(f=e=0,h=m.length;e<h;f=++e){b=m[f];this.photos_html.push(this.timeline.tmpl({photo:b,display_date:this._display_date(b),shareable:true}))}PhotosSelection.refresh(m);this.add_metadata_to_global_arrays(m,k,this.num_rows_loaded_metadata*this.timeline.THUMBS_PER_ROW);for(d=0,c=m.length;d<c;d++){b=m[d];if(b.item_counter in this.init_sel_items){PhotosSelection._add(b);this.num_to_select--;if(this.num_to_select===0){PhotosSelection.dec_num_loading_events_before_share()}delete this.init_sel_items[b.item_counter];if(this.scroll_to_first_sel){this.scroll_to_first_sel=false;n=this.timeline;l=b.uniqueness_key;$j(document).ready(function(){return n.scroll_to_photo_with_key(l)})}}}if(g){this.num_rows_loaded_metadata=Math.floor(this.photos.length/this.timeline.THUMBS_PER_ROW)}else{this.num_rows_loaded_metadata=Math.ceil(this.photos.length/this.timeline.THUMBS_PER_ROW)}if(!g){this._fix_photo_count();this.write_metadata_to_cache();if(typeof this.on_load_all_metadata==="function"){this.on_load_all_metadata()}this.on_load_all_metadata=null}this.loading_metadata=false;this.update_photo_divs();if(!this.has_loaded_metadata()&&this.num_rows_to_load_metadata>j+1){return this.load_metadata(this.num_rows_to_load_metadata-1)}};a.prototype._fix_photo_count=function(){var h,c,j,d,b,m,k,l,f,g,e;if(this.photos.length!==this.num_photos){d=this.num_photos;b=this.num_rows;this.num_photos=this.photos.length;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);c=this.num_photos-d;j=this.num_rows-b;if(Photos._is_all_photos){PhotosLogger.log("event_miscount",null,null,null,{event_id:this.unique_id,false_count:d,true_count:this.num_photos,count_delta:c})}if(c<0){this.timeline.preview_objs.splice(this.photo_index_offset+this.num_photos,Math.abs(c));this.timeline.photos.splice(this.photo_index_offset+this.num_photos,Math.abs(c));this.timeline.grid.photo_row_offsets.splice(this.photo_row_offset+this.num_rows,Math.abs(j))}this.create_global_row_heights();this._num_photos_changed();l=Util.scroll_offsets().top;if(this.top_offset+this.height<l){Util.scroll_to(0,l+j*this.timeline.THUMB_SIZE)}k=this.timeline.events.indexOfKey(this.unique_id);for(h=f=g=k+1,e=this.timeline.events.length();g<=e?f<e:f>e;h=g<=e?++f:--f){m=this.timeline.events.valueAtIndex(h);m.change_index_offset(c,j,false)}}if(this.num_photos===0){if(this.is_collection()){return $("single-album-empty").show()}else{return this.remove()}}};a.prototype.remove=function(){this.timeline.queue_remove_event(this);$("h-"+this.unique_id).hide();$("p-"+this.unique_id).hide();if(this.is_collection()){return $("single-album-empty").show()}};a.prototype.restore=function(){$("h-"+this.unique_id).show();return $("p-"+this.unique_id).show()};a.prototype.change_index_offset=function(b,d,c){this.photo_index_offset+=b;this.top_offset+=d*this.timeline.THUMB_SIZE;if(c){this.top_offset-=this.timeline.HEADER_HEIGHT}this.photo_row_offset+=d;this.add_metadata_to_global_arrays();return this.create_global_row_heights()};a.prototype.in_y_range=function(c,b){return !(this.top_offset+this.timeline.HEADER_HEIGHT>b||this.top_offset+this.height<c)};a.prototype.blur_range=function(e,b,g){var d,c,f;if(g==null){g=Util.get_viewport()}f=Velocity.get();if(f>=0){c=this.timeline.VIEWPORT_SCALE_OTHER_DIRECTION;d=this.timeline.VIEWPORT_SCALE_SCROLL_DIRECTION}else{if(f<0){c=this.timeline.VIEWPORT_SCALE_SCROLL_DIRECTION;d=this.timeline.VIEWPORT_SCALE_OTHER_DIRECTION}}e-=c*g.height;b+=d*g.height;return[e,b]};a.prototype.in_current_viewport=function(d,f){var b,c,e;if(d==null){d=Util.get_viewport()}if(f==null){f=true}c=d.top;b=d.top+d.height;if(f){e=this.blur_range(c,b,d),c=e[0],b=e[1]}return this.in_y_range(c,b)};a.prototype.add_html_elements_to=function(c){var b;if(this.is_event()){b=new Element("div",{"class":"photo-event"});b.__sert(this.header_html);b.__sert(this.placeholder_html);return c.__sert(b)}else{c.__sert(this.header_html);return c.__sert(this.placeholder_html)}};a.prototype.hide_photos_if_not_in_current_viewport=function(c){var b,e,d;if(!this.in_current_viewport(c)){for(b=e=0,d=this.num_rows_loaded_metadata;0<=d?e<d:e>d;b=0<=d?++e:--e){this._remove_row(b)}$("p-top-"+this.unique_id).setStyle({height:this.num_rows*this.timeline.THUMB_SIZE+"px"});$("p-bottom-"+this.unique_id).setStyle({height:"0px"});return true}return false};a.prototype.get_row_range_to_render=function(e,h){var g,c,b,d,f;if(h==null){h=true}d=e.top;b=e.bottom;if(h){f=this.blur_range(d,b,e),d=f[0],b=f[1]}if(!this.in_y_range(d,b)){return[null,null]}c=Math.floor((d-this.top_offset-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE);g=Math.floor((b-this.top_offset-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE);return[Math.max(0,c),Math.min(this.num_rows-1,g)]};a.prototype.get_row_range_to_render_with_blur=function(e){var d,g,h,c,f,b;f=this.get_row_range_to_render(e,true),c=f[0],g=f[1];b=this.get_row_range_to_render(e,false),h=b[0],d=b[1];return[c,h,d,g]};a.prototype.get_thumb_indexes_to_load=function(k){var h,g,l,f,m,e,c,j,b,d;d=this.get_row_range_to_render_with_blur(k),j=d[0],c=d[1],h=d[2],g=d[3];if(c==null){l=this.get_photo_indexes_for_row_range(j,g);if(this.top_offset>k.bottom){return l}else{return l.reverse()}}e=this.get_photo_indexes_for_row_range(c,h);f=[];m=[];if(j<c){f=this.get_photo_indexes_for_row_range(j,c-1).reverse()}if(g>h){m=this.get_photo_indexes_for_row_range(h+1,g)}b=Velocity.get();if(b>=0){return e.concat(m).concat(f)}else{return e.concat(f).concat(m)}};a.prototype.update_photo_divs=function(){var c,v,w,A,r,p,h,x,u,o,s,m,j,f,d,y,z,b,t,q,n,l,g,e,k;if(!this.num_rows_loaded_metadata||!this.num_photos){return}s=Util.get_viewport();if(this.hide_photos_if_not_in_current_viewport(s)){return}t=this.get_row_range_to_render(s),u=t[0],v=t[1];assert((u!=null)&&(v!=null),"This line is after @hide_photos_if_not_in_      current_viewport, so top_row_to_render and bottom_row_to_render shouldn't be null.");if(!this.has_loaded_metadata()&&v>this.num_rows_loaded_metadata-1){this.load_metadata(v);v=this.num_rows_loaded_metadata-1;if(u>this.num_rows_loaded_metadata-1){return}}o=u*this.timeline.THUMB_SIZE;$("p-top-"+this.unique_id).setStyle({height:o+"px"});A=(this.num_rows-v-1)*this.timeline.THUMB_SIZE;$("p-bottom-"+this.unique_id).setStyle({height:A+"px"});for(w=m=0;0<=u?m<u:m>u;w=0<=u?++m:--m){this._remove_row(w)}for(w=j=q=v+1,n=this.num_rows_loaded_metadata;q<=n?j<n:j>n;w=q<=n?++j:--j){this._remove_row(w)}this._add_rows((function(){k=[];for(var B=u;u<=v?B<=v:B>=v;u<=v?B++:B--){k.push(B)}return k}).apply(this));l=PhotosSelection.get();for(d=0,y=l.length;d<y;d++){p=l[d];if((g=$(p.uniqueness_key))!=null){g.addClassName("selected")}}this.scroll_count=Photos.scroll_count;c=[];e=this.get_thumb_indexes_to_load(s);for(b=0,z=e.length;b<z;b++){h=e[b];if(h<this.photos.length){x=$(this.photos[h].uniqueness_key);if((x!=null?x.down("img"):void 0)!=null){c.push(x.down("img"))}}}r=function(B){return B.up(".cu-thumb").addClassName("thumb-loaded")};return BatchThumbLoader.batch_load_thumbs(c,this.timeline.THUMBS_BATCH_SIZE,r,this.log_thumb_load.bind(this))};a.prototype.log_thumb_load=function(c,d){var f,b,e;if(this.scroll_count===Photos.scroll_count&&!this.logged_thumbs_arrived){if((c+1)%this.timeline.THUMBS_PER_ROW===0||c+1===d){if(this.visible_thumbs_loaded()){b=Util.get_viewport();f=(this.photo_index_offset+this.num_photos)===this.timeline.photos.length;if((this.top_offset<b.bottom&&b.bottom<this.top_offset+this.height)||f){if(Photos.scroll_count<2&&((e=PhotosLogger.get_current_view())===PhotosViews.PHOTOS_VIEW||e===PhotosViews.CAMERA_VIEW)){this.log_timing_event(PhotosTimingEvents.viewport_initial_load);Photos.scroll_count+=2}else{this.log_timing_event(PhotosTimingEvents.viewport_loaded)}}return this.logged_thumbs_arrived=true}}}};a.prototype.log_timing_event=function(e){var b,c,f,d;c=Util.time();b={};if(e===PhotosTimingEvents.viewport_initial_load){if((typeof performance!=="undefined"&&performance!==null?(d=performance.timing)!=null?d.navigationStart:void 0:void 0)!=null){f=Util.time()-performance.timing.navigationStart;b={current_view:PhotosLogger.get_current_view()};WebTimingLogger.log_ajax_transition(f,e,b,e)}return}if(this.timing_stopped_scrolling_on_event===-1){return}if(e===PhotosTimingEvents.viewport_loaded){f=c-this.timing_stopped_scrolling_on_event}return WebTimingLogger.log_ajax_transition(f,e,b,e)};a.prototype._remove_row=function(f){var b,e,h,d,g,c;if(!this.displaying_row[f]){return}this.displaying_row[f]=false;g=this.get_photo_indexes_in_row(f);c=[];for(h=0,d=g.length;h<d;h++){b=g[h];if(b<this.photos_html.length){e=$(this.photos[b].uniqueness_key);c.push(e.hide())}else{c.push(void 0)}}return c};a.prototype._add_rows=function(q){var n,m,p,e,r,s,k,l,j,g,f,o,d,c,b,h;e=[];for(l=0,o=q.length;l<o;l++){m=q[l];s=this._add_row(m);if(!s){continue}p=s[0],r=s[1];k=false;for(j=0,d=e.length;j<d;j++){n=e[j];if(n.after===p){n.photos.push.apply(n.photos,r);k=true;break}}if(!k){e.push({after:p,photos:r})}}for(g=0,c=e.length;g<c;g++){n=e[g];n.after.__sert({after:n.photos})}h=[];for(f=0,b=q.length;f<b;f++){m=q[f];h.push(this.rendered_row[m]=true)}return h};a.prototype._add_row=function(l){var o,j,p,b,m,k,g,f,d,n,h,e,c;if(this.displaying_row[l]){return}this.displaying_row[l]=true;if(this.rendered_row[l]){h=this.get_photo_indexes_in_row(l);for(g=0,n=h.length;g<n;g++){k=h[g];if(k<this.photos_html.length){$(this.photos[k].uniqueness_key).show()}}}else{p=$("p-top-"+this.unique_id);if(l!==0){for(j=f=e=l-1;e<=0?f<=0:f>=0;j=e<=0?++f:--f){if(this.rendered_row[j]){m=(j+1)*this.timeline.THUMBS_PER_ROW-1;if(m>this.photos.length-1){m=this.photos.length-1}b=this.timeline.get_thumb_elm_for_photo(this.photos[m]);assert(b!=null,"row "+j+" was marked as rendered, but its last thumb elm doesn't exist");p=b;break}}}o=[];for(j=d=0,c=this.timeline.THUMBS_PER_ROW-1;0<=c?d<=c:d>=c;j=0<=c?++d:--d){k=l*this.timeline.THUMBS_PER_ROW+j;if(k<this.num_photos){o.push(this.photos_html[k])}}return[p,o]}};a.prototype._check_row_display_states=function(){var e,b,j,f,d,h,g,c;c=[];for(f=h=0,g=this.num_rows-1;0<=g?h<=g:h>=g;f=0<=g?++h:--h){j=(function(){var n,l,k,m;k=this.get_photo_indexes_in_row(f);m=[];for(n=0,l=k.length;n<l;n++){e=k[n];if(e<this.photos.length){m.push(e)}}return m}).call(this);if(this.displaying_row[f]){c.push((function(){var m,k,l;l=[];for(m=0,k=j.length;m<k;m++){b=j[m];d=$(this.photos[b].uniqueness_key);assert(d!=null);l.push(assert(d.visible()))}return l}).call(this))}else{if(this.rendered_row[f]){c.push((function(){var m,k,l;l=[];for(m=0,k=j.length;m<k;m++){b=j[m];d=$(this.photos[b].uniqueness_key);assert(d!=null);l.push(assert(!d.visible()))}return l}).call(this))}else{c.push(void 0)}}}return c};a.prototype.marquee_highlight=function(b,j,f){var d,k,c,l,n,e,h,g,m;if(this.top_offset>j||this.top_offset+this.height<b){return}if(b<this.top_offset){j-=this.top_offset;if(j<this.timeline.HEADER_HEIGHT){return}e=0;n=Math.floor((j-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}else{if(j>this.top_offset+this.height){b-=this.top_offset;n=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);if(b<this.timeline.HEADER_HEIGHT){e=0}else{e=Math.floor((b-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}}else{b-=this.top_offset;j-=this.top_offset;if(b<this.timeline.HEADER_HEIGHT&&j<this.timeline.HEADER_HEIGHT){return}else{if(b<this.timeline.HEADER_HEIGHT){e=0;n=Math.floor((j-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}else{e=Math.floor((b-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE);n=Math.floor((j-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}}}}for(l=h=e;e<=n?h<=n:h>=n;l=e<=n?++h:--h){for(g=0,m=f.length;g<m;g++){d=f[g];k=this.timeline.THUMBS_PER_ROW*l+d;if(k<this.num_photos){c=this.photos[k];if(!PhotosSelection.contains(c)){PhotosSelection._highlight(c)}}}}};a.prototype.remove_photo=function(b,n){var l,m,d,p,o,h,c,e,j,k,g,f;if(n==null){n=false}c=this.photos.indexOf(b);assert(c>-1,"Photo not found in the photos array!");h=this.photo_index_offset+c;d=this.num_rows;this.num_photos--;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);m=this.num_rows-d;this.photos.splice(c,1);delete this.key_to_duplicates[b.uniqueness_key];this.photos_html.splice(c,1);this.timeline.grid.photo_row_offsets.splice(this.photo_row_offset+this.num_rows,Math.abs(m));this.create_global_row_heights();this._num_photos_changed();if(!this.has_loaded_metadata()){this.num_rows_loaded_metadata=Math.floor(this.photos.length/this.timeline.THUMBS_PER_ROW)}else{this.num_rows_loaded_metadata=this.num_rows}this._fix_row_display_after_remove(Math.ceil(c/this.timeline.THUMBS_PER_ROW),m);if(!n){this.update_photo_divs()}if((k=$(this.timeline.photos[h].uniqueness_key))!=null){k.remove()}this.timeline.photos.splice(h,1);delete this.timeline.key_to_duplicates[b.uniqueness_key];this.timeline.preview_objs.splice(h,1);PhotosSelection._remove(b);if(h>=this.timeline.photos.length){h=this.timeline.photos.length-1}o=this.timeline.events.indexOfKey(this.unique_id);for(l=j=g=o+1,f=this.timeline.events.length();g<=f?j<f:j>f;l=g<=f?++j:--j){p=this.timeline.events.valueAtIndex(l);e=this.num_photos===0;p.change_index_offset(-1,m,e)}if(this.has_loaded_metadata()){this.write_metadata_to_cache()}if(Lightbox.shown){if(this.timeline.preview_objs.length){Lightbox.jump_to(h)}else{Lightbox.back()}}if(this.num_photos===0){return this.remove()}};a.prototype._fix_row_display_after_remove=function(n,l){var k,o,e,b,h,g,m,j,f,d,c;for(k=h=n,j=this.num_rows_loaded_metadata;n<=j?h<j:h>j;k=n<=j?++h:--h){o=(k+1)*this.timeline.THUMBS_PER_ROW-1;if(o>=this.photos.length){break}b=$(this.photos[o].uniqueness_key);if(this.displaying_row[k]){if(this.rendered_row[k+1]){b.show()}else{if(o<this.photos_html.length){e=$(this.photos[o-1].uniqueness_key);e.__sert({after:this.photos_html[o]})}}}else{if(this.rendered_row[k]){if(this.displaying_row[k+1]){b.hide()}else{if(!this.rendered_row[k+1]){if(o<this.photos_html.length){e=$(this.photos[o-1].uniqueness_key);e.__sert({after:this.photos_html[o]});$(this.photos[o].uniqueness_key).hide()}}}}else{if(this.rendered_row[k+1]){b.remove()}}}}if(!this.has_loaded_metadata()){this.displaying_row[this.num_rows_loaded_metadata]=false;this.rendered_row[this.num_rows_loaded_metadata]=false;f=this.get_photo_indexes_in_row(this.num_rows_loaded_metadata);for(g=0,m=f.length;g<m;g++){k=f[g];if((d=$((c=this.photos[k])!=null?c.uniqueness_key:void 0))!=null){d.remove()}}}if(l===-1){this.rendered_row[this.num_rows]=false;return this.displaying_row[this.num_rows]=false}};a.prototype.add_photo=function(b,d,n,m){var k,o,l,c,r,p,g,e,q,h,j,f;if(n==null){n=false}if(m==null){m=null}assert(d<=this.photos.length,"cannot insert past end of photos array");g=this.photo_index_offset+d;c=this.num_rows;this.num_photos++;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);l=this.num_rows-c;this.photos.splice(d,0,b);if(m){this.key_to_duplicates[b.uniqueness_key]=m}this.photos_html.splice(d,0,this.timeline.tmpl({photo:b,display_date:this._display_date(b),shareable:true}));this.timeline.update_offsets(this.timeline.top_offset,this.timeline.left_offset);this.create_global_row_heights();this._num_photos_changed();if(this.num_photos===1){this.num_rows_loaded_metadata=1}else{if(!this.has_loaded_metadata()){this.num_rows_loaded_metadata+=l}else{this.num_rows_loaded_metadata=this.num_rows}}q=Math.floor(d/this.timeline.THUMBS_PER_ROW);if(d===0){o=$("p-top-"+this.unique_id)}else{o=this.timeline.get_thumb_elm_for_photo(this.photos[d-1])}if(this.displaying_row[q]){o.__sert({after:this.photos_html[d]})}else{if(this.rendered_row[q]){o.__sert({after:this.photos_html[d]});$(b.uniqueness_key).hide()}else{if(this.num_photos===1){o.__sert({after:this.photos_html[d]});$(b.uniqueness_key).hide();this.rendered_row[q]=true}}}this._fix_row_display_after_add(Math.ceil(d/this.timeline.THUMBS_PER_ROW));if(!n){this.update_photo_divs()}this.timeline.photos.splice(g,0,b);if(m){this.timeline.key_to_duplicates[b.uniqueness_key]=m}e=this.timeline.get_preview_obj(b);this.timeline.preview_objs.splice(g,0,e);p=this.timeline.events.indexOfKey(this.unique_id);for(k=h=j=p+1,f=this.timeline.events.length();j<=f?h<f:h>f;k=j<=f?++h:--h){r=this.timeline.events.valueAtIndex(k);r.change_index_offset(1,l,false)}if(Lightbox.shown){return Lightbox.jump_to(g)}};a.prototype._fix_row_display_after_add=function(k){var c,j,d,b,g,h,f,e;e=[];for(j=g=h=k+1,f=this.num_rows_loaded_metadata;h<=f?g<f:g>f;j=h<=f?++g:--g){c=j*this.timeline.THUMBS_PER_ROW;if(c>=this.photos.length){break}b=$(this.photos[c].uniqueness_key);if(this.displaying_row[j]){if(this.rendered_row[j-1]){e.push(b.show())}else{d=$(this.photos[c-1].uniqueness_key);e.push(d.__sert({after:this.photos_html[c]}))}}else{if(this.rendered_row[j]){if(this.displaying_row[j-1]){e.push(b.hide())}else{if(!this.rendered_row[j-1]){d=$(this.photos[c-1].uniqueness_key);d.__sert({after:this.photos_html[c]});e.push($(this.photos[c].uniqueness_key).hide())}else{e.push(void 0)}}}else{if(this.rendered_row[j-1]){e.push(b.remove())}else{e.push(void 0)}}}}return e};a.prototype.get_photo_index=function(b,c){return b*this.timeline.THUMBS_PER_ROW+c};a.prototype.get_photo_indexes_in_row=function(b){var c;return(function(){var f,e,d;d=[];for(c=f=0,e=this.timeline.THUMBS_PER_ROW;0<=e?f<e:f>e;c=0<=e?++f:--f){d.push(this.get_photo_index(b,c))}return d}).call(this)};a.prototype.get_photo_indexes_for_row_range=function(b,h){var g,c,j,f,d,e;j=[];for(c=f=b;b<=h?f<=h:f>=h;c=b<=h?++f:--f){for(g=d=0,e=this.timeline.THUMBS_PER_ROW;0<=e?d<e:d>e;g=0<=e?++d:--d){j.push(this.get_photo_index(c,g))}}return j};a.prototype.visible_thumbs_loaded=function(c){var f,g,b,e,d;if(c==null){c=Util.get_viewport()}d=this.get_row_range_to_render(c,false),b=d[0],f=d[1];if(b===null&&f===null){return true}for(g=e=b;b<=f?e<=f:e>=f;g=b<=f?++e:--e){if(!this.rendered_row[g]){return false}}return true};return a})();var FilePreview;FilePreview={PARTIAL_TEXT_LENGTH_THRESHOLD:64*1024,init_doc:function(){var a,b=this;a=new DocViewer({id:"crocodoc-preview",zoom:"auto"});a.bind("fail",this._preview_failed);$j(".doc").attr("tabindex",0).focus();a.bind("statusupdate",function(c){if(c!=null?c.viewable:void 0){return b._fire_pdf_render_event()}});return this._log_pdf_render_time("pdf-crocodoc")},init_pdf:function(f,d,c){var b,a,e,g=this;this._log_pdf_render_time(f);if(f==="pdf-embedded"){Util.smart_window_load(function(){return g._fire_pdf_render_event()});if($j.browser.chrome){e=function(){var h;h=$j('link[rel="shortcut icon"]').remove();return $j("head").append(h)};setTimeout(e,1000)}a=$$("#pdf-embed-container iframe");return window.setTimeout((function(){return a.invoke("setStyle",{visibility:"visible"})}),200)}else{if(f==="pdf-js"){PDFView.initialize();c=Util.remove_protocol_and_host(c);PDFJS.workerSrc=c;if(Prototype.BrowserFeatures.DB_CORS){b=window["pdf-js-data"];if(b){if(b.byteLength){delete window["pdf-js-data"];return PDFView.open(b,0)}else{if(b.pending){return window.addEventListener("message",function(h){if(h.data==="pdf-js-data-ready"){b=window["pdf-js-data"];if(b.byteLength){delete window["pdf-js-data"];return PDFView.open(b,0)}}})}}}else{return PDFView.open(d,0)}}else{Util.add_script(Util.add_qstring(d,{js_callback:"got_text",binary:"1",b64:"1"}));return window.got_text=function(h){var n,j,k,m,l;n=Util.decode_b64(h,true);k=new Uint8Array(n.length);for(j=m=0,l=n.length;0<=l?m<=l:m>=l;j=0<=l?++m:--m){k[j]=n.charCodeAt(j)}return PDFView.open(k)}}}}},init_font:function(){var a=this;return Util.smartLoad(function(){if(!$(document.documentElement).hasClassName("fontface")||$(document.body).hasClassName("gecko")){return $(document.body).removeClassName("file-preview-body")}})},init_photo:function(d,g){var j,e,h,f,c,a,b;$("preview-img").observe("error",this._preview_failed.bind(this));if(IE7_OR_LESS){$(document.body).removeClassName("preview-photo");Util.smartLoad(this.resize_preview_img.bind(this));setInterval(this.resize_preview_img,500)}if((f=window.performance)!=null?(c=f.timing)!=null?c.navigationStart:void 0:void 0){$("preview-img").observe("load",function(){var k;k=Util.time()-window.performance.timing.navigationStart;return WebTimingLogger.log_ajax_transition(k,"file-preview-photo")})}$("full-img").src=d;a=$$("#preview-img, #full-img");b=[];for(e=0,h=a.length;e<h;e++){j=a[e];j.setAttribute("data-original-href",g);b.push(j.on("contextmenu","img",ContextMenu.show_shmodel.bind(ContextMenu)))}return b},init_text:function(d,b,h){var c,f,e,a,g=this;c=0;e=function(k){var j;if(!k.responseText){return}j=k.responseText.length;if(c===0&&j>g.PARTIAL_TEXT_LENGTH_THRESHOLD){a(k.responseText,true);return c=j}};f=function(j){return a(j.responseText)};window.got_text=function(j){if(j){j=Util.decode_b64(j)}return a(j)};a=function(j,k){var l,m;if(!j||!j.length){$("code-wrapper").remove();return}$j("#code-loading").hide();if(typeof h==="function"){h()}l=$("code").className;m=j.substring(c);$("code").appendChild(document.createTextNode(m));if(b&&!k){SyntaxHighlighter.defaults.toolbar=false;SyntaxHighlighter.defaults["quick-code"]=false;SyntaxHighlighter.highlight($("code"))}return window.filled_text=1};return Util.smartLoad(function(){var j;j=function(){return Util.add_script(Util.add_qstring(d,{js_callback:"got_text",b64:"1"}))};if(Prototype.BrowserFeatures.DB_CORS){new Ajax.DBRequest(d,{method:"GET",parameters:{},log_timing:true,onInteractive:e,onSuccess:f,onFailure:j})}else{j()}return setTimeout((function(){if(!window.filled_text){return g._preview_failed()}}),10000)})},init_htmlified:function(){var a=this;if(window.htmlified_height){htmlified_loaded();return}if(!window.postMessage){this._preview_failed();return}return setTimeout((function(){if(!window.htmlified_height){return a._preview_failed()}}),10000)},htmlified_loaded:function(){var a;if((a=$("htmlified-loading"))!=null){a.remove()}$("htmlified").style.height=window.htmlified_height+"px";return $("htmlified").style.visibility=""},init_video:function(f,b,d,g,h,a){var j,c,e=this;if(a){c=(Util.viewport_dimensions().width-a)*0.9}else{c=Util.viewport_dimensions().width*0.9}j=c*0.55;return Util.smartLoad(function(){var k;k=e._preview_failed;if(g==="hls"){return VideoUtil.embed("#video",{src:d,type:"application/vnd.apple.mpegurl",width:c,height:j,controls:true,poster:h,onError:k})}else{if(f){$("video").__date();if(b){return VideoUtil.embed("#video",{src:d,type:"video/mp4",width:c,height:j,controls:true,poster:h,onError:k})}else{return k()}}else{if(FlashDetect.installed){$("video").__date();return VideoUtil.embed("#video",{src:d,type:"video/flv",width:c,height:j,controls:true,poster:h,onError:k})}else{return k()}}}})},photo_loaded:function(c){var b,a;if((b=window.performance)!=null?(a=b.timing)!=null?a.navigationStart:void 0:void 0){c=c-window.performance.timing.navigationStart;return WebTimingLogger.log_ajax_transition(c,"file-preview-photo")}},resize_preview_img:function(){var c,b,a;c=document.viewport.getDimensions();a=(c.width-56)+"px";b=(c.height-103)+"px";return $("preview-img").setStyle({maxHeight:b,maxWidth:a})},_preview_failed:function(){var a;a=$(document.body);if(a.hasClassName("shmodel-body")){return a.removeClassName("file-preview-body")}},_fire_pdf_render_event:function(){var a;if(document.createEvent&&window.dispatchEvent){a=document.createEvent("UIEvents");a.initUIEvent("pagerender",false,false,window,0);return window.dispatchEvent(a)}},_log_pdf_render_time:function(b){var a;a=function(f){var d,e,c;if((e=window.performance)!=null?(c=e.timing)!=null?c.navigationStart:void 0:void 0){d=Util.time()-window.performance.timing.navigationStart;return WebTimingLogger.log_ajax_transition(d,f)}};Event.observe(window,"pagerender",function(){Event.stopObserving(window,"pagerender");return a(b)});return Event.observe(window,"parsecomplete",function(){Event.stopObserving(window,"parsecomplete");return a(""+b+"-parse")})}};var parse_color_to_rgba;Effect.BlindFadeUp=function(d,c){var b,a;b=new Effect.BlindUp(d,c);a=new Effect.Fade(d,c);this.cancel=function(){b.cancel();return a.cancel()}};Effect.BlindFadeDown=function(d,c){var b,a;b=new Effect.BlindDown(d,c);a=new Effect.Appear(d,c);this.cancel=function(){b.cancel();return a.cancel()}};Effect.Flash=function(c,b,a){assert(b.startcolor&&b.endcolor,"Start and end colors must be specified");assert(b.cycles,"Fade cycles must be specified");a=a||0;return new Effect.Highlight(c,{duration:1,startcolor:b.startcolor,endcolor:b.endcolor,restorecolor:b.endcolor,afterFinish:function(){return new Effect.Highlight(c,{duration:1,startcolor:b.endcolor,endcolor:b.startcolor,restorecolor:b.startcolor,afterFinish:function(){if(a<b.cycles){return Effect.Flash(c,b,a+1)}}})}})};Effect.ScaleComprehensive=Class.create(Effect.Scale,{setup:function(){var s,q,y,m,r,t,n,o,h,e,c,b,z,E,C,A,x,w,v,u,a,F,D,B,p,l,j,g,d,f;this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};p=["top","left","width","height","fontSize"];for(h=0,z=p.length;h<z;h++){t=p[h];this.originalStyle[t]=this.element.style[t]}this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;m=this.element.getStyle("font-size")||"100%";l=["em","px","%","pt"];for(e=0,E=l.length;e<E;e++){r=l[e];if(m.indexOf(r)>0){this.fontSize=parseFloat(m);this.fontSizeType=r}}this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;if(this.options.scaleMode==="box"){this.dims={height:this.element.offsetHeight,width:this.element.offsetWidth}}if(/^content/.test(this.options.scaleMode)){this.dims={height:this.element.scrollHeight,width:this.element.scrollWidth}}if(!this.dims){this.dims={height:this.options.scaleMode.originalHeight,width:this.options.scaleMode.originalWidth}}this.full_height=this.dims.height;this.full_width=this.dims.width;q=["border%sWidth","margin%s","padding%s"];for(c=0,C=q.length;c<C;c++){n=q[c];j=["Top","Bottom","Left","Right"];for(b=0,A=j.length;b<A;b++){y=j[b];o=n.format(y);this.dims[o]=parseFloat(this.element.getStyle(o));if(y==="Top"||y==="Bottom"){this.full_height+=this.dims[o]}else{this.full_width+=this.dims[o]}}}this.attrs_vertical=[];this.attrs_horizontal=[];if(this.options.scaleX){for(a=0,x=q.length;a<x;a++){s=q[a];this.attrs_horizontal.push(s.format("Left"))}this.attrs_horizontal.push("width");g=q.reverse();for(F=0,w=g.length;F<w;F++){s=g[F];this.attrs_horizontal.push(s.format("Right"))}}if(this.options.scaleY){for(D=0,v=q.length;D<v;D++){s=q[D];this.attrs_vertical.push(s.format("Top"))}this.attrs_vertical.push("height");d=q.reverse();f=[];for(B=0,u=d.length;B<u;B++){s=d[B];f.push(this.attrs_vertical.push(s.format("Bottom")))}return f}},update:function(a){var b;b=(this.options.scaleFrom/100)+(this.factor*a);b=(-0.5+1/(1+Math.exp((0.5-b)*7)))*1.055+0.5;if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}return this.setDimensions(b)},setDimensions:function(f){var l,o,m,j,k,b,g,e,n,a,h,c;m={};h=[[this.full_width,this.attrs_horizontal],[this.full_height,this.attrs_vertical]];for(g=0,n=h.length;g<n;g++){c=h[g],j=c[0],o=c[1];k=j*f;for(e=0,a=o.length;e<a;e++){l=o[e];b=this.dims[l];if(b<k){m[l]=b+"px";k-=b}else{m[l]=k.round()+"px";k=0}}}return this.element.setStyle(m)}});Effect.BlindUpComprehensive=function(a){a=$(a);a.makeClipping();return new Effect.ScaleComprehensive(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){return b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDownComprehensive=function(b){var a;b=$(b);a=b.getDimensions();return new Effect.ScaleComprehensive(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){return c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){return c.element.undoClipping()}},arguments[1]||{}))};Effect.HighlightForcedWithAlpha=Class.create(Effect.Highlight,{setup:function(){var k,h,c,g,j,d,l,f,b,a;this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._supports_alpha=false;try{h=new Element("div");j="rgba(1, 1, 1, 0)";h.setStyle({backgroundColor:j});this._supports_alpha=(h.getStyle("background-color"))===j}catch(m){}this._base=parse_color_to_rgba(this.options.startcolor);if((f=this.options.endcolor)==="transparent"||f==="rgba(0, 0, 0, 0)"){if(this._supports_alpha){c=this._base.slice(0);c[3]=0}else{c=[255,255,255,1]}}else{c=parse_color_to_rgba(this.options.endcolor)}this._delta=[];b=this._base;a=[];for(g=d=0,l=b.length;d<l;g=++d){k=b[g];a.push(this._delta.push(c[g]-k))}return a},update:function(a){var h,c,g,d,f,b,e;g=[];e=this._base;for(d=f=0,b=e.length;f<b;d=++f){h=e[d];c=h+this._delta[d]*a;if(!(d>2)){c=Math.round(c)}g.push(c)}if(this._supports_alpha){return this.element.setStyle({backgroundColor:"rgba("+(g.join(", "))+")"})}else{return this.element.setStyle({backgroundColor:"rgb("+(g.slice(0,3).join(", "))+")"})}}});parse_color_to_rgba=function(c){var d,g,f,e,a,b,h,k,j;b=/^rgb\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)$/;a=/^rgba\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3}), ?(\d+?\.?\d*)\)$/;e=/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i;g=/^#([0-9A-F])([0-9A-F])([0-9A-F])([0-9A-F])$/i;f=/^#([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])$/i;d=/^#([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])$/i;if(k=c.match(b)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,10))}return l})()}else{if(k=c.match(a)){j=(function(){var o,m,n,l;n=k.slice(1,4);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,10))}return l})();j[3]=parseFloat(k[4])}else{if(k=c.match(e)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c+c,16))}return l})()}else{if(k=c.match(g)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c+c,16))}return l})()}else{if(k=c.match(f)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,16))}return l})()}else{if(k=c.match(d)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,16))}return l})()}}}}}}j=j||[255,255,255,1];h=j.length;if(h===3){j.push(1)}else{if(h===4&&j[h-1]>1){j[h-1]=j[h-1]/255}}return j};var ClientDownload;ClientDownload=(function(){function a(){}a.prototype.show_download_modal=function(){return new Ajax.DBRequest("/download_modal_view",{onSuccess:function(b){var c;c=new Element("div",{"class":"brodal-header"});c.__sert(_("Install Dropbox"));return Modal.show(c,$("client-download"),{},false,450)}})};return a})();var WebTimingLogger;WebTimingLogger={init:function(){if(!Constants.WEB_TIMING_ENABLED||!window.performance){return}return Util.smart_window_load(function(){return WebTimingLogger._log_navigation.defer()})},_log_navigation:function(){var b,c,a;a=window.performance&&window.performance.timing;if(!a){return}c=a.navigationStart||a.fetchStart;if(!c){return}b={navigation_type:WebTimingLogger._get_navigation_type(),redirect_time:a.fetchStart-c,connect_time:a.requestStart-c,time_to_first_byte:a.responseStart-c,dom_load_time:a.domContentLoadedEventEnd-c,page_load_time:a.loadEventEnd-c};return WebTimingLogger._log(b)},log_ajax_transition:function(g,a,d,c,f,b){var e;if(f==null){f=-1}e={navigation_type:"ajax",server_response_time:f,page_load_time:g,url:b};if(Constants.GSLB_ENABLED){d=d||{};d.gslb_enabled=true}if(d!=null){e.extra_columns=Util.to_json(d)}if(c!=null){e.stopwatch_suffix=c}return WebTimingLogger._log(e,a)},_log:function(b,a,c){if(c==null){c="/web_timing_log"}if(!Constants.WEB_TIMING_ENABLED){return}b.url=b.url||window.location.href;b.request_id=Constants.REQUEST_ID;b.source_type="web";if(a){b.url_info=a}return new Ajax.DBRequest(c,{noAutonotify:true,no_watch:true,parameters:b})},_get_navigation_type:function(){switch(window.performance.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward"}}};var HiRes,_this=this;HiRes=(function(){var a;a=false;if("devicePixelRatio" in window&&window.devicePixelRatio>1){a=true}return{init:function(){var j,h,f,e,d,g,b,c;if(!a){return}g=$$("[data-hi-res]");for(h=0,e=g.length;h<e;h++){j=g[h];this._replace(j,j.readAttribute("data-hi-res"),this._replace_img)}b=$$("[data-hi-res-background]");c=[];for(f=0,d=b.length;f<d;f++){j=b[f];c.push(this._replace(j,j.readAttribute("data-hi-res-background"),this._replace_background))}return c},get_background:function(c,b){if(!a){return}return this._replace(c,b,this._replace_background)},_replace:function(e,c,d){var b;if(!c){return}b=new Image();b.src=c;return b.observe("load",function(){return d(e,c)})},_replace_img:function(c,b){return c.src=b},_replace_background:function(d,b){var c;c="url('%(src)s')".format({src:b});return d.setStyle({backgroundImage:c})}}})();Util.smartLoad(function(){return HiRes.init()});var TwoFactorAuth;TwoFactorAuth={_checkpoint_token:null,_email:null,_container_selector:null,_error_selector:null,_is_offline_setup:null,_invalid_code_count:null,login_init:function(){this._container_selector="#twofactor-confirm";this._error_selector="#twofactor-confirm .error-message";return this.login_listen()},login_listen:function(){var a;if((a=$("resend-link"))!=null){a.observe("click",this.resend_phone_code.bind(this))}return $("code").focus()},account_init:function(b,f){var e,d,a,c;this._email=b;this._container_selector=".twofactor-account-form";this._error_selector=".twofactor-account-form .error-message";c=$$(".email-placeholder");for(d=0,a=c.length;d<a;d++){e=c[d];e.__date(b)}this.account_listen();return Util.async_load_script(f)},account_listen:function(){var f,d,b,c,a,e=this;c=$$("#enable-twofactor, #disable-twofactor, #toggle-qr");for(d=0,b=c.length;d<b;d++){f=c[d];f.observe("click",function(g){return g.preventDefault()})}$("enable-twofactor").observe("click",this.show_enable_start.bind(this));if((a=$("disable-twofactor"))!=null){a.observe("click",this.disable_show_enter_password.bind(this))}$("add-twofactor-backup-link").observe("click",this.start_add_backup_phone_number.bind(this));$("twofactor-start").observe("submit",this.show_enter_password.bind(this));$("twofactor-enter-password").observe("submit",this.submit_password.bind(this));$("twofactor-delivery-choice").observe("submit",this.submit_delivery_choice.bind(this));$("twofactor-offline-setup").observe("submit",this.show_confirm_phone.bind(this));$("twofactor-enter-phone").observe("submit",this.submit_phone_number.bind(this));$("twofactor-enable-confirm").observe("submit",this.submit_phone_code.bind(this));$("twofactor-enter-backup-phone").observe("submit",this.submit_backup_phone_number.bind(this));$("twofactor-recovery").observe("submit",this.submit_finish.bind(this));$("twofactor-done").observe("submit",this.close_modal.bind(this));$$("#twofactor-enter-phone #country-code")[0].observe("change",this.reset_phone_field_and_backup_country.bind(this));$("twofactor-enter-backup-phone").down("#country-code").observe("change",this.reset_phone_field.bind(this));$("resend-link").observe("click",this.enable_resend_phone_code.bind(this));$$("#twofactor-enter-phone .backbutton")[0].observe("click",this.show_delivery_choice.bind(this));$$("#twofactor-offline-setup .backbutton")[0].observe("click",this.show_delivery_choice.bind(this));$$("#twofactor-recovery .backbutton")[0].observe("click",this.show_enter_backup_phone_number.bind(this));$("cancel-backup-phone-button").observe("click",this.close_modal.bind(this));$j("#twofactor-enable-confirm .backbutton, #prev-backup-phone-button").click(function(){if(e._is_offline_setup){e.show_offline_setup()}else{e.show_enter_phone_number()}return false});$j("#twofactor-delivery-choice input").change(function(){$j(".delivery-choice").removeClass("selected");return $j(this).parents(".delivery-choice").addClass("selected")});$("show-qr").observe("click",function(g){Event.stop(g);return $("twofactor-offline-setup").addClassName("showing-qr")});$("hide-qr").observe("click",function(g){Event.stop(g);return $("twofactor-offline-setup").removeClassName("showing-qr")});$("twofactor-disable-enter-password").observe("submit",this.disable_submit_password.bind(this));$("twofactor-disable").observe("submit",this.disable_submit.bind(this));$("cancel-button").observe("click",this.close_modal.bind(this));if(window.location.hash==="#backup2fa"&&$j("#twofactor-row").hasClass("allow-autopop")){return this.start_add_backup_phone_number()}},connect_login_init:function(){this._container_selector="#twofactor-form";this._error_selector="#twofactor-form .error";return this.connect_login_listen()},connect_login_listen:function(){return $("resend-link").observe("click",this.connect_resend_phone_code.bind(this))},resend_phone_code:function(b){var a,c=this;Event.stop(b);if(this.is_resending()){return}this.show_resending();a="/twofactor_resend";if($j("#twofactor-confirm").hasClass("backup")){a+="?backup=true"}return new Ajax.DBRequest(a,{onSuccess:function(d){switch(d.responseText.strip()){case"OK":c.hide_error();return c.notify_resent();case"UNREACHABLE":return c.show_error_unreachable();case"BADCARRIER":return c.show_error_bad_carrier();case"INVALIDNUMBER":return c.show_error_invalid_number();case"NOTAMOBILE":return c.show_error_not_a_mobile();case"RATELIMIT":return Notify.server_error(_("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-confirm").submit()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)})},connect_resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return Notify.server_error(error_unreachable());case"BADCARRIER":return Notify.server_error(error_bad_carrier());case"INVALIDNUMBER":return b.show_error_invalid_number();case"NOTAMOBILE":return Notify.server_error(error_not_a_mobile());case"RATELIMIT":return Notify.server_error(_("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-form").submit()}},onFailure:function(c){return Notify.server_error(b.error500())},cleanUp:this.hide_resending_with_delay.bind(this)})},DEFAULT_ENABLE_TITLE:_("Enable two-step verification"),DEFAULT_DISABLE_TITLE:_("Disable two-step verification"),ADD_BACKUP_TITLE:_("Add a backup phone number"),LOCK_ICON:"lock32",show_enable_start:function(){var a,b=this;this.hide_error();this.successfully_enabled=false;Modal.onHide=function(){if(!b.successfully_enabled){Notify.server_success(_("Two-step verification is not enabled"))}return b.close_modal()};a=$("twofactor-start");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a)},show_enter_password:function(b){var a;Event.stop(b);this.hide_error();a=$("twofactor-enter-password");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a);return $("password").clear().focus()},submit_password:function(b){var a,c=this;Event.stop(b);a=$("password").getValue();if(!a){this.show_error(_("Please enter your password"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/confirm_password",{parameters:{password:a},onSuccess:function(d){var e;e=d.responseText.strip();if(e.startsWith("OK:")){c._checkpoint_token=e.substr(3);return c.show_delivery_choice()}else{switch(e){case"EXPIRED_PASSWORD":return c.show_error_expired_password();case"INVALID":return c.show_error(_("Invalid password"));case"RATELIMIT":return c.show_error(_("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_ENABLED":$("twofactor-row").addClassName("twofactor-enabled");Notify.server_success("Two-step verification is already enabled. Did you maybe enable it in another window?");return c.close_modal()}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_delivery_choice:function(){var b,a;this.hide_error();b=$("twofactor-delivery-choice");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,b);a=0;$j(".delivery-choice").each(function(){var c;c=$j(this).height();return a=Math.max(c,a)});$j(".delivery-choice").height(a);return $j(".delivery-choice.selected > input").attr("checked","true")},submit_delivery_choice:function(a){Event.stop(a);if($("use-sms").getValue()==="on"){return this.show_enter_phone_number()}else{return this.fetch_offline_key()}},show_offline_setup:function(){var a;this.hide_error();this._is_offline_setup=true;this._phone_number=null;a=$("twofactor-offline-setup");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a)},fetch_offline_key:function(){var a=this;this.show_loading();return new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,offline:true},onSuccess:function(b){var c;c=b.responseText.strip();if(c.startsWith("OK:")){a.fill_key(c.substr(3));return a.show_offline_setup()}else{switch(c){case"EXPIRED":a.show_enter_password();return a.show_error_expired()}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},fill_key:function(b){var a,d,c;b=b.replace(new RegExp("=+$"),"");a=b.toLowerCase().replace(/(.{4})/g,"$1 ");$("secret-div").__date(a);$("qr-div").__date();c=Constants.IS_PROD?"Dropbox":"DropboxDev";d={text:"otpauth://totp/"+c+":"+this._email+"?secret="+b,width:200,height:200};if(!Modernizr.canvas){d.render="table"}$j("#qr-div").qrcode(d);if(!Modernizr.canvas){return $j("#qr-div > table").css("margin","0 auto")}},show_enter_phone_number:function(){var a;this.hide_error();this._is_offline_setup=false;this._phone_number=null;a=$("twofactor-enter-phone");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a);return $("phone-number").clear().focus()},submit_phone_number:function(c){var b,a,d=this;Event.stop(c);a=$j.trim($j("#phone-number").val());if(!a){this.show_error(_("Please enter your phone number"));return}b=$j.trim($j("#country-code",c.element()).val());a=this.validate_phone_number(b,a);if(!a){this.show_error(_("Invalid phone number"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,phone_number:a},onSuccess:function(e){switch(e.responseText.strip()){case"OK":d._phone_number=a;return d.show_confirm_phone(null,a);case"EXPIRED":d.show_enter_password();return d.show_error_expired();case"UNREACHABLE":return d.show_error_unreachable();case"BADCARRIER":return d.show_error_bad_carrier();case"INVALIDNUMBER":return d.show_error_invalid_number();case"NOTAMOBILE":return d.show_error_not_a_mobile();case"RATELIMIT":return d.show_error(_("You've added too many phone numbers. Please try again in a few minutes."))}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},validate_phone_number:function(b,a){var c;a=a.replace(/\D/g,"");c=""+b+" "+a;if(typeof phone_helpers!=="undefined"&&phone_helpers!==null){if(!phone_helpers.is_valid(c)){return}return""+b+" "+(phone_helpers.format(b,a))}if(b==="+1"){if(a.length!==10){return}}else{if(!(a.length>=4)){return}}return c},show_confirm_phone:function(c,a){var b;Event.stop(c);this._invalid_code_count=0;if(this._is_offline_setup){$("twofactor-enable-confirm").addClassName("offline")}else{assert(a,"expected a display_phone argument");$("phone-number-placeholder").__date(a);$("twofactor-enable-confirm").removeClassName("offline")}this.hide_error();b=$("twofactor-enable-confirm");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,b);$("phone-code").clear().focus();return this.fill_delivery_choice(a)},submit_phone_code:function(b){var a,c=this;Event.stop(b);a=$("phone-code").getValue().strip();if(!a){this.show_error(_("Please enter the security code"));return}if(a.search(/^\d{6}$/)===-1){this.show_error(_("Invalid security code"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_token:this._checkpoint_token,twofactor_code:a},onSuccess:function(d){var f,e;e=d.responseText.strip();if(e.startsWith("OK:")){c.fill_recovery_code(e.substr(3));return c.show_enter_backup_phone_number()}else{switch(e){case"INVALID":c._invalid_code_count+=1;f=c._invalid_code_count<=2?_("Invalid code"):c._is_offline_setup?_("Invalid code. Check the clock on your phone: it must be accurate to the minute."):_("Invalid code");return c.show_error(f);case"EXPIRED":c.show_enter_password();return c.show_error_expired();case"RATELIMIT":return c.show_error(_("Too many invalid codes. Try again in a few minutes."))}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},enable_resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return b.show_error_unreachable();case"BADCARRIER":return b.show_error_bad_carrier();case"INVALIDNUMBER":return b.show_error_invalid_number();case"NOTAMOBILE":return b.show_error_not_a_mobile();case"RATELIMIT":return Notify.server_error("You've asked for too many SMS messages. Please try again in a few minutes.");case"EXPIRED":b.show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)})},show_enter_backup_phone_number:function(b,d){var a,c;this.hide_error();a=$("twofactor-enter-backup-phone");$j(a).toggleClass("add-flow",!!d);c=d?this.ADD_BACKUP_TITLE:this.DEFAULT_ENABLE_TITLE;Modal.icon_show(this.LOCK_ICON,c,a);return $("backup-phone-number").clear().focus()},submit_backup_phone_number:function(c){var b,d,a;Event.stop(c);a=$j.trim($j("#backup-phone-number").val());d=$j(c.element()).hasClass("add-flow");if(a){b=$j.trim($j("#country-code",c.element()).val());a=this.validate_phone_number(b,a);if(!a){this.show_error(_("Invalid phone number"));return}if(this.is_primary_number(a)){this.show_error(_("You can't use your primary phone as your backup"));return}}else{if(d){this.show_error(_("Please enter phone number"));return}}this._backup_phone=a;if(d){this.save_added_backup_phone(a);return}this.fill_backup_phone(a);return this.show_recovery(c)},is_same_phone_number:function(b,a){if(!b||!a){return false}return b.replace(/\D+/g,"")===a.replace(/\D+/g,"")},is_primary_number:function(a){if(this._is_offline_setup){return false}if(this.is_same_phone_number(a,$j("#confirm-phone-primary-number").text())){return true}if(this.is_same_phone_number(a,$j("#twofactor-sms-number").text())){return true}return false},save_added_backup_phone:function(a){var b=this;this.show_loading();return new Ajax.DBRequest("/account/twofactor/set_backup_phone",{parameters:{checkpoint_token:this._checkpoint_token,backup_phone_number:a},onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();$j("#twofactor-backup-number").text(a);$j("#twofactor-row").addClass("with-backup");Util.syncHeight();Notify.server_success(_("Backup phone number added."));return b.close_modal();case"EXPIRED":return $("twofactor-form").submit()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},fill_delivery_choice:function(a){$j("#twofactor-delivery-phone-label,#confirm-phone-primary").toggle(!!a);$j("#twofactor-delivery-offline-label").toggle(!a);return $j("#confirm-phone-primary-number").text(a)},fill_backup_phone:function(a){$j("#confirm-phone-backup").toggle(!!a);return $j("#confirm-phone-backup-number").text(a)},fill_recovery_code:function(a){a=a.toLowerCase().replace(/(.{4})/g,"$1 ");return $("backup-code-div").__date(a)},show_recovery:function(b){var a;this.hide_error();Event.stop(b);a=$("twofactor-recovery");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a)},submit_finish:function(a){var b,c=this;Event.stop(a);this.show_loading();b={checkpoint_token:this._checkpoint_token};if(this._backup_phone){b.backup_phone_number=this._backup_phone}return new Ajax.DBRequest("/account/twofactor/enable_finish",{parameters:b,onSuccess:function(d){switch(d.responseText.strip()){case"OK":c.successfully_enabled=true;return c.show_done();case"EXPIRED":c.show_enter_password();return c.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_done:function(){var a,c,b;this._checkpoint_token=null;this.hide_error();c=$j("#twofactor-row");if(this._phone_number){$j("#twofactor-sms-number").text(this._phone_number);c.addClass("with-sms")}if(this._backup_phone){$j("#twofactor-backup-number").text(this._backup_phone);c.addClass("with-backup")}c.addClass("twofactor-enabled");Util.syncHeight();a=$("twofactor-done");b=_("Congrats! You've enabled two-step verification!");return Modal.icon_show(this.LOCK_ICON,b,a)},close_modal:function(a){if(a!=null){Event.stop(a)}Modal.onHide=null;return Modal.hide()},start_add_backup_phone_number:function(b){var a;Event.stop(b);this.hide_error();a=$("twofactor-disable-enter-password");Modal.icon_show(this.LOCK_ICON,this.ADD_BACKUP_TITLE,a);$j("#password",a).val("").focus();return this._is_add_backup_flow=true},disable_show_enter_password:function(){var a,b=this;this.hide_error();this.successfully_disabled=false;Modal.onHide=function(){if(!b.successfully_disabled){Notify.server_success(_("Two-step verification is still enabled"))}return b.close_modal()};a=$("twofactor-disable-enter-password");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_DISABLE_TITLE,a);$("password").clear().focus();return this._is_add_backup_flow=false},show_team_locked_info:function(a){Event.stop(a);return new UIRequest(a.target,"/account/twofactor/team_info")},disable_submit_password:function(b){var a,c=this;Event.stop(b);a=$("password").getValue();if(!a){this.show_error(_("Please enter your password"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/disable_confirm_password",{parameters:{password:a},onSuccess:function(d){var e;e=d.responseText.strip();if(e.startsWith("OK:")){c._checkpoint_token=e.substr(3);if(c._is_add_backup_flow){return c.show_enter_backup_phone_number(null,true)}else{return c.disable_show()}}else{switch(e){case"EXPIRED_PASSWORD":return c.show_error_expired_password();case"INVALID":return c.show_error(_("Invalid password"));case"RATELIMIT":return c.show_error(_("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_DISABLED":$("twofactor-row").removeClassName("twofactor-enabled");Notify.server_success("Two-step verification is already disabled. Did you maybe disable it in another window?");return c.close_modal()}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},disable_show:function(){var a;this.hide_error();a=$("twofactor-disable");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_DISABLE_TITLE,a)},disable_submit:function(a){var b=this;Event.stop(a);this.show_loading();return new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.successfully_disabled=true;b._checkpoint_token=null;$j("#twofactor-row").removeClass("twofactor-enabled with-sms with-backup");Util.syncHeight();Notify.server_success(_("Two-step verification is now disabled."));return b.close_modal();case"EXPIRED":b.disable_show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_error:function(b){var a;a=$$(this._error_selector);if(b===this.error_expired_password()){a.invoke("update",b)}else{a.invoke("__date",b)}return a.invoke("show")},show_error500:function(){return this.show_error(this.error_500())},show_error_bad_carrier:function(){return this.show_error(this.error_bad_carrier())},show_error_invalid_number:function(){return this.show_error(this.error_invalid_number())},show_error_not_a_mobile:function(){return this.show_error(this.error_not_a_mobile())},show_error_unreachable:function(){return this.show_error(this.error_unreachable())},show_error_expired:function(){return this.show_error(this.error_expired())},show_error_expired_password:function(){return this.show_error(this.error_expired_password())},error_500:function(){return _("Sorry, an error occurred. Please try again later.")},error_bad_carrier:function(){return _("Unfortunately, your carrier is not supported at this time.")},error_invalid_number:function(){return _("That is not a valid phone number.")},error_not_a_mobile:function(){return _("That phone number does not appear to be a valid mobile number.")},error_unreachable:function(){return _("We couldn't reach your phone number. Are you sure it's correct?")},error_expired:function(){return _("Since it's been a while, please enter your password again.")},error_expired_password:function(){return _('Your password has expired. Please create a new password <a target="_blank" href="/password_expired">here</a>.')},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){this.hide_error();return $$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3000)},notify_resent:function(){return Notify.server_success(_("We sent you another code. Keep in mind that it might take a few minutes."))},reset_phone_field:function(b){var a,c;a=b.element();c=$j(".sick-input",a.form);$j("input",c).val("").focus();return this.fill_example_phone_number(a,c)},fill_example_phone_number:function(a,d){var c,b;if(typeof phone_helpers!=="undefined"&&phone_helpers!==null){c=$j(a).val().substr(1);b=phone_helpers.get_example_mobile_number(c);return $j("label",d).text(_("Example: ")+b)}},reset_phone_field_and_backup_country:function(b){var a;this.reset_phone_field(b);if($j("#backup-phone-number").val()===""){a=$j("#twofactor-enter-backup-phone #country-code");a.val(b.element().getValue());return this.fill_example_phone_number(a,$j(".sick-input",a[0].form))}}};var DBLocalStorage,PseudoLocalStorage,dbstore;PseudoLocalStorage={_store:{},getItem:function(a){return this._store[a]},setItem:function(a,b){return this._store[a]=b},removeItem:function(a){return delete this._store[a]},clear:function(){return this._store={}}};dbstore=Modernizr.localstorage?window.localStorage:PseudoLocalStorage;DBLocalStorage={_access_order_key:"ao",_get_access_order:function(){var a;a=dbstore.getItem(this._access_order_key);try{a=Util.from_json(a)}catch(b){a=[]}if(a instanceof Array){return a}else{return[]}},_to_key:function(a){return Util.to_json(a)},attemptWrite:function(g,d){var j,c,e,h,f,k,b;j=0;c=10;f=0;b=[];while(j<c&&!f){e=this._get_access_order();e.push(g);try{dbstore.setItem(g,d);dbstore.setItem(this._access_order_key,Util.to_json(e));f=1}catch(a){h=this._get_access_order();if(h.length){k=h.shift();dbstore.removeItem(k);dbstore.setItem(this._access_order_key,Util.to_json(h))}else{dbstore.clear()}}b.push(j+=1)}return b},getItem:function(b){var c,a,d;b=this._to_key(b);d=dbstore.getItem(b);if(d){c=this._get_access_order();c.removeItem(b);c.push(b);dbstore.setItem(this._access_order_key,Util.to_json(c));a=Util.from_json(d);return a}},setItem:function(a,b){return this.attemptWrite(this._to_key(a),Util.to_json(b))},removeItem:function(a){var b;a=this._to_key(a);b=this._get_access_order();b.removeItem(a);dbstore.setItem(this._access_order_key,Util.to_json(b));return dbstore.removeItem(a)},clear:function(){return dbstore.clear()}};var FileViewer;FileViewer={KEY_SCOPE:"fileviewer",file:null,last_file:null,has_preview:false,shown:false,is_loaded:false,has_key_listener:false,show:function(b){var a,c;this.file=b;if(!this.file){if(!this.last_file){window.history.go(-1);return}this.file=this.last_file}this.shown=true;a=DBHistory.deconstruct_url(DBHistory.get_url());if(a.path.indexOf("/view/")!==0){DBHistory.push_state("/view"+a.path,a.qargs)}this._render_viewer();this._listen();c=$j("#file-viewer").show();return c.trigger("preview-show",{file:this.file})},_log_view:function(){var a;a={mode:"file-preview",file_ext:FileOps.file_extension_for_logging(this.file.filename),preview_type:this.file.preview_type,has_preview:this.has_preview&&this.file.bytes>0,has_pdf_preview:this.file.has_pdf_preview,file_bytes:this.file.bytes};return UserActivityLogger.log("web","file_view",Util.to_json(a))},_render_viewer:function(){var a,b;$j("html").addClass("no-scroll");$j("body").addClass("full_no_overflow");b=$j("#file-viewer");a=""+this.file.href+"&dl=1";this.has_preview=(this.file.preview_type==="text"&&this.file.bytes<Constants.MAX_TEXT_FILE_SIZE_B)||(this.file.preview_type==="doc"&&this.file.has_pdf_preview&&this.file.bytes<Constants.MAX_DOC_FILE_SIZE_B);this._log_view();if(this.has_preview&&this.file.bytes>0){b.find(".title-bar .filename").text(this.file.filename.snippet(70));b.addClass("has-preview");if(this.file.htmlified_link){b.addClass("markdown-preview")}else{if(this.file.code_class){b.addClass("code-preview")}else{b.addClass(""+this.file.preview_type+"-preview")}}b.find(".loading").show();this._render_preview();b.find(".download-img-button").attr({href:a})}else{b.find(".title-bar .filename").text(this.file.filename.snippet(40));b.addClass("no-preview");b.find(".file-thumbnail img").attr({src:"/static/images/icons128/"+(FileOps.filename_to_icon(this.file.filename))+".png"});b.find(".file-type").text(this.file.get_category().capitalize());b.find(".file-size").text(this.file.size);b.find(".file-modified").text(this.file.ago);b.find(".download-button").attr({href:a})}return this._initial_resize()},_remove_loading:function(){$j("#file-viewer .loading").hide();return this.is_loaded=true},_initial_resize:function(){if(this.is_loaded){return}return setTimeout($j.proxy(this._resize,this),100)},_render_preview:function(){var d,j,c,f,b,h,g,a,e=this;f=$j("#file-viewer .preview");if(this.file.preview_type==="text"&&!this.file.htmlified_link){a=$j("<div/>",{id:"code-wrapper"});a.append($j("<pre/>",{id:"code","class":this.file.code_class||"plain-text"}));f.append(a);window.addEventListener("message",function(k){if(k.data==="syntax.js"){FilePreview.init_text(e.file.href,true,$j.proxy(e._remove_loading,e));return window._syntax_js_loaded=true}});if(!window._syntax_js_loaded){Util.async_load_script("/static/javascript/external/syntax.js");return Util.async_load_css("/static/css/syntax.css")}else{return FilePreview.init_text(this.file.href,true,$j.proxy(this._remove_loading,this))}}else{if(this.file.htmlified_link){d=$j("<iframe/>",{src:this.file.htmlified_link});f.append(d);return d.on("load",this._remove_loading)}else{if(this.file.preview_type==="doc"){b=Util.add_qstring(this.file.href,{disable_range:1,convert_doc_to_pdf:1});if(Constants.PDF_PREVIEW_MODE==="pdf-js"){if(!window.PDFJS||!window.PDFView){Util.async_load_script(VflMap.pdfjs_compatibility);Util.async_load_script(VflMap.pdfjs_worker);Util.async_load_script(VflMap.pdfjs_viewer);Util.async_load_css(Util.remove_protocol_and_host(VflMap.pdfjs_css))}h=$j("<div/>",{id:"viewerContainer"});h.html($j("<div/>",{id:"viewer"}));c=$j("<div/>",{id:"loadingBox",style:"display: none"});c.append($j("<div/>",{id:"loading"}));j=$j("<div/>",{id:"loadingBar"});j.html($j("<div/>",{"class":"progress"}));c.append(j);f.append(h);f.append(c);g=function(){if(!window.PDFJS||!window.PDFView){window.setTimeout(g,100);return}PDFView.initialize();PDFJS.workerSrc=Util.remove_protocol_and_host(VflMap.pdfjs_worker);if(Util.cors_supported()){PDFView.open(b,0)}else{Util.add_script(Util.add_qstring(b,{js_callback:"got_text",binary:"1",b64:"1"}));window.got_text=function(k){var p,l,m,o,n;p=Util.decode_b64(k,true);m=new Uint8Array(p.length);for(l=o=0,n=p.length;0<=n?o<=n:o>=n;l=0<=n?++o:--o){m[l]=p.charCodeAt(l)}return PDFView.open(m)}}return e._remove_loading()};return window.setTimeout(g,0)}else{d=$j("<iframe/>",{src:b});f.append(d);return d.on("load",this._remove_loading)}}}}},_listen:function(){var a;DBHistory.add_exit_callback("/view",function(){return FileViewer._hide()});a=$j("#file-viewer");a.on("click",$j.proxy(this._back,this));a.find("#file-viewer-container").on("click",function(b){return b.stopPropagation()});a.find(".close-img-button").on("click",$j.proxy(this._back,this));if(!this.has_key_listener){key("esc",this.KEY_SCOPE,$j.proxy(this._back,this));this.has_key_listener=true}key.setScope(this.KEY_SCOPE);if(this.has_preview){a.find(".share-img-button").on("click",$j.proxy(this._share,this))}else{a.find(".share-button").on("click",$j.proxy(this._share,this))}return $j(window).on("resize",$j.proxy(this._resize,this))},_unlisten:function(){var a;a=$j("#file-viewer");a.off("click",$j.proxy(this._back,this));a.find("#file-viewer-container").off("click",function(b){return b.stopPropagation()});a.find(".close-img-button").off("click",$j.proxy(this._back,this));if(this.has_preview){a.find(".share-img-button").off("click",$j.proxy(this._share,this))}else{a.find(".share-button").off("click",$j.proxy(this._share,this))}return $j(window).off("resize",$j.proxy(this._resize,this))},_resize:function(b){var a,c;c=$j("#file-viewer");a=c.find("#file-viewer-container").height()-(c.find(".title-bar").height()+1);c.find(".preview").height(a);return c.trigger("height-resize",{height:a})},_share:function(a){a.preventDefault();return Forms.postRequest("/sm/create"+Util.urlquote(this.file.fq_path),{},{target:"_blank"})},_back:function(a){if(a!=null){a.stopPropagation()}if(a!=null){a.preventDefault()}if($j.browser.msie&&this.file.preview_type==="doc"){if(parseInt($j.browser.version)===9){return window.location.replace("/home#!"+(window.location.hash.slice(7)))}else{return window.history.replaceState(null,null,DBHistory.get_url().slice(5))}}else{return window.history.go(-1)}},_hide:function(){var a;BrowseSelection.set_selected_files(this.file);a=$j("#file-viewer");$j("html").removeClass("no-scroll");$j("body").removeClass("full_no_overflow");a.hide().removeClass("has-preview").removeClass("no-preview");a.find(".preview").empty();if(this.has_preview){this.has_preview=false}else{a.find(".file-thumbnail img").attr({src:""});a.find(".file-size").text("")}a.find(".file-thumbnail img").attr({src:""});a.find(".title-bar .filename").text("");a.attr({"class":""});this._unlisten();this._remove_loading();this.last_file=this.file;this.file=null;this.shown=false;return this.is_loaded=false}};var Index;Index={init:function(a){var c,b,d,e;if(!FlashDetect.versionAtLeast(9)&&!Util.supports_video()){d=$j("#take-tour");d.show();WebMiscActivityLogger.log("take_tour_shown",{session_id:Constants.sess_id});d.on("click",function(){return window.location.href="/tour"})}else{b=$j("#play-video");b.show();WebMiscActivityLogger.log("commoncraft_video_shown",{session_id:Constants.sess_id});c=b.find("img");c.hover((function(){return c.fadeTo(0.2,1)}),(function(){return c.fadeTo(0.2,0.8)}));e=$j("<div />",{id:"video-container",style:"display:none"})[0];b.on("click",function(){var g,h,f;Modal.onHide=function(){$j("#video-container").empty();Modal.onHide=null;return Modal.hide()};f=900;g=1;h=f+2*g;Modal.show("",e,false,false,h,false,"landing-page-modal");Index.showScreencast("video-container",true,f);return false})}if(a.lastname_goes_first){$j("#lname").focus()}else{$j("#fname").focus()}},showScreencast:function(e,j,c){var b,g,d,k,h,a,f;a=localized_path("https://scast.s3.amazonaws.com/cc/dropbox_intro.mp4",["de","es","es_ES","fr","id","it","ja","ko","ms","pl","pt_BR","ru","zh_CN","zh_TW"]);d="/static/images/cc_endframe_en.jpg";h=352/640;if((f=Constants.USER_LOCALE)==="ms"||f==="id"){h=352/626}k=parseInt(h*c,10);$j("#"+e).height(k);g="commoncraft-embed";b=new Element("div",{id:g,style:"display: inline-block;"});$(e).__date(b);VideoUtil.embed("#"+g,{src:a,type:"video/mp4",width:c,height:k,controls:true,preload:"auto",poster:d,autoplay:j});WebMiscActivityLogger.log("commoncraft_video_view")}};var VflMap;VflMap={};var BatchThumbLoader;BatchThumbLoader={MAX_THUMB_BATCH_REQUESTS:24,MAX_URL_LENGTH:6000,batch_load_thumbs_queue:[],num_pending_batch_requests:0,batch_load_thumbs:function(c,d,f,b){var h,g,e,a;g=[];for(e=0,a=c.length;e<a;e++){h=c[e];if(h.hasAttribute("data-src")){if(Prototype.BrowserFeatures.DB_CORS&&Constants.BATCH_THUMB_ENDPOINTS.length){g.push(h);if(g.length===d){this.batch_load_thumbs_queue.push(g);g=[]}}else{Util.thumb_load(h,f)}}}if(g.length){this.batch_load_thumbs_queue.push(g)}if(this.num_pending_batch_requests<this.MAX_THUMB_BATCH_REQUESTS){return this._do_batch_load(f,b)}},_do_batch_load:function(f,n){var p,d,l,e,g,b,o,k,a,c,h,m,j=this;if(this.batch_load_thumbs_queue.length===0){return}e=this.batch_load_thumbs_queue.first();this.batch_load_thumbs_queue=this.batch_load_thumbs_queue.slice(1);g=[];l=[];for(h=0,m=e.length;h<m;h++){d=e[h];if(d.hasAttribute("data-src")){a=d.readAttribute("data-src");d.removeAttribute("data-src");d.writeAttribute("loading-src",a);a=a.replace(/https?:\/\/[^\/]+\//,"/");g.push(a);l.push(d)}}if(!g.length){return}p=Constants.BATCH_THUMB_ENDPOINTS[Math.abs(Util.string_hash(Util.to_json(g))%Constants.BATCH_THUMB_ENDPOINTS.length)];c=p+"?image_urls="+encodeURIComponent(Util.to_json(g));b=(c.length<this.MAX_URL_LENGTH?"get":"post");k=function(B,y){var x,C,z,D,w,A,v,u,s,r,q,t;if(y==null){y=false}if(!B.responseText){return}D=B.responseText.split("\n");if(D.length<2){return}D.splice(D.length-1);w=function(G,F,E){if(!E){G.observe("load",function(H){return typeof f==="function"?f(G):void 0});G.observe("error",function(H){var I;I=Sprite.SPACER;if(G.hasAttribute("data-fail-src")){I=G.readAttribute("data-fail-src")}return G.writeAttribute("src",I)})}G.writeAttribute("src",F);G.removeAttribute("loading-src");if(E){return typeof f==="function"?f(G):void 0}};for(z=u=0,r=D.length;u<r;z=++u){C=D[z];A=C.indexOf(":");if(A===-1){continue}v=C.substring(0,A).split("-");x=parseInt(v[0],10);C=C.substring(A+1);d=l[x];if(!d||!d.hasAttribute("loading-src")){continue}if(C.indexOf("data:image")!==0){w(d,d.getAttribute("loading-src"),false);continue}w(d,C,true);if(typeof n==="function"){n(z,l.length)}}if(y){t=[];for(s=0,q=e.length;s<q;s++){d=e[s];if(d.hasAttribute("loading-src")){t.push(w(d,d.getAttribute("loading-src"),false))}else{t.push(void 0)}}return t}};this.num_pending_batch_requests++;o={image_urls:Util.to_json(g),parallel:true};new Ajax.DBRequest(p,{method:b,parameters:o,withCredentials:true,allow_retries:true,onInteractive:k,onSuccess:function(q){return k(q,true)},onComplete:function(){j.num_pending_batch_requests--}});return this._do_batch_load(f,n)}};var EventsFull;EventsFull={_first_event:null,init:function(a){this._first_event=a;if(this._first_event){EventDatePicker.first_event=new Date(this._first_event)}on_script_loaded(function(){EventsFull._listen();return EventsFull._get_more(0)});this.more=true;Event.observe(window,"scroll",this._window_scroll);return this.SCROLL_OFFSET=50},has_more:function(a){return this.more=a},_window_scroll:function(){var c,b,a;if(!EventsFull.more){return}a=Util.scroll_offsets().top;b=Util.viewport_dimensions().height;c=document.body.getHeight();if(a+b+Scroll.SCROLL_OFFSET>=c){return EventsFull._get_more()}},_get_more:function(b){var a;a=b!=null?b:(parseInt(Feed.page_num,10)||0)+1;return Feed.getPage(a)},load_more_if_needed:function(){if(Util.viewport_dimensions().height>=document.body.getHeight()&&EventsFull.more){return EventsFull._get_more()}},history_change:function(e,f){var b,a,d,c;a=f.ns;c=f.s;d=f.n;b=f.d;return Feed.url_check(a,d,b)},_listen:function(){DBHistory.add_callback("/events",EventsFull.history_change);return $("namespace-list-container").observe("db:change",this._set_feed_url.bind(this))},_set_feed_url:function(a){return Feed.set_url({ns_id:a.memo,page_num:0})},update_rss_button_title:function(){var b,a;b=$j("#namespace-list-container").find("li.selected").text();a=_("Subscribe to %(folder_name)s changes feed").format({folder_name:b});return $j("#rss-feed a").attr("data-title",a)}};var UserNotifier;UserNotifier={THUMBS_BATCH_SIZE:16,USER_NOTIFICATION_STATUS_UNREAD:0,USER_NOTIFICATION_STATUS_READ:1,USER_NOTIFICATION_STATUS_INVISIBLE:2,FEED_ROW_HEIGHT:49,MAX_NUM_ROWS:100,NUM_ROWS_TO_INITIALIZE:5,NUM_ROWS_TO_APPEND:10,_acked:{},_num_event_rows:0,_latest_nid:0,_feed:[],_unread_count:0,_thumb_cache:{},init:function(){this._num_event_rows=this.NUM_ROWS_TO_INITIALIZE;this.refresh_feed();$j("#event-feed").on("click",this._mouseclick.bindAsEventListener(this));$j("#event-feed").on("mousemove",this._mousemove.bindAsEventListener(this));this._has_acked=false;return this._shown={}},_mouseclick:function(f){var b,d,c,a;d=$j(f.target);if(d.is("a")){if(d.hasClass("option")){f.preventDefault();b=d.attr("data-mount");c=parseInt(d.attr("data-nsid",10));return Sharing.get_sharing_options(b)}else{if(d.hasClass("view")){f.preventDefault();a=d.attr("data-mount");return window.open(a)}}}},_mousemove:function(){if(!this._has_acked&&this._unread_count>0){this._ack();return this._has_acked=true}},_append_event_rows:function(s){var a,q,k,f,e,u,l,b,n,m,h,r,g,o,c,t,j,d,p=this;if(s==null){s=false}this._has_acked=false;if(s){$j("#event-feed").empty();for(e in this._shown){delete this._shown[e]}if(this._num_event_rows===this._feed.length-1&&this._num_event_rows<this.NUM_ROWS_TO_INITIALIZE){this._num_event_rows=this._feed.length}}else{this._num_event_rows+=this.NUM_ROWS_TO_APPEND}this._num_event_rows=Math.min(this._num_event_rows,this._feed.length);r=$j(".feed-row").size();b=$j("#event-feed-more").length?$j("#event-feed-more").detach():false;a=[];j=this._feed;for(c=0,t=j.length;c<t;c++){m=j[c];if(r>=this._num_event_rows){break}e=this._identifier(m.type_id,m.target_object_key);if(e in this._shown){continue}this._shown[e]=true;o=m.status;k=$j(m.notification_div);$j("#event-feed").append(k);r++;l=k.find("img");u=l.get(0);if(u){q=$j(u).attr("data-src");if(q){if(q in this._thumb_cache&&!(this._thumb_cache[q]===e)){n=this._thumb_cache[q];$j(u).attr("src",n);if(!n.endsWith(Sprite.SPACER)){this._add_thumbnail_frame($j(u))}}else{this._thumb_cache[e]=q;a.push($(u))}}}if(o===this.USER_NOTIFICATION_STATUS_INVISIBLE){k.addClass("invisible");if(e in this._acked){delete this._acked[e]}}else{if(o===this.USER_NOTIFICATION_STATUS_READ){if(!(e in this._acked)){k.addClass("read")}}}}g=function(x){var v,w;if(!x.src.endsWith(Sprite.SPACER)){p._add_thumbnail_frame($j(x));e=$j(x).closest(".feed-row").data("identifier");w=p._thumb_cache[e];v=$j(x).attr("src");delete p._thumb_cache[e];return p._thumb_cache[w]=v}};BatchThumbLoader.batch_load_thumbs(a,this.THUMBS_BATCH_SIZE,g);this.update_unread_nots_count();f=this._num_event_rows<this._feed.length;if($j(".feed-row").length===0){$j("#event-feed-container").removeClass("show");return $j("#old-event-feed-header").addClass("no-events")}else{$j("#event-feed-container").addClass("show");$j("#old-event-feed-header").removeClass("no-events");h=(d=this._num_event_rows+f)!=null?d:{1:0};$j("#event-feed-container").height(h*this.FEED_ROW_HEIGHT-1);if(!b){b=$j("<div id='event-feed-more'><a href='#'></a></div>");b.find("a").text(_("See more"));b.on("click",function(v){v.preventDefault();return p._append_event_rows(false)})}b.appendTo($j("#event-feed"));if(f){return b.addClass("show")}else{return b.removeClass("show")}}},_add_thumbnail_frame:function(a){$j(a).addClass("thumbnail");return $j(a).parent(".feed-thumbnail").addClass("has-frame")},longpoll:function(){var a=this;return Notserver.subscribe(Constants.SUBSCRIBE_URL,{onUser:function(){return UserNotifier.refresh_feed()},cursorForUser:UserNotifier._latest_nid})},refresh_feed:function(){var a=this;if($j("#event-feed-container").size()){return new Ajax.DBRequest("/web/notifications/user/retrieve",{parameters:{count:this.MAX_NUM_ROWS},onSuccess:function(b){var c;c=Util.from_json(b.responseText);if(c.notifications){a._latest_nid=c.latest_nid;a._feed=c.notifications;return a._append_event_rows(true)}},onComplete:function(){return a.longpoll()}})}},update_unread_nots_count:function(){var a=this;return new Ajax.DBRequest("/web/notifications/user/unread_notifications",{onSuccess:function(h){var f,g,k,d,e,b,j,c;e=Util.from_json(h.responseText);a._latest_nid=e.latest_nid;a._unread_count=e.notifications.length;k=0;for(f in a._acked){k++}c=e.notifications;for(b=0,j=c.length;b<j;b++){d=c[b];g=a._identifier(d.type_id,d.target_object_key);if(!(g in a._acked)){k++}}return Subscriber.update_jewel_with_unread_count(k)}})},_identifier:function(b,a){return""+b+" "+a},_ack:function(){var a=this;return new Ajax.DBRequest("/web/notifications/user/ack_all",{onSuccess:function(e){var d,g,h,f,c,b;h=Util.from_json(e.responseText);b=[];for(f=0,c=h.length;f<c;f++){g=h[f];d=a._identifier(g.type_id,g.target_object_key);b.push(a._acked[d]=true)}return b}})}};var InstallBar,TopNotificationBar,UnsupportedBrowser;TopNotificationBar={SHOW_EVENT:"db:topnotificationbar:show",HIDE_EVENT:"db:topnotificationbar:hide",show:function(){var b,a;b=$j("#top-notification-bar-container");a=b.find(".top-notification-bar").attr("data-style-class");b.addClass(a).show();$j("#outer-frame").addClass("top-notification-bar");return $j(document).trigger(this.SHOW_EVENT)},hide:function(){$j("#top-notification-bar-container").hide();$j("#outer-frame").removeClass("top-notification-bar");return $j(document).trigger(this.HIDE_EVENT)}};InstallBar={init:function(a){var b=this;if(a==null){a=false}if(a){$j("#top-notification-bar-container").addClass("dismiss")}$j("#complete-setup-dismiss-link").on("click",function(c){c.preventDefault();TopNotificationBar.hide();return GrowthWebActivityLogger.log("install-bar-dismiss")});return $j("#complete-setup-button").on("click",function(c){return GrowthWebActivityLogger.log("install-bar-click")})}};UnsupportedBrowser={init:function(){var a=this;return $j("#unsupported-browser-dismiss").on("click",function(b){b.preventDefault();TopNotificationBar.hide();return new Ajax.DBRequest("/dismiss_browser_msg")})}};var handler,listener,_i,_j,_len,_len1,_ref,_ref1;Util.smart_window_load(function(){var b,a;b=$("footer");if(b){a=(b.getStyle("display")==="none")||(b.getWidth()<900);if(!a){return assert(false,"HTML Broken on "+window.location.pathname)}}});if(window._document_observe_listeners){_ref=window._document_observe_listeners;for(_i=0,_len=_ref.length;_i<_len;_i++){listener=_ref[_i];if(document.loaded){listener.func()}else{document.observe(listener.event,listener.func)}}}if(window._jquery_ready_handlers){_ref1=window._jquery_ready_handlers;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){handler=_ref1[_j];$j(handler)}}Util.smartLoad(function(){Event.fire(document,"script:loaded");return $(document.body).removeClassName("deferred-resources")});window.LoadedJsSuccessfully=true;